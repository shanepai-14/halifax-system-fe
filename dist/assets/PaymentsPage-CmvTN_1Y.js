import{j as e,Q as be,aC as fe,S as Pe,a$ as Ce,r as l,G as a,C as v,x as y,T as r,q as b,E as N,I as w,F as G,P as De,b0 as Se,b1 as _e,b2 as Re,b3 as K,y as F}from"./index-DNRk7xG9.js";import{u as Te,R as we,P as Fe}from"./PaymentReceipt-DsA-toyR.js";import{a as C,b as s,T as f,S as Q,c as Ie,d as Ve,e as ke,f as Me}from"./TextField-qX0ABBN6.js";import{S as d}from"./Skeleton-DAk-Yb6A.js";import{C as ze}from"./Container-zwVJ-3zC.js";import{R as Ae}from"./SearchOutlined-D082z98Y.js";import{R as We}from"./FilterOutlined-C0j4b3fN.js";import{I as J,B as I}from"./InputLabel-DVcin1Fw.js";import{M as c}from"./MenuItem-B1LMWmDD.js";import{R as Ee}from"./DeleteOutlined-CmJcso-p.js";import{T as Oe}from"./TablePagination-DjQt2_7v.js";import{D as U}from"./Dialog-CJApJnGB.js";import"./index-DifcCCYm.js";import"./PrinterOutlined-DGNdqUgd.js";import"./CloseOutlined-B_XHIcrp.js";const Be=()=>e.jsxs(C,{children:[e.jsx(s,{children:e.jsx(d,{variant:"text",width:"90%",height:20})}),e.jsx(s,{children:e.jsx(d,{variant:"text",width:"90%",height:20})}),e.jsx(s,{children:e.jsx(d,{variant:"text",width:"90%",height:20})}),e.jsx(s,{children:e.jsx(d,{variant:"text",width:"90%",height:20})}),e.jsx(s,{children:e.jsx(d,{variant:"text",width:"90%",height:20})}),e.jsx(s,{align:"right",children:e.jsx(d,{variant:"text",width:"90%",height:20})}),e.jsx(s,{children:e.jsx(d,{variant:"rounded",width:70,height:22})}),e.jsx(s,{children:e.jsx(d,{variant:"text",width:"90%",height:20})}),e.jsx(s,{align:"right",children:e.jsx(d,{variant:"rounded",width:90,height:30})})]}),P=o=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2}).format(o),X=o=>o?new Date(o).toLocaleDateString("en-PH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",qe=o=>({cash:"Cash",credit_card:"Credit Card",debit_card:"Debit Card",cheque:"Cheque",bank_transfer:"Bank Transfer",online:"Online Payment",mobile_payment:"Mobile Payment",store_credit:"Store Credit"})[o]||o,rt=()=>{var B,q,L,$;const o=be(),h=fe(),n=Pe(Ce),{payments:x,isLoading:D,getAllPayments:Y,getPaymentStats:Z,voidPayment:ee}=Te(),[S,_]=l.useState(0),[j,te]=l.useState(10),[V,se]=l.useState(n.searchTerm),[re,k]=l.useState(null),[ae,M]=l.useState(!1),[ne,z]=l.useState(!1),[m,A]=l.useState(""),[u,W]=l.useState(null),[p,ie]=l.useState({total_payments:0,total_amount:0,total_voided:0,voided_amount:0});l.useEffect(()=>{R()},[n.paymentMethodFilter,n.statusFilter,n.startDate,n.endDate]);const R=async()=>{const t={payment_method:n.paymentMethodFilter!=="all"?n.paymentMethodFilter:void 0,status:n.statusFilter!=="all"?n.statusFilter:void 0,date_from:n.startDate||void 0,date_to:n.endDate||void 0,search:n.searchTerm||void 0};await Y(t);const i={date_from:t.date_from,date_to:t.date_to},g=await Z(i);g&&ie(g)},le=(t,i)=>{_(i)},oe=t=>{te(parseInt(t.target.value,10)),_(0)},de=t=>{se(t.target.value)},E=()=>{h(Se(V)),_(0),R()},ce=t=>{t.key==="Enter"&&E()},he=t=>{h(_e(t.target.value))},xe=t=>{h(Re(t.target.value))},me=t=>{h(K({startDate:t.target.value,endDate:n.endDate}))},ue=t=>{h(K({startDate:n.startDate,endDate:t.target.value}))},je=t=>{o(`/app/delivery-report/${t}`)},ge=t=>{const i={payment:t,sale:t.sale};k(i),M(!0)},O=()=>{M(!1),k(null)},pe=t=>{W(t),z(!0)},T=()=>{z(!1),A(""),W(null)},ve=async()=>{if(m.trim())try{await ee(u.id,m),T(),R()}catch(t){console.error("Error voiding payment:",t)}};console.log(x);const ye=t=>t==="completed"?e.jsx(F,{label:"Completed",color:"success",size:"small"}):t==="voided"?e.jsx(F,{label:"Voided",color:"error",size:"small"}):e.jsx(F,{label:t,size:"small"});return e.jsxs(ze,{maxWidth:"xxl",sx:{mt:0,p:"0!important"},children:[e.jsxs(a,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(v,{children:e.jsxs(y,{children:[e.jsx(r,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:"Total Payments"}),e.jsx(r,{variant:"h4",children:p.total_payments||0}),e.jsx(r,{variant:"caption",color:"text.secondary",children:"For the selected date range"})]})})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(v,{children:e.jsxs(y,{children:[e.jsx(r,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:"Total Amount"}),e.jsx(r,{variant:"h4",children:P(p.total_amount||0)}),e.jsx(r,{variant:"caption",color:"text.secondary",children:"For the selected date range"})]})})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(v,{children:e.jsxs(y,{children:[e.jsx(r,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:"Voided Payments"}),e.jsx(r,{variant:"h4",children:p.total_voided||0}),e.jsx(r,{variant:"caption",color:"text.secondary",children:"For the selected date range"})]})})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(v,{children:e.jsxs(y,{children:[e.jsx(r,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:"Voided Amount"}),e.jsx(r,{variant:"h4",children:P(p.voided_amount||0)}),e.jsx(r,{variant:"caption",color:"text.secondary",children:"For the selected date range"})]})})})]}),e.jsx(b,{sx:{mb:3},children:e.jsxs(a,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(f,{fullWidth:!0,placeholder:"Search by reference or invoice",variant:"outlined",size:"small",value:V,onChange:de,onKeyPress:ce,InputProps:{startAdornment:e.jsx(N,{position:"start",children:e.jsx(Ae,{})}),endAdornment:e.jsx(N,{position:"end",children:e.jsx(w,{onClick:E,size:"small",children:e.jsx(We,{})})})}})}),e.jsx(a,{item:!0,xs:6,md:2,children:e.jsxs(G,{fullWidth:!0,size:"small",children:[e.jsx(J,{children:"Payment Method"}),e.jsxs(Q,{value:n.paymentMethodFilter,onChange:he,label:"Payment Method",children:[e.jsx(c,{value:"all",children:"All Methods"}),e.jsx(c,{value:"cod",children:"COD"}),e.jsx(c,{value:"cash",children:"Cash"}),e.jsx(c,{value:"cheque",children:"Cheque"}),e.jsx(c,{value:"online",children:"Online Payment"})]})]})}),e.jsx(a,{item:!0,xs:6,md:2,children:e.jsxs(G,{fullWidth:!0,size:"small",children:[e.jsx(J,{children:"Status"}),e.jsxs(Q,{value:n.statusFilter,onChange:xe,label:"Status",children:[e.jsx(c,{value:"all",children:"All Status"}),e.jsx(c,{value:"completed",children:"Completed"}),e.jsx(c,{value:"voided",children:"Voided"})]})]})}),e.jsx(a,{item:!0,xs:6,md:2,children:e.jsx(f,{label:"Start Date",type:"date",value:n.startDate,onChange:me,InputLabelProps:{shrink:!0},size:"small",fullWidth:!0})}),e.jsx(a,{item:!0,xs:6,md:2,children:e.jsx(f,{label:"End Date",type:"date",value:n.endDate,onChange:ue,InputLabelProps:{shrink:!0},size:"small",fullWidth:!0,inputProps:{min:n.startDate}})}),e.jsx(a,{item:!0,xs:6,md:1,children:e.jsx(I,{variant:"contained",size:"small",children:"Export"})})]})}),e.jsx(Ie,{component:De,children:e.jsxs(Ve,{size:"small",children:[e.jsx(ke,{children:e.jsxs(C,{children:[e.jsx(s,{children:"Date & Time"}),e.jsx(s,{children:"Reference #"}),e.jsx(s,{children:"Invoice #"}),e.jsx(s,{children:"Customer"}),e.jsx(s,{children:"Payment Method"}),e.jsx(s,{align:"right",children:"Amount"}),e.jsx(s,{children:"Status"}),e.jsx(s,{children:"Received By"}),e.jsx(s,{align:"right",children:"Actions"})]})}),e.jsx(Me,{children:D?Array(j).fill(0).map((t,i)=>e.jsx(Be,{},i)):x&&((B=x.data)==null?void 0:B.length)>0?(q=x.data)==null?void 0:q.slice(S*j,S*j+j).map(t=>{var i,g;return e.jsxs(C,{sx:{backgroundColor:t.status==="voided"?"#fff8f8":"inherit"},children:[e.jsx(s,{children:X(t.payment_date)}),e.jsx(s,{children:t.reference_number}),e.jsx(s,{children:e.jsx(r,{variant:"body2",sx:{cursor:"pointer",color:"primary.main","&:hover":{textDecoration:"underline"}},onClick:()=>{var H;return je((H=t.sale)==null?void 0:H.id)},children:(i=t.sale)==null?void 0:i.invoice_number})}),e.jsx(s,{children:(g=t.sale)!=null&&g.customer?typeof t.sale.customer=="object"?t.sale.customer.customer_name:t.sale.customer:"Walk-in Customer"}),e.jsx(s,{children:qe(t.payment_method)}),e.jsx(s,{align:"right",children:P(t.amount)}),e.jsx(s,{children:ye(t.status)}),e.jsx(s,{children:typeof t.received_by=="object"?t.received_by.customer_name:t.received_by||"System"}),e.jsxs(s,{align:"right",children:[e.jsx(w,{size:"small",color:"primary",onClick:()=>ge(t),title:"View Receipt",children:e.jsx(we,{})}),t.status==="completed"&&e.jsx(w,{size:"small",color:"error",onClick:()=>pe(t),title:"Void Payment",children:e.jsx(Ee,{})})]})]},t.id)}):e.jsx(C,{children:e.jsx(s,{colSpan:9,align:"center",children:e.jsx(r,{variant:"body1",sx:{py:2},children:"No payments found"})})})})]})}),e.jsx(Oe,{rowsPerPageOptions:[5,10,25,50],component:"div",count:x?(L=x.data)==null?void 0:L.length:0,rowsPerPage:j,page:S,onPageChange:le,onRowsPerPageChange:oe}),e.jsx(U,{open:ae,onClose:O,maxWidth:"md",fullWidth:!0,children:e.jsx(Fe,{receipt:re,onClose:O})}),e.jsx(U,{open:ne,onClose:T,maxWidth:"sm",fullWidth:!0,children:e.jsxs(b,{sx:{p:3},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Void Payment"}),e.jsx(r,{variant:"body2",sx:{mb:2},children:"Are you sure you want to void this payment? This action cannot be undone."}),u&&e.jsx(b,{sx:{mb:3,p:2,bgcolor:"background.level1",borderRadius:1},children:e.jsxs(a,{container:!0,spacing:1,children:[e.jsx(a,{item:!0,xs:6,children:e.jsx(r,{variant:"body2",children:e.jsx("strong",{children:"Reference:"})})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(r,{variant:"body2",children:u.reference_number})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(r,{variant:"body2",children:e.jsx("strong",{children:"Invoice:"})})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(r,{variant:"body2",children:($=u.sale)==null?void 0:$.invoice_number})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(r,{variant:"body2",children:e.jsx("strong",{children:"Amount:"})})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(r,{variant:"body2",children:P(u.amount)})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(r,{variant:"body2",children:e.jsx("strong",{children:"Date:"})})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(r,{variant:"body2",children:X(u.payment_date)})})]})}),e.jsx(f,{label:"Reason for voiding payment",fullWidth:!0,multiline:!0,rows:3,value:m,onChange:t=>A(t.target.value),required:!0,error:!m.trim(),helperText:m.trim()?"":"Reason is required",margin:"normal",sx:{mb:2}}),e.jsxs(b,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:[e.jsx(I,{onClick:T,sx:{mr:1},children:"Cancel"}),e.jsx(I,{variant:"contained",color:"error",onClick:ve,disabled:!m.trim()||D,children:D?"Processing...":"Void Payment"})]})]})})]})};export{rt as default};
