import{r as u,ar as we,as as _e,j as e,U as g,P as y,K as n,T as a,at as Ce,L as T,a5 as Se,a0 as X,ae as Ie,au as Ae,R as Z,a4 as Re,Z as Y,E as v,X as N,$ as ee,N as te,J as se}from"./index-iwU4FU1d.js";import{u as ke,a as Te,b as Le,c as Pe,d as $e,I as Ne}from"./useInventory-Dyx4hqwJ.js";import{R as oe}from"./WarningOutlined-CuurCzU_.js";import{S as c}from"./Skeleton-BujRsbeW.js";import{C as Fe}from"./Container-D5Ja5zij.js";import{T as De,a as F}from"./Tabs-BzakTJ4d.js";import{T as We,S as re,c as D,d as W,e as z,a as h,b as s,f as q}from"./TextField-DS9zh2A1.js";import{R as ze}from"./SearchOutlined-B9TxrIKJ.js";import{I as ne}from"./InputLabel-c_6Gp7Kp.js";import{M as w}from"./MenuItem-DwVfVTlm.js";import{R as qe}from"./ClearOutlined-DUv6dJMN.js";import{R as Oe}from"./ReloadOutlined-BLvboxUk.js";import{R as Ve}from"./PlusOutlined-BNJ8jXq-.js";import{A as Be}from"./Alert-CjUZgNuH.js";import{R as Ee}from"./EyeOutlined-DjcN5f95.js";import{R as Me}from"./EditOutlined-CUVq75YB.js";import{R as ae}from"./DownloadOutlined-DWSa7IuS.js";import{D as He}from"./Dialog-uw4uRqg7.js";import{D as Ue,a as Ge}from"./DialogTitle-igWtyaEh.js";import"./Autocomplete-D5E8BdEB.js";import"./Close-xmY92Z9x.js";import"./CloseOutlined-Dj8Kfe5V.js";import"./SaveOutlined-DySoedu3.js";import"./KeyboardArrowRight-CJUXje0u.js";var Qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M740 161c-61.8 0-112 50.2-112 112 0 50.1 33.1 92.6 78.5 106.9v95.9L320 602.4V318.1c44.2-15 76-56.9 76-106.1 0-61.8-50.2-112-112-112s-112 50.2-112 112c0 49.2 31.8 91 76 106.1V706c-44.2 15-76 56.9-76 106.1 0 61.8 50.2 112 112 112s112-50.2 112-112c0-49.2-31.8-91-76-106.1v-27.8l423.5-138.7a50.52 50.52 0 0034.9-48.2V378.2c42.9-15.8 73.6-57 73.6-105.2 0-61.8-50.2-112-112-112zm-504 51a48.01 48.01 0 0196 0 48.01 48.01 0 01-96 0zm96 600a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm408-491a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"branches",theme:"outlined"},Je=function(i,m){return u.createElement(we,_e({},i,{ref:m,icon:Qe}))},Ke=u.forwardRef(Je);const Xe=({inventoryData:I=[],stats:i={},isLoading:m=!1})=>{const x=o=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2,maximumFractionDigits:2}).format(o||0),A=()=>e.jsxs(y,{sx:{p:2,height:"100%"},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(c,{width:120,height:30}),e.jsx(c,{variant:"circular",width:40,height:40})]}),e.jsx(c,{width:80,height:60}),e.jsx(T,{sx:{my:2}}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(c,{width:100,height:24}),e.jsx(c,{width:80,height:24})]})]}),b=i.categoriesWithValue?Object.entries(i.categoriesWithValue).sort(([,o],[,j])=>j.value-o.value).map(([o,j])=>({id:o,...j})):[];return e.jsxs(e.Fragment,{children:[e.jsxs(g,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(g,{item:!0,xs:12,sm:6,md:6,children:m?e.jsx(A,{}):e.jsxs(y,{elevation:1,sx:{p:2,height:"100%",borderTop:"4px solid #1976d2",borderRadius:"4px"},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[e.jsx(a,{variant:"subtitle2",color:"text.secondary",children:"Total Inventory"}),e.jsx(n,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:40,height:40,borderRadius:"50%",backgroundColor:"rgba(25, 118, 210, 0.12)"},children:e.jsx(n,{sx:{color:"#1976d2"},children:e.jsx(Ce,{style:{fontSize:24}})})})]}),e.jsx(a,{variant:"h4",sx:{fontWeight:"bold",color:"#1976d2",mb:1},children:i.totalItems||I.length}),e.jsxs(n,{sx:{mt:"auto"},children:[e.jsx(T,{sx:{my:1}}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:"Total Value"}),e.jsx(a,{variant:"body1",fontWeight:"medium",children:x(i.totalValue||0)})]})]})]})}),e.jsx(g,{item:!0,xs:12,sm:6,md:6,children:m?e.jsx(A,{}):e.jsxs(y,{elevation:1,sx:{p:2,height:"100%",borderTop:"4px solid #f44336",borderRadius:"4px"},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[e.jsx(a,{variant:"subtitle2",color:"text.secondary",children:"Low Stock Items"}),e.jsx(n,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:40,height:40,borderRadius:"50%",backgroundColor:"rgba(244, 67, 54, 0.12)"},children:e.jsx(n,{sx:{color:"#f44336"},children:e.jsx(oe,{style:{fontSize:24}})})})]}),e.jsx(a,{variant:"h4",sx:{fontWeight:"bold",color:"#f44336",mb:1},children:i.lowStockItems||0}),e.jsxs(n,{sx:{mt:"auto"},children:[e.jsx(T,{sx:{my:1}}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:"Require Reorder"}),e.jsx(a,{variant:"body1",fontWeight:"medium",children:i.reorderNeeded||0})]})]})]})})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Ke,{style:{fontSize:20,marginRight:8,color:"#4caf50"}}),e.jsx(a,{variant:"h6",children:"Inventory by Category"}),e.jsxs(a,{variant:"body2",color:"text.secondary",sx:{ml:2},children:["(",i.categoryCount||0," categories)"]})]}),e.jsx(g,{container:!0,spacing:2,children:m?Array.from(new Array(4)).map((o,j)=>e.jsx(g,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(A,{})},j)):b.length>0?b.map(o=>e.jsx(g,{item:!0,xs:12,sm:6,md:4,lg:4,children:e.jsxs(y,{elevation:1,sx:{p:2,height:"100%",borderLeft:"4px solid #4caf50",borderRadius:"4px"},children:[e.jsx(a,{variant:"subtitle2",noWrap:!0,title:o.name,sx:{mb:1},children:o.name}),e.jsx(a,{variant:"h5",sx:{fontWeight:"bold",color:"#4caf50",mb:1},children:x(o.value)}),e.jsxs(n,{sx:{mt:"auto"},children:[e.jsx(T,{sx:{my:1}}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:"Items"}),e.jsx(a,{variant:"body1",children:o.count})]})]})]})},o.id)):e.jsx(g,{item:!0,xs:12,children:e.jsx(y,{sx:{p:3,textAlign:"center"},children:e.jsx(a,{color:"text.secondary",children:"No category data available"})})})})]})},ie={low:{color:"error",label:"Low Stock"},normal:{color:"success",label:"Normal"},overstocked:{color:"warning",label:"Overstocked"}},Ze=[{value:"addition",label:"Addition"},{value:"reduction",label:"Reduction"},{value:"damage",label:"Damage"},{value:"loss",label:"Loss"}],O=()=>e.jsxs(h,{children:[e.jsx(s,{children:e.jsx(c,{animation:"wave"})}),e.jsx(s,{children:e.jsx(c,{animation:"wave"})}),e.jsx(s,{children:e.jsx(c,{animation:"wave"})}),e.jsx(s,{children:e.jsx(c,{animation:"wave"})}),e.jsx(s,{children:e.jsx(c,{animation:"wave"})}),e.jsx(s,{children:e.jsx(c,{animation:"wave"})}),e.jsx(s,{align:"right",children:e.jsxs(n,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[e.jsx(c,{animation:"wave",variant:"circular",width:32,height:32}),e.jsx(c,{animation:"wave",variant:"circular",width:32,height:32})]})})]}),_t=()=>{const I=Se(),[i,m]=u.useState(0),[x,A]=u.useState(10),[b,o]=u.useState(""),[j,V]=u.useState("All Categories"),[L,B]=u.useState("All Status"),[le,E]=u.useState(!1),[_,P]=u.useState(null),[R,ce]=u.useState(0),C=X(Ie),M=X(Ae),{data:H=[],isLoading:de,refetch:U}=ke(),{data:G=[],isLoading:xe}=Te(),{mutateAsync:he}=Le(),{data:Q=[],isLoading:ue}=Pe(),{data:je={},isLoading:me}=$e(),f=Z.useMemo(()=>H.map(t=>{const r=C.find(l=>l.id===t.product_id);return{...t,...r,status:pe(t.quantity,(r==null?void 0:r.reorder_level)||0)}}),[H,C]);Z.useMemo(()=>{const t=f.length,r=f.reduce((d,S)=>d+S.quantity*(S.cost_price||0),0),l=f.filter(d=>d.status==="low").length,p=f.filter(d=>d.quantity<=d.reorder_level*.7).length;return{totalItems:t,totalValue:r,lowStockItems:l,reorderNeeded:p,topSellingItems:5,incomingStock:42,inventoryTurnover:4.2,stockAccuracy:98.3}},[f]);const k=f.filter(t=>{var d,S,K;const r=((d=t.product_name)==null?void 0:d.toLowerCase().includes(b.toLowerCase()))||((S=t.product_code)==null?void 0:S.toLowerCase().includes(b.toLowerCase())),l=j==="All Categories"||((K=t.product_category_id)==null?void 0:K.toString())===j,p=L==="All Status"||t.status===L.toLowerCase();return r&&l&&p});function pe(t,r){return t<=r?"low":t>r*3?"overstocked":"normal"}const ye=()=>{o(""),V("All Categories"),B("All Status")},J=t=>{P(t),E(!0)},fe=t=>{P(t)},$=()=>{E(!1),P(null)},ge=async t=>{try{const r={id:t.id,quantity:t.quantity,adjustment_type:t.type,reason:t.reason,notes:t.notes};t.type==="addition"&&(r.distribution_price=t.distribution_price,r.walk_in_price=t.walk_in_price,r.wholesale_price=t.wholesale_price,r.regular_price=t.regular_price),await he(r),se.success("Inventory adjustment recorded successfully"),U(),$()}catch(r){se.error("Error recording adjustment: "+(r.message||"Unknown error"))}},ve=(t,r)=>{ce(r)},be=t=>{I(`/app/inventory/${t}`)};return e.jsxs(Fe,{maxWidth:"xxl",sx:{mt:0,px:"0!important"},children:[e.jsx(Xe,{inventoryData:f,stats:je,isLoading:me}),e.jsxs(n,{sx:{mb:4},children:[e.jsxs(De,{value:R,onChange:ve,sx:{mb:3},children:[e.jsx(F,{label:"Current Inventory"}),e.jsx(F,{label:"Adjustments History"}),e.jsx(F,{label:"Inventory Logs"})]}),R===0&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,gap:2},children:[e.jsxs(n,{sx:{display:"flex",gap:2,flex:1},children:[e.jsx(We,{placeholder:"Search product name or code",variant:"outlined",size:"small",value:b,onChange:t=>o(t.target.value),InputProps:{startAdornment:e.jsx(Re,{position:"start",children:e.jsx(ze,{})})},sx:{minWidth:250}}),e.jsxs(Y,{size:"small",sx:{minWidth:200},children:[e.jsx(ne,{children:"Category"}),e.jsxs(re,{value:j,onChange:t=>V(t.target.value),label:"Category",children:[e.jsx(w,{value:"All Categories",children:"All Categories"}),M.map(t=>e.jsx(w,{value:t.id.toString(),children:t.name},t.id))]})]}),e.jsxs(Y,{size:"small",sx:{minWidth:200},children:[e.jsx(ne,{children:"Stock Status"}),e.jsxs(re,{value:L,onChange:t=>B(t.target.value),label:"Stock Status",children:[e.jsx(w,{value:"All Status",children:"All Status"}),e.jsx(w,{value:"Low",children:"Low Stock"}),e.jsx(w,{value:"Normal",children:"Normal"}),e.jsx(w,{value:"Overstocked",children:"Overstocked"})]})]})]}),e.jsxs(n,{children:[e.jsx(v,{variant:"text",color:"error",sx:{mr:1},onClick:ye,children:e.jsx(qe,{})}),e.jsx(v,{variant:"contained",color:"primary",startIcon:e.jsx(Oe,{}),onClick:()=>U(),sx:{mr:1},children:"Refresh"}),e.jsx(v,{variant:"contained",color:"error",startIcon:e.jsx(Ve,{}),onClick:()=>J({product_id:null}),children:"New Adjustment"})]})]}),k.some(t=>t.status==="low")&&e.jsx(Be,{severity:"warning",sx:{mb:2},icon:e.jsx(oe,{}),children:"Some products are below their reorder levels. Please check and restock as needed."}),e.jsx(D,{component:y,children:e.jsxs(W,{children:[e.jsx(z,{children:e.jsxs(h,{children:[e.jsx(s,{children:"Product Code"}),e.jsx(s,{children:"Product Name"}),e.jsx(s,{children:"Category"}),e.jsx(s,{children:"Current Qty"}),e.jsx(s,{children:"Reorder Level"}),e.jsx(s,{children:"Status"}),e.jsx(s,{align:"right",children:"Actions"})]})}),e.jsx(q,{children:de?Array.from(Array(x)).map((t,r)=>e.jsx(O,{},r)):k.length===0?e.jsx(h,{children:e.jsx(s,{colSpan:7,align:"center",sx:{py:3},children:e.jsx(a,{variant:"body1",color:"text.secondary",children:"No inventory items found"})})}):k.slice(i*x,i*x+x).map(t=>{var r,l,p;return e.jsxs(h,{hover:!0,children:[e.jsx(s,{children:t.product_code}),e.jsx(s,{children:e.jsx(n,{sx:{display:"flex",alignItems:"center"},children:t.product_name})}),e.jsx(s,{children:((r=M.find(d=>d.id===t.product_category_id))==null?void 0:r.name)||"-"}),e.jsx(s,{children:t.quantity}),e.jsx(s,{children:t.reorder_level}),e.jsx(s,{children:e.jsx(N,{label:(l=ie[t.status])==null?void 0:l.label,color:(p=ie[t.status])==null?void 0:p.color,size:"small"})}),e.jsxs(s,{align:"right",children:[e.jsx(ee,{title:"View Product Details",children:e.jsx(te,{onClick:()=>be(t.product_id),children:e.jsx(Ee,{})})}),e.jsx(ee,{title:"Adjust Inventory",children:e.jsx(te,{onClick:()=>J(t),children:e.jsx(Me,{})})})]})]},t.product_id)})})]})}),e.jsxs(n,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:[e.jsx(v,{disabled:i===0,onClick:()=>m(i-1),sx:{mr:1},children:"Previous"}),e.jsx(v,{disabled:i>=Math.ceil(k.length/x)-1,onClick:()=>m(i+1),children:"Next"})]})]}),R===1&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(a,{variant:"h6",children:"Inventory Adjustments History"}),e.jsx(v,{variant:"outlined",startIcon:e.jsx(ae,{}),onClick:()=>console.log("Download adjustments report"),children:"Export Report"})]}),e.jsx(D,{component:y,children:e.jsxs(W,{children:[e.jsx(z,{children:e.jsxs(h,{children:[e.jsx(s,{children:"Date"}),e.jsx(s,{children:"Product"}),e.jsx(s,{children:"Adjustment Type"}),e.jsx(s,{children:"Quantity"}),e.jsx(s,{children:"Reason"}),e.jsx(s,{children:"Performed By"}),e.jsx(s,{children:"Notes"})]})}),e.jsx(q,{children:xe?Array.from(Array(x)).map((t,r)=>e.jsx(O,{},r)):G.length===0?e.jsx(h,{children:e.jsx(s,{colSpan:7,align:"center",sx:{py:3},children:e.jsx(a,{variant:"body1",color:"text.secondary",children:"No adjustment records found"})})}):G.map(t=>{var l;const r=C.find(p=>p.id===t.product_id);return e.jsxs(h,{hover:!0,children:[e.jsx(s,{children:new Date(t.created_at).toLocaleString()}),e.jsx(s,{children:(r==null?void 0:r.product_name)||"Unknown Product"}),e.jsx(s,{children:e.jsx(N,{label:t.adjustment_type.charAt(0).toUpperCase()+t.adjustment_type.slice(1),color:t.adjustment_type==="addition"||t.adjustment_type==="return"?"success":t.adjustment_type==="correction"?"info":"error",size:"small"})}),e.jsx(s,{children:t.adjustment_type==="addition"||t.adjustment_type==="return"?`+${t.quantity}`:`-${t.quantity}`}),e.jsx(s,{children:t.reason}),e.jsx(s,{children:((l=t.user)==null?void 0:l.name)||"System"}),e.jsx(s,{children:t.notes||"-"})]},t.id)})})]})})]}),R===2&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(a,{variant:"h6",children:"Inventory Transaction History"}),e.jsx(v,{variant:"outlined",startIcon:e.jsx(ae,{}),onClick:()=>console.log("Download logs report"),children:"Export Logs"})]}),e.jsx(D,{component:y,children:e.jsxs(W,{children:[e.jsx(z,{children:e.jsxs(h,{children:[e.jsx(s,{children:"Date"}),e.jsx(s,{children:"Product"}),e.jsx(s,{children:"Transaction Type"}),e.jsx(s,{children:"Quantity"}),e.jsx(s,{children:"Reference"}),e.jsx(s,{children:"Before"}),e.jsx(s,{children:"After"})]})}),e.jsx(q,{children:ue?Array.from(Array(x)).map((t,r)=>e.jsx(O,{},r)):Q.length===0?e.jsx(h,{children:e.jsx(s,{colSpan:7,align:"center",sx:{py:3},children:e.jsx(a,{variant:"body1",color:"text.secondary",children:"No inventory logs found"})})}):Q.map(t=>{const r=C.find(l=>l.id===t.product_id);return e.jsxs(h,{hover:!0,children:[e.jsx(s,{children:new Date(t.created_at).toLocaleString()}),e.jsx(s,{children:(r==null?void 0:r.product_name)||"Unknown Product"}),e.jsx(s,{children:e.jsx(N,{label:t.transaction_type.charAt(0).toUpperCase()+t.transaction_type.slice(1),color:t.transaction_type==="purchase"||t.transaction_type==="adjustment_in"?"success":t.transaction_type==="sales"||t.transaction_type==="adjustment_out"?"error":"info",size:"small"})}),e.jsx(s,{children:t.transaction_type==="purchase"||t.transaction_type==="adjustment_in"?`+${t.quantity}`:`-${t.quantity}`}),e.jsx(s,{children:t.reference_type==="purchase_order"?`PO-${t.reference_id}`:t.reference_type==="sales_order"?`SO-${t.reference_id}`:t.reference_type==="adjustment"?`ADJ-${t.reference_id}`:t.reference_id}),e.jsx(s,{children:t.quantity_before}),e.jsx(s,{children:t.quantity_after})]},t.id)})})]})})]})]}),e.jsxs(He,{open:le,onClose:$,maxWidth:"md",fullWidth:!0,children:[e.jsx(Ue,{children:_!=null&&_.product_name?`Adjust Inventory: ${_.product_name}`:"New Inventory Adjustment"}),e.jsx(Ge,{children:e.jsx(Ne,{product:_,products:C,adjustmentTypes:Ze,onSubmit:ge,onCancel:$,onSelectedProduct:fe})})]})]})};export{_t as default};
