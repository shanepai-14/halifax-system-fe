import{V as q,K as L,r as Q,W as F,j as e,M as P,v as n,X as G,T as r,l as A,Y as M,U as K,P as b,G as d,z as I,D as U}from"./index-VYacBzdn.js";import{f as p,a as R}from"./currencyFormat-BsuV9MhS.js";import{R as k}from"./LeftOutlined-BDNxeg2Q.js";import{L as y}from"./Link-C_3rcFug.js";import{R as W}from"./HomeOutlined-BL0nYU_M.js";import{R as X}from"./TeamOutlined-Cr4RwS31.js";import{T as Y,a as D}from"./Tabs-Bx-oxw0i.js";import{b as S,c as N,d as O,T as g,a as s,e as $}from"./TableRow-F8UK-irz.js";import"./KeyboardArrowRight-CWBZhDWc.js";function z(v){const{children:x,value:h,index:j,...f}=v;return e.jsx("div",{role:"tabpanel",hidden:h!==j,id:`simple-tabpanel-${j}`,"aria-labelledby":`simple-tab-${j}`,...f,children:h===j&&e.jsx(n,{sx:{pt:2},children:x})})}const le=()=>{const{supplierId:v}=q(),x=L(),[h,j]=Q.useState(0),{data:f,isLoading:E,isError:V,error:w}=F(v),H=(t,o)=>{j(o)},T=()=>{x("/app/supplier")};if(E)return e.jsx(P,{children:e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"400px"},children:e.jsx(G,{})})});if(V)return e.jsxs(P,{children:[e.jsxs(r,{variant:"h5",color:"error",align:"center",children:["Error: ",w.message||"Failed to load supplier purchase history"]}),e.jsx(n,{sx:{mt:2,textAlign:"center"},children:e.jsx(A,{variant:"contained",onClick:T,startIcon:e.jsx(k,{}),children:"Back to Suppliers"})})]});const{supplier:i,stats:a,items:_,items_by_po:m}=f||{},B=m?Object.keys(m).sort((t,o)=>{var l,u;const c=(l=m[t][0])==null?void 0:l.po_date,C=(u=m[o][0])==null?void 0:u.po_date;return new Date(C)-new Date(c)}):[];return e.jsxs(P,{children:[e.jsxs(M,{sx:{mb:2},children:[e.jsxs(y,{underline:"hover",color:"inherit",sx:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>x("/app/dashboard"),children:[e.jsx(W,{style:{marginRight:8}}),"Dashboard"]}),e.jsxs(y,{underline:"hover",color:"inherit",sx:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>x("/app/supplier"),children:[e.jsx(X,{style:{marginRight:8}}),"Suppliers"]}),e.jsxs(r,{color:"text.primary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(K,{style:{marginRight:8}}),"Purchase History"]})]}),e.jsx(A,{variant:"outlined",startIcon:e.jsx(k,{}),onClick:T,sx:{mb:3},children:"Back to Suppliers"}),e.jsxs(b,{sx:{p:3,mb:4},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,children:"Supplier Details"}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsxs(d,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"subtitle1",children:"Name:"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:(i==null?void 0:i.supplier_name)||"N/A"}),e.jsx(r,{variant:"subtitle1",children:"Contact Person:"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:(i==null?void 0:i.contact_person)||"N/A"})]}),e.jsxs(d,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"subtitle1",children:"Email:"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:(i==null?void 0:i.email)||"N/A"}),e.jsx(r,{variant:"subtitle1",children:"Phone:"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:(i==null?void 0:i.phone)||"N/A"}),e.jsx(r,{variant:"subtitle1",children:"Address:"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:(i==null?void 0:i.address)||"N/A"})]})]})]}),e.jsxs(b,{sx:{p:3,mb:4},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,children:"Purchase Summary"}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,sm:3,children:e.jsxs(n,{sx:{p:2,border:"1px solid #e0e0e0",borderRadius:1,textAlign:"center"},children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Total Orders"}),e.jsx(r,{variant:"h4",sx:{my:1},children:(a==null?void 0:a.total_orders)||0})]})}),e.jsx(d,{item:!0,xs:12,sm:3,children:e.jsxs(n,{sx:{p:2,border:"1px solid #e0e0e0",borderRadius:1,textAlign:"center"},children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Total Items"}),e.jsx(r,{variant:"h4",sx:{my:1},children:(a==null?void 0:a.total_items)||0})]})}),e.jsx(d,{item:!0,xs:12,sm:3,children:e.jsxs(n,{sx:{p:2,border:"1px solid #e0e0e0",borderRadius:1,textAlign:"center"},children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Total Quantity"}),e.jsx(r,{variant:"h4",sx:{my:1},children:(a==null?void 0:a.total_quantity)||0})]})}),e.jsx(d,{item:!0,xs:12,sm:3,children:e.jsxs(n,{sx:{p:2,border:"1px solid #e0e0e0",borderRadius:1,textAlign:"center"},children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Total Value"}),e.jsx(r,{variant:"h4",sx:{my:1},children:p((a==null?void 0:a.total_value)||0)})]})})]})]}),e.jsxs(b,{sx:{p:3},children:[e.jsx(n,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Y,{value:h,onChange:H,"aria-label":"purchase history tabs",children:[e.jsx(D,{label:"All Items",id:"tab-0"}),e.jsx(D,{label:"By Purchase Order",id:"tab-1"})]})}),e.jsxs(z,{value:h,index:0,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"All Purchased Items"}),_&&_.length>0?e.jsx(S,{component:b,variant:"outlined",children:e.jsxs(N,{size:"small",children:[e.jsx(O,{children:e.jsxs(g,{sx:{backgroundColor:"#f5f5f5"},children:[e.jsx(s,{children:"PO Number"}),e.jsx(s,{children:"Product"}),e.jsx(s,{children:"Code"}),e.jsx(s,{children:"Date Received"}),e.jsx(s,{align:"right",children:"Quantity"}),e.jsx(s,{align:"right",children:"Cost Price"}),e.jsx(s,{align:"right",children:"Total"}),e.jsx(s,{children:"Status"})]})}),e.jsx($,{children:_.map((t,o)=>e.jsxs(g,{children:[e.jsx(s,{children:e.jsx(y,{href:"#",onClick:()=>x(`/app/purchase/${t.po_number}/edit`),sx:{textDecoration:"none"},children:t.po_number})}),e.jsx(s,{children:t.product_name}),e.jsx(s,{children:t.product_code}),e.jsx(s,{children:R(t.rr_date)}),e.jsx(s,{align:"right",children:t.received_quantity}),e.jsx(s,{align:"right",children:p(t.cost_price)}),e.jsx(s,{align:"right",children:p(t.total_cost)}),e.jsx(s,{children:e.jsx(I,{label:t.payment_status,color:t.payment_status==="Paid"?"success":"error",size:"small"})})]},o))})]})}):e.jsx(n,{sx:{p:4,textAlign:"center"},children:e.jsx(r,{variant:"body1",color:"text.secondary",children:"No purchase history found for this supplier."})})]}),e.jsxs(z,{value:h,index:1,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Purchases By Order"}),B.length>0?e.jsx(e.Fragment,{children:B.map(t=>{const o=m[t],c=o[0],C=o.reduce((l,u)=>l+u.total_cost,0);return e.jsxs(n,{sx:{mb:4},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(n,{children:[e.jsx(r,{variant:"h6",sx:{color:"primary.main"},children:e.jsxs(y,{href:"#",onClick:()=>x(`/app/purchase/${t}/edit`),sx:{textDecoration:"none"},children:["PO #: ",t]})}),e.jsxs(r,{variant:"body2",children:["Date: ",R(c.po_date)," | Batch #: ",c.batch_number," | Invoice: ",c.invoice!=="N/A"?c.invoice:"Not Available"]})]}),e.jsx(n,{children:e.jsx(I,{label:c.payment_status,color:c.payment_status==="Paid"?"success":"error",size:"small"})})]}),e.jsx(S,{component:b,variant:"outlined",children:e.jsxs(N,{size:"small",children:[e.jsx(O,{children:e.jsxs(g,{sx:{backgroundColor:"#f5f5f5"},children:[e.jsx(s,{children:"Product"}),e.jsx(s,{children:"Code"}),e.jsx(s,{align:"right",children:"Quantity"}),e.jsx(s,{align:"right",children:"Cost Price"}),e.jsx(s,{align:"right",children:"Total"})]})}),e.jsxs($,{children:[o.map((l,u)=>e.jsxs(g,{children:[e.jsx(s,{children:l.product_name}),e.jsx(s,{children:l.product_code}),e.jsx(s,{align:"right",children:l.received_quantity}),e.jsx(s,{align:"right",children:p(l.cost_price)}),e.jsx(s,{align:"right",children:p(l.total_cost)})]},u)),e.jsxs(g,{children:[e.jsx(s,{colSpan:3}),e.jsx(s,{align:"right",children:e.jsx(r,{variant:"subtitle2",children:"Order Total:"})}),e.jsx(s,{align:"right",children:e.jsx(r,{variant:"subtitle2",children:p(C)})})]})]})]})}),e.jsx(U,{sx:{my:4}})]},t)})}):e.jsx(n,{sx:{p:4,textAlign:"center"},children:e.jsx(r,{variant:"body1",color:"text.secondary",children:"No purchase orders found for this supplier."})})]})]})]})};export{le as default};
