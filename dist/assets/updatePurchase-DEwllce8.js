import{r as m,g as ce,h as de,s as H,w as pe,j as e,k as se,z as ue,C as X,ai as pt,m as me,aj as et,l as nt,R as We,K as A,P as le,T as k,N as V,Y as qe,ak as ut,V as mt,W as ht,_ as ie,E as B,al as xt,am as ft,an as vt,X as _e,$ as ze,U as N,L as _t,ab as jt,a5 as bt,a0 as ke,ae as gt,af as yt,ag as Ct,J as ee}from"./index-iwU4FU1d.js";import{S as $e}from"./sweetalert2.esm.all-D3pEHXw3.js";import{b as St,c as wt,d as Rt,e as Tt}from"./usePurchaseOrders-nv6LiAqR.js";import{P as Lt,u as Pt,a as It}from"./PrintableRR-DFb31Vjc.js";import{P as ot}from"./Print-DMgVL9gh.js";import{P as Et}from"./PrintablePO-1Zs_z5Mc.js";import{l as lt}from"./index-CSy0oy2g.js";import{A as At}from"./AddCostTypeModal-BYltnPue.js";import{c as kt,s as $t,r as Mt}from"./filepond.esm-Uz-eCX8X.js";import{A as Ft}from"./Add-3Vbs0nTx.js";import{D as qt}from"./Download-DLML0ySc.js";import{C as zt}from"./Close-CEcHadxF.js";import{E as ct}from"./ExpandMore-DH4eyC9q.js";import{R as Dt}from"./Receipt-BIAhliOh.js";import{E as tt}from"./Edit-DPmSIYS8.js";import{a as G,b as T,T as U,c as Be,d as Ge,e as Ve,f as Ye}from"./TextField-DS9zh2A1.js";import{A as be}from"./Autocomplete-D5E8BdEB.js";import{R as He}from"./DeleteOutlined-C4sBctnP.js";import{R as ge}from"./PlusOutlined-BNJ8jXq-.js";import{D as Qe}from"./Dialog-uw4uRqg7.js";import{D as Xe,a as Je}from"./DialogTitle-igWtyaEh.js";import{R as Ot}from"./CloseOutlined-Dj8Kfe5V.js";import{A as Nt}from"./Alert-CjUZgNuH.js";import{i as De}from"./index.esm-GQnMFM9Y.js";import{S as Oe}from"./Switch-D6C2Rr9r.js";import{D as Ke}from"./DialogActions-DaCZbXUr.js";import{A as Ut,a as Wt,b as Bt}from"./AccordionSummary-V4CkthLV.js";import{C as Gt}from"./Container-D5Ja5zij.js";import{D as Vt}from"./DialogContentText-DbuNkwYC.js";import{S as te}from"./Skeleton-BujRsbeW.js";import"./InputLabel-c_6Gp7Kp.js";import"./Close-xmY92Z9x.js";const ye=m.createContext({}),Ze=m.createContext({});function Yt(t){return de("MuiStep",t)}ce("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const Ht=t=>{const{classes:r,orientation:s,alternativeLabel:h,completed:n}=t;return ue({root:["root",s,h&&"alternativeLabel",n&&"completed"]},Yt,r)},Qt=H("div",{name:"MuiStep",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation],s.alternativeLabel&&r.alternativeLabel,s.completed&&r.completed]}})({variants:[{props:{orientation:"horizontal"},style:{paddingLeft:8,paddingRight:8}},{props:{alternativeLabel:!0},style:{flex:1,position:"relative"}}]}),Xt=m.forwardRef(function(r,s){const h=pe({props:r,name:"MuiStep"}),{active:n,children:w,className:v,component:_="div",completed:y,disabled:p,expanded:C=!1,index:j,last:L,...d}=h,{activeStep:u,connector:x,alternativeLabel:S,orientation:g,nonLinear:I}=m.useContext(ye);let[f=!1,F=!1,z=!1]=[n,y,p];u===j?f=n!==void 0?n:!0:!I&&u>j?F=y!==void 0?y:!0:!I&&u<j&&(z=p!==void 0?p:!0);const q=m.useMemo(()=>({index:j,last:L,expanded:C,icon:j+1,active:f,completed:F,disabled:z}),[j,L,C,f,F,z]),R={...h,active:f,orientation:g,alternativeLabel:S,completed:F,disabled:z,expanded:C,component:_},W=Ht(R),P=e.jsxs(Qt,{as:_,className:se(W.root,v),ref:s,ownerState:R,...d,children:[x&&S&&j!==0?x:null,w]});return e.jsx(Ze.Provider,{value:q,children:x&&!S&&j!==0?e.jsxs(m.Fragment,{children:[x,P]}):P})}),Jt=X(e.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"}),"CheckCircle"),Kt=X(e.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}),"Warning");function Zt(t){return de("MuiStepIcon",t)}const Me=ce("MuiStepIcon",["root","active","completed","error","text"]);var st;const es=t=>{const{classes:r,active:s,completed:h,error:n}=t;return ue({root:["root",s&&"active",h&&"completed",n&&"error"],text:["text"]},Zt,r)},Fe=H(pt,{name:"MuiStepIcon",slot:"Root",overridesResolver:(t,r)=>r.root})(me(({theme:t})=>({display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),color:(t.vars||t).palette.text.disabled,[`&.${Me.completed}`]:{color:(t.vars||t).palette.primary.main},[`&.${Me.active}`]:{color:(t.vars||t).palette.primary.main},[`&.${Me.error}`]:{color:(t.vars||t).palette.error.main}}))),ts=H("text",{name:"MuiStepIcon",slot:"Text",overridesResolver:(t,r)=>r.text})(me(({theme:t})=>({fill:(t.vars||t).palette.primary.contrastText,fontSize:t.typography.caption.fontSize,fontFamily:t.typography.fontFamily}))),ss=m.forwardRef(function(r,s){const h=pe({props:r,name:"MuiStepIcon"}),{active:n=!1,className:w,completed:v=!1,error:_=!1,icon:y,...p}=h,C={...h,active:n,completed:v,error:_},j=es(C);if(typeof y=="number"||typeof y=="string"){const L=se(w,j.root);return _?e.jsx(Fe,{as:Kt,className:L,ref:s,ownerState:C,...p}):v?e.jsx(Fe,{as:Jt,className:L,ref:s,ownerState:C,...p}):e.jsxs(Fe,{className:L,ref:s,ownerState:C,...p,children:[st||(st=e.jsx("circle",{cx:"12",cy:"12",r:"12"})),e.jsx(ts,{className:j.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:C,children:y})]})}return y});function is(t){return de("MuiStepLabel",t)}const Q=ce("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),rs=t=>{const{classes:r,orientation:s,active:h,completed:n,error:w,disabled:v,alternativeLabel:_}=t;return ue({root:["root",s,w&&"error",v&&"disabled",_&&"alternativeLabel"],label:["label",h&&"active",n&&"completed",w&&"error",v&&"disabled",_&&"alternativeLabel"],iconContainer:["iconContainer",h&&"active",n&&"completed",w&&"error",v&&"disabled",_&&"alternativeLabel"],labelContainer:["labelContainer",_&&"alternativeLabel"]},is,r)},as=H("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation]]}})({display:"flex",alignItems:"center",[`&.${Q.alternativeLabel}`]:{flexDirection:"column"},[`&.${Q.disabled}`]:{cursor:"default"},variants:[{props:{orientation:"vertical"},style:{textAlign:"left",padding:"8px 0"}}]}),ns=H("span",{name:"MuiStepLabel",slot:"Label",overridesResolver:(t,r)=>r.label})(me(({theme:t})=>({...t.typography.body2,display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),[`&.${Q.active}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${Q.completed}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${Q.alternativeLabel}`]:{marginTop:16},[`&.${Q.error}`]:{color:(t.vars||t).palette.error.main}}))),os=H("span",{name:"MuiStepLabel",slot:"IconContainer",overridesResolver:(t,r)=>r.iconContainer})({flexShrink:0,display:"flex",paddingRight:8,[`&.${Q.alternativeLabel}`]:{paddingRight:0}}),ls=H("span",{name:"MuiStepLabel",slot:"LabelContainer",overridesResolver:(t,r)=>r.labelContainer})(me(({theme:t})=>({width:"100%",color:(t.vars||t).palette.text.secondary,[`&.${Q.alternativeLabel}`]:{textAlign:"center"}}))),Ne=m.forwardRef(function(r,s){const h=pe({props:r,name:"MuiStepLabel"}),{children:n,className:w,componentsProps:v={},error:_=!1,icon:y,optional:p,slots:C={},slotProps:j={},StepIconComponent:L,StepIconProps:d,...u}=h,{alternativeLabel:x,orientation:S}=m.useContext(ye),{active:g,disabled:I,completed:f,icon:F}=m.useContext(Ze),z=y||F;let q=L;z&&!q&&(q=ss);const R={...h,active:g,alternativeLabel:x,completed:f,disabled:I,error:_,orientation:S},W=rs(R),P={slots:C,slotProps:{stepIcon:d,...v,...j}},[$,M]=et("label",{elementType:ns,externalForwardedProps:P,ownerState:R}),[Y,re]=et("stepIcon",{elementType:q,externalForwardedProps:P,ownerState:R});return e.jsxs(as,{className:se(W.root,w),ref:s,ownerState:R,...u,children:[z||Y?e.jsx(os,{className:W.iconContainer,ownerState:R,children:e.jsx(Y,{completed:f,active:g,error:_,icon:z,...re})}):null,e.jsxs(ls,{className:W.labelContainer,ownerState:R,children:[n?e.jsx($,{...M,className:se(W.label,M==null?void 0:M.className),children:n}):null,p]})]})});Ne&&(Ne.muiName="StepLabel");function cs(t){return de("MuiStepConnector",t)}ce("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const ds=t=>{const{classes:r,orientation:s,alternativeLabel:h,active:n,completed:w,disabled:v}=t,_={root:["root",s,h&&"alternativeLabel",n&&"active",w&&"completed",v&&"disabled"],line:["line",`line${nt(s)}`]};return ue(_,cs,r)},ps=H("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation],s.alternativeLabel&&r.alternativeLabel,s.completed&&r.completed]}})({flex:"1 1 auto",variants:[{props:{orientation:"vertical"},style:{marginLeft:12}},{props:{alternativeLabel:!0},style:{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"}}]}),us=H("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.line,r[`line${nt(s.orientation)}`]]}})(me(({theme:t})=>{const r=t.palette.mode==="light"?t.palette.grey[400]:t.palette.grey[600];return{display:"block",borderColor:t.vars?t.vars.palette.StepConnector.border:r,variants:[{props:{orientation:"horizontal"},style:{borderTopStyle:"solid",borderTopWidth:1}},{props:{orientation:"vertical"},style:{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24}}]}})),ms=m.forwardRef(function(r,s){const h=pe({props:r,name:"MuiStepConnector"}),{className:n,...w}=h,{alternativeLabel:v,orientation:_="horizontal"}=m.useContext(ye),{active:y,disabled:p,completed:C}=m.useContext(Ze),j={...h,alternativeLabel:v,orientation:_,active:y,completed:C,disabled:p},L=ds(j);return e.jsx(ps,{className:se(L.root,n),ref:s,ownerState:j,...w,children:e.jsx(us,{className:L.line,ownerState:j})})});function hs(t){return de("MuiStepper",t)}ce("MuiStepper",["root","horizontal","vertical","nonLinear","alternativeLabel"]);const xs=t=>{const{orientation:r,nonLinear:s,alternativeLabel:h,classes:n}=t;return ue({root:["root",r,s&&"nonLinear",h&&"alternativeLabel"]},hs,n)},fs=H("div",{name:"MuiStepper",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation],s.alternativeLabel&&r.alternativeLabel,s.nonLinear&&r.nonLinear]}})({display:"flex",variants:[{props:{orientation:"horizontal"},style:{flexDirection:"row",alignItems:"center"}},{props:{orientation:"vertical"},style:{flexDirection:"column"}},{props:{alternativeLabel:!0},style:{alignItems:"flex-start"}}]}),vs=e.jsx(ms,{}),_s=m.forwardRef(function(r,s){const h=pe({props:r,name:"MuiStepper"}),{activeStep:n=0,alternativeLabel:w=!1,children:v,className:_,component:y="div",connector:p=vs,nonLinear:C=!1,orientation:j="horizontal",...L}=h,d={...h,nonLinear:C,alternativeLabel:w,orientation:j,component:y},u=xs(d),x=m.Children.toArray(v).filter(Boolean),S=x.map((I,f)=>m.cloneElement(I,{index:f,last:f+1===x.length,...I.props})),g=m.useMemo(()=>({activeStep:n,alternativeLabel:w,connector:p,nonLinear:C,orientation:j}),[n,w,p,C,j]);return e.jsx(ye.Provider,{value:g,children:e.jsx(fs,{as:y,ownerState:d,className:se(u.root,_),ref:s,...L,children:S})})}),it=X(e.jsx("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"AddCircleOutline"),js=X(e.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBackOutlined"),bs=X(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"}),"CancelOutlined"),gs=X(e.jsx("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess"),ys=X(e.jsx("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile"),Cs=X(e.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save");/*!
 * react-filepond v7.1.3
 * A handy FilePond adapter component for React
 * 
 * Copyright (c) 2024 PQINA
 * https://pqina.nl/filepond
 * 
 * Licensed under the MIT license.
 */const Ss=$t(),ws=["setOptions","on","off","onOnce","appendTo","insertAfter","insertBefore","isAttachedTo","replaceElement","restoreElement","destroy"];class Rs extends We.Component{constructor(r){super(r),this.allowFilesSync=!0}componentDidMount(){if(this._input=this._element.querySelector('input[type="file"]'),this._inputClone=this._input.cloneNode(),!Ss)return;const r=Object.assign({},this.props);if(r.onupdatefiles){const s=r.onupdatefiles;r.onupdatefiles=h=>{this.allowFilesSync=!1,s(h)}}this._pond=kt(this._input,r),Object.keys(this._pond).filter(s=>!ws.includes(s)).forEach(s=>{this[s]=this._pond[s]})}componentWillUnmount(){if(!this._pond)return;const r=document.createElement("div");r.append(this._pond.element),r.id="foo",this._pond.destroy(),this._pond=void 0,this._element.append(this._inputClone)}shouldComponentUpdate(){return this.allowFilesSync?!0:(this.allowFilesSync=!0,!1)}componentDidUpdate(){if(!this._pond)return;const r=Object.assign({},this.props);delete r.onupdatefiles,this._pond.setOptions(r)}render(){const{id:r,name:s,className:h,allowMultiple:n,required:w,captureMethod:v,acceptedFileTypes:_}=this.props;return m.createElement("div",{className:"filepond--wrapper",ref:y=>this._element=y},m.createElement("input",{type:"file",name:s,id:r,accept:_,multiple:n,required:w,className:h,capture:v}))}}/*!
 * FilePondPluginFileValidateType 1.2.9
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */const dt=({addFilter:t,utils:r})=>{const{Type:s,isString:h,replaceInString:n,guesstimateMimeType:w,getExtensionFromFilename:v,getFilenameFromURL:_}=r,y=(d,u)=>{const x=(/^[^/]+/.exec(d)||[]).pop(),S=u.slice(0,-2);return x===S},p=(d,u)=>d.some(x=>/\*$/.test(x)?y(u,x):x===u),C=d=>{let u="";if(h(d)){const x=_(d),S=v(x);S&&(u=w(S))}else u=d.type;return u},j=(d,u,x)=>{if(u.length===0)return!0;const S=C(d);return x?new Promise((g,I)=>{x(d,S).then(f=>{p(u,f)?g():I()}).catch(I)}):p(u,S)},L=d=>u=>d[u]===null?!1:d[u]||u;return t("SET_ATTRIBUTE_TO_OPTION_MAP",d=>Object.assign(d,{accept:"acceptedFileTypes"})),t("ALLOW_HOPPER_ITEM",(d,{query:u})=>u("GET_ALLOW_FILE_TYPE_VALIDATION")?j(d,u("GET_ACCEPTED_FILE_TYPES")):!0),t("LOAD_FILE",(d,{query:u})=>new Promise((x,S)=>{if(!u("GET_ALLOW_FILE_TYPE_VALIDATION")){x(d);return}const g=u("GET_ACCEPTED_FILE_TYPES"),I=u("GET_FILE_VALIDATE_TYPE_DETECT_TYPE"),f=j(d,g,I),F=()=>{const z=g.map(L(u("GET_FILE_VALIDATE_TYPE_LABEL_EXPECTED_TYPES_MAP"))).filter(R=>R!==!1),q=z.filter((R,W)=>z.indexOf(R)===W);S({status:{main:u("GET_LABEL_FILE_TYPE_NOT_ALLOWED"),sub:n(u("GET_FILE_VALIDATE_TYPE_LABEL_EXPECTED_TYPES"),{allTypes:q.join(", "),allButLastType:q.slice(0,-1).join(", "),lastType:q[q.length-1]})}})};if(typeof f=="boolean")return f?x(d):F();f.then(()=>{x(d)}).catch(F)})),{options:{allowFileTypeValidation:[!0,s.BOOLEAN],acceptedFileTypes:[[],s.ARRAY],labelFileTypeNotAllowed:["File is of invalid type",s.STRING],fileValidateTypeLabelExpectedTypes:["Expects {allButLastType} or {lastType}",s.STRING],fileValidateTypeLabelExpectedTypesMap:[{},s.OBJECT],fileValidateTypeDetectType:[null,s.FUNCTION]}}},Ts=typeof window<"u"&&typeof window.document<"u";Ts&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:dt}));Mt(dt);const Ls=({files:t,onRemove:r})=>{const[s,h]=m.useState(!1),[n,w]=m.useState(null),v=p=>{if(p===0)return"0 Bytes";const C=1024,j=["Bytes","KB","MB","GB"],L=Math.floor(Math.log(p)/Math.log(C));return parseFloat((p/Math.pow(C,L)).toFixed(2))+" "+j[L]},_=async p=>{try{w(p),(await qe.post(`/attachments/${p}`)).data.status==="success"?r(p):console.error("Failed to delete attachment")}catch(C){w(null),console.error("Error deleting attachment:",C)}finally{w(null)}},y=async p=>{try{const C=await qe.get(`/storage/${p.file_path}`,{responseType:"blob"}),j=new Blob([C.data],{type:p.file_type}),L=window.URL.createObjectURL(j),d=document.createElement("a");d.href=L,d.download=p.file_name,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(L)}catch(C){console.error("Error downloading file:",C)}};return e.jsxs(A,{sx:{position:"relative"},children:[e.jsx(ut,{in:!s,collapsedSize:75,children:e.jsx(A,{sx:{display:"flex",flexWrap:"wrap",gap:1.5},children:t.map((p,C)=>e.jsx(mt,{onClick:()=>y(p),sx:{width:100,overflow:"visible",cursor:"pointer",position:"relative",transition:"transform 0.2s ease, box-shadow 0.2s ease","&:hover":{transform:"translateY(-2px)",boxShadow:"0 4px 8px rgba(0,0,0,0.1)","& .download-overlay":{opacity:1},"& .file-icon":{opacity:0}}},children:e.jsxs(ht,{sx:{p:1.5,"&:last-child":{pb:1.5},overflow:"visible",position:"relative"},children:[e.jsxs(A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:[e.jsx(ys,{className:"file-icon",sx:{fontSize:20,color:"action.active",transition:"opacity 0.2s ease"},color:"action"}),e.jsx(A,{className:"download-overlay",sx:{position:"absolute",top:12,left:11,opacity:0,transition:"opacity 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",width:"20px",height:"20px"},children:e.jsx(qt,{sx:{fontSize:23,color:"primary.main"}})}),e.jsx(V,{size:"small",disabled:n===p.id,onClick:j=>{j.stopPropagation(),_(p.id)},sx:{borderRadius:100,position:"absolute",top:-6,right:-6,backgroundColor:"#E5E4E2"},children:e.jsxs(A,{children:[" ",n===p.id?e.jsx(ie,{size:"15px"}):e.jsx(zt,{sx:{fontSize:20}})]})})]}),e.jsx(k,{variant:"body2",sx:{mt:.5,fontSize:"0.75rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:p.file_name}),p.file_size&&e.jsx(k,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:v(p.file_size)})]})},p.id||C))})}),t.length>3&&e.jsx(B,{fullWidth:!0,size:"small",endIcon:s?e.jsx(gs,{}):e.jsx(ct,{}),onClick:()=>h(!s),sx:{mt:1},children:s?"Show Less":"Show More"})]})},Ue=({uploadedFiles:t=[],onFilesChange:r,referenceNumber:s,modelType:h})=>{const[n,w]=m.useState([]),[v,_]=m.useState(!1),y=C=>{w(C)},p=C=>{const j=t.filter(L=>L.id!==C);r(j,"replace")};return e.jsxs(A,{sx:{maxWidth:"100%",p:0,position:"relative"},children:[e.jsxs(le,{elevation:1,sx:{p:1},children:[e.jsx(A,{sx:{mb:1},children:e.jsxs(k,{variant:"h6",sx:{display:"flex",alignItems:"center"},children:["Uploaded Attachment",e.jsx(V,{onClick:()=>_(!v),sx:{ml:1},children:e.jsx(Ft,{})})]})}),e.jsx(Ls,{files:t,onRemove:p})]}),e.jsx(le,{elevation:3,sx:{visibility:v?"visible":"hidden",position:"absolute",top:"100%",left:0,right:24,mt:1.2,p:2,zIndex:1e3,width:"100%",backgroundColor:"background.paper"},children:e.jsx(Rs,{files:n,onupdatefiles:y,allowMultiple:!0,maxFiles:10,name:"attachments",labelIdle:"Upload Attachment",acceptedFileTypes:["image/*","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet"],server:{process:async(C,j,L,d,u,x)=>{try{const S=new FormData;S.append("attachments[]",j);let g="";switch(h){case"purchase-orders":g=`/purchase-orders/${s}/attachments`;break;case"receiving-reports":g=`/receiving-reports/${s}/attachments`;break}const I=await qe.post(g,S,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:f=>{x(f.lengthComputable,f.loaded,f.total)}});if(I.data.status==="success"){const f=I.data.data.attachments[0];d(f.id),r&&(console.log(f),r([f])),w([])}else u("Upload failed")}catch(S){u("Upload failed"),console.error("Upload error:",S)}}},stylePanelLayout:"compact",styleLoadIndicatorPosition:"center bottom",styleProgressIndicatorPosition:"right bottom",styleButtonRemoveItemPosition:"left bottom",styleButtonProcessItemPosition:"right bottom"})})]})},Ps=We.memo(({item:t,index:r,products:s,errors:h,onItemChange:n,onRemoveItem:w,disabled:v,isCompleted:_,isCancelled:y,distributionCostPerUnit:p})=>{const C=m.useMemo(()=>!t.received_quantity||!t.cost_price?"₱0.00":`₱${(parseFloat(t.cost_price||0)+p).toFixed(2)}`,[t.cost_price,t.received_quantity,p]),j=m.useMemo(()=>`₱${(t.cost_price*t.received_quantity).toFixed(2)}`,[t.cost_price,t.received_quantity]),L=m.useCallback((f,F)=>{n(r,"product_id",F?F.id:"")},[r,n]),d=m.useCallback(f=>{n(r,"received_quantity",f.target.value)},[r,n]),u=m.useCallback(f=>{n(r,"cost_price",f.target.value)},[r,n]),x=m.useCallback(f=>{n(r,"walk_in_price",f.target.value)},[r,n]);m.useCallback(f=>{n(r,"wholesale_price",f.target.value)},[r,n]),m.useCallback(f=>{n(r,"regular_price",f.target.value)},[r,n]);const S=m.useCallback(()=>{w(r)},[r,w]),g=m.useMemo(()=>(s==null?void 0:s.filter(f=>!s.some((F,z)=>z!==r&&F.product_id===f.id)))||[],[s,r]),I=m.useMemo(()=>(s==null?void 0:s.find(f=>f.id===t.product_id))||null,[s,t.product_id]);return m.useEffect(()=>{if(t.received_quantity&&t.cost_price&&p>0){const f=parseFloat(t.cost_price||0)+p;t.distribution_price!==f.toFixed(2)&&n(r,"distribution_price",f.toFixed(2))}},[t.cost_price,t.received_quantity,p,r,n,t.distribution_price]),e.jsxs(G,{children:[e.jsx(T,{sx:{verticalAlign:"top"},children:!_&&!y?e.jsx(be,{value:I,onChange:L,options:g,size:"small",sx:{width:300},getOptionLabel:f=>f.product_name||"",isOptionEqualToValue:(f,F)=>f.id===F,disabled:v,renderInput:f=>e.jsx(U,{...f,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!h[`received_items.${r}.product_id`],helperText:h[`received_items.${r}.product_id`]||"Required"})}):(I==null?void 0:I.product_name)||""}),e.jsx(T,{sx:{verticalAlign:"top"},children:!_&&!y?e.jsx(U,{type:"number",value:t.received_quantity,onChange:d,error:!!h[`received_items.${r}.received_quantity`],helperText:h[`received_items.${r}.received_quantity`]||"Required",inputProps:{min:0,step:"0.01"},disabled:v,size:"small"}):t.received_quantity}),e.jsx(T,{sx:{verticalAlign:"top"},children:!_&&!y?e.jsx(U,{type:"number",value:t.cost_price,onChange:u,error:!!h[`received_items.${r}.cost_price`],helperText:h[`received_items.${r}.cost_price`]||"Required",inputProps:{min:0,step:"0.01"},disabled:v,size:"small"}):`₱${t.cost_price}`}),e.jsx(T,{sx:{verticalAlign:"top"},children:e.jsx(U,{type:"text",value:C,readOnly:!0,size:"small",sx:{"& .MuiInputBase-input":{color:"rgba(0, 0, 0, 0.87)"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(0, 0, 0, 0.23)"}}})}),e.jsx(T,{sx:{verticalAlign:"top"},children:!_&&!y?e.jsx(U,{type:"number",value:t.walk_in_price,onChange:x,error:!!h[`received_items.${r}.walk_in_price`],helperText:h[`received_items.${r}.walk_in_price`]||"Required",inputProps:{min:0,step:"0.01"},disabled:v,size:"small"}):`₱${t.walk_in_price}`}),e.jsx(T,{sx:{verticalAlign:"top"},children:j}),!v&&!_&&!y&&e.jsx(T,{sx:{verticalAlign:"top"},children:e.jsx(V,{size:"large",onClick:S,disabled:v||t.isLastItem,children:e.jsx(He,{})})})]})}),Is=({products:t,attributes:r,receivedItems:s,onItemChange:h,onAddItem:n,onRemoveItem:w,errors:v={},disabled:_=!1,status:y,totalAdditonalCost:p})=>{const C=y==="completed",j=y==="cancelled",L=m.useMemo(()=>s.reduce((x,S)=>x+parseFloat(S.cost_price||0)*parseFloat(S.received_quantity||0),0),[s]),d=m.useMemo(()=>{if(!p||p<=0||s.length===0)return 0;const x=s.reduce((S,g)=>S+parseFloat(g.received_quantity||0),0);return x<=0?0:parseFloat(p)/x},[p,s]),u=m.useCallback(()=>{n()},[n]);return e.jsx(Be,{sx:{mt:4},children:e.jsxs(Ge,{size:"small",children:[e.jsxs(Ve,{children:[e.jsx(G,{children:e.jsx(T,{colSpan:C?8:9,children:e.jsx(k,{variant:"h5",children:"Received Items"})})}),e.jsxs(G,{children:[e.jsx(T,{children:"Product"}),e.jsx(T,{children:"Received Qty"}),e.jsx(T,{children:"Cost Price"}),e.jsx(T,{children:"Distribution Cost"}),e.jsx(T,{children:"Walk-in Price"}),e.jsx(T,{children:"Total"}),!_&&e.jsx(T,{width:50})]})]}),e.jsxs(Ye,{children:[s.map((x,S)=>e.jsx(Ps,{item:x,index:S,products:t,errors:v,onItemChange:h,onRemoveItem:w,disabled:_,isCompleted:C,isCancelled:j,distributionCostPerUnit:d,isLastItem:s.length===1},`${x.product_id||"new"}-${S}`)),e.jsxs(G,{children:[e.jsx(T,{colSpan:5,sx:{border:"none"},children:e.jsx(B,{startIcon:e.jsx(ge,{}),onClick:u,sx:{visibility:!_&&!C&&!j?"visible":"hidden"},children:"Add Received Item"})}),e.jsx(T,{children:e.jsx(k,{variant:"h5",children:"Total Received:"})}),e.jsxs(T,{children:["₱",L.toFixed(2)]})]})]})]})})},rt=We.memo(Is),at=({costTypes:t=[],additionalCosts:r=[],onCostChange:s,onAddCost:h,onRemoveCost:n,errors:w={},disabled:v=!1,status:_,showTotals:y=!1,calculateTotalCosts:p=()=>0,onAddCostType:C})=>{const d=v||_==="completed"||_==="cancelled";return e.jsx(e.Fragment,{children:e.jsx(Be,{sx:{mt:4},children:e.jsxs(Ge,{size:"small",children:[e.jsxs(Ve,{children:[e.jsx(G,{children:e.jsx(T,{colSpan:d?3:4,children:e.jsxs(A,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(k,{variant:"h5",children:"Additional Costs"}),C&&!d&&e.jsx(V,{sx:{marginLeft:"8px !important"},onClick:C,children:e.jsx(ge,{})})]})})}),e.jsxs(G,{children:[e.jsx(T,{children:"Cost Type"}),e.jsx(T,{children:"Amount"}),e.jsx(T,{children:"Remarks"}),!d&&e.jsx(T,{width:50})]})]}),e.jsxs(Ye,{children:[r.map((u,x)=>{var S;return e.jsxs(G,{children:[e.jsx(T,{children:d?((S=t==null?void 0:t.find(g=>g.cost_type_id===u.cost_type_id))==null?void 0:S.name)||"":e.jsx(be,{size:"small",value:(t==null?void 0:t.find(g=>g.cost_type_id===u.cost_type_id))||null,onChange:(g,I)=>s(x,"cost_type_id",I?I.cost_type_id:""),options:(t==null?void 0:t.filter(g=>g.is_active&&!r.some((I,f)=>f!==x&&I.cost_type_id===g.cost_type_id)))||[],getOptionLabel:g=>g.name||"",isOptionEqualToValue:(g,I)=>g.cost_type_id===I,renderInput:g=>e.jsx(U,{...g,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!w[`additional_costs.${x}.cost_type_id`],helperText:w[`additional_costs.${x}.cost_type_id`]||"Required"})})}),e.jsx(T,{children:d?`₱${parseFloat(u.amount).toFixed(2)}`:e.jsx(U,{size:"small",type:"number",value:u.amount,onChange:g=>s(x,"amount",g.target.value),error:!!w[`additional_costs.${x}.amount`],helperText:w[`additional_costs.${x}.amount`]||"Required",inputProps:{min:0,step:.01}})}),e.jsx(T,{sx:{verticalAlign:"top"},children:d?u.remarks||"":e.jsx(U,{size:"small",value:u.remarks||"",onChange:g=>s(x,"remarks",g.target.value),fullWidth:!0})}),!d&&e.jsx(T,{sx:{verticalAlign:"top"},children:e.jsx(V,{size:"large",onClick:()=>n(x),disabled:r.length===0,children:e.jsx(He,{})})})]},x)}),r.length===0&&e.jsx(G,{children:e.jsx(T,{colSpan:d?3:4,align:"center",sx:{py:3},children:e.jsx(k,{variant:"body2",color:"text.secondary",children:"No additional costs"})})}),e.jsxs(G,{children:[e.jsx(T,{sx:{border:"none"},colSpan:d?2:3,children:e.jsx(B,{startIcon:e.jsx(ge,{}),onClick:h,sx:{visibility:d?"hidden":"visible"},children:"Add Additional Cost"})}),y&&e.jsx(T,{children:e.jsxs(k,{variant:"h6",children:["₱",p().toFixed(2)]})})]})]})]})})})},Es=({open:t,onClose:r,costTypeId:s=null,onSuccess:h})=>{var f,F,z,q,R,W;const[n,w]=m.useState({name:"",code:"",description:"",is_active:!0,is_deduction:!1}),[v,_]=m.useState({}),y=!!s,{data:p,isLoading:C}=xt(s),j=ft(),L=vt(),d=j.isPending||L.isPending;m.useEffect(()=>{t&&(y&&p?w({name:p.name||"",code:p.code||"",description:p.description||"",is_active:p.is_active??!0,is_deduction:p.is_deduction??!1}):y||w({name:"",code:"",description:"",is_active:!0,is_deduction:!1}),_({}))},[t,y,p]);const u=(P,$)=>{w(M=>({...M,[P]:$})),v[P]&&_(M=>({...M,[P]:""}))},x=()=>{const P={};return n.name.trim()?n.name.trim().length<2?P.name="Cost type name must be at least 2 characters":n.name.trim().length>100&&(P.name="Cost type name must be less than 100 characters"):P.name="Cost type name is required",n.code.trim()?n.code.trim().length<2?P.code="Cost type code must be at least 2 characters":n.code.trim().length>20&&(P.code="Cost type code must be less than 20 characters"):P.code="Cost type code is required",n.description&&n.description.trim().length>500&&(P.description="Description must be less than 500 characters"),_(P),Object.keys(P).length===0},S=async()=>{var $,M;if(!x())return;const P={name:n.name.trim(),code:n.code.trim().toUpperCase(),description:n.description.trim()||null,is_active:n.is_active,is_deduction:n.is_deduction};try{y?await L.mutateAsync({id:s,data:P}):await j.mutateAsync(P),h&&h(),g()}catch(Y){(M=($=Y.response)==null?void 0:$.data)!=null&&M.errors&&_(Y.response.data.errors)}},g=()=>{d||(w({name:"",code:"",description:"",is_active:!0,is_deduction:!1}),_({}),r())},I=j.error||L.error;return e.jsxs(Qe,{open:t,onClose:g,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{minHeight:"400px"}},children:[e.jsx(Xe,{children:e.jsxs(A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(k,{variant:"h6",children:y?"Edit Cost Type":"Create New Cost Type"}),e.jsx(V,{onClick:g,disabled:d,size:"small",children:e.jsx(Ot,{})})]})}),e.jsx(Je,{dividers:!0,children:y&&C?e.jsx(A,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(ie,{})}):e.jsxs(A,{sx:{display:"flex",flexDirection:"column",gap:3,pt:1},children:[I&&e.jsx(Nt,{severity:"error",children:((z=(F=(f=j.error)==null?void 0:f.response)==null?void 0:F.data)==null?void 0:z.message)||((W=(R=(q=L.error)==null?void 0:q.response)==null?void 0:R.data)==null?void 0:W.message)||"An error occurred. Please try again."}),e.jsx(U,{label:"Cost Type Name",value:n.name,onChange:P=>u("name",P.target.value),error:!!v.name,helperText:v.name||"Enter a descriptive name for this cost type",fullWidth:!0,required:!0,disabled:d,inputProps:{maxLength:100}}),e.jsx(U,{label:"Cost Type Code",value:n.code,onChange:P=>u("code",P.target.value.toUpperCase()),error:!!v.code,helperText:v.code||"Enter a unique code (e.g., SHIPPING, TAX, etc.)",fullWidth:!0,required:!0,disabled:d,inputProps:{maxLength:20},placeholder:"e.g., SHIPPING"}),e.jsx(U,{label:"Description",value:n.description,onChange:P=>u("description",P.target.value),error:!!v.description,helperText:v.description||"Optional description for this cost type",fullWidth:!0,multiline:!0,rows:3,disabled:d,inputProps:{maxLength:500}}),e.jsx(De,{control:e.jsx(Oe,{checked:n.is_active,onChange:P=>u("is_active",P.target.checked),disabled:d}),label:e.jsxs(A,{children:[e.jsx(k,{variant:"body1",children:"Active"}),e.jsx(k,{variant:"caption",color:"text.secondary",children:n.is_active?"This cost type can be used in purchase orders":"This cost type will be hidden from selection"})]})}),e.jsx(De,{control:e.jsx(Oe,{checked:n.is_deduction,onChange:P=>u("is_deduction",P.target.checked),disabled:d}),label:e.jsxs(A,{children:[e.jsx(k,{variant:"body1",children:"Deduction"}),e.jsx(k,{variant:"caption",color:"text.secondary",children:n.is_deduction?"This cost will be subtracted from the total amount":"This cost will be added to the total amount"})]})})]})}),e.jsxs(Ke,{sx:{px:3,py:2},children:[e.jsx(B,{onClick:g,disabled:d,color:"inherit",children:"Cancel"}),e.jsx(B,{onClick:S,variant:"contained",disabled:d||y&&C,startIcon:d?e.jsx(ie,{size:16}):null,children:d?y?"Updating...":"Creating...":y?"Update Cost Type":"Create Cost Type"})]})]})},As=({receivingReports:t=[],products:r=[],attributes:s=[],costTypes:h=[],status:n,poId:w,poNumber:v,onCreateReceivingReport:_,onUpdateReceivingReport:y})=>{const p=m.useRef(),[C,j]=m.useState(!1),[L,d]=m.useState(!1),[u,x]=m.useState(!1),[S,g]=m.useState(!1),[I,f]=m.useState(null),[F,z]=m.useState(null),[q,R]=m.useState({}),[W,P]=m.useState(!1),[$,M]=m.useState({invoice:"",term:0,is_paid:!1,received_items:[{product_id:"",attribute_id:"",received_quantity:0,cost_price:0,distribution_price:0,walk_in_price:0,term_price:0,wholesale_price:0,regular_price:0,remarks:""}],additional_costs:[],attachments:[]}),Y=lt.useReactToPrint({contentRef:p}),re=i=>(a,o)=>{j(o?i:!1)},Ce=()=>{P(!0)},he=()=>{M({invoice:"",term:0,is_paid:!1,received_items:[{product_id:"",attribute_id:"",received_quantity:0,cost_price:0,distribution_price:0,walk_in_price:0,term_price:0,wholesale_price:0,regular_price:0,remarks:""}],additional_costs:[],attachments:[]}),R({}),g(!1),f(null),d(!0)},K=i=>{M({invoice:i.invoice||"",term:i.term||0,is_paid:i.is_paid||!1,received_items:i.received_items?[...i.received_items]:[],additional_costs:i.additional_costs?[...i.additional_costs]:[],attachments:i.attachments||[]}),R({}),g(!0),f(i.rr_id),d(!0)},Se=(i,a,o)=>{const l=[...$.additional_costs];l[i]={...l[i],[a]:o},M(E=>({...E,additional_costs:l})),q[`additional_costs.${i}.${a}`]&&R(E=>{const D={...E};return delete D[`additional_costs.${i}.${a}`],D})},we=(i,a,o="append")=>{M(S?o==="append"?l=>{const E=i.filter(D=>!l.attachments.some(Ae=>Ae.id===D.id));return{...l,attachments:[...l.attachments||[],...E]}}:l=>({...l,attachments:i}):l=>({...l,attachments:o==="append"?[...l.attachments||[],...i]:i}))},xe=()=>$.additional_costs.reduce((i,a)=>i+(Number(a.amount)||0),0),Re=()=>{const i={cost_type_id:"",amount:0,remarks:""};M(a=>({...a,additional_costs:[...a.additional_costs,i]}))},Te=i=>{const a=$.additional_costs.filter((o,l)=>l!==i);M(o=>({...o,additional_costs:a}))},fe=()=>{d(!1)},ae=(i,a)=>{M(o=>({...o,[i]:a})),q[i]&&R(o=>{const l={...o};return delete l[i],l})},Z=(i,a,o)=>{a=="distribution_price"&&console.log("distribution_price",o);const l=[...$.received_items];l[i]={...l[i],[a]:o},M(E=>({...E,received_items:l})),q[`received_items.${i}.${a}`]&&R(E=>{const D={...E};return delete D[`received_items.${i}.${a}`],D})},Le=()=>{const i={product_id:"",attribute_id:"",received_quantity:0,cost_price:0,distribution_price:0,walk_in_price:0,term_price:0,wholesale_price:0,regular_price:0,remarks:""};M(a=>({...a,received_items:[...a.received_items,i]}))},Pe=i=>{if($.received_items.length>1){const a=$.received_items.filter((o,l)=>l!==i);M(o=>({...o,received_items:a}))}},O=()=>{const i={};return $.received_items.forEach((a,o)=>{a.product_id||(i[`received_items.${o}.product_id`]="Product is required"),(!a.received_quantity||Number(a.received_quantity)<=0)&&(i[`received_items.${o}.received_quantity`]="Received quantity must be greater than 0"),Object.entries({cost_price:"Cost price",walk_in_price:"Walk-in price"}).forEach(([E,D])=>{(!a[E]||Number(a[E])<=0)&&(i[`received_items.${o}.${E}`]=`${D} must be greater than 0`)})}),R(i),Object.keys(i).length===0},J=async()=>{var i,a;if(O())try{x(!0);const o={po_id:w,invoice:$.invoice,term:$.term,is_paid:$.is_paid,received_items:$.received_items.map(l=>({...l,wholesale_price:l.walk_in_price,regular_price:l.walk_in_price})),additional_costs:$.additional_costs};S?await y(I,o):await _(o),d(!1),x(!1)}catch(o){console.error(`Error ${S?"updating":"creating"} receiving report:`,o),x(!1),(a=(i=o.response)==null?void 0:i.data)!=null&&a.errors&&R(o.response.data.errors)}},Ie=i=>i.reduce((a,o)=>a+o.cost_price*o.received_quantity,0),Ee=i=>i.reduce((a,o)=>a+(Number(o.amount)||0),0),ve=i=>{const a=Ie(i.received_items||[]),o=Ee(i.additional_costs||[]);return a+o},ne=i=>new Date(i).toLocaleDateString(),oe=n==="partially_received"&&_,c=(n==="partially_received"||n==="completed")&&y,b=()=>e.jsxs(Qe,{open:L,onClose:fe,fullWidth:!0,maxWidth:"lg",children:[e.jsx(Xe,{children:S?`Edit Receiving Report for ${v}`:`Create New Receiving Report for PO ${v}`}),e.jsxs(Je,{children:[e.jsx(A,{sx:{mb:3,mt:2},children:e.jsxs(N,{container:!0,spacing:3,children:[e.jsx(N,{item:!0,xs:12,md:6,children:e.jsx(U,{label:"Reference Number",fullWidth:!0,value:$.invoice,onChange:i=>ae("invoice",i.target.value),helperText:"Optional"})}),e.jsx(N,{item:!0,xs:12,md:6,children:e.jsx(U,{label:"Payment Terms (days)",type:"number",fullWidth:!0,value:$.term,onChange:i=>ae("term",i.target.value),inputProps:{min:0}})}),e.jsx(N,{item:!0,xs:12,md:6,children:e.jsx(De,{control:e.jsx(Oe,{checked:$.is_paid,onChange:i=>ae("is_paid",i.target.checked),color:"primary"}),label:"Mark as Paid"})}),e.jsx(N,{item:!0,xs:12,children:e.jsx(Ue,{referenceNumber:I||"temp",uploadedFiles:$.attachments||[],onFilesChange:(i,a)=>we(i,I,a),modelType:"receiving-reports"})})]})}),e.jsx(rt,{products:r,attributes:s,receivedItems:$.received_items,onItemChange:Z,onAddItem:Le,onRemoveItem:Pe,errors:q,disabled:!1,status:n,totalAdditonalCost:xe()}),e.jsx(at,{costTypes:h,additionalCosts:$.additional_costs,onCostChange:Se,onAddCost:Re,onRemoveCost:Te,errors:q,disabled:!1,status:"partially_received",showTotals:!0,calculateTotalCosts:xe,onAddCostType:Ce})]}),e.jsxs(Ke,{children:[e.jsx(B,{onClick:fe,disabled:u,children:"Cancel"}),e.jsx(B,{onClick:J,variant:"contained",color:"primary",disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(ie,{size:24,color:"inherit",sx:{mr:1}}),S?"Updating...":"Creating..."]}):S?"Update Receiving Report":"Create Receiving Report"})]})]});return!t||t.length===0?e.jsxs(A,{sx:{mt:4,mb:2},children:[e.jsxs(A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(k,{variant:"h5",children:"Receiving Reports"}),oe&&e.jsx(B,{variant:"contained",color:"primary",startIcon:e.jsx(it,{}),onClick:he,children:"New Receiving Report"})]}),e.jsx(le,{elevation:0,sx:{p:3,textAlign:"center"},children:e.jsx(k,{variant:"body1",color:"text.secondary",children:"No receiving reports available"})}),L&&b()]}):e.jsxs(A,{sx:{mt:4,mb:2},children:[e.jsxs(A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(k,{variant:"h5",children:["Receiving Reports (",t.length,")"]}),oe&&e.jsx(B,{variant:"contained",color:"primary",startIcon:e.jsx(it,{}),onClick:he,children:"New Receiving Report"})]}),t.map((i,a)=>e.jsxs(Ut,{expanded:C===`panel${a}`,onChange:re(`panel${a}`),sx:{mb:2},children:[e.jsx(Wt,{expandIcon:e.jsx(ct,{}),sx:{backgroundColor:"rgba(0, 0, 0, 0.03)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.06)"}},children:e.jsxs(A,{sx:{display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},children:[e.jsxs(A,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Dt,{sx:{mr:2}}),e.jsxs(k,{variant:"subtitle1",sx:{fontWeight:"bold"},children:["Batch #",i.batch_number]})]}),e.jsxs(A,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.invoice&&e.jsx(_e,{label:`Invoice: ${i.invoice}`,size:"small",color:"primary",variant:"outlined"}),e.jsx(_e,{label:`Received: ${ne(i.created_at)}`,size:"small",sx:{backgroundColor:"primary.light",color:"white"}}),i.is_paid?e.jsx(_e,{label:"PAID",size:"small",color:"success"}):e.jsx(_e,{label:"UNPAID",size:"small",color:"error"}),e.jsxs(k,{variant:"subtitle1",sx:{fontWeight:"bold"},children:["₱",ve(i).toFixed(2)]}),c&&e.jsx(V,{color:"primary",size:"small",onClick:o=>{o.stopPropagation(),K(i)},children:e.jsx(tt,{})}),e.jsx(ze,{title:"Print Receiving Report",children:e.jsx(V,{size:"small",onClick:o=>{o.stopPropagation(),z(i),setTimeout(Y,100)},children:e.jsx(ot,{})})})]})]})}),e.jsx(Bt,{sx:{p:0},children:e.jsx(A,{sx:{p:2},children:e.jsxs(N,{container:!0,spacing:2,children:[e.jsxs(N,{item:!0,xs:12,md:6,children:[e.jsx(k,{variant:"subtitle1",sx:{fontWeight:"bold",mt:2,mb:1},children:"Report Details"}),e.jsxs(A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(k,{variant:"body2",children:[e.jsx("strong",{children:"Batch Number:"})," ",i.batch_number]}),e.jsxs(k,{variant:"body2",children:[e.jsx("strong",{children:"Invoice:"})," ",i.invoice||"N/A"]}),e.jsxs(k,{variant:"body2",children:[e.jsx("strong",{children:"Payment Terms:"})," ",i.term||0," days"]}),e.jsxs(k,{variant:"body2",children:[e.jsx("strong",{children:"Received Date:"})," ",ne(i.created_at)]}),e.jsxs(k,{variant:"body2",children:[e.jsx("strong",{children:"Payment Status:"})," ",i.is_paid?"Paid":"Unpaid"]})]})]}),e.jsx(N,{item:!0,xs:12,md:6,children:e.jsx(Ue,{referenceNumber:i.rr_id,uploadedFiles:i.attachments||[],onFilesChange:(o,l)=>{},modelType:"receiving-reports"})}),e.jsxs(N,{item:!0,xs:12,children:[e.jsx(rt,{products:r,attributes:s,receivedItems:i.received_items||[],onItemChange:()=>{},onAddItem:()=>{},onRemoveItem:()=>{},errors:{},disabled:!0,status:"completed"}),e.jsx(at,{costTypes:h,additionalCosts:i.additional_costs||[],onCostChange:()=>{},onAddCost:()=>{},onRemoveCost:()=>{},errors:{},disabled:!0,status:"completed",showTotals:!0,calculateTotalCosts:()=>(i.additional_costs||[]).reduce((o,l)=>o+(Number(l.amount)||0),0)})]}),e.jsxs(N,{item:!0,xs:12,sx:{mt:2},children:[e.jsx(_t,{}),e.jsxs(A,{sx:{display:"flex",justifyContent:"space-between",p:2},children:[e.jsx(A,{children:c&&e.jsx(B,{variant:"outlined",color:"primary",startIcon:e.jsx(tt,{}),onClick:()=>K(i),children:"Edit Report"})}),e.jsxs(k,{variant:"h6",children:["Grand Total: ₱",ve(i).toFixed(2)]})]})]})]})})})]},i.rr_id||a)),L&&b(),e.jsx(Lt,{receivingReport:F,contentRef:p}),e.jsx(Es,{open:W,onClose:()=>P(!1),costTypeId:null,onSuccess:()=>{}})]})},ks=()=>e.jsxs(A,{children:[e.jsx(te,{variant:"rectangular",width:40,height:40,sx:{mb:2}}),e.jsx(te,{variant:"rectangular",height:60,sx:{mb:4}}),e.jsx(te,{variant:"text",sx:{fontSize:"2rem",mb:2}}),e.jsxs(N,{container:!0,spacing:3,children:[e.jsxs(N,{item:!0,xs:12,children:[e.jsx(te,{variant:"text",sx:{fontSize:"1.2rem",mb:1}}),e.jsx(te,{variant:"text",sx:{fontSize:"1.2rem",mb:2}})]}),e.jsx(N,{item:!0,xs:12,children:e.jsx(te,{variant:"rectangular",height:300})})]})]}),je=[{label:"Pending",value:"pending"},{label:"Partially Received",value:"partially_received"},{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"}],ui=()=>{var ne,oe;const{id:t}=jt(),r=bt(),[s,h]=m.useState({items:[],additional_costs:[],received_items:[]}),n=m.useRef(),w=lt.useReactToPrint({contentRef:n}),[v,_]=m.useState({}),[y,p]=m.useState(0),[C,j]=m.useState(!1),[L,d]=m.useState(""),[u,x]=m.useState(!1),S=ke(gt),g=ke(yt),I=ke(Ct),[f,F]=m.useState(!1),[z,q]=m.useState(!1),{data:R,isLoading:W,refetch:P}=St(t),$=Pt(),M=It(),Y=wt(),re=Rt(),Ce=Tt(),[he,K]=m.useState([]),Se=(c,b="append")=>{K(b==="append"?i=>{const a=c.filter(o=>!i.some(l=>l.id===o.id));return[...i,...a]}:c)};m.useEffect(()=>{var c;if(R){if(h({...R,items:R.items.map(i=>({...i,received_quantity:i.received_quantity||0})),received_items:R.status==="partially_received"&&((c=R.received_items)==null?void 0:c.length)===0?[{product_id:"",attribute_id:"",received_quantity:0,cost_price:0,walk_in_price:0,term_price:0,wholesale_price:0,regular_price:0,remarks:""}]:R.received_items||[]}),R!=null&&R.attachments){const i=R.attachments.map(a=>({id:a.id,file_size:a.file_size,file_name:a.file_name,file_path:a.file_path,file_type:a.file_type}));K(i)}const b=je.findIndex(i=>i.value===R.status);p(b)}},[R]);const we=()=>{h(c=>({...c,items:[...c.items,{product_id:"",attribute_id:"",requested_quantity:1,price:0}]}))},xe=c=>{if(s.items.length>1){const b=s.items.filter((a,o)=>o!==c);h(a=>({...a,items:b}));const i={...v};Object.keys(i).forEach(a=>{a.startsWith(`items.${c}`)&&delete i[a]}),_(i)}},Re=async()=>{var b,i;const c={};if(O&&s.items.forEach((a,o)=>{a.product_id||(c[`items.${o}.product_id`]="Product is required"),a.attribute_id||(c[`items.${o}.attribute_id`]="Measurement is required"),(!a.requested_quantity||a.requested_quantity<=0)&&(c[`items.${o}.requested_quantity`]="Quantity must be greater than 0"),(!a.price||a.price<=0)&&(c[`items.${o}.price`]="Price must be greater than 0")}),J&&s.received_items.forEach((a,o)=>{a.product_id||(c[`received_items.${o}.product_id`]="Product is required"),(!a.received_quantity||Number(a.received_quantity)<=0)&&(c[`received_items.${o}.received_quantity`]="Received quantity must be greater than 0"),Object.entries({cost_price:"Cost price",walk_in_price:"Walk-in price",wholesale_price:"Wholesale price",regular_price:"Regular price"}).forEach(([E,D])=>{(!a[E]||Number(a[E])<=0)&&(c[`received_items.${o}.${E}`]=`${D} must be greater than 0`)})}),Object.keys(c).length>0){_(c),console.log(c),ee.error("Please fill in all required fields correctly");return}try{q(!0),await Y.mutateAsync({id:t,data:s}),ee.success("Purchase Order updated successfully"),P()}catch(a){(i=(b=a.response)==null?void 0:b.data)!=null&&i.errors&&_(a.response.data.errors),ee.error("Something went wrong please try again")}finally{q(!1)}},Te=()=>{let c="";s.status==="pending"?c="partially_received":s.status==="partially_received"&&(c="completed"),d(c),j(!0)},fe=()=>s.items.reduce((c,b)=>c+b.price*b.requested_quantity,0),ae=async()=>{var i,a;_({});let c=!1;const b={};if(O&&s.items.forEach((o,l)=>{o.product_id||(b[`items.${l}.product_id`]="Product is required",c=!0),o.attribute_id||(b[`items.${l}.attribute_id`]="Measurement is required",c=!0),(!o.requested_quantity||o.requested_quantity<=0)&&(b[`items.${l}.requested_quantity`]="Quantity must be greater than 0",c=!0),(!o.price||o.price<=0)&&(b[`items.${l}.price`]="Price must be greater than 0",c=!0)}),s.received_items.forEach((o,l)=>{console.log(o,l),o.product_id||(b[`received_items.${l}.product_id`]="Product is required",c=!0),(!o.received_quantity||Number(o.received_quantity)<=0)&&(b[`received_items.${l}.received_quantity`]="Received quantity must be greater than 0",c=!0),Object.entries({cost_price:"Cost price",walk_in_price:"Walk-in price",wholesale_price:"Wholesale price",regular_price:"Regular price"}).forEach(([D,Ae])=>{(!o[D]||Number(o[D])<=0)&&(b[`received_items.${l}.${D}`]=`${Ae} must be greater than 0`,c=!0)})}),c){_(b),j(!1),ee.error("Please fill in all required fields correctly");return}try{x(!0),await Y.mutateAsync({id:t,data:{...s,status:L}}),s.attachment instanceof File&&await Ce.mutateAsync({id:t,file:s.attachment}),j(!1),ee.success("Purchase Order updated successfully"),P()}catch(o){(a=(i=o.response)==null?void 0:i.data)!=null&&a.errors&&(_(o.response.data.errors),ee.error("Something went wrong please try again")),x(!1),j(!1)}finally{x(!1)}},Z=(c,b,i)=>{if(b==="product_id"&&i&&s.items.some((l,E)=>E!==c&&l.product_id===i)){_(l=>({...l,[`items.${c}.product_id`]:"This product is already added"}));return}const a=[...s.items];a[c]={...a[c],[b]:i},h(o=>({...o,items:a})),v[`items.${c}.${b}`]&&_(o=>{const l={...o};return delete l[`items.${c}.${b}`],l})},Le=async c=>{try{await $.mutateAsync(c)}catch(b){return Promise.reject(b)}},Pe=async(c,b)=>{try{console.log(c,b),await M.mutateAsync({rrID:c,data:b})}catch(i){return Promise.reject(i)}},O=s.status==="pending",J=s.status==="partially_received";s.status,s.status;const Ie=()=>O?"Mark as Partially Received":J?"Mark as Completed":"",Ee=()=>L==="partially_received"?"Are you sure you want to mark this Purchase Order as partially received? This will allow you to start recording received quantities.":L==="completed"?"Are you sure you want to mark this Purchase Order as completed? This action cannot be undone.":"",ve=()=>{$e.fire({title:"Are you sure?",text:"You want to cancel this purchase order? This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, cancel it!",cancelButtonText:"No, keep it"}).then(async c=>{if(c.isConfirmed)try{x(!0),await re.mutateAsync({id:t,status:"cancelled"}),$e.fire("Cancelled!","The purchase order has been cancelled.","success"),P()}catch{$e.fire("Error!","Failed to cancel the purchase order.","error")}finally{x(!1)}})};return W?e.jsx(ks,{}):e.jsxs(Gt,{maxWidth:"xxl",sx:{mt:0,mb:4},children:[e.jsxs(A,{sx:{mb:4},children:[e.jsx(_s,{activeStep:y,sx:{mb:4},children:je.map((c,b)=>e.jsx(Xt,{children:e.jsx(Ne,{sx:{"& .MuiStepLabel-label":{color:y===3&&c.value==="cancelled"?"error.main":b===je.length-1?"grey.400":"primary.primary"},"& .MuiStepIcon-root":{color:y===3&&c.value==="cancelled"?"error.main":b===je.length-1?"grey.400":"primary.primary"}},children:c.label})},c.value))}),e.jsxs(A,{sx:{display:"flex",justifyContent:"space-between",mb:4},children:[e.jsx(V,{onClick:()=>r("/app/purchase"),sx:{mb:2},color:"primary",children:e.jsx(js,{})}),e.jsxs(A,{sx:{display:"flex",gap:2,justifyContent:"flex-end",mt:2},children:[e.jsx(ze,{title:"Save Purchase Order",children:e.jsx(V,{variant:"contained",color:"primary",onClick:Re,disabled:z||!O&&!J,children:z?e.jsx(A,{children:e.jsx(ie,{size:"30px"})}):e.jsx(Cs,{})})}),e.jsx(ze,{title:"Print Purchase Order",children:e.jsx(V,{onClick:w,color:"primary",children:e.jsx(ot,{})})})]}),e.jsx(Et,{purchaseOrder:R,contentRef:n})]}),e.jsx(le,{elevation:0,sx:{p:0,mb:3},children:e.jsxs(N,{container:!0,spacing:3,alignItems:"flex-start",children:[e.jsxs(N,{item:!0,xs:12,md:8,children:[e.jsxs(k,{variant:"h5",sx:{mb:2},children:["Purchase Order: ",R==null?void 0:R.po_number]}),e.jsxs(k,{variant:"subtitle1",sx:{mb:2},children:["Supplier: ",(ne=R==null?void 0:R.supplier)==null?void 0:ne.supplier_name]}),e.jsxs(k,{variant:"subtitle1",sx:{mb:2},children:["PO Date: ",new Date(R==null?void 0:R.po_date).toLocaleDateString()]})]}),e.jsx(N,{item:!0,xs:12,md:4,children:e.jsx(A,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:e.jsx(Ue,{referenceNumber:t,uploadedFiles:he,onFilesChange:Se,modelType:"purchase-orders"})})})]})}),e.jsxs(le,{elevation:0,sx:{p:0},children:[e.jsxs(N,{item:!0,xs:12,children:[e.jsx(Be,{children:e.jsxs(Ge,{children:[e.jsxs(Ve,{children:[e.jsx(G,{children:e.jsx(T,{colSpan:O?6:5,children:e.jsx(k,{variant:"h5",children:"Requested Items"})})}),e.jsxs(G,{children:[e.jsx(T,{children:"Product"}),e.jsx(T,{children:"Measurement"}),e.jsx(T,{children:"Request Quantity"}),e.jsx(T,{children:"Price"}),e.jsx(T,{children:"Total"}),O&&e.jsx(T,{width:50})]})]}),e.jsxs(Ye,{children:[s.items.map((c,b)=>{var i,a,o;return e.jsxs(G,{children:[e.jsx(T,{sx:{verticalAlign:"top"},children:O?e.jsx(be,{size:"small",sx:{width:300},value:(S==null?void 0:S.find(l=>l.id===c.product_id))||null,onChange:(l,E)=>Z(b,"product_id",E?E.id:""),options:(S==null?void 0:S.filter(l=>!s.items.some((E,D)=>D!==b&&E.product_id===l.id)))||[],getOptionLabel:l=>l.product_name||"",isOptionEqualToValue:(l,E)=>l.id===E,renderInput:l=>e.jsx(U,{...l,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!v[`items.${b}.product_id`],helperText:v[`items.${b}.product_id`]||"Required"})}):(i=c.product)==null?void 0:i.product_name}),e.jsx(T,{sx:{verticalAlign:"top"},children:O?e.jsx(be,{size:"small",sx:{width:300},value:(g==null?void 0:g.find(l=>l.id===c.attribute_id))||null,onChange:(l,E)=>Z(b,"attribute_id",E?E.id:""),options:(g==null?void 0:g.filter(l=>!s.items.some((E,D)=>D!==b&&E.attribute_id===l.id)))||[],getOptionLabel:l=>`${l.attribute_name} (${l.unit_of_measurement})`||"",isOptionEqualToValue:(l,E)=>l.id===E,renderInput:l=>e.jsx(U,{...l,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!v[`items.${b}.attribute_id`],helperText:v[`items.${b}.attribute_id`]||"Required"})}):`${(a=c.attribute)==null?void 0:a.attribute_name} (${(o=c.attribute)==null?void 0:o.unit_of_measurement})`}),e.jsx(T,{sx:{verticalAlign:"top"},children:O?e.jsx(U,{type:"number",value:c.requested_quantity,onChange:l=>Z(b,"requested_quantity",l.target.value),error:!!v[`items.${b}.requested_quantity`],helperText:v[`items.${b}.requested_quantity`]||"Required",inputProps:{min:1},disabled:!O,size:"small"}):c.requested_quantity}),e.jsx(T,{sx:{verticalAlign:"top"},children:O?e.jsx(U,{type:"number",value:c.price,onChange:l=>Z(b,"price",l.target.value),error:!!v[`items.${b}.price`],helperText:v[`items.${b}.price`]||"Required",inputProps:{min:0,step:.01},disabled:!O,size:"small"}):`₱${c.price}`}),e.jsxs(T,{sx:{verticalAlign:"top"},children:["₱",(c.price*c.requested_quantity).toFixed(2)]}),O&&e.jsx(T,{sx:{verticalAlign:"top"},children:e.jsx(V,{onClick:()=>xe(b),disabled:s.items.length===1,children:e.jsx(He,{})})})]},b)}),e.jsxs(G,{children:[e.jsx(T,{colSpan:3,children:e.jsx(B,{sx:{visibility:O?"visible":"hidden"},startIcon:e.jsx(ge,{}),onClick:we,children:"Add Item"})}),e.jsx(T,{verticalAlign:"left",children:e.jsx(k,{variant:"h5",textAlign:"left",children:"Total Requested: "})}),e.jsx(T,{children:e.jsxs(k,{variant:"h5",children:["₱",fe().toFixed(2)]})})]})]})]})}),e.jsx(A,{sx:{mt:2,display:"flex",justifyContent:"flex-end"}}),!O&&e.jsx(As,{receivingReports:(oe=s.receiving_reports)==null?void 0:oe.map(c=>({...c,supplier:s.supplier})),products:S,costTypes:I,attributes:g,status:s.status,poId:s.po_id,poNumber:s.po_number,onCreateReceivingReport:Le,onUpdateReceivingReport:Pe})]}),e.jsx(N,{item:!0,xs:12,md:4,children:e.jsxs(A,{sx:{display:"flex",mt:4,justifyContent:"flex-end",gap:2},children:[J&&e.jsx(B,{variant:"contained",onClick:ve,disabled:u,color:"error",startIcon:e.jsx(bs,{}),sx:{minWidth:200},children:"Cancel Order"}),(O||J)&&!u&&e.jsx(B,{variant:"contained",onClick:Te,disabled:Y.isPending,color:"primary",sx:{minWidth:200},children:Ie()})]})})]})]}),e.jsxs(Qe,{open:C,onClose:()=>j(!1),PaperProps:{sx:{borderRadius:2,minWidth:"500px",padding:2,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)"}},children:[e.jsx(Xe,{sx:{fontSize:"1.5rem",fontWeight:600,color:"#333",pb:1},children:"Confirm Status Update"}),e.jsx(Je,{sx:{pt:2},children:e.jsx(Vt,{sx:{fontSize:"1.1rem",color:"#555",lineHeight:1.5},children:Ee()})}),e.jsxs(Ke,{sx:{padding:3,paddingTop:2,gap:2},children:[e.jsx(B,{onClick:()=>j(!1),sx:{fontSize:"1rem",minWidth:"100px",textTransform:"none"},children:"Cancel"}),e.jsx(B,{onClick:ae,variant:"contained",color:"primary",disabled:u,sx:{fontSize:"1rem",minWidth:"100px",textTransform:"none",boxShadow:2},children:u?e.jsxs(A,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{size:20,color:"inherit"}),e.jsx("span",{children:"Updating..."})]}):"Confirm"})]})]}),e.jsx(At,{open:f,handleClose:()=>F(!1)})]})};export{ui as default};
