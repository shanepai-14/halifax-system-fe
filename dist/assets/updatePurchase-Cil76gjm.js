import{r as m,g as ce,h as de,s as H,w as pe,j as e,k as se,z as ue,C as X,ai as pt,m as me,aj as et,l as nt,R as We,L as k,P as le,T as $,_ as V,Y as qe,ak as ut,V as mt,W as ht,$ as ie,F as B,al as xt,am as ft,an as vt,X as _e,a0 as ze,U as N,N as _t,ab as jt,a5 as bt,a1 as ke,ae as gt,af as yt,ag as Ct,K as ee}from"./index-MFznN85Y.js";import{S as $e}from"./sweetalert2.esm.all-D3pEHXw3.js";import{b as St,c as wt,d as Rt,e as Tt}from"./usePurchaseOrders-DsqBzRCK.js";import{P as Lt,u as Pt,a as It}from"./PrintableRR-DW-kKDwG.js";import{P as ot}from"./Print-CJWXSkGr.js";import{P as Et}from"./PrintablePO-MJo22uJI.js";import{l as lt}from"./index-Bcs7yvqa.js";import{A as At}from"./AddCostTypeModal-DX3FL-31.js";import{c as kt,s as $t,r as Ft}from"./filepond.esm-Uz-eCX8X.js";import{A as Mt}from"./Add-kteAXJ42.js";import{D as qt}from"./Download-BY58O9BX.js";import{C as zt}from"./Close-DO7wEk0s.js";import{E as ct}from"./ExpandMore-BzTe7MED.js";import{R as Dt}from"./Receipt-C31MjGex.js";import{E as tt}from"./Edit-acnduTpd.js";import{a as G,b as R,T as U,c as Be,d as Ge,e as Ve,f as Ye}from"./TextField-DllOVEH5.js";import{A as be}from"./Autocomplete-9P9ImrtI.js";import{R as He}from"./DeleteOutlined-B6C8z9xI.js";import{R as ge}from"./PlusOutlined-BFHWOpzv.js";import{D as Qe}from"./Dialog-EsyIrAit.js";import{D as Xe,a as Ke}from"./DialogTitle-DU-OKhNB.js";import{R as Ot}from"./CloseOutlined-DFy-qra4.js";import{A as Nt}from"./Alert-DmcZosAT.js";import{g as De}from"./index.esm-DVSvLc0O.js";import{S as Oe}from"./Switch-CnQRh0Es.js";import{D as Je}from"./DialogActions-Cg7Nf5jf.js";import{A as Ut,a as Wt,b as Bt}from"./AccordionSummary-BZHLhEJ9.js";import{C as Gt}from"./Container-BReizEgd.js";import{D as Vt}from"./DialogContentText-DxIWO7Tt.js";import{S as te}from"./Skeleton-BXQeoAq0.js";import"./InputLabel-WGrZKIER.js";import"./Close-B6M6Y8BO.js";const ye=m.createContext({}),Ze=m.createContext({});function Yt(t){return de("MuiStep",t)}ce("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const Ht=t=>{const{classes:r,orientation:s,alternativeLabel:h,completed:n}=t;return ue({root:["root",s,h&&"alternativeLabel",n&&"completed"]},Yt,r)},Qt=H("div",{name:"MuiStep",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation],s.alternativeLabel&&r.alternativeLabel,s.completed&&r.completed]}})({variants:[{props:{orientation:"horizontal"},style:{paddingLeft:8,paddingRight:8}},{props:{alternativeLabel:!0},style:{flex:1,position:"relative"}}]}),Xt=m.forwardRef(function(r,s){const h=pe({props:r,name:"MuiStep"}),{active:n,children:S,className:f,component:v="div",completed:y,disabled:p,expanded:C=!1,index:_,last:T,...d}=h,{activeStep:u,connector:b,alternativeLabel:g,orientation:x,nonLinear:E}=m.useContext(ye);let[P=!1,L=!1,M=!1]=[n,y,p];u===_?P=n!==void 0?n:!0:!E&&u>_?L=y!==void 0?y:!0:!E&&u<_&&(M=p!==void 0?p:!0);const z=m.useMemo(()=>({index:_,last:T,expanded:C,icon:_+1,active:P,completed:L,disabled:M}),[_,T,C,P,L,M]),w={...h,active:P,orientation:x,alternativeLabel:g,completed:L,disabled:M,expanded:C,component:v},W=Ht(w),I=e.jsxs(Qt,{as:v,className:se(W.root,f),ref:s,ownerState:w,...d,children:[b&&g&&_!==0?b:null,S]});return e.jsx(Ze.Provider,{value:z,children:b&&!g&&_!==0?e.jsxs(m.Fragment,{children:[b,I]}):I})}),Kt=X(e.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"}),"CheckCircle"),Jt=X(e.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}),"Warning");function Zt(t){return de("MuiStepIcon",t)}const Fe=ce("MuiStepIcon",["root","active","completed","error","text"]);var st;const es=t=>{const{classes:r,active:s,completed:h,error:n}=t;return ue({root:["root",s&&"active",h&&"completed",n&&"error"],text:["text"]},Zt,r)},Me=H(pt,{name:"MuiStepIcon",slot:"Root",overridesResolver:(t,r)=>r.root})(me(({theme:t})=>({display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),color:(t.vars||t).palette.text.disabled,[`&.${Fe.completed}`]:{color:(t.vars||t).palette.primary.main},[`&.${Fe.active}`]:{color:(t.vars||t).palette.primary.main},[`&.${Fe.error}`]:{color:(t.vars||t).palette.error.main}}))),ts=H("text",{name:"MuiStepIcon",slot:"Text",overridesResolver:(t,r)=>r.text})(me(({theme:t})=>({fill:(t.vars||t).palette.primary.contrastText,fontSize:t.typography.caption.fontSize,fontFamily:t.typography.fontFamily}))),ss=m.forwardRef(function(r,s){const h=pe({props:r,name:"MuiStepIcon"}),{active:n=!1,className:S,completed:f=!1,error:v=!1,icon:y,...p}=h,C={...h,active:n,completed:f,error:v},_=es(C);if(typeof y=="number"||typeof y=="string"){const T=se(S,_.root);return v?e.jsx(Me,{as:Jt,className:T,ref:s,ownerState:C,...p}):f?e.jsx(Me,{as:Kt,className:T,ref:s,ownerState:C,...p}):e.jsxs(Me,{className:T,ref:s,ownerState:C,...p,children:[st||(st=e.jsx("circle",{cx:"12",cy:"12",r:"12"})),e.jsx(ts,{className:_.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:C,children:y})]})}return y});function is(t){return de("MuiStepLabel",t)}const Q=ce("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),rs=t=>{const{classes:r,orientation:s,active:h,completed:n,error:S,disabled:f,alternativeLabel:v}=t;return ue({root:["root",s,S&&"error",f&&"disabled",v&&"alternativeLabel"],label:["label",h&&"active",n&&"completed",S&&"error",f&&"disabled",v&&"alternativeLabel"],iconContainer:["iconContainer",h&&"active",n&&"completed",S&&"error",f&&"disabled",v&&"alternativeLabel"],labelContainer:["labelContainer",v&&"alternativeLabel"]},is,r)},as=H("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation]]}})({display:"flex",alignItems:"center",[`&.${Q.alternativeLabel}`]:{flexDirection:"column"},[`&.${Q.disabled}`]:{cursor:"default"},variants:[{props:{orientation:"vertical"},style:{textAlign:"left",padding:"8px 0"}}]}),ns=H("span",{name:"MuiStepLabel",slot:"Label",overridesResolver:(t,r)=>r.label})(me(({theme:t})=>({...t.typography.body2,display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),[`&.${Q.active}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${Q.completed}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${Q.alternativeLabel}`]:{marginTop:16},[`&.${Q.error}`]:{color:(t.vars||t).palette.error.main}}))),os=H("span",{name:"MuiStepLabel",slot:"IconContainer",overridesResolver:(t,r)=>r.iconContainer})({flexShrink:0,display:"flex",paddingRight:8,[`&.${Q.alternativeLabel}`]:{paddingRight:0}}),ls=H("span",{name:"MuiStepLabel",slot:"LabelContainer",overridesResolver:(t,r)=>r.labelContainer})(me(({theme:t})=>({width:"100%",color:(t.vars||t).palette.text.secondary,[`&.${Q.alternativeLabel}`]:{textAlign:"center"}}))),Ne=m.forwardRef(function(r,s){const h=pe({props:r,name:"MuiStepLabel"}),{children:n,className:S,componentsProps:f={},error:v=!1,icon:y,optional:p,slots:C={},slotProps:_={},StepIconComponent:T,StepIconProps:d,...u}=h,{alternativeLabel:b,orientation:g}=m.useContext(ye),{active:x,disabled:E,completed:P,icon:L}=m.useContext(Ze),M=y||L;let z=T;M&&!z&&(z=ss);const w={...h,active:x,alternativeLabel:b,completed:P,disabled:E,error:v,orientation:g},W=rs(w),I={slots:C,slotProps:{stepIcon:d,...f,..._}},[F,q]=et("label",{elementType:ns,externalForwardedProps:I,ownerState:w}),[Y,re]=et("stepIcon",{elementType:z,externalForwardedProps:I,ownerState:w});return e.jsxs(as,{className:se(W.root,S),ref:s,ownerState:w,...u,children:[M||Y?e.jsx(os,{className:W.iconContainer,ownerState:w,children:e.jsx(Y,{completed:P,active:x,error:v,icon:M,...re})}):null,e.jsxs(ls,{className:W.labelContainer,ownerState:w,children:[n?e.jsx(F,{...q,className:se(W.label,q==null?void 0:q.className),children:n}):null,p]})]})});Ne&&(Ne.muiName="StepLabel");function cs(t){return de("MuiStepConnector",t)}ce("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const ds=t=>{const{classes:r,orientation:s,alternativeLabel:h,active:n,completed:S,disabled:f}=t,v={root:["root",s,h&&"alternativeLabel",n&&"active",S&&"completed",f&&"disabled"],line:["line",`line${nt(s)}`]};return ue(v,cs,r)},ps=H("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation],s.alternativeLabel&&r.alternativeLabel,s.completed&&r.completed]}})({flex:"1 1 auto",variants:[{props:{orientation:"vertical"},style:{marginLeft:12}},{props:{alternativeLabel:!0},style:{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"}}]}),us=H("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.line,r[`line${nt(s.orientation)}`]]}})(me(({theme:t})=>{const r=t.palette.mode==="light"?t.palette.grey[400]:t.palette.grey[600];return{display:"block",borderColor:t.vars?t.vars.palette.StepConnector.border:r,variants:[{props:{orientation:"horizontal"},style:{borderTopStyle:"solid",borderTopWidth:1}},{props:{orientation:"vertical"},style:{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24}}]}})),ms=m.forwardRef(function(r,s){const h=pe({props:r,name:"MuiStepConnector"}),{className:n,...S}=h,{alternativeLabel:f,orientation:v="horizontal"}=m.useContext(ye),{active:y,disabled:p,completed:C}=m.useContext(Ze),_={...h,alternativeLabel:f,orientation:v,active:y,completed:C,disabled:p},T=ds(_);return e.jsx(ps,{className:se(T.root,n),ref:s,ownerState:_,...S,children:e.jsx(us,{className:T.line,ownerState:_})})});function hs(t){return de("MuiStepper",t)}ce("MuiStepper",["root","horizontal","vertical","nonLinear","alternativeLabel"]);const xs=t=>{const{orientation:r,nonLinear:s,alternativeLabel:h,classes:n}=t;return ue({root:["root",r,s&&"nonLinear",h&&"alternativeLabel"]},hs,n)},fs=H("div",{name:"MuiStepper",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation],s.alternativeLabel&&r.alternativeLabel,s.nonLinear&&r.nonLinear]}})({display:"flex",variants:[{props:{orientation:"horizontal"},style:{flexDirection:"row",alignItems:"center"}},{props:{orientation:"vertical"},style:{flexDirection:"column"}},{props:{alternativeLabel:!0},style:{alignItems:"flex-start"}}]}),vs=e.jsx(ms,{}),_s=m.forwardRef(function(r,s){const h=pe({props:r,name:"MuiStepper"}),{activeStep:n=0,alternativeLabel:S=!1,children:f,className:v,component:y="div",connector:p=vs,nonLinear:C=!1,orientation:_="horizontal",...T}=h,d={...h,nonLinear:C,alternativeLabel:S,orientation:_,component:y},u=xs(d),b=m.Children.toArray(f).filter(Boolean),g=b.map((E,P)=>m.cloneElement(E,{index:P,last:P+1===b.length,...E.props})),x=m.useMemo(()=>({activeStep:n,alternativeLabel:S,connector:p,nonLinear:C,orientation:_}),[n,S,p,C,_]);return e.jsx(ye.Provider,{value:x,children:e.jsx(fs,{as:y,ownerState:d,className:se(u.root,v),ref:s,...T,children:g})})}),it=X(e.jsx("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"AddCircleOutline"),js=X(e.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBackOutlined"),bs=X(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"}),"CancelOutlined"),gs=X(e.jsx("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess"),ys=X(e.jsx("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile"),Cs=X(e.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save");/*!
 * react-filepond v7.1.3
 * A handy FilePond adapter component for React
 * 
 * Copyright (c) 2024 PQINA
 * https://pqina.nl/filepond
 * 
 * Licensed under the MIT license.
 */const Ss=$t(),ws=["setOptions","on","off","onOnce","appendTo","insertAfter","insertBefore","isAttachedTo","replaceElement","restoreElement","destroy"];class Rs extends We.Component{constructor(r){super(r),this.allowFilesSync=!0}componentDidMount(){if(this._input=this._element.querySelector('input[type="file"]'),this._inputClone=this._input.cloneNode(),!Ss)return;const r=Object.assign({},this.props);if(r.onupdatefiles){const s=r.onupdatefiles;r.onupdatefiles=h=>{this.allowFilesSync=!1,s(h)}}this._pond=kt(this._input,r),Object.keys(this._pond).filter(s=>!ws.includes(s)).forEach(s=>{this[s]=this._pond[s]})}componentWillUnmount(){if(!this._pond)return;const r=document.createElement("div");r.append(this._pond.element),r.id="foo",this._pond.destroy(),this._pond=void 0,this._element.append(this._inputClone)}shouldComponentUpdate(){return this.allowFilesSync?!0:(this.allowFilesSync=!0,!1)}componentDidUpdate(){if(!this._pond)return;const r=Object.assign({},this.props);delete r.onupdatefiles,this._pond.setOptions(r)}render(){const{id:r,name:s,className:h,allowMultiple:n,required:S,captureMethod:f,acceptedFileTypes:v}=this.props;return m.createElement("div",{className:"filepond--wrapper",ref:y=>this._element=y},m.createElement("input",{type:"file",name:s,id:r,accept:v,multiple:n,required:S,className:h,capture:f}))}}/*!
 * FilePondPluginFileValidateType 1.2.9
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */const dt=({addFilter:t,utils:r})=>{const{Type:s,isString:h,replaceInString:n,guesstimateMimeType:S,getExtensionFromFilename:f,getFilenameFromURL:v}=r,y=(d,u)=>{const b=(/^[^/]+/.exec(d)||[]).pop(),g=u.slice(0,-2);return b===g},p=(d,u)=>d.some(b=>/\*$/.test(b)?y(u,b):b===u),C=d=>{let u="";if(h(d)){const b=v(d),g=f(b);g&&(u=S(g))}else u=d.type;return u},_=(d,u,b)=>{if(u.length===0)return!0;const g=C(d);return b?new Promise((x,E)=>{b(d,g).then(P=>{p(u,P)?x():E()}).catch(E)}):p(u,g)},T=d=>u=>d[u]===null?!1:d[u]||u;return t("SET_ATTRIBUTE_TO_OPTION_MAP",d=>Object.assign(d,{accept:"acceptedFileTypes"})),t("ALLOW_HOPPER_ITEM",(d,{query:u})=>u("GET_ALLOW_FILE_TYPE_VALIDATION")?_(d,u("GET_ACCEPTED_FILE_TYPES")):!0),t("LOAD_FILE",(d,{query:u})=>new Promise((b,g)=>{if(!u("GET_ALLOW_FILE_TYPE_VALIDATION")){b(d);return}const x=u("GET_ACCEPTED_FILE_TYPES"),E=u("GET_FILE_VALIDATE_TYPE_DETECT_TYPE"),P=_(d,x,E),L=()=>{const M=x.map(T(u("GET_FILE_VALIDATE_TYPE_LABEL_EXPECTED_TYPES_MAP"))).filter(w=>w!==!1),z=M.filter((w,W)=>M.indexOf(w)===W);g({status:{main:u("GET_LABEL_FILE_TYPE_NOT_ALLOWED"),sub:n(u("GET_FILE_VALIDATE_TYPE_LABEL_EXPECTED_TYPES"),{allTypes:z.join(", "),allButLastType:z.slice(0,-1).join(", "),lastType:z[z.length-1]})}})};if(typeof P=="boolean")return P?b(d):L();P.then(()=>{b(d)}).catch(L)})),{options:{allowFileTypeValidation:[!0,s.BOOLEAN],acceptedFileTypes:[[],s.ARRAY],labelFileTypeNotAllowed:["File is of invalid type",s.STRING],fileValidateTypeLabelExpectedTypes:["Expects {allButLastType} or {lastType}",s.STRING],fileValidateTypeLabelExpectedTypesMap:[{},s.OBJECT],fileValidateTypeDetectType:[null,s.FUNCTION]}}},Ts=typeof window<"u"&&typeof window.document<"u";Ts&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:dt}));Ft(dt);const Ls=({files:t,onRemove:r})=>{const[s,h]=m.useState(!1),[n,S]=m.useState(null),f=p=>{if(p===0)return"0 Bytes";const C=1024,_=["Bytes","KB","MB","GB"],T=Math.floor(Math.log(p)/Math.log(C));return parseFloat((p/Math.pow(C,T)).toFixed(2))+" "+_[T]},v=async p=>{try{S(p),(await qe.post(`/attachments/${p}`)).data.status==="success"?r(p):console.error("Failed to delete attachment")}catch(C){S(null),console.error("Error deleting attachment:",C)}finally{S(null)}},y=async p=>{try{const C=await qe.get(`/storage/${p.file_path}`,{responseType:"blob"}),_=new Blob([C.data],{type:p.file_type}),T=window.URL.createObjectURL(_),d=document.createElement("a");d.href=T,d.download=p.file_name,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(T)}catch(C){console.error("Error downloading file:",C)}};return e.jsxs(k,{sx:{position:"relative"},children:[e.jsx(ut,{in:!s,collapsedSize:75,children:e.jsx(k,{sx:{display:"flex",flexWrap:"wrap",gap:1.5},children:t.map((p,C)=>e.jsx(mt,{onClick:()=>y(p),sx:{width:100,overflow:"visible",cursor:"pointer",position:"relative",transition:"transform 0.2s ease, box-shadow 0.2s ease","&:hover":{transform:"translateY(-2px)",boxShadow:"0 4px 8px rgba(0,0,0,0.1)","& .download-overlay":{opacity:1},"& .file-icon":{opacity:0}}},children:e.jsxs(ht,{sx:{p:1.5,"&:last-child":{pb:1.5},overflow:"visible",position:"relative"},children:[e.jsxs(k,{sx:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:[e.jsx(ys,{className:"file-icon",sx:{fontSize:20,color:"action.active",transition:"opacity 0.2s ease"},color:"action"}),e.jsx(k,{className:"download-overlay",sx:{position:"absolute",top:12,left:11,opacity:0,transition:"opacity 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",width:"20px",height:"20px"},children:e.jsx(qt,{sx:{fontSize:23,color:"primary.main"}})}),e.jsx(V,{size:"small",disabled:n===p.id,onClick:_=>{_.stopPropagation(),v(p.id)},sx:{borderRadius:100,position:"absolute",top:-6,right:-6,backgroundColor:"#E5E4E2"},children:e.jsxs(k,{children:[" ",n===p.id?e.jsx(ie,{size:"15px"}):e.jsx(zt,{sx:{fontSize:20}})]})})]}),e.jsx($,{variant:"body2",sx:{mt:.5,fontSize:"0.75rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:p.file_name}),p.file_size&&e.jsx($,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:f(p.file_size)})]})},p.id||C))})}),t.length>3&&e.jsx(B,{fullWidth:!0,size:"small",endIcon:s?e.jsx(gs,{}):e.jsx(ct,{}),onClick:()=>h(!s),sx:{mt:1},children:s?"Show Less":"Show More"})]})},Ue=({uploadedFiles:t=[],onFilesChange:r,referenceNumber:s,modelType:h})=>{const[n,S]=m.useState([]),[f,v]=m.useState(!1),y=C=>{S(C)},p=C=>{const _=t.filter(T=>T.id!==C);r(_,"replace")};return e.jsxs(k,{sx:{maxWidth:"100%",p:0,position:"relative"},children:[e.jsxs(le,{elevation:1,sx:{p:1},children:[e.jsx(k,{sx:{mb:1},children:e.jsxs($,{variant:"h6",sx:{display:"flex",alignItems:"center"},children:["Uploaded Attachment",e.jsx(V,{onClick:()=>v(!f),sx:{ml:1},children:e.jsx(Mt,{})})]})}),e.jsx(Ls,{files:t,onRemove:p})]}),e.jsx(le,{elevation:3,sx:{visibility:f?"visible":"hidden",position:"absolute",top:"100%",left:0,right:24,mt:1.2,p:2,zIndex:1e3,width:"100%",backgroundColor:"background.paper"},children:e.jsx(Rs,{files:n,onupdatefiles:y,allowMultiple:!0,maxFiles:10,name:"attachments",labelIdle:"Upload Attachment",acceptedFileTypes:["image/*","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet"],server:{process:async(C,_,T,d,u,b)=>{try{const g=new FormData;g.append("attachments[]",_);let x="";switch(h){case"purchase-orders":x=`/purchase-orders/${s}/attachments`;break;case"receiving-reports":x=`/receiving-reports/${s}/attachments`;break}const E=await qe.post(x,g,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:P=>{b(P.lengthComputable,P.loaded,P.total)}});if(E.data.status==="success"){const P=E.data.data.attachments[0];d(P.id),r&&(console.log(P),r([P])),S([])}else u("Upload failed")}catch(g){u("Upload failed"),console.error("Upload error:",g)}}},stylePanelLayout:"compact",styleLoadIndicatorPosition:"center bottom",styleProgressIndicatorPosition:"right bottom",styleButtonRemoveItemPosition:"left bottom",styleButtonProcessItemPosition:"right bottom"})})]})},Ps=We.memo(({item:t,index:r,products:s,errors:h,onItemChange:n,onRemoveItem:S,disabled:f,isCompleted:v,isCancelled:y,distributionCostPerUnit:p,isEditing:C})=>{const _=m.useMemo(()=>!t.received_quantity||!t.cost_price?"₱0.00":`₱${(parseFloat(t.cost_price||0)+p).toFixed(2)}`,[t.cost_price,t.received_quantity,p]),T=m.useMemo(()=>`₱${(t.cost_price*t.received_quantity).toFixed(2)}`,[t.cost_price,t.received_quantity]),d=m.useCallback((L,M)=>{n(r,"product_id",M?M.id:"")},[r,n]),u=m.useCallback(L=>{n(r,"received_quantity",L.target.value)},[r,n]),b=m.useCallback(L=>{n(r,"cost_price",L.target.value)},[r,n]),g=m.useCallback(L=>{n(r,"walk_in_price",L.target.value)},[r,n]);m.useCallback(L=>{n(r,"wholesale_price",L.target.value)},[r,n]),m.useCallback(L=>{n(r,"regular_price",L.target.value)},[r,n]);const x=m.useCallback(()=>{S(r)},[r,S]),E=m.useMemo(()=>(s==null?void 0:s.filter(L=>!s.some((M,z)=>z!==r&&M.product_id===L.id)))||[],[s,r]),P=m.useMemo(()=>(s==null?void 0:s.find(L=>L.id===t.product_id))||null,[s,t.product_id]);return m.useEffect(()=>{if(t.received_quantity&&t.cost_price&&p>0){const L=parseFloat(t.cost_price||0)+p;t.distribution_price!==L.toFixed(2)&&n(r,"distribution_price",L.toFixed(2))}},[t.cost_price,t.received_quantity,p,r,n,t.distribution_price]),e.jsxs(G,{children:[e.jsx(R,{sx:{verticalAlign:"top"},children:!v&&!y?e.jsx(be,{value:P,onChange:d,options:E,size:"small",sx:{width:300},getOptionLabel:L=>L.product_name||"",isOptionEqualToValue:(L,M)=>L.id===M,disabled:f,renderInput:L=>e.jsx(U,{...L,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!h[`received_items.${r}.product_id`],helperText:h[`received_items.${r}.product_id`]||"Required"})}):(P==null?void 0:P.product_name)||""}),e.jsx(R,{sx:{verticalAlign:"top"},children:!v&&!y?e.jsx(U,{type:"number",value:parseInt(t.received_quantity),onChange:u,error:!!h[`received_items.${r}.received_quantity`],helperText:h[`received_items.${r}.received_quantity`]||"Required",inputProps:{min:0,step:"0"},disabled:C&&parseInt(t.received_quantity)!=0?C:f,size:"small"}):parseInt(t.received_quantity)}),e.jsx(R,{sx:{verticalAlign:"top"},children:!v&&!y?e.jsx(U,{type:"number",value:t.cost_price,onChange:b,error:!!h[`received_items.${r}.cost_price`],helperText:h[`received_items.${r}.cost_price`]||"Required",inputProps:{min:0,step:"0.01"},disabled:f,size:"small"}):`₱${t.cost_price}`}),e.jsx(R,{sx:{verticalAlign:"top"},children:e.jsx(U,{type:"text",value:_,readOnly:!0,size:"small",sx:{"& .MuiInputBase-input":{color:"rgba(0, 0, 0, 0.87)"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(0, 0, 0, 0.23)"}}})}),e.jsx(R,{sx:{verticalAlign:"top"},children:!v&&!y?e.jsx(U,{type:"number",value:t.walk_in_price,onChange:g,error:!!h[`received_items.${r}.walk_in_price`],helperText:h[`received_items.${r}.walk_in_price`]||"Required",inputProps:{min:0,step:"0.01"},disabled:f,size:"small"}):`₱${t.walk_in_price}`}),e.jsx(R,{sx:{verticalAlign:"top"},children:T}),!f&&!v&&!y&&e.jsx(R,{sx:{verticalAlign:"top"},children:e.jsx(V,{size:"large",onClick:x,disabled:f||t.isLastItem,children:e.jsx(He,{})})})]})}),Is=({products:t,attributes:r,receivedItems:s,onItemChange:h,onAddItem:n,onRemoveItem:S,errors:f={},disabled:v=!1,status:y,totalAdditonalCost:p,isEditing:C})=>{const _=y==="completed",T=y==="cancelled",d=m.useMemo(()=>s.reduce((g,x)=>g+parseFloat(x.cost_price||0)*parseFloat(x.received_quantity||0),0),[s]),u=m.useMemo(()=>{if(!p||p<=0||s.length===0)return 0;const g=s.reduce((x,E)=>x+parseFloat(E.received_quantity||0),0);return g<=0?0:parseFloat(p)/g},[p,s]),b=m.useCallback(()=>{n()},[n]);return e.jsx(Be,{sx:{mt:4},children:e.jsxs(Ge,{size:"small",children:[e.jsxs(Ve,{children:[e.jsx(G,{children:e.jsx(R,{colSpan:_?8:9,children:e.jsx($,{variant:"h5",children:"Received Items"})})}),e.jsxs(G,{children:[e.jsx(R,{children:"Product"}),e.jsx(R,{children:"Received Qty"}),e.jsx(R,{children:"Cost Price"}),e.jsx(R,{children:"Distribution Cost"}),e.jsx(R,{children:"Walk-in Price"}),e.jsx(R,{children:"Total"}),!v&&e.jsx(R,{width:50})]})]}),e.jsxs(Ye,{children:[s.map((g,x)=>e.jsx(Ps,{item:g,index:x,products:t,errors:f,onItemChange:h,onRemoveItem:S,disabled:v,isCompleted:_,isCancelled:T,distributionCostPerUnit:u,isLastItem:s.length===1,isEditing:C},`${g.product_id||"new"}-${x}`)),e.jsxs(G,{children:[e.jsx(R,{colSpan:5,sx:{border:"none"},children:e.jsx(B,{startIcon:e.jsx(ge,{}),onClick:b,sx:{visibility:!v&&!_&&!T?"visible":"hidden"},children:"Add Received Item"})}),e.jsx(R,{children:e.jsx($,{variant:"h5",children:"Total Received:"})}),e.jsxs(R,{children:["₱",d.toFixed(2)]})]})]})]})})},rt=We.memo(Is),at=({costTypes:t=[],additionalCosts:r=[],onCostChange:s,onAddCost:h,onRemoveCost:n,errors:S={},disabled:f=!1,status:v,showTotals:y=!1,calculateTotalCosts:p=()=>0,onAddCostType:C})=>{const d=f||v==="completed"||v==="cancelled";return e.jsx(e.Fragment,{children:e.jsx(Be,{sx:{mt:4},children:e.jsxs(Ge,{size:"small",children:[e.jsxs(Ve,{children:[e.jsx(G,{children:e.jsx(R,{colSpan:d?3:4,children:e.jsxs(k,{sx:{display:"flex",alignItems:"center"},children:[e.jsx($,{variant:"h5",children:"Additional Costs"}),C&&!d&&e.jsx(V,{sx:{marginLeft:"8px !important"},onClick:C,children:e.jsx(ge,{})})]})})}),e.jsxs(G,{children:[e.jsx(R,{children:"Cost Type"}),e.jsx(R,{children:"Amount"}),e.jsx(R,{children:"Remarks"}),!d&&e.jsx(R,{width:50})]})]}),e.jsxs(Ye,{children:[r.map((u,b)=>{var g;return e.jsxs(G,{children:[e.jsx(R,{children:d?((g=t==null?void 0:t.find(x=>x.cost_type_id===u.cost_type_id))==null?void 0:g.name)||"":e.jsx(be,{size:"small",value:(t==null?void 0:t.find(x=>x.cost_type_id===u.cost_type_id))||null,onChange:(x,E)=>s(b,"cost_type_id",E?E.cost_type_id:""),options:(t==null?void 0:t.filter(x=>x.is_active&&!r.some((E,P)=>P!==b&&E.cost_type_id===x.cost_type_id)))||[],getOptionLabel:x=>x.name||"",isOptionEqualToValue:(x,E)=>x.cost_type_id===E,renderInput:x=>e.jsx(U,{...x,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!S[`additional_costs.${b}.cost_type_id`],helperText:S[`additional_costs.${b}.cost_type_id`]||"Required"})})}),e.jsx(R,{children:d?`₱${parseFloat(u.amount).toFixed(2)}`:e.jsx(U,{size:"small",type:"number",value:u.amount,onChange:x=>s(b,"amount",x.target.value),error:!!S[`additional_costs.${b}.amount`],helperText:S[`additional_costs.${b}.amount`]||"Required",inputProps:{min:0,step:.01}})}),e.jsx(R,{sx:{verticalAlign:"top"},children:d?u.remarks||"":e.jsx(U,{size:"small",value:u.remarks||"",onChange:x=>s(b,"remarks",x.target.value),fullWidth:!0})}),!d&&e.jsx(R,{sx:{verticalAlign:"top"},children:e.jsx(V,{size:"large",onClick:()=>n(b),disabled:r.length===0,children:e.jsx(He,{})})})]},b)}),r.length===0&&e.jsx(G,{children:e.jsx(R,{colSpan:d?3:4,align:"center",sx:{py:3},children:e.jsx($,{variant:"body2",color:"text.secondary",children:"No additional costs"})})}),e.jsxs(G,{children:[e.jsx(R,{sx:{border:"none"},colSpan:d?2:3,children:e.jsx(B,{startIcon:e.jsx(ge,{}),onClick:h,sx:{visibility:d?"hidden":"visible"},children:"Add Additional Cost"})}),y&&e.jsx(R,{children:e.jsxs($,{variant:"h6",children:["₱",p().toFixed(2)]})})]})]})]})})})},Es=({open:t,onClose:r,costTypeId:s=null,onSuccess:h})=>{var P,L,M,z,w,W;const[n,S]=m.useState({name:"",code:"",description:"",is_active:!0,is_deduction:!1}),[f,v]=m.useState({}),y=!!s,{data:p,isLoading:C}=xt(s),_=ft(),T=vt(),d=_.isPending||T.isPending;m.useEffect(()=>{t&&(y&&p?S({name:p.name||"",code:p.code||"",description:p.description||"",is_active:p.is_active??!0,is_deduction:p.is_deduction??!1}):y||S({name:"",code:"",description:"",is_active:!0,is_deduction:!1}),v({}))},[t,y,p]);const u=(I,F)=>{S(q=>({...q,[I]:F})),f[I]&&v(q=>({...q,[I]:""}))},b=()=>{const I={};return n.name.trim()?n.name.trim().length<2?I.name="Cost type name must be at least 2 characters":n.name.trim().length>100&&(I.name="Cost type name must be less than 100 characters"):I.name="Cost type name is required",n.code.trim()?n.code.trim().length<2?I.code="Cost type code must be at least 2 characters":n.code.trim().length>20&&(I.code="Cost type code must be less than 20 characters"):I.code="Cost type code is required",n.description&&n.description.trim().length>500&&(I.description="Description must be less than 500 characters"),v(I),Object.keys(I).length===0},g=async()=>{var F,q;if(!b())return;const I={name:n.name.trim(),code:n.code.trim().toUpperCase(),description:n.description.trim()||null,is_active:n.is_active,is_deduction:n.is_deduction};try{y?await T.mutateAsync({id:s,data:I}):await _.mutateAsync(I),h&&h(),x()}catch(Y){(q=(F=Y.response)==null?void 0:F.data)!=null&&q.errors&&v(Y.response.data.errors)}},x=()=>{d||(S({name:"",code:"",description:"",is_active:!0,is_deduction:!1}),v({}),r())},E=_.error||T.error;return e.jsxs(Qe,{open:t,onClose:x,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{minHeight:"400px"}},children:[e.jsx(Xe,{children:e.jsxs(k,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx($,{variant:"h6",children:y?"Edit Cost Type":"Create New Cost Type"}),e.jsx(V,{onClick:x,disabled:d,size:"small",children:e.jsx(Ot,{})})]})}),e.jsx(Ke,{dividers:!0,children:y&&C?e.jsx(k,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(ie,{})}):e.jsxs(k,{sx:{display:"flex",flexDirection:"column",gap:3,pt:1},children:[E&&e.jsx(Nt,{severity:"error",children:((M=(L=(P=_.error)==null?void 0:P.response)==null?void 0:L.data)==null?void 0:M.message)||((W=(w=(z=T.error)==null?void 0:z.response)==null?void 0:w.data)==null?void 0:W.message)||"An error occurred. Please try again."}),e.jsx(U,{label:"Cost Type Name",value:n.name,onChange:I=>u("name",I.target.value),error:!!f.name,helperText:f.name||"Enter a descriptive name for this cost type",fullWidth:!0,required:!0,disabled:d,inputProps:{maxLength:100}}),e.jsx(U,{label:"Cost Type Code",value:n.code,onChange:I=>u("code",I.target.value.toUpperCase()),error:!!f.code,helperText:f.code||"Enter a unique code (e.g., SHIPPING, TAX, etc.)",fullWidth:!0,required:!0,disabled:d,inputProps:{maxLength:20},placeholder:"e.g., SHIPPING"}),e.jsx(U,{label:"Description",value:n.description,onChange:I=>u("description",I.target.value),error:!!f.description,helperText:f.description||"Optional description for this cost type",fullWidth:!0,multiline:!0,rows:3,disabled:d,inputProps:{maxLength:500}}),e.jsx(De,{control:e.jsx(Oe,{checked:n.is_active,onChange:I=>u("is_active",I.target.checked),disabled:d}),label:e.jsxs(k,{children:[e.jsx($,{variant:"body1",children:"Active"}),e.jsx($,{variant:"caption",color:"text.secondary",children:n.is_active?"This cost type can be used in purchase orders":"This cost type will be hidden from selection"})]})}),e.jsx(De,{control:e.jsx(Oe,{checked:n.is_deduction,onChange:I=>u("is_deduction",I.target.checked),disabled:d}),label:e.jsxs(k,{children:[e.jsx($,{variant:"body1",children:"Deduction"}),e.jsx($,{variant:"caption",color:"text.secondary",children:n.is_deduction?"This cost will be subtracted from the total amount":"This cost will be added to the total amount"})]})})]})}),e.jsxs(Je,{sx:{px:3,py:2},children:[e.jsx(B,{onClick:x,disabled:d,color:"inherit",children:"Cancel"}),e.jsx(B,{onClick:g,variant:"contained",disabled:d||y&&C,startIcon:d?e.jsx(ie,{size:16}):null,children:d?y?"Updating...":"Creating...":y?"Update Cost Type":"Create Cost Type"})]})]})},As=({receivingReports:t=[],products:r=[],attributes:s=[],costTypes:h=[],status:n,poId:S,poNumber:f,onCreateReceivingReport:v,onUpdateReceivingReport:y})=>{const p=m.useRef(),[C,_]=m.useState(!1),[T,d]=m.useState(!1),[u,b]=m.useState(!1),[g,x]=m.useState(!1),[E,P]=m.useState(null),[L,M]=m.useState(null),[z,w]=m.useState({}),[W,I]=m.useState(!1),[F,q]=m.useState({invoice:"",term:0,is_paid:!1,received_items:[{product_id:"",attribute_id:"",received_quantity:0,cost_price:0,distribution_price:0,walk_in_price:0,term_price:0,wholesale_price:0,regular_price:0,remarks:""}],additional_costs:[],attachments:[]}),Y=lt.useReactToPrint({contentRef:p}),re=i=>(a,o)=>{_(o?i:!1)},Ce=()=>{I(!0)},he=()=>{q({invoice:"",term:0,is_paid:!1,received_items:[{product_id:"",attribute_id:"",received_quantity:0,cost_price:0,distribution_price:0,walk_in_price:0,term_price:0,wholesale_price:0,regular_price:0,remarks:""}],additional_costs:[],attachments:[]}),w({}),x(!1),P(null),d(!0)},J=i=>{q({invoice:i.invoice||"",term:i.term||0,is_paid:i.is_paid||!1,received_items:i.received_items?[...i.received_items]:[],additional_costs:i.additional_costs?[...i.additional_costs]:[],attachments:i.attachments||[]}),w({}),x(!0),P(i.rr_id),d(!0)},Se=(i,a,o)=>{const l=[...F.additional_costs];l[i]={...l[i],[a]:o},q(A=>({...A,additional_costs:l})),z[`additional_costs.${i}.${a}`]&&w(A=>{const D={...A};return delete D[`additional_costs.${i}.${a}`],D})},we=(i,a,o="append")=>{q(g?o==="append"?l=>{const A=i.filter(D=>!l.attachments.some(Ae=>Ae.id===D.id));return{...l,attachments:[...l.attachments||[],...A]}}:l=>({...l,attachments:i}):l=>({...l,attachments:o==="append"?[...l.attachments||[],...i]:i}))},xe=()=>F.additional_costs.reduce((i,a)=>i+(Number(a.amount)||0),0),Re=()=>{const i={cost_type_id:"",amount:0,remarks:""};q(a=>({...a,additional_costs:[...a.additional_costs,i]}))},Te=i=>{const a=F.additional_costs.filter((o,l)=>l!==i);q(o=>({...o,additional_costs:a}))},fe=()=>{d(!1)},ae=(i,a)=>{q(o=>({...o,[i]:a})),z[i]&&w(o=>{const l={...o};return delete l[i],l})},Z=(i,a,o)=>{a=="distribution_price"&&console.log("distribution_price",o);const l=[...F.received_items];l[i]={...l[i],[a]:o},q(A=>({...A,received_items:l})),z[`received_items.${i}.${a}`]&&w(A=>{const D={...A};return delete D[`received_items.${i}.${a}`],D})},Le=()=>{const i={product_id:"",attribute_id:"",received_quantity:0,cost_price:0,distribution_price:0,walk_in_price:0,term_price:0,wholesale_price:0,regular_price:0,remarks:""};q(a=>({...a,received_items:[...a.received_items,i]}))},Pe=i=>{if(F.received_items.length>1){const a=F.received_items.filter((o,l)=>l!==i);q(o=>({...o,received_items:a}))}},O=()=>{const i={};return F.received_items.forEach((a,o)=>{a.product_id||(i[`received_items.${o}.product_id`]="Product is required"),(!a.received_quantity||Number(a.received_quantity)<=0)&&(i[`received_items.${o}.received_quantity`]="Received quantity must be greater than 0"),Object.entries({cost_price:"Cost price",walk_in_price:"Walk-in price"}).forEach(([A,D])=>{(!a[A]||Number(a[A])<=0)&&(i[`received_items.${o}.${A}`]=`${D} must be greater than 0`)})}),w(i),Object.keys(i).length===0},K=async()=>{var i,a;if(O())try{b(!0);const o={po_id:S,invoice:F.invoice,term:F.term,is_paid:F.is_paid,received_items:F.received_items.map(l=>({...l,wholesale_price:l.walk_in_price,regular_price:l.walk_in_price})),additional_costs:F.additional_costs};g?await y(E,o):await v(o),d(!1),b(!1)}catch(o){console.error(`Error ${g?"updating":"creating"} receiving report:`,o),b(!1),(a=(i=o.response)==null?void 0:i.data)!=null&&a.errors&&w(o.response.data.errors)}},Ie=i=>i.reduce((a,o)=>a+o.cost_price*o.received_quantity,0),Ee=i=>i.reduce((a,o)=>a+(Number(o.amount)||0),0),ve=i=>{const a=Ie(i.received_items||[]),o=Ee(i.additional_costs||[]);return a+o},ne=i=>new Date(i).toLocaleDateString(),oe=n==="partially_received"&&v,c=(n==="partially_received"||n==="completed")&&y,j=()=>e.jsxs(Qe,{open:T,onClose:fe,fullWidth:!0,maxWidth:"lg",children:[e.jsx(Xe,{children:g?`Edit Receiving Report for ${f}`:`Create New Receiving Report for PO ${f}`}),e.jsxs(Ke,{children:[e.jsx(k,{sx:{mb:3,mt:2},children:e.jsxs(N,{container:!0,spacing:3,children:[e.jsx(N,{item:!0,xs:12,md:6,children:e.jsx(U,{label:"Reference Number",fullWidth:!0,value:F.invoice,onChange:i=>ae("invoice",i.target.value),helperText:"Optional"})}),e.jsx(N,{item:!0,xs:12,md:6,children:e.jsx(U,{label:"Payment Terms (days)",type:"number",fullWidth:!0,value:F.term,onChange:i=>ae("term",i.target.value),inputProps:{min:0}})}),e.jsx(N,{item:!0,xs:12,md:6,children:e.jsx(De,{control:e.jsx(Oe,{checked:F.is_paid,onChange:i=>ae("is_paid",i.target.checked),color:"primary"}),label:"Mark as Paid"})}),e.jsx(N,{item:!0,xs:12,children:e.jsx(Ue,{referenceNumber:E||"temp",uploadedFiles:F.attachments||[],onFilesChange:(i,a)=>we(i,E,a),modelType:"receiving-reports"})})]})}),e.jsx(rt,{products:r,attributes:s,receivedItems:F.received_items,onItemChange:Z,onAddItem:Le,onRemoveItem:Pe,errors:z,disabled:!1,status:n,totalAdditonalCost:xe(),isEditing:g}),e.jsx(at,{costTypes:h,additionalCosts:F.additional_costs,onCostChange:Se,onAddCost:Re,onRemoveCost:Te,errors:z,disabled:!1,status:"partially_received",showTotals:!0,calculateTotalCosts:xe,onAddCostType:Ce})]}),e.jsxs(Je,{children:[e.jsx(B,{onClick:fe,disabled:u,children:"Cancel"}),e.jsx(B,{onClick:K,variant:"contained",color:"primary",disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(ie,{size:24,color:"inherit",sx:{mr:1}}),g?"Updating...":"Creating..."]}):g?"Update Receiving Report":"Create Receiving Report"})]})]});return!t||t.length===0?e.jsxs(k,{sx:{mt:4,mb:2},children:[e.jsxs(k,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx($,{variant:"h5",children:"Receiving Reports"}),oe&&e.jsx(B,{variant:"contained",color:"primary",startIcon:e.jsx(it,{}),onClick:he,children:"New Receiving Report"})]}),e.jsx(le,{elevation:0,sx:{p:3,textAlign:"center"},children:e.jsx($,{variant:"body1",color:"text.secondary",children:"No receiving reports available"})}),T&&j()]}):e.jsxs(k,{sx:{mt:4,mb:2},children:[e.jsxs(k,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs($,{variant:"h5",children:["Receiving Reports (",t.length,")"]}),oe&&e.jsx(B,{variant:"contained",color:"primary",startIcon:e.jsx(it,{}),onClick:he,children:"New Receiving Report"})]}),t.map((i,a)=>e.jsxs(Ut,{expanded:C===`panel${a}`,onChange:re(`panel${a}`),sx:{mb:2},children:[e.jsx(Wt,{expandIcon:e.jsx(ct,{}),sx:{backgroundColor:"rgba(0, 0, 0, 0.03)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.06)"}},children:e.jsxs(k,{sx:{display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},children:[e.jsxs(k,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Dt,{sx:{mr:2}}),e.jsxs($,{variant:"subtitle1",sx:{fontWeight:"bold"},children:["Batch #",i.batch_number]})]}),e.jsxs(k,{sx:{display:"flex",alignItems:"center",gap:2},children:[i.invoice&&e.jsx(_e,{label:`Invoice: ${i.invoice}`,size:"small",color:"primary",variant:"outlined"}),e.jsx(_e,{label:`Received: ${ne(i.created_at)}`,size:"small",sx:{backgroundColor:"primary.light",color:"white"}}),i.is_paid?e.jsx(_e,{label:"PAID",size:"small",color:"success"}):e.jsx(_e,{label:"UNPAID",size:"small",color:"error"}),e.jsxs($,{variant:"subtitle1",sx:{fontWeight:"bold"},children:["₱",ve(i).toFixed(2)]}),c&&e.jsx(V,{color:"primary",size:"small",onClick:o=>{o.stopPropagation(),J(i)},children:e.jsx(tt,{})}),e.jsx(ze,{title:"Print Receiving Report",children:e.jsx(V,{size:"small",onClick:o=>{o.stopPropagation(),M(i),setTimeout(Y,100)},children:e.jsx(ot,{})})})]})]})}),e.jsx(Bt,{sx:{p:0},children:e.jsx(k,{sx:{p:2},children:e.jsxs(N,{container:!0,spacing:2,children:[e.jsxs(N,{item:!0,xs:12,md:6,children:[e.jsx($,{variant:"subtitle1",sx:{fontWeight:"bold",mt:2,mb:1},children:"Report Details"}),e.jsxs(k,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs($,{variant:"body2",children:[e.jsx("strong",{children:"Batch Number:"})," ",i.batch_number]}),e.jsxs($,{variant:"body2",children:[e.jsx("strong",{children:"Invoice:"})," ",i.invoice||"N/A"]}),e.jsxs($,{variant:"body2",children:[e.jsx("strong",{children:"Payment Terms:"})," ",i.term||0," days"]}),e.jsxs($,{variant:"body2",children:[e.jsx("strong",{children:"Received Date:"})," ",ne(i.created_at)]}),e.jsxs($,{variant:"body2",children:[e.jsx("strong",{children:"Payment Status:"})," ",i.is_paid?"Paid":"Unpaid"]})]})]}),e.jsx(N,{item:!0,xs:12,md:6,children:e.jsx(Ue,{referenceNumber:i.rr_id,uploadedFiles:i.attachments||[],onFilesChange:(o,l)=>{},modelType:"receiving-reports"})}),e.jsxs(N,{item:!0,xs:12,children:[e.jsx(rt,{products:r,attributes:s,receivedItems:i.received_items||[],onItemChange:()=>{},onAddItem:()=>{},onRemoveItem:()=>{},errors:{},disabled:!0,status:"completed"}),e.jsx(at,{costTypes:h,additionalCosts:i.additional_costs||[],onCostChange:()=>{},onAddCost:()=>{},onRemoveCost:()=>{},errors:{},disabled:!0,status:"completed",showTotals:!0,calculateTotalCosts:()=>(i.additional_costs||[]).reduce((o,l)=>o+(Number(l.amount)||0),0)})]}),e.jsxs(N,{item:!0,xs:12,sx:{mt:2},children:[e.jsx(_t,{}),e.jsxs(k,{sx:{display:"flex",justifyContent:"space-between",p:2},children:[e.jsx(k,{children:c&&e.jsx(B,{variant:"outlined",color:"primary",startIcon:e.jsx(tt,{}),onClick:()=>J(i),children:"Edit Report"})}),e.jsxs($,{variant:"h6",children:["Grand Total: ₱",ve(i).toFixed(2)]})]})]})]})})})]},i.rr_id||a)),T&&j(),e.jsx(Lt,{receivingReport:L,contentRef:p}),e.jsx(Es,{open:W,onClose:()=>I(!1),costTypeId:null,onSuccess:()=>{}})]})},ks=()=>e.jsxs(k,{children:[e.jsx(te,{variant:"rectangular",width:40,height:40,sx:{mb:2}}),e.jsx(te,{variant:"rectangular",height:60,sx:{mb:4}}),e.jsx(te,{variant:"text",sx:{fontSize:"2rem",mb:2}}),e.jsxs(N,{container:!0,spacing:3,children:[e.jsxs(N,{item:!0,xs:12,children:[e.jsx(te,{variant:"text",sx:{fontSize:"1.2rem",mb:1}}),e.jsx(te,{variant:"text",sx:{fontSize:"1.2rem",mb:2}})]}),e.jsx(N,{item:!0,xs:12,children:e.jsx(te,{variant:"rectangular",height:300})})]})]}),je=[{label:"Pending",value:"pending"},{label:"Partially Received",value:"partially_received"},{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"}],ui=()=>{var ne,oe;const{id:t}=jt(),r=bt(),[s,h]=m.useState({items:[],additional_costs:[],received_items:[]}),n=m.useRef(),S=lt.useReactToPrint({contentRef:n}),[f,v]=m.useState({}),[y,p]=m.useState(0),[C,_]=m.useState(!1),[T,d]=m.useState(""),[u,b]=m.useState(!1),g=ke(gt),x=ke(yt),E=ke(Ct),[P,L]=m.useState(!1),[M,z]=m.useState(!1),{data:w,isLoading:W,refetch:I}=St(t),F=Pt(),q=It(),Y=wt(),re=Rt(),Ce=Tt(),[he,J]=m.useState([]),Se=(c,j="append")=>{J(j==="append"?i=>{const a=c.filter(o=>!i.some(l=>l.id===o.id));return[...i,...a]}:c)};m.useEffect(()=>{var c;if(w){if(h({...w,items:w.items.map(i=>({...i,received_quantity:i.received_quantity||0})),received_items:w.status==="partially_received"&&((c=w.received_items)==null?void 0:c.length)===0?[{product_id:"",attribute_id:"",received_quantity:0,cost_price:0,walk_in_price:0,term_price:0,wholesale_price:0,regular_price:0,remarks:""}]:w.received_items||[]}),w!=null&&w.attachments){const i=w.attachments.map(a=>({id:a.id,file_size:a.file_size,file_name:a.file_name,file_path:a.file_path,file_type:a.file_type}));J(i)}const j=je.findIndex(i=>i.value===w.status);p(j)}},[w]);const we=()=>{h(c=>({...c,items:[...c.items,{product_id:"",attribute_id:"",requested_quantity:1,price:0}]}))},xe=c=>{if(s.items.length>1){const j=s.items.filter((a,o)=>o!==c);h(a=>({...a,items:j}));const i={...f};Object.keys(i).forEach(a=>{a.startsWith(`items.${c}`)&&delete i[a]}),v(i)}},Re=async()=>{var j,i;const c={};if(O&&s.items.forEach((a,o)=>{a.product_id||(c[`items.${o}.product_id`]="Product is required"),a.attribute_id||(c[`items.${o}.attribute_id`]="Measurement is required"),(!a.requested_quantity||a.requested_quantity<=0)&&(c[`items.${o}.requested_quantity`]="Quantity must be greater than 0"),(!a.price||a.price<=0)&&(c[`items.${o}.price`]="Price must be greater than 0")}),K&&s.received_items.forEach((a,o)=>{a.product_id||(c[`received_items.${o}.product_id`]="Product is required"),(!a.received_quantity||Number(a.received_quantity)<=0)&&(c[`received_items.${o}.received_quantity`]="Received quantity must be greater than 0"),Object.entries({cost_price:"Cost price",walk_in_price:"Walk-in price",wholesale_price:"Wholesale price",regular_price:"Regular price"}).forEach(([A,D])=>{(!a[A]||Number(a[A])<=0)&&(c[`received_items.${o}.${A}`]=`${D} must be greater than 0`)})}),Object.keys(c).length>0){v(c),console.log(c),ee.error("Please fill in all required fields correctly");return}try{z(!0),await Y.mutateAsync({id:t,data:s}),ee.success("Purchase Order updated successfully"),I()}catch(a){(i=(j=a.response)==null?void 0:j.data)!=null&&i.errors&&v(a.response.data.errors),ee.error("Something went wrong please try again")}finally{z(!1)}},Te=()=>{let c="";s.status==="pending"?c="partially_received":s.status==="partially_received"&&(c="completed"),d(c),_(!0)},fe=()=>s.items.reduce((c,j)=>c+j.price*j.requested_quantity,0),ae=async()=>{var i,a;v({});let c=!1;const j={};if(O&&s.items.forEach((o,l)=>{o.product_id||(j[`items.${l}.product_id`]="Product is required",c=!0),o.attribute_id||(j[`items.${l}.attribute_id`]="Measurement is required",c=!0),(!o.requested_quantity||o.requested_quantity<=0)&&(j[`items.${l}.requested_quantity`]="Quantity must be greater than 0",c=!0),(!o.price||o.price<=0)&&(j[`items.${l}.price`]="Price must be greater than 0",c=!0)}),s.received_items.forEach((o,l)=>{console.log(o,l),o.product_id||(j[`received_items.${l}.product_id`]="Product is required",c=!0),(!o.received_quantity||Number(o.received_quantity)<=0)&&(j[`received_items.${l}.received_quantity`]="Received quantity must be greater than 0",c=!0),Object.entries({cost_price:"Cost price",walk_in_price:"Walk-in price",wholesale_price:"Wholesale price",regular_price:"Regular price"}).forEach(([D,Ae])=>{(!o[D]||Number(o[D])<=0)&&(j[`received_items.${l}.${D}`]=`${Ae} must be greater than 0`,c=!0)})}),c){v(j),_(!1),ee.error("Please fill in all required fields correctly");return}try{b(!0),await Y.mutateAsync({id:t,data:{...s,status:T}}),s.attachment instanceof File&&await Ce.mutateAsync({id:t,file:s.attachment}),_(!1),ee.success("Purchase Order updated successfully"),I()}catch(o){(a=(i=o.response)==null?void 0:i.data)!=null&&a.errors&&(v(o.response.data.errors),ee.error("Something went wrong please try again")),b(!1),_(!1)}finally{b(!1)}},Z=(c,j,i)=>{if(j==="product_id"&&i&&s.items.some((l,A)=>A!==c&&l.product_id===i)){v(l=>({...l,[`items.${c}.product_id`]:"This product is already added"}));return}const a=[...s.items];a[c]={...a[c],[j]:i},h(o=>({...o,items:a})),f[`items.${c}.${j}`]&&v(o=>{const l={...o};return delete l[`items.${c}.${j}`],l})},Le=async c=>{try{await F.mutateAsync(c)}catch(j){return Promise.reject(j)}},Pe=async(c,j)=>{try{console.log(c,j),await q.mutateAsync({rrID:c,data:j})}catch(i){return Promise.reject(i)}},O=s.status==="pending",K=s.status==="partially_received";s.status,s.status;const Ie=()=>O?"Mark as Partially Received":K?"Mark as Completed":"",Ee=()=>T==="partially_received"?"Are you sure you want to mark this Purchase Order as partially received? This will allow you to start recording received quantities.":T==="completed"?"Are you sure you want to mark this Purchase Order as completed? This action cannot be undone.":"",ve=()=>{$e.fire({title:"Are you sure?",text:"You want to cancel this purchase order? This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, cancel it!",cancelButtonText:"No, keep it"}).then(async c=>{if(c.isConfirmed)try{b(!0),await re.mutateAsync({id:t,status:"cancelled"}),$e.fire("Cancelled!","The purchase order has been cancelled.","success"),I()}catch{$e.fire("Error!","Failed to cancel the purchase order.","error")}finally{b(!1)}})};return W?e.jsx(ks,{}):e.jsxs(Gt,{maxWidth:"xxl",sx:{mt:0,mb:4},children:[e.jsxs(k,{sx:{mb:4},children:[e.jsx(_s,{activeStep:y,sx:{mb:4},children:je.map((c,j)=>e.jsx(Xt,{children:e.jsx(Ne,{sx:{"& .MuiStepLabel-label":{color:y===3&&c.value==="cancelled"?"error.main":j===je.length-1?"grey.400":"primary.primary"},"& .MuiStepIcon-root":{color:y===3&&c.value==="cancelled"?"error.main":j===je.length-1?"grey.400":"primary.primary"}},children:c.label})},c.value))}),e.jsxs(k,{sx:{display:"flex",justifyContent:"space-between",mb:4},children:[e.jsx(V,{onClick:()=>r("/app/purchase"),sx:{mb:2},color:"primary",children:e.jsx(js,{})}),e.jsxs(k,{sx:{display:"flex",gap:2,justifyContent:"flex-end",mt:2},children:[e.jsx(ze,{title:"Save Purchase Order",children:e.jsx(V,{variant:"contained",color:"primary",onClick:Re,disabled:M||!O&&!K,children:M?e.jsx(k,{children:e.jsx(ie,{size:"30px"})}):e.jsx(Cs,{})})}),e.jsx(ze,{title:"Print Purchase Order",children:e.jsx(V,{onClick:S,color:"primary",children:e.jsx(ot,{})})})]}),e.jsx(Et,{purchaseOrder:w,contentRef:n})]}),e.jsx(le,{elevation:0,sx:{p:0,mb:3},children:e.jsxs(N,{container:!0,spacing:3,alignItems:"flex-start",children:[e.jsxs(N,{item:!0,xs:12,md:8,children:[e.jsxs($,{variant:"h5",sx:{mb:2},children:["Purchase Order: ",w==null?void 0:w.po_number]}),e.jsxs($,{variant:"subtitle1",sx:{mb:2},children:["Supplier: ",(ne=w==null?void 0:w.supplier)==null?void 0:ne.supplier_name]}),e.jsxs($,{variant:"subtitle1",sx:{mb:2},children:["PO Date: ",new Date(w==null?void 0:w.po_date).toLocaleDateString()]})]}),e.jsx(N,{item:!0,xs:12,md:4,children:e.jsx(k,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:e.jsx(Ue,{referenceNumber:t,uploadedFiles:he,onFilesChange:Se,modelType:"purchase-orders"})})})]})}),e.jsxs(le,{elevation:0,sx:{p:0},children:[e.jsxs(N,{item:!0,xs:12,children:[e.jsx(Be,{children:e.jsxs(Ge,{children:[e.jsxs(Ve,{children:[e.jsx(G,{children:e.jsx(R,{colSpan:O?6:5,children:e.jsx($,{variant:"h5",children:"Requested Items"})})}),e.jsxs(G,{children:[e.jsx(R,{children:"Product"}),e.jsx(R,{children:"Measurement"}),e.jsx(R,{children:"Request Quantity"}),e.jsx(R,{children:"Price"}),e.jsx(R,{children:"Total"}),O&&e.jsx(R,{width:50})]})]}),e.jsxs(Ye,{children:[s.items.map((c,j)=>{var i,a,o;return e.jsxs(G,{children:[e.jsx(R,{sx:{verticalAlign:"top"},children:O?e.jsx(be,{size:"small",sx:{width:300},value:(g==null?void 0:g.find(l=>l.id===c.product_id))||null,onChange:(l,A)=>Z(j,"product_id",A?A.id:""),options:(g==null?void 0:g.filter(l=>!s.items.some((A,D)=>D!==j&&A.product_id===l.id)))||[],getOptionLabel:l=>l.product_name||"",isOptionEqualToValue:(l,A)=>l.id===A,renderInput:l=>e.jsx(U,{...l,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!f[`items.${j}.product_id`],helperText:f[`items.${j}.product_id`]||"Required"})}):(i=c.product)==null?void 0:i.product_name}),e.jsx(R,{sx:{verticalAlign:"top"},children:O?e.jsx(be,{size:"small",sx:{width:300},value:(x==null?void 0:x.find(l=>l.id===c.attribute_id))||null,onChange:(l,A)=>Z(j,"attribute_id",A?A.id:""),options:(x==null?void 0:x.filter(l=>!s.items.some((A,D)=>D!==j&&A.attribute_id===l.id)))||[],getOptionLabel:l=>`${l.attribute_name} (${l.unit_of_measurement})`||"",isOptionEqualToValue:(l,A)=>l.id===A,renderInput:l=>e.jsx(U,{...l,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!f[`items.${j}.attribute_id`],helperText:f[`items.${j}.attribute_id`]||"Required"})}):`${(a=c.attribute)==null?void 0:a.attribute_name} (${(o=c.attribute)==null?void 0:o.unit_of_measurement})`}),e.jsx(R,{sx:{verticalAlign:"top"},children:O?e.jsx(U,{type:"number",value:c.requested_quantity,onChange:l=>Z(j,"requested_quantity",l.target.value),error:!!f[`items.${j}.requested_quantity`],helperText:f[`items.${j}.requested_quantity`]||"Required",inputProps:{min:1},disabled:!O,size:"small"}):c.requested_quantity}),e.jsx(R,{sx:{verticalAlign:"top"},children:O?e.jsx(U,{type:"number",value:c.price,onChange:l=>Z(j,"price",l.target.value),error:!!f[`items.${j}.price`],helperText:f[`items.${j}.price`]||"Required",inputProps:{min:0,step:.01},disabled:!O,size:"small"}):`₱${c.price}`}),e.jsxs(R,{sx:{verticalAlign:"top"},children:["₱",(c.price*c.requested_quantity).toFixed(2)]}),O&&e.jsx(R,{sx:{verticalAlign:"top"},children:e.jsx(V,{onClick:()=>xe(j),disabled:s.items.length===1,children:e.jsx(He,{})})})]},j)}),e.jsxs(G,{children:[e.jsx(R,{colSpan:3,children:e.jsx(B,{sx:{visibility:O?"visible":"hidden"},startIcon:e.jsx(ge,{}),onClick:we,children:"Add Item"})}),e.jsx(R,{verticalAlign:"left",children:e.jsx($,{variant:"h5",textAlign:"left",children:"Total Requested: "})}),e.jsx(R,{children:e.jsxs($,{variant:"h5",children:["₱",fe().toFixed(2)]})})]})]})]})}),e.jsx(k,{sx:{mt:2,display:"flex",justifyContent:"flex-end"}}),!O&&e.jsx(As,{receivingReports:(oe=s.receiving_reports)==null?void 0:oe.map(c=>({...c,supplier:s.supplier})),products:g,costTypes:E,attributes:x,status:s.status,poId:s.po_id,poNumber:s.po_number,onCreateReceivingReport:Le,onUpdateReceivingReport:Pe})]}),e.jsx(N,{item:!0,xs:12,md:4,children:e.jsxs(k,{sx:{display:"flex",mt:4,justifyContent:"flex-end",gap:2},children:[K&&e.jsx(B,{variant:"contained",onClick:ve,disabled:u,color:"error",startIcon:e.jsx(bs,{}),sx:{minWidth:200},children:"Cancel Order"}),(O||K)&&!u&&e.jsx(B,{variant:"contained",onClick:Te,disabled:Y.isPending,color:"primary",sx:{minWidth:200},children:Ie()})]})})]})]}),e.jsxs(Qe,{open:C,onClose:()=>_(!1),PaperProps:{sx:{borderRadius:2,minWidth:"500px",padding:2,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)"}},children:[e.jsx(Xe,{sx:{fontSize:"1.5rem",fontWeight:600,color:"#333",pb:1},children:"Confirm Status Update"}),e.jsx(Ke,{sx:{pt:2},children:e.jsx(Vt,{sx:{fontSize:"1.1rem",color:"#555",lineHeight:1.5},children:Ee()})}),e.jsxs(Je,{sx:{padding:3,paddingTop:2,gap:2},children:[e.jsx(B,{onClick:()=>_(!1),sx:{fontSize:"1rem",minWidth:"100px",textTransform:"none"},children:"Cancel"}),e.jsx(B,{onClick:ae,variant:"contained",color:"primary",disabled:u,sx:{fontSize:"1rem",minWidth:"100px",textTransform:"none",boxShadow:2},children:u?e.jsxs(k,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{size:20,color:"inherit"}),e.jsx("span",{children:"Updating..."})]}):"Confirm"})]})]}),e.jsx(At,{open:P,handleClose:()=>L(!1)})]})};export{ui as default};
