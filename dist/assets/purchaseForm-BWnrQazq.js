import{r as x,N as te,_ as se,Q as re,S as T,a9 as ie,aa as ae,U as oe,ab as ne,J as le,j as e,q as $,I as f,T as g,G as p,t as k}from"./index-DSrAcRxp.js";import{a as de}from"./usePurchaseOrders-apmeEOhY.js";import{S as ce}from"./SupplierModal-Dr9MYYhF.js";import{A as v,a as ue}from"./AddCostTypeModal-C7wUCdvc.js";import{C as pe,T as c,R as S,c as E,d as B,e as D,a as I,b as d,f as F}from"./PlusOutlined-CKpybx2v.js";import{R as W}from"./DeleteOutlined-Dzh2-pYC.js";import{B as A}from"./InputLabel-CmXbOXsa.js";import"./index.esm-DddEpk9o.js";import"./DialogTitle-BlGFaLHC.js";import"./FormControlLabel-B0Bo-vhA.js";var me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},he=function(o,u){return x.createElement(te,se({},o,{ref:u,icon:me}))},_e=x.forwardRef(he);const xe={supplier_id:"",po_date:new Date().toISOString().split("T")[0],remarks:"",items:[{product_id:"",requested_quantity:1,price:0}],additional_costs:[]},Se=()=>{const y=re(),[o,u]=x.useState(xe),[l,m]=x.useState({}),h=T(ie),C=T(ae),b=T(oe),_=T(ne),[N,w]=x.useState(!1),[H,L]=x.useState(!1),P=de(),Q=le(),G=async r=>{var s,i;r.preventDefault();const t={};if(o.supplier_id||(t.supplier_id="Supplier is required"),o.items.forEach((a,n)=>{a.product_id||(t[`items.${n}.product_id`]="Product is required"),a.attribute_id||(t[`items.${n}.attribute_id`]="Measurement is required"),(!a.requested_quantity||a.requested_quantity<=0)&&(t[`items.${n}.requested_quantity`]="Quantity must be greater than 0"),(!a.price||a.price<=0)&&(t[`items.${n}.price`]="Price must be greater than 0");const j=o.items.filter(ee=>ee.product_id===a.product_id).length;a.product_id&&j>1&&(t[`items.${n}.product_id`]="Duplicate product is not allowed")}),o.additional_costs.forEach((a,n)=>{a.cost_type_id||(t[`additional_costs.${n}.cost_type_id`]="Cost type is required"),(!a.amount||Number(a.amount)<=0)&&(t[`additional_costs.${n}.amount`]="Amount must be greater than 0")}),Object.keys(t).length>0){m(t),k.error("Please fill in all required fields correctly");return}try{await P.mutateAsync(o),y("/app/purchase"),k.success("Successfully Created Purchase Order")}catch(a){(i=(s=a.response)==null?void 0:s.data)!=null&&i.errors&&m(a.response.data.errors),k.error("Something went wrong please try again")}},J=async r=>{try{await Q.mutateAsync(r),R()}catch(t){console.error("Error creating supplier:",t)}},U=()=>{w(!0)},K=()=>{u(r=>({...r,additional_costs:[...r.additional_costs,{cost_type_id:"",amount:"",remarks:""}]}))},O=(r,t,s)=>{if(t==="cost_type_id"&&s&&o.additional_costs.some((n,j)=>j!==r&&n.cost_type_id===s)){m(n=>({...n,[`additional_costs.${r}.cost_type_id`]:"This cost type is already added"}));return}const i=[...o.additional_costs];i[r]={...i[r],[t]:s},u(a=>({...a,additional_costs:i})),l[`additional_costs.${r}.${t}`]&&m(a=>{const n={...a};return delete n[`additional_costs.${r}.${t}`],n})},V=r=>{const t=o.additional_costs.filter((s,i)=>i!==r);u(s=>({...s,additional_costs:t}))},X=()=>{const r=z(),t=o.additional_costs.reduce((s,i)=>s+(Number(i.amount)||0),0);return r+t},R=()=>{w(!1)},M=r=>{u(t=>({...t,[r.target.name]:r.target.value}))},q=(r,t,s)=>{if(t==="product_id"&&s&&o.items.some((n,j)=>j!==r&&n.product_id===s)){m(n=>({...n,[`items.${r}.product_id`]:"This product is already added"}));return}const i=[...o.items];i[r]={...i[r],[t]:s},u(a=>({...a,items:i})),l[`items.${r}.${t}`]&&m(a=>{const n={...a};return delete n[`items.${r}.${t}`],n})},Y=()=>{u(r=>({...r,items:[...r.items,{product_id:"",requested_quantity:1,price:0}]}))},Z=r=>{if(o.items.length>1){const t=o.items.filter((s,i)=>i!==r);u(s=>({...s,items:t}))}},z=()=>o.items.reduce((r,t)=>r+t.price*t.requested_quantity,0);return e.jsxs(pe,{maxWidth:"lg",sx:{mt:0,mb:4},children:[e.jsxs($,{sx:{mb:4,display:"flex",alignItems:"center",gap:2},children:[e.jsx(f,{onClick:()=>y("/app/purchase"),children:e.jsx(_e,{})}),e.jsx(g,{variant:"h5",children:"Create Purchase Order"})]}),e.jsx("form",{onSubmit:G,children:e.jsxs(p,{container:!0,spacing:1,children:[e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(v,{size:"small",value:(b==null?void 0:b.find(r=>r.supplier_id===o.supplier_id))||null,onChange:(r,t)=>M({target:{name:"supplier_id",value:t?t.supplier_id:""}}),options:b||[],getOptionLabel:r=>r.supplier_name||"",isOptionEqualToValue:(r,t)=>r.supplier_id===t,renderInput:r=>e.jsx(c,{...r,fullWidth:!0,label:"Supplier",name:"supplier_id",error:!!l.supplier_id,helperText:l.supplier_id,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}}})})}),e.jsx(p,{item:!0,xs:"auto",sx:{paddingLeft:0},children:e.jsx(f,{sx:{marginLeft:"0px !important"},onClick:U,children:e.jsx(S,{})})}),e.jsx(p,{item:!0,xs:12,md:4,ml:7,children:e.jsx(c,{size:"small",fullWidth:!0,type:"date",name:"po_date",label:"PO Date",value:o.po_date,onChange:M,error:!!l.po_date,helperText:l.po_date,InputLabelProps:{shrink:!0}})}),e.jsxs(p,{item:!0,xs:12,children:[e.jsx(E,{children:e.jsxs(B,{children:[e.jsx(D,{children:e.jsxs(I,{children:[e.jsx(d,{children:"Product"}),e.jsx(d,{children:"Measurement"}),e.jsx(d,{children:"Quantity"}),e.jsx(d,{children:"Price"}),e.jsx(d,{children:"Total"}),e.jsx(d,{width:50})]})}),e.jsx(F,{children:o.items.map((r,t)=>e.jsxs(I,{children:[e.jsx(d,{children:e.jsx(v,{size:"small",sx:{width:300},value:(h==null?void 0:h.find(s=>s.id===r.product_id))||null,onChange:(s,i)=>q(t,"product_id",i?i.id:""),options:(h==null?void 0:h.filter(s=>!o.items.some((i,a)=>a!==t&&i.product_id===s.id)))||[],getOptionLabel:s=>s.product_name||"",isOptionEqualToValue:(s,i)=>s.id===i,renderInput:s=>e.jsx(c,{...s,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!l[`items.${t}.product_id`],helperText:l[`items.${t}.product_id`]||"Required"})})}),e.jsx(d,{children:e.jsx(v,{size:"small",sx:{width:200},value:(C==null?void 0:C.find(s=>s.id===r.attribute_id))||null,onChange:(s,i)=>q(t,"attribute_id",i?i.id:""),options:C||[],getOptionLabel:s=>`${s.attribute_name} (${s.unit_of_measurement})`||"",isOptionEqualToValue:(s,i)=>s.id===i,renderInput:s=>e.jsx(c,{...s,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!l[`items.${t}.attribute_id`],helperText:l[`items.${t}.attribute_id`]||"Required"})})}),e.jsx(d,{children:e.jsx(c,{size:"small",type:"number",value:r.requested_quantity,onChange:s=>q(t,"requested_quantity",s.target.value),error:!!l[`items.${t}.requested_quantity`],helperText:l[`items.${t}.requested_quantity`]||"Required",inputProps:{min:1}})}),e.jsx(d,{children:e.jsx(c,{size:"small",type:"number",value:r.price,onChange:s=>q(t,"price",s.target.value),error:!!l[`items.${t}.price`],helperText:l[`items.${t}.price`]||"Required",inputProps:{min:0,step:.01}})}),e.jsx(d,{sx:{verticalAlign:"top"},children:e.jsxs(g,{mt:1,children:["₱",(r.price*r.requested_quantity).toFixed(2)]})}),e.jsx(d,{sx:{verticalAlign:"top"},children:e.jsx(f,{size:"large",onClick:()=>Z(t),disabled:o.items.length===1,children:e.jsx(W,{})})})]},t))})]})}),e.jsxs($,{sx:{mt:2,display:"flex",justifyContent:"space-between"},children:[e.jsx(A,{startIcon:e.jsx(S,{}),onClick:Y,children:"Add Item"}),e.jsxs(g,{variant:"h6",children:["Total: ₱",z().toFixed(2)]})]})]}),e.jsxs(p,{item:!0,xs:12,children:[e.jsxs(g,{variant:"h6",sx:{mt:4,mb:2},children:["Additional Costs",e.jsx(f,{sx:{marginLeft:"0px !important"},onClick:()=>L(!0),children:e.jsx(S,{})})]}),e.jsx(E,{children:e.jsxs(B,{children:[e.jsx(D,{children:e.jsxs(I,{children:[e.jsx(d,{children:"Cost Type"}),e.jsx(d,{children:"Amount"}),e.jsx(d,{children:"Remarks"}),e.jsx(d,{width:50})]})}),e.jsx(F,{children:o.additional_costs.map((r,t)=>e.jsxs(I,{children:[e.jsx(d,{children:e.jsx(v,{size:"small",value:(_==null?void 0:_.find(s=>s.cost_type_id===r.cost_type_id))||null,onChange:(s,i)=>O(t,"cost_type_id",i?i.cost_type_id:""),options:(_==null?void 0:_.filter(s=>s.is_active&&!o.additional_costs.some((i,a)=>a!==t&&i.cost_type_id===s.cost_type_id)))||[],getOptionLabel:s=>s.name||"",isOptionEqualToValue:(s,i)=>s.cost_type_id===i,renderInput:s=>e.jsx(c,{...s,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!l[`additional_costs.${t}.cost_type_id`],helperText:l[`additional_costs.${t}.cost_type_id`]||"Required"})})}),e.jsx(d,{children:e.jsx(c,{size:"small",type:"number",value:r.amount,onChange:s=>O(t,"amount",s.target.value),error:!!l[`additional_costs.${t}.amount`],helperText:l[`additional_costs.${t}.amount`]||"Required",inputProps:{min:0,step:.01}})}),e.jsx(d,{children:e.jsx(c,{size:"small",value:r.remarks||"",onChange:s=>O(t,"remarks",s.target.value),fullWidth:!0,helperText:"Not Required"})}),e.jsx(d,{sx:{verticalAlign:"top"},children:e.jsx(f,{size:"large",onClick:()=>V(t),children:e.jsx(W,{})})})]},t))})]})}),e.jsxs($,{sx:{mt:2,display:"flex",justifyContent:"space-between"},children:[e.jsx(A,{startIcon:e.jsx(S,{}),onClick:K,children:"Add Additional Cost"}),e.jsxs(g,{variant:"h6",children:["Total with Costs: ₱",X().toFixed(2)]})]})]}),e.jsx(p,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,multiline:!0,rows:4,name:"remarks",label:"Remarks",value:o.remarks,onChange:M,error:!!l.remarks,helperText:l.remarks})}),e.jsx(p,{item:!0,xs:12,children:e.jsxs($,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(A,{variant:"outlined",onClick:()=>y("/app/purchase"),children:"Cancel"}),e.jsx(A,{variant:"contained",type:"submit",disabled:P.isPending,children:"Create Purchase Order"})]})})]})}),e.jsx(ce,{open:N,handleClose:R,handleAddSupplier:J}),e.jsx(ue,{open:H,handleClose:()=>L(!1)})]})};export{Se as default};
