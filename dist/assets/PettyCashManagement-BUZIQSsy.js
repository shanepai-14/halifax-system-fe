import{r as f,ar as ze,as as We,aK as or,a0 as G,bc as Mr,bd as $r,be as Or,bf as Sr,bg as Br,bh as Lr,bi as qr,bj as J,Y as $,bk as Vr,bl as X,J as F,bm as Hr,bn as Ur,bo as Gr,bp as rr,bq as Kr,br as Me,bs as Yr,bt as Jr,bu as Xr,bv as Zr,bw as Qr,bx as es,by as De,bz as $e,bA as Fe,bB as rs,bC as ss,bD as ns,bE as sr,bF as nr,bG as tr,bH as ts,bI as as,bJ as ls,bK as is,j as e,K as k,T as s,N,a4 as te,E as O,_ as ce,Z as Y,bL as os,U as o,P as V,L as Pe,X as B,V as ee,W as re,$ as K,bM as ar,bN as cs}from"./index-P7JVNn7a.js";import{u as Oe,w as ds}from"./xlsx-DjuO7_Ju.js";import{D as ae}from"./Dialog-C7qQn7up.js";import{D as le,a as ie}from"./DialogTitle-C-j_NXqZ.js";import{R as se}from"./CloseOutlined-CHsBa3-3.js";import{T as M,S as Z,c as he,d as me,e as pe,a as C,b as t,f as je}from"./TextField-CQUS4omo.js";import{R as Re}from"./DollarOutlined-wTtFfyR7.js";import{D as oe}from"./DialogActions-lTRFRNwk.js";import{R as cr}from"./SaveOutlined-HceZgIDv.js";import{I as Q,a as Te}from"./InputLabel-DlxItPrF.js";import{R as Ee}from"./PlusOutlined-DqU9aPSI.js";import{M as W}from"./MenuItem-DXdXk801.js";import{R as qe}from"./DeleteOutlined-7AuNUWvY.js";import{A as dr}from"./Alert-C-eXOTrG.js";import{A as us}from"./Autocomplete-CSCg1rLQ.js";import{f as L}from"./currencyFormat-th2sljt-.js";import{l as ur}from"./index-DvNuHoZ7.js";import{f as ge}from"./dateUtils-Dj0n6tHU.js";import{R as we}from"./PrinterOutlined-BCXk_xAY.js";import{R as xs}from"./ReloadOutlined-CPnlfKDZ.js";import{T as xr,a as _e}from"./Tabs-DjAOieGp.js";import{R as hs}from"./DownloadOutlined-CGovnmGJ.js";import{R as hr}from"./SearchOutlined-DaSXuFk-.js";import{R as Ve}from"./FilterOutlined-R2-oD11G.js";import{R as Be}from"./EyeOutlined-Bbj24Mdb.js";import{R as ke}from"./CheckCircleOutlined-CyGyCdCH.js";import{R as He}from"./EditOutlined-BszYevA3.js";import{R as mr}from"./CloseCircleOutlined-DgOcmuTd.js";import{D as ms}from"./DialogContentText-CmPpXMiT.js";import{a as ps,R as Le}from"./TeamOutlined-ShSoFfVS.js";import{R as js}from"./WarningOutlined-NmvSj_Av.js";import"./Close-BF0PBH_P.js";import"./KeyboardArrowRight-DWAtJwBs.js";var gs={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-600-80h56c4.4 0 8-3.6 8-8V560c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v144c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V384c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v320c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V462c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v242c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V304c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v400c0 4.4 3.6 8 8 8z"}}]},name:"bar-chart",theme:"outlined"},fs=function(u,l){return f.createElement(ze,We({},u,{ref:l,icon:gs}))},vs=f.forwardRef(fs),bs={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm47.7-395.2l-25.4-5.9V348.6c38 5.2 61.5 29 65.5 58.2.5 4 3.9 6.9 7.9 6.9h44.9c4.7 0 8.4-4.1 8-8.8-6.1-62.3-57.4-102.3-125.9-109.2V263c0-4.4-3.6-8-8-8h-28.1c-4.4 0-8 3.6-8 8v33c-70.8 6.9-126.2 46-126.2 119 0 67.6 49.8 100.2 102.1 112.7l24.7 6.3v142.7c-44.2-5.9-69-29.5-74.1-61.3-.6-3.8-4-6.6-7.9-6.6H363c-4.7 0-8.4 4-8 8.7 4.5 55 46.2 105.6 135.2 112.1V761c0 4.4 3.6 8 8 8h28.4c4.4 0 8-3.6 8-8.1l-.2-31.7c78.3-6.9 134.3-48.8 134.3-124-.1-69.4-44.2-100.4-109-116.4zm-68.6-16.2c-5.6-1.6-10.3-3.1-15-5-33.8-12.2-49.5-31.9-49.5-57.3 0-36.3 27.5-57 64.5-61.7v124zM534.3 677V543.3c3.1.9 5.9 1.6 8.8 2.2 47.3 14.4 63.2 34.4 63.2 65.1 0 39.1-29.4 62.6-72 66.4z"}}]},name:"dollar-circle",theme:"outlined"},ys=function(u,l){return f.createElement(ze,We({},u,{ref:l,icon:bs}))},_s=f.forwardRef(ys),Es={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file",theme:"outlined"},ws=function(u,l){return f.createElement(ze,We({},u,{ref:l,icon:Es}))},Ts=f.forwardRef(ws),As={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 464H528V448h312v128zm0 264H184V184h656v200H496c-17.7 0-32 14.3-32 32v192c0 17.7 14.3 32 32 32h344v200zM580 512a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"wallet",theme:"outlined"},Ds=function(u,l){return f.createElement(ze,We({},u,{ref:l,icon:As}))},Fs=f.forwardRef(Ds);const fe=()=>{const r=or(),u=G(Mr),l=G($r),p=G(Or),i=G(Sr),x=G(Br),E=G(Lr),j=G(qr);return{funds:u,transactions:l,stats:p,balance:i,loading:x,error:E,filters:j,getBalance:async()=>{var _,n;try{r(J());const a=await $.get("/petty-cash/balance");return r(Vr(a.data.data)),a.data.data}catch(a){return console.error("Error fetching petty cash balance:",a),r(X(a.message)),F.error(((n=(_=a.response)==null?void 0:_.data)==null?void 0:n.message)||"Failed to fetch petty cash balance"),null}},getAllFunds:async(_={})=>{var n,a;try{r(J());const d={search:j.search||_.search,status:j.status!=="all"?j.status:void 0,date_from:j.startDate||_.startDate,date_to:j.endDate||_.endDate,sort_by:_.sort_by||"date",sort_order:_.sort_order||"desc"},v=await $.get("/petty-cash/funds",{params:d});return r(Hr(v.data.data)),v.data.data}catch(d){return console.error("Error fetching petty cash funds:",d),r(X(d.message)),F.error(((a=(n=d.response)==null?void 0:n.data)==null?void 0:a.message)||"Failed to fetch petty cash funds"),[]}},createFund:async _=>{var n,a;try{r(J());const v={...(await $.post("/petty-cash/funds",_)).data.data};return r(Ur(v)),F.success("Petty cash fund created successfully"),v}catch(d){throw console.error("Error creating petty cash fund:",d),r(X(d.message)),F.error(((a=(n=d.response)==null?void 0:n.data)==null?void 0:a.message)||"Failed to create petty cash fund"),d}},approveFund:async _=>{var n,a;try{r(J());const v={...(await $.put(`/petty-cash/funds/${_}/approve`)).data.data};return r(Gr(v)),F.success("Petty cash fund approved successfully"),v}catch(d){throw console.error("Error approving petty cash fund:",d),r(X(d.message)),F.error(((a=(n=d.response)==null?void 0:n.data)==null?void 0:a.message)||"Failed to approve petty cash fund"),d}},getAllTransactions:async(_={})=>{var n,a;try{r(J());const d={search:j.search||_.search,status:j.status!=="all"?j.status:void 0,employee_id:j.employeeId||_.employeeId,date_from:j.startDate||_.startDate,date_to:j.endDate||_.endDate},v=await $.get("/petty-cash/transactions",{params:d});return r(rr(v.data.data)),v.data.data}catch(d){return console.error("Error fetching petty cash transactions:",d),r(X(d.message)),F.error(((a=(n=d.response)==null?void 0:n.data)==null?void 0:a.message)||"Failed to fetch petty cash transactions"),[]}},createTransaction:async _=>{var n,a;try{r(J());let d;_ instanceof FormData?d=await $.post("/petty-cash/transactions",_,{headers:{"Content-Type":"multipart/form-data"}}):d=await $.post("/petty-cash/transactions",_);const v={...d.data.data,created_at:new Date().toISOString()};return r(Kr(v)),F.success("Petty cash transaction created successfully"),v}catch(d){throw console.error("Error creating petty cash transaction:",d),r(X(d.message)),F.error(((a=(n=d.response)==null?void 0:n.data)==null?void 0:a.message)||"Failed to create petty cash transaction"),d}},settleTransaction:async(_,n)=>{var a,d;try{r(J());let v;n instanceof FormData?v=await $.put(`/petty-cash/transactions/${_}/settle`,n,{headers:{"Content-Type":"multipart/form-data"}}):v=await $.put(`/petty-cash/transactions/${_}/settle`,n);const q={...v.data.data};return r(Me(q)),F.success("Petty cash transaction settled successfully"),q}catch(v){throw console.error("Error settling petty cash transaction:",v),r(X(v.message)),F.error(((d=(a=v.response)==null?void 0:a.data)==null?void 0:d.message)||"Failed to settle petty cash transaction"),v}},approveTransaction:async _=>{var n,a;try{r(J());const v={...(await $.put(`/petty-cash/transactions/${_}/approve`)).data.data};return r(Me(v)),F.success("Petty cash transaction approved successfully"),v}catch(d){throw console.error("Error approving petty cash transaction:",d),r(X(d.message)),F.error(((a=(n=d.response)==null?void 0:n.data)==null?void 0:a.message)||"Failed to approve petty cash transaction"),d}},cancelTransaction:async(_,n)=>{var a,d;try{r(J());const v=await $.put(`/petty-cash/transactions/${_}/cancel`,{reason:n});return r(Me(v.data.data)),F.success("Petty cash transaction cancelled successfully"),v.data.data}catch(v){throw console.error("Error cancelling petty cash transaction:",v),r(X(v.message)),F.error(((d=(a=v.response)==null?void 0:a.data)==null?void 0:d.message)||"Failed to cancel petty cash transaction"),v}},getStats:async()=>{var _,n;try{r(J());const a=await $.get("/petty-cash/stats");return r(Yr(a.data.data)),a.data.data}catch(a){return console.error("Error fetching petty cash stats:",a),r(X(a.message)),F.error(((n=(_=a.response)==null?void 0:_.data)==null?void 0:n.message)||"Failed to fetch petty cash statistics"),null}},getEmployeeTransactions:async(_,n={})=>{var a,d;try{r(J());const v={status:j.status!=="all"?j.status:void 0,date_from:j.startDate||n.startDate,date_to:j.endDate||n.endDate,sort_by:n.sort_by||"date",sort_order:n.sort_order||"desc"},q=await $.get(`/petty-cash/employees/${_}/transactions`,{params:v});return r(rr(q.data.data)),q.data.data}catch(v){return console.error("Error fetching employee transactions:",v),r(X(v.message)),F.error(((d=(a=v.response)==null?void 0:a.data)==null?void 0:d.message)||"Failed to fetch employee transactions"),[]}}}},Ae=()=>{const r=or(),u=G(Jr),l=G(Xr),p=G(Zr),i=G(Qr),x=G(es);return{employees:u,stats:l,loading:p,error:i,filters:x,getAllEmployees:async(y={})=>{var g,c;try{r(De());const h={search:x.search||y.search,status:x.status!=="all"?x.status:void 0,department:x.department!=="all"?x.department:void 0,sort_by:y.sort_by||"created_at",sort_order:y.sort_order||"desc"},D=await $.get("/employees",{params:h});return r($e(D.data.data)),D.data.data}catch(h){return console.error("Error fetching employees:",h),r(Fe(h.message)),F.error(((c=(g=h.response)==null?void 0:g.data)==null?void 0:c.message)||"Failed to fetch employees"),[]}},getEmployeeById:async y=>{var g,c;try{r(De());const h=await $.get(`/employees/${y}`);return r($e([h.data.data])),h.data.data}catch(h){return console.error("Error fetching employee:",h),r(Fe(h.message)),F.error(((c=(g=h.response)==null?void 0:g.data)==null?void 0:c.message)||"Failed to fetch employee"),null}},createEmployee:async y=>{var g,c;try{r(rs());const h=await $.post("/employees",y);return r(ss(h.data.data)),F.success("Employee created successfully"),h.data.data}catch(h){throw console.error("Error creating employee:",h),r(ns(h.message)),F.error(((c=(g=h.response)==null?void 0:g.data)==null?void 0:c.message)||"Failed to create employee"),h}},updateEmployee:async(y,g)=>{var c,h;try{r(sr());const D=await $.put(`/employees/${y}`,g);return r(nr(D.data.data)),F.success("Employee updated successfully"),D.data.data}catch(D){throw console.error("Error updating employee:",D),r(tr(D.message)),F.error(((h=(c=D.response)==null?void 0:c.data)==null?void 0:h.message)||"Failed to update employee"),D}},deleteEmployee:async y=>{var g,c;try{return r(ts()),await $.delete(`/employees/${y}`),r(as(y)),F.success("Employee deleted successfully"),!0}catch(h){throw console.error("Error deleting employee:",h),r(ls(h.message)),F.error(((c=(g=h.response)==null?void 0:g.data)==null?void 0:c.message)||"Failed to delete employee"),h}},getEmployeeStats:async()=>{var y,g;try{r(De());const c=await $.get("/employees/stats");return r(is(c.data.data)),c.data.data}catch(c){return console.error("Error fetching employee statistics:",c),r(Fe(c.message)),F.error(((g=(y=c.response)==null?void 0:y.data)==null?void 0:g.message)||"Failed to fetch employee statistics"),null}},getTrashedEmployees:async()=>{var y,g;try{r(De());const c=await $.get("/employees/trashed");return r($e(c.data.data)),c.data.data}catch(c){return console.error("Error fetching trashed employees:",c),r(Fe(c.message)),F.error(((g=(y=c.response)==null?void 0:y.data)==null?void 0:g.message)||"Failed to fetch trashed employees"),[]}},restoreEmployee:async y=>{var g,c;try{r(sr());const h=await $.post(`/employees/${y}/restore`);return r(nr(h.data.data)),F.success("Employee restored successfully"),h.data.data}catch(h){throw console.error("Error restoring employee:",h),r(tr(h.message)),F.error(((c=(g=h.response)==null?void 0:g.data)==null?void 0:c.message)||"Failed to restore employee"),h}}}},Is=({open:r,onClose:u,onSuccess:l})=>{const[p,i]=f.useState({date:new Date().toISOString().split("T")[0],amount:"",description:""}),[x,E]=f.useState({}),{createFund:j,loading:I}=fe(),T=b=>{const{name:y,value:g}=b.target;i(c=>({...c,[y]:g})),x[y]&&E(c=>({...c,[y]:null}))},z=()=>{const b={};return p.date||(b.date="Date is required"),p.amount?parseFloat(p.amount)<=0&&(b.amount="Amount must be greater than 0"):b.amount="Amount is required",p.description.trim()||(b.description="Description is required"),E(b),Object.keys(b).length===0},P=async b=>{if(b.preventDefault(),!!z())try{const y={...p,amount:parseFloat(p.amount)},g=await j(y);w(!0,g)}catch(y){console.error("Error adding fund:",y)}},w=(b=!1,y=null)=>{i({date:new Date().toISOString().split("T")[0],amount:"",description:""}),E({}),b?l(y):u()};return e.jsxs(ae,{open:r,onClose:()=>w(),maxWidth:"sm",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(k,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(s,{variant:"h6",children:"Add Petty Cash Fund"}),e.jsx(N,{edge:"end",color:"inherit",onClick:()=>w(),"aria-label":"close",children:e.jsx(se,{})})]})}),e.jsxs("form",{onSubmit:P,children:[e.jsxs(ie,{children:[e.jsx(M,{margin:"dense",fullWidth:!0,label:"Date",type:"date",name:"date",value:p.date,onChange:T,error:!!x.date,helperText:x.date,InputLabelProps:{shrink:!0}}),e.jsx(M,{margin:"dense",fullWidth:!0,label:"Amount",type:"number",name:"amount",value:p.amount,onChange:T,error:!!x.amount,helperText:x.amount,InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(Re,{})})}}),e.jsx(M,{margin:"dense",fullWidth:!0,label:"Description",name:"description",value:p.description,onChange:T,error:!!x.description,helperText:x.description,multiline:!0,rows:3})]}),e.jsxs(oe,{children:[e.jsx(O,{onClick:()=>w(),color:"primary",disabled:I,children:"Cancel"}),e.jsx(O,{type:"submit",variant:"contained",color:"primary",disabled:I,startIcon:I?e.jsx(ce,{size:24}):null,children:I?"Submitting...":"Add Fund"})]})]})]})},Ps=({value:r,onChange:u,error:l,helperText:p,name:i="purpose",label:x="Purpose *"})=>{const[E,j]=f.useState([]),[I,T]=f.useState(!1),[z,P]=f.useState(!1),[w,b]=f.useState("");f.useEffect(()=>{y()},[]);const y=async()=>{T(!0);try{const n=await $.get("/purposes");j(n.data.data)}catch(n){console.error("Error loading purposes:",n),F.error("Failed to load purposes")}finally{T(!1)}},g=n=>{console.log(n.target.value),u({target:{name:i,value:n.target.value}})},c=()=>{P(!0)},h=()=>{P(!1),b("")},D=async()=>{var n,a;if(!w.trim()){F.error("Purpose name cannot be empty");return}try{const v=(await $.post("/purposes",{name:w})).data.data;j([...E,v]),u({target:{name:i,value:v.id}}),F.success("Purpose created successfully"),P(!1),b("")}catch(d){console.error("Error creating purpose:",d),F.error(((a=(n=d.response)==null?void 0:n.data)==null?void 0:a.message)||"Failed to create purpose")}},_=async(n,a)=>{var d,v;a.stopPropagation();try{await $.delete(`/purposes/${n.id}`),j(E.filter(q=>q.id!==n.id)),r===n.id&&u({target:{name:i,value:""}}),F.success("Purpose deleted successfully")}catch(q){console.error("Error deleting purpose:",q),F.error(((v=(d=q.response)==null?void 0:d.data)==null?void 0:v.message)||"Failed to delete purpose")}};return e.jsx(e.Fragment,{children:z?e.jsxs(k,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[e.jsx(M,{fullWidth:!0,label:"New Purpose Name",value:w,onChange:n=>b(n.target.value),autoFocus:!0,size:"small",margin:"dense"}),e.jsx(N,{color:"primary",onClick:D,size:"small",sx:{mt:1},children:e.jsx(cr,{})}),e.jsx(N,{onClick:h,size:"small",sx:{mt:1},children:e.jsx(se,{})})]}):e.jsxs(Y,{fullWidth:!0,error:!!l,margin:"dense",children:[e.jsx(Q,{id:`${i}-label`,children:x}),e.jsx(Z,{labelId:`${i}-label`,value:r||"",onChange:g,label:x,disabled:I,endAdornment:e.jsx(te,{position:"end",children:e.jsx(N,{onClick:c,edge:"end",size:"small",sx:{mr:1},children:e.jsx(Ee,{})})}),renderValue:n=>{const a=E.find(d=>d.name===n);return(a==null?void 0:a.name)||""},children:E.length===0?e.jsx(W,{disabled:!0,children:I?"Loading...":"No purposes available"}):E.map(n=>e.jsxs(W,{value:n.name,sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:n.name}),e.jsx(N,{size:"small",color:"error",onClick:a=>_(n,a),children:e.jsx(qe,{})})]},n.name))}),p&&e.jsx(Te,{children:p})]})})},Rs=({value:r,onChange:u,error:l,helperText:p,name:i="expense",label:x="Expense *"})=>{const[E,j]=f.useState([]),[I,T]=f.useState(!1),[z,P]=f.useState(!1),[w,b]=f.useState("");f.useEffect(()=>{y()},[]);const y=async()=>{T(!0);try{const n=await $.get("/expenses");j(n.data.data)}catch(n){console.error("Error loading expenses:",n),F.error("Failed to load expenses")}finally{T(!1)}},g=n=>{u({target:{name:i,value:n.target.value}})},c=()=>{P(!0)},h=()=>{P(!1),b("")},D=async()=>{var n,a;if(!w.trim()){F.error("Expense name cannot be empty");return}try{const v=(await $.post("/expenses",{name:w})).data.data;j([...E,v]),u({target:{name:i,value:v.id}}),F.success("Expense created successfully"),P(!1),b("")}catch(d){console.error("Error creating expense:",d),F.error(((a=(n=d.response)==null?void 0:n.data)==null?void 0:a.message)||"Failed to create expense")}},_=async(n,a)=>{var d,v;a.stopPropagation();try{await $.delete(`/expenses/${n.id}`),j(E.filter(q=>q.id!==n.id)),r===n.id&&u({target:{name:i,value:""}}),F.success("Expense deleted successfully")}catch(q){console.error("Error deleting expense:",q),F.error(((v=(d=q.response)==null?void 0:d.data)==null?void 0:v.message)||"Failed to delete expense")}};return e.jsx(e.Fragment,{children:z?e.jsxs(k,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[e.jsx(M,{fullWidth:!0,label:"New Expense Name",value:w,onChange:n=>b(n.target.value),autoFocus:!0,size:"small",margin:"dense"}),e.jsx(N,{color:"primary",onClick:D,size:"small",sx:{mt:1},children:e.jsx(cr,{})}),e.jsx(N,{onClick:h,size:"small",sx:{mt:1},children:e.jsx(se,{})})]}):e.jsxs(Y,{fullWidth:!0,error:!!l,margin:"dense",children:[e.jsx(Q,{id:`${i}-label`,children:x}),e.jsx(Z,{labelId:`${i}-label`,value:r||"",onChange:g,label:x,disabled:I,endAdornment:e.jsx(te,{position:"end",children:e.jsx(N,{onClick:c,edge:"end",size:"small",sx:{mr:1},children:e.jsx(Ee,{})})}),renderValue:n=>{const a=E.find(d=>d.name===n);return(a==null?void 0:a.name)||""},children:E.length===0?e.jsx(W,{disabled:!0,children:I?"Loading...":"No expenses available"}):E.map(n=>e.jsxs(W,{value:n.name,sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:n.name}),e.jsx(N,{size:"small",color:"error",onClick:a=>_(n,a),children:e.jsx(qe,{})})]},n.name))}),p&&e.jsx(Te,{children:p})]})})},ks=({open:r,onClose:u,onSuccess:l,employees:p,balance:i})=>{const[x,E]=f.useState({employee_id:"",purpose:"",expense:"",description:"",amount_issued:""}),[j,I]=f.useState({}),{createTransaction:T,loading:z}=fe(),P=g=>{const{name:c,value:h}=g.target;E(D=>({...D,[c]:h})),j[c]&&I(D=>({...D,[c]:null}))},w=()=>{const g={};return x.employee_id||(g.employee_id="Employee is required"),x.purpose.trim()||(g.purpose="Purpose is required"),x.expense.trim()||(g.expense="Expense is required"),x.amount_issued?parseFloat(x.amount_issued)<=0?g.amount_issued="Amount must be greater than 0":parseFloat(x.amount_issued)>i&&(g.amount_issued="Amount cannot exceed available balance"):g.amount_issued="Amount is required",I(g),Object.keys(g).length===0},b=async g=>{if(g.preventDefault(),!!w())try{const c={...x,amount_issued:parseFloat(x.amount_issued)},h=await T(c);y(!0,h)}catch(c){console.error("Error adding transaction:",c)}},y=(g=!1,c=null)=>{E({employee_id:"",purpose:"",expense:"",description:"",amount_issued:""}),I({}),g?l(c):u()};return e.jsxs(ae,{open:r,onClose:()=>y(),maxWidth:"sm",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(k,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(s,{variant:"h6",children:"New Petty Cash Transaction"}),e.jsx(N,{edge:"end",color:"inherit",onClick:()=>y(),"aria-label":"close",children:e.jsx(se,{})})]})}),e.jsxs("form",{onSubmit:b,children:[e.jsxs(ie,{children:[e.jsxs(dr,{severity:"info",sx:{mb:2},children:["Available Balance: ",new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(i)]}),e.jsx(Y,{fullWidth:!0,margin:"dense",error:!!j.employee_id,children:e.jsx(us,{id:"employee-autocomplete",options:p||[],getOptionLabel:g=>`${g.full_name} - ${g.position}`,value:p.find(g=>g.id===x.employee_id)||null,onChange:(g,c)=>{P({target:{name:"employee_id",value:c?c.id:""}})},renderInput:g=>e.jsx(M,{...g,label:"Employee *",error:!!j.employee_id,helperText:j.employee_id,InputProps:{...g.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(te,{position:"start",children:e.jsx(os,{})}),g.InputProps.startAdornment]})}}),noOptionsText:"No employees available",loading:p.length===0,loadingText:"Loading employees..."})}),e.jsx(Ps,{value:x.purpose,onChange:P,error:!!j.purpose,helperText:j.purpose,name:"purpose",label:"Purpose *"}),e.jsx(Rs,{value:x.expense,onChange:P,error:!!j.expense,helperText:j.expense,name:"expense",label:"Expense Type *"}),e.jsx(M,{margin:"dense",fullWidth:!0,label:"Description",name:"description",value:x.description,onChange:P,multiline:!0,rows:2}),e.jsx(M,{margin:"dense",fullWidth:!0,label:"Amount to Issue *",type:"number",name:"amount_issued",value:x.amount_issued,onChange:P,error:!!j.amount_issued,helperText:j.amount_issued,InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(Re,{})})}})]}),e.jsxs(oe,{children:[e.jsx(O,{onClick:()=>y(),color:"primary",disabled:z,children:"Cancel"}),e.jsx(O,{type:"submit",variant:"contained",color:"primary",disabled:z||!p.length,startIcon:z?e.jsx(ce,{size:24}):null,children:z?"Submitting...":"Create Transaction"})]})]})]})},pr=({open:r,onClose:u,onSuccess:l,transaction:p})=>{var _;const[i,x]=f.useState({amount_spent:"",amount_returned:"",remarks:"",receipt_attachment:null}),[E,j]=f.useState({}),[I,T]=f.useState(""),[z,P]=f.useState(0),{settleTransaction:w,loading:b}=fe();f.useEffect(()=>{p&&(x({amount_spent:"",amount_returned:"",remarks:"",receipt_attachment:null}),j({}),T(""))},[p]),f.useEffect(()=>{if(p&&i.amount_spent){const n=parseFloat(p.amount_issued),a=parseFloat(i.amount_spent)||0,d=n-a;P(d>=0?d:0),d>=0&&x(v=>({...v,amount_returned:Number(d)}))}},[i.amount_spent,p]);const y=n=>{const{name:a,value:d}=n.target;x(v=>({...v,[a]:d})),E[a]&&j(v=>({...v,[a]:null}))},g=n=>{const a=n.target.files[0];if(T(""),a){if(a.size>2*1024*1024){T("File size must be less than 2MB");return}if(!["image/jpeg","image/png","application/pdf"].includes(a.type)){T("Only JPG, PNG, and PDF files are allowed");return}x(v=>({...v,receipt_attachment:a}))}},c=()=>{const n={};if(i.amount_spent?parseFloat(i.amount_spent)<0?n.amount_spent="Amount spent cannot be negative":p&&parseFloat(i.amount_spent)>parseFloat(p.amount_issued)&&(n.amount_spent="Amount spent cannot exceed issued amount"):n.amount_spent="Amount spent is required",i.amount_returned===null||i.amount_returned===""||i.amount_returned===void 0?n.amount_returned="Amount returned is required":parseFloat(i.amount_returned)<0&&(n.amount_returned="Amount returned cannot be negative"),p&&i.amount_spent&&i.amount_returned&&!n.amount_spent&&!n.amount_returned){const a=parseFloat(p.amount_issued),d=parseFloat(i.amount_spent),v=parseFloat(i.amount_returned);Math.abs(d+v-a)>.01&&(n.amount_returned="Total of spent and returned must equal issued amount")}return j(n),Object.keys(n).length===0},h=async n=>{if(n.preventDefault(),!(!c()||I))try{let a;i.receipt_attachment?(a=new FormData,a.append("amount_spent",i.amount_spent),a.append("amount_returned",i.amount_returned),a.append("remarks",i.remarks),a.append("receipt_attachment",i.receipt_attachment)):a={amount_spent:parseFloat(i.amount_spent),amount_returned:parseFloat(i.amount_returned),remarks:i.remarks},await w(p.id,a),D(!0)}catch(a){console.error("Error settling transaction:",a)}},D=(n=!1)=>{x({amount_spent:"",amount_returned:"",remarks:"",receipt_attachment:null}),j({}),T(""),n?l():u()};return p?e.jsxs(ae,{open:r,onClose:()=>D(),maxWidth:"sm",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(k,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(s,{variant:"h6",children:"Settle Transaction"}),e.jsx(N,{edge:"end",color:"inherit",onClick:()=>D(),"aria-label":"close",children:e.jsx(se,{})})]})}),e.jsxs("form",{onSubmit:h,children:[e.jsxs(ie,{children:[e.jsxs(dr,{severity:"info",sx:{mb:2},children:["Transaction Reference: ",p.transaction_reference,e.jsx("br",{}),"Employee: ",(_=p.employee)==null?void 0:_.full_name,e.jsx("br",{}),"Issued Amount: ",L(p.amount_issued)]}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(M,{margin:"dense",fullWidth:!0,label:"Amount Spent *",type:"number",name:"amount_spent",value:i.amount_spent,onChange:y,error:!!E.amount_spent,helperText:E.amount_spent,InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(Re,{})})}})}),e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(M,{margin:"dense",fullWidth:!0,label:"Amount Returned *",type:"number",name:"amount_returned",value:i.amount_returned,onChange:y,error:!!E.amount_returned,helperText:E.amount_returned,InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(Re,{})})}})})]}),i.amount_spent&&e.jsxs(s,{variant:"body2",color:"textSecondary",sx:{mt:1},children:["Remaining amount to be returned: ",L(z)]}),e.jsx(M,{margin:"dense",fullWidth:!0,label:"Remarks",name:"remarks",value:i.remarks,onChange:y,multiline:!0,rows:2}),e.jsxs(k,{sx:{mt:2},children:[e.jsx(s,{variant:"body2",gutterBottom:!0,children:"Receipt Attachment"}),e.jsxs(O,{variant:"outlined",component:"label",startIcon:e.jsx(Ts,{}),fullWidth:!0,children:["Upload Receipt",e.jsx("input",{type:"file",hidden:!0,accept:"image/jpeg,image/png,application/pdf",onChange:g})]}),i.receipt_attachment&&e.jsxs(s,{variant:"caption",display:"block",sx:{mt:1},children:["Selected file: ",i.receipt_attachment.name]}),I&&e.jsx(Te,{error:!0,children:I})]})]}),e.jsxs(oe,{children:[e.jsx(O,{onClick:()=>D(),color:"primary",disabled:b,children:"Cancel"}),e.jsx(O,{type:"submit",variant:"contained",color:"primary",disabled:b,startIcon:b?e.jsx(ce,{size:24}):null,children:b?"Submitting...":"Settle Transaction"})]})]})]}):null},zs=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",lr=({open:r,onClose:u,transaction:l,isNew:p=!1})=>{var j,I,T,z,P,w,b;const i=f.useRef(),x=ur.useReactToPrint({contentRef:i});if(!l)return null;const E=y=>({issued:"ISSUED",settled:"SETTLED",approved:"APPROVED",cancelled:"CANCELLED"})[y]||y.toUpperCase();return e.jsxs(ae,{open:r,onClose:u,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsxs(le,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2},children:[e.jsx(s,{variant:"h6",children:p?"New Transaction Receipt":"Transaction Receipt"}),e.jsxs(k,{children:[e.jsx(N,{color:"primary",onClick:x,sx:{mr:1},children:e.jsx(we,{})}),e.jsx(N,{onClick:u,children:e.jsx(se,{})})]})]}),e.jsx(ie,{dividers:!0,children:e.jsxs(k,{ref:i,sx:{p:3},children:[e.jsxs(k,{sx:{textAlign:"center",mb:3},children:[e.jsx(s,{variant:"h4",children:"PETTY CASH TRANSACTION"}),e.jsx(s,{variant:"h6",children:l.transaction_reference}),e.jsx(k,{sx:{display:"inline-block",border:1,borderColor:"divider",borderRadius:1,px:2,py:.5,mt:1,backgroundColor:l.status==="approved"?"success.light":l.status==="issued"?"primary.light":l.status==="settled"?"info.light":"error.light"},children:e.jsx(s,{variant:"subtitle1",fontWeight:"bold",children:E(l.status)})})]}),e.jsxs(o,{container:!0,spacing:2,sx:{mb:3},children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx(s,{children:"Halifax Glass & Aluminum Supply"}),e.jsx(s,{children:"Malagamot Road, Panacan"}),e.jsx(s,{children:"glasshalifax@gmail.com"}),e.jsx(s,{children:"0939 924 3876"})]}),e.jsxs(o,{item:!0,xs:6,sx:{textAlign:"right"},children:[e.jsxs(s,{children:[e.jsx("strong",{children:"Date:"})," ",zs(l.created_at)]}),e.jsxs(s,{children:[e.jsx("strong",{children:"Purpose:"})," ",l.purpose]}),e.jsxs(s,{children:[e.jsx("strong",{children:"Expense:"})," ",l.expense]}),l.status==="settled"||l.status==="approved"?e.jsxs(s,{children:[e.jsx("strong",{children:"Settled on:"})," ",ge(l.updated_at)]}):null]})]}),e.jsxs(V,{variant:"outlined",sx:{p:2,mb:3},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Employee Information"}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsxs(s,{children:[e.jsx("strong",{children:"Name:"})," ",((j=l.employee)==null?void 0:j.full_name)||"N/A"]}),e.jsxs(s,{children:[e.jsx("strong",{children:"Position:"})," ",((I=l.employee)==null?void 0:I.position)||"N/A"]})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsxs(s,{children:[e.jsx("strong",{children:"Department:"})," ",((T=l.employee)==null?void 0:T.department)||"N/A"]}),e.jsxs(s,{children:[e.jsx("strong",{children:"Contact:"})," ",((z=l.employee)==null?void 0:z.phone_number)||"N/A"]})]})]})]}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Transaction Summary"}),e.jsx(he,{component:V,variant:"outlined",sx:{mb:3},children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(C,{children:[e.jsx(t,{children:e.jsx("strong",{children:"Description"})}),e.jsx(t,{align:"right",children:e.jsx("strong",{children:"Amount"})})]})}),e.jsxs(je,{children:[e.jsxs(C,{children:[e.jsx(t,{children:"Amount Issued"}),e.jsx(t,{align:"right",children:L(l.amount_issued)})]}),(l.status==="settled"||l.status==="approved")&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{children:[e.jsx(t,{children:"Amount Spent"}),e.jsx(t,{align:"right",children:L(l.amount_spent)})]}),e.jsxs(C,{children:[e.jsx(t,{children:"Amount Returned"}),e.jsx(t,{align:"right",children:L(l.amount_returned)})]})]})]})]})}),l.description&&e.jsxs(k,{sx:{mb:3},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Description"}),e.jsx(V,{variant:"outlined",sx:{p:2},children:e.jsx(s,{children:l.description})})]}),l.remarks&&e.jsxs(k,{sx:{mb:3},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Remarks"}),e.jsx(V,{variant:"outlined",sx:{p:2},children:e.jsx(s,{children:l.remarks})})]}),e.jsx(Pe,{sx:{my:3}}),e.jsxs(o,{container:!0,spacing:4,sx:{mt:3},children:[e.jsx(o,{item:!0,xs:4,children:e.jsxs(k,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:[e.jsx(s,{children:"Issued By"}),e.jsx(s,{variant:"caption",children:((P=l.issuer)==null?void 0:P.name)||"System User"})]})}),e.jsx(o,{item:!0,xs:4,children:e.jsxs(k,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:[e.jsx(s,{children:"Received By"}),e.jsx(s,{variant:"caption",children:((w=l.employee)==null?void 0:w.full_name)||"Employee"})]})}),e.jsx(o,{item:!0,xs:4,children:e.jsxs(k,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:[e.jsx(s,{children:"Approved By"}),e.jsx(s,{variant:"caption",children:l.status==="approved"?((b=l.approver)==null?void 0:b.name)||"Manager":""})]})})]}),e.jsx(k,{sx:{mt:4,textAlign:"center"},children:e.jsx(s,{variant:"caption",color:"textSecondary",children:"This document serves as an official record of petty cash disbursement."})})]})}),e.jsxs(oe,{sx:{p:2},children:[e.jsx(O,{variant:"outlined",startIcon:e.jsx(we,{}),onClick:x,children:"Print Receipt"}),e.jsx(O,{variant:"contained",onClick:u,children:"Close"})]})]})},Ie=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",ir=({open:r,onClose:u,fund:l,isNew:p=!1})=>{var j,I,T,z;const i=f.useRef(),x=ur.useReactToPrint({contentRef:i});if(!l)return null;const E=P=>{switch(P){case"approved":return e.jsx(B,{label:"APPROVED",color:"success"});case"pending":return e.jsx(B,{label:"PENDING",color:"warning"});case"rejected":return e.jsx(B,{label:"REJECTED",color:"error"});default:return e.jsx(B,{label:P.toUpperCase()})}};return e.jsxs(ae,{open:r,onClose:u,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsxs(le,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2},children:[e.jsx(s,{variant:"h6",children:p?"New Fund Receipt":"Fund Receipt"}),e.jsxs(k,{children:[e.jsx(N,{color:"primary",onClick:x,sx:{mr:1},children:e.jsx(we,{})}),e.jsx(N,{onClick:u,children:e.jsx(se,{})})]})]}),e.jsx(ie,{dividers:!0,children:e.jsxs(k,{ref:i,sx:{p:3},children:[e.jsxs(k,{sx:{textAlign:"center",mb:3},children:[e.jsx(s,{variant:"h4",children:"PETTY CASH FUND"}),e.jsx(s,{variant:"h6",children:l.transaction_reference}),e.jsx(k,{sx:{mt:1},children:E(l.status)})]}),e.jsxs(o,{container:!0,spacing:2,sx:{mb:3},children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx(s,{children:"Halifax Glass & Aluminum Supply"}),e.jsx(s,{children:"Malagamot Road, Panacan"}),e.jsx(s,{children:"glasshalifax@gmail.com"}),e.jsx(s,{children:"0939 924 3876"})]}),e.jsxs(o,{item:!0,xs:6,sx:{textAlign:"right"},children:[e.jsxs(s,{children:[e.jsx("strong",{children:"Created on:"})," ",Ie(l.created_at)]}),l.status==="approved"&&e.jsxs(s,{children:[e.jsx("strong",{children:"Approved on:"})," ",Ie(l.updated_at)]})]})]}),e.jsxs(V,{variant:"outlined",sx:{p:3,mb:3,textAlign:"center",backgroundColor:l.status==="approved"?"success.light":"background.paper"},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Fund Amount"}),e.jsx(s,{variant:"h3",children:L(l.amount)})]}),e.jsxs(V,{variant:"outlined",sx:{p:2,mb:3},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Description"}),e.jsx(s,{children:l.description})]}),e.jsxs(o,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(o,{item:!0,xs:6,children:e.jsxs(V,{variant:"outlined",sx:{p:2,height:"100%"},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Created By"}),e.jsx(s,{children:((j=l.creator)==null?void 0:j.name)||"System User"}),e.jsx(s,{variant:"caption",color:"textSecondary",children:Ie(l.created_at)})]})}),e.jsx(o,{item:!0,xs:6,children:e.jsxs(V,{variant:"outlined",sx:{p:2,height:"100%"},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Approved By"}),l.status==="approved"?e.jsxs(e.Fragment,{children:[e.jsx(s,{children:((I=l.approver)==null?void 0:I.name)||"Manager"}),e.jsx(s,{variant:"caption",color:"textSecondary",children:Ie(l.updated_at)})]}):e.jsx(s,{color:"textSecondary",children:"Pending approval"})]})})]}),e.jsx(Pe,{sx:{my:3}}),e.jsxs(o,{container:!0,spacing:4,sx:{mt:3},children:[e.jsx(o,{item:!0,xs:6,children:e.jsxs(k,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:[e.jsx(s,{children:"Prepared By"}),e.jsx(s,{variant:"caption",children:((T=l.creator)==null?void 0:T.name)||"System User"})]})}),e.jsx(o,{item:!0,xs:6,children:e.jsxs(k,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:[e.jsx(s,{children:"Approved By"}),e.jsx(s,{variant:"caption",children:l.status==="approved"?((z=l.approver)==null?void 0:z.name)||"Manager":""})]})})]}),e.jsx(k,{sx:{mt:4,textAlign:"center"},children:e.jsx(s,{variant:"caption",color:"textSecondary",children:"This document serves as an official record of petty cash fund allocation."})})]})}),e.jsxs(oe,{sx:{p:2},children:[e.jsx(O,{variant:"outlined",startIcon:e.jsx(we,{}),onClick:x,children:"Print Receipt"}),e.jsx(O,{variant:"contained",onClick:u,children:"Close"})]})]})},Ws=()=>{const[r,u]=f.useState(0),[l,p]=f.useState(!1),[i,x]=f.useState(!1),[E,j]=f.useState(!1),[I,T]=f.useState(!1),[z,P]=f.useState(!1),[w,b]=f.useState(null),[y,g]=f.useState(null),[c,h]=f.useState("all"),[D,_]=f.useState(""),[n,a]=f.useState("all"),[d,v]=f.useState(new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString().split("T")[0]),[q,ve]=f.useState(new Date().toISOString().split("T")[0]),[be,A]=f.useState(!1),[H,R]=f.useState(!1),[jr,Ue]=f.useState(null),[gr,Ge]=f.useState(null),[fr,vr]=f.useState(0),{funds:de,transactions:ue,balance:Ke,getBalance:br,getAllFunds:yr,getAllTransactions:_r,approveFund:Er,approveTransaction:wr,cancelTransaction:Tr,settleTransaction:Ar,loading:ye}=fe(),{employees:Ye,getAllEmployees:Dr,loading:Ss}=Ae();f.useEffect(()=>{xe(),Dr()},[r,fr]);const xe=async()=>{try{const m={search:D,status:n!=="all"?n:void 0,startDate:d,endDate:q,employeeId:c!=="all"?c:void 0};r===0?await _r(m):await yr(m),await br()}catch(m){console.error("Error loading data:",m)}},Fr=()=>{vr(m=>m+1)},Je=()=>{xe()},Ir=(m,S)=>{u(S)},Xe=async(m,S)=>{try{if(S==="fund"){const ne=await Er(m);ne&&(g(ne),P(!0))}else{const ne=await wr(m);ne&&(b(ne),T(!0))}xe()}catch(ne){console.error("Error approving item:",ne)}},Pr=async m=>{try{const S=prompt("Please enter a reason for cancellation:");S&&(await Tr(m,S),xe())}catch(S){console.error("Error cancelling transaction:",S)}},Rr=m=>{b(m),j(!0)},kr=async m=>{try{const S=await Ar(w.id,m);S&&(j(!1),b(S),T(!0),xe())}catch(S){console.error("Error settling transaction:",S)}},Ne=m=>{b(m),T(!0)},Ce=m=>{g(m),P(!0)},zr=m=>{p(!1),Ue(m),A(!0),xe()},Wr=m=>{x(!1),Ge(m),R(!0),xe()},Ze=m=>{switch(m){case"approved":return e.jsx(B,{label:"Approved",color:"success",size:"small"});case"pending":return e.jsx(B,{label:"Pending",color:"warning",size:"small"});case"settled":return e.jsx(B,{label:"Settled",color:"info",size:"small"});case"issued":return e.jsx(B,{label:"Issued",color:"primary",size:"small"});case"cancelled":return e.jsx(B,{label:"Cancelled",color:"error",size:"small"});case"rejected":return e.jsx(B,{label:"Rejected",color:"error",size:"small"});default:return e.jsx(B,{label:m,size:"small"})}},Nr=()=>{try{const m=r===0?ue:de;let S=[];r===0?(S.push(["Reference","Date","Employee","Purpose","Expense","Issued Amount","Spent Amount","Returned Amount","Status"]),m.forEach(U=>{var er;S.push([U.transaction_reference||"",ge(U.date)||"",((er=U.employee)==null?void 0:er.full_name)||"",U.purpose||"",U.expense||"",U.amount_issued||0,U.amount_spent||0,U.amount_returned||0,U.status||""])})):(S.push(["Reference","Date","Description","Amount","Status"]),m.forEach(U=>{S.push([U.transaction_reference||"",ge(U.date)||"",U.description||"",U.amount||0,U.status||""])}));const ne=Oe.aoa_to_sheet(S),Qe=Oe.book_new();Oe.book_append_sheet(Qe,ne,r===0?"Transactions":"Funds");const Cr=`PettyCash_${r===0?"Transactions":"Funds"}_${new Date().toISOString().split("T")[0]}.xlsx`;ds(Qe,Cr),F.success(`${r===0?"Transactions":"Funds"} exported successfully`)}catch(m){console.error("Error exporting to Excel:",m),F.error("Failed to export data")}};return e.jsxs(k,{children:[e.jsx(ee,{sx:{mb:3},children:e.jsx(re,{children:e.jsxs(o,{container:!0,spacing:3,children:[e.jsxs(o,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"subtitle2",color:"textSecondary",children:"Current Balance"}),e.jsx(s,{variant:"h4",children:L(Ke||0)})]}),e.jsx(o,{item:!0,xs:12,md:6,sx:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(k,{children:[e.jsx(O,{variant:"outlined",color:"primary",startIcon:e.jsx(xs,{}),onClick:Fr,sx:{mr:2},disabled:ye,children:"Refresh"}),e.jsx(O,{variant:"contained",color:"primary",startIcon:e.jsx(Ee,{}),onClick:()=>p(!0),sx:{mr:2},children:"Add Funds"}),e.jsx(O,{variant:"contained",color:"secondary",startIcon:e.jsx(Ee,{}),onClick:()=>x(!0),children:"New Transaction"})]})})]})})}),e.jsxs(k,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(k,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(xr,{value:r,onChange:Ir,"aria-label":"petty cash sub-tabs",textColor:"primary",indicatorColor:"primary",children:[e.jsx(_e,{label:"Transactions",id:"petty-cash-subtab-0"}),e.jsx(_e,{label:"Funds",id:"petty-cash-subtab-1"})]})}),e.jsxs(k,{children:[e.jsx(O,{variant:"outlined",color:"primary",startIcon:e.jsx(we,{}),onClick:()=>{r===0&&ue.length>0?Ne(ue[0]):r===1&&de.length>0?Ce(de[0]):F.info("No records available to view")},sx:{mr:2},disabled:ye||(r===0?ue.length===0:de.length===0),children:"View Latest"}),e.jsx(O,{variant:"outlined",color:"primary",startIcon:e.jsx(hs,{}),onClick:Nr,disabled:ye||(r===0?ue.length===0:de.length===0),children:"Export to Excel"})]})]}),e.jsx(V,{sx:{p:2,mb:3},children:e.jsxs(o,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(M,{fullWidth:!0,placeholder:"Search",value:D,onChange:m=>_(m.target.value),onKeyPress:m=>m.key==="Enter"&&Je(),InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(hr,{})})},size:"small"})}),e.jsx(o,{item:!0,xs:12,md:2,children:e.jsxs(Y,{fullWidth:!0,size:"small",children:[e.jsx(Q,{children:"Status"}),e.jsxs(Z,{value:n,onChange:m=>a(m.target.value),label:"Status",children:[e.jsx(W,{value:"all",children:"All Status"}),e.jsx(W,{value:"pending",children:"Pending"}),e.jsx(W,{value:"approved",children:"Approved"}),r===0&&[e.jsx(W,{value:"issued",children:"Issued"},"issued"),e.jsx(W,{value:"settled",children:"Settled"},"settled"),e.jsx(W,{value:"cancelled",children:"Cancelled"},"cancelled")],r===1&&e.jsx(W,{value:"rejected",children:"Rejected"})]})]})}),r===0&&e.jsx(o,{item:!0,xs:12,md:2,children:e.jsxs(Y,{fullWidth:!0,size:"small",children:[e.jsx(Q,{children:"Employee"}),e.jsxs(Z,{value:c,onChange:m=>h(m.target.value),label:"Employee",children:[e.jsx(W,{value:"all",children:"All Employees"}),[...Ye.map(m=>e.jsx(W,{value:m.id,children:m.full_name},m.id))]]})]})}),e.jsx(o,{item:!0,xs:6,md:2,children:e.jsx(M,{label:"Start Date",type:"date",value:d,onChange:m=>v(m.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,size:"small"})}),e.jsx(o,{item:!0,xs:6,md:2,children:e.jsx(M,{label:"End Date",type:"date",value:q,onChange:m=>ve(m.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,size:"small",inputProps:{min:d}})}),e.jsx(o,{item:!0,xs:12,md:1,children:e.jsx(O,{variant:"contained",color:"primary",fullWidth:!0,onClick:Je,startIcon:e.jsx(Ve,{}),children:"Filter"})})]})}),r===1?e.jsx(he,{component:V,children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(C,{children:[e.jsx(t,{children:"Reference"}),e.jsx(t,{children:"Date"}),e.jsx(t,{children:"Description"}),e.jsx(t,{align:"right",children:"Amount"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Created By"}),e.jsx(t,{children:"Actions"})]})}),e.jsx(je,{children:ye?e.jsx(C,{children:e.jsx(t,{colSpan:7,align:"center",children:e.jsx(ce,{size:24})})}):de.length===0?e.jsx(C,{children:e.jsx(t,{colSpan:7,align:"center",children:"No funds found"})}):de.map(m=>{var S;return e.jsxs(C,{children:[e.jsx(t,{children:e.jsx(s,{component:"span",sx:{cursor:"pointer",color:"primary.main","&:hover":{textDecoration:"underline"}},onClick:()=>Ce(m),children:m.transaction_reference})}),e.jsx(t,{children:ge(m.date)}),e.jsx(t,{children:m.description}),e.jsx(t,{align:"right",children:L(m.amount)}),e.jsx(t,{children:Ze(m.status)}),e.jsx(t,{children:((S=m.creator)==null?void 0:S.name)||"-"}),e.jsxs(t,{children:[e.jsx(K,{title:"View Receipt",children:e.jsx(N,{color:"primary",size:"small",onClick:()=>Ce(m),children:e.jsx(Be,{})})}),m.status==="pending"&&e.jsx(K,{title:"Approve",children:e.jsx(N,{color:"success",size:"small",onClick:()=>Xe(m.id,"fund"),children:e.jsx(ke,{})})})]})]},m.id)})})]})}):e.jsx(he,{component:V,children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(C,{children:[e.jsx(t,{children:"Reference"}),e.jsx(t,{children:"Date"}),e.jsx(t,{children:"Employee"}),e.jsx(t,{children:"Purpose"}),e.jsx(t,{children:"Expense"}),e.jsx(t,{align:"right",children:"Issued"}),e.jsx(t,{align:"right",children:"Spent"}),e.jsx(t,{align:"right",children:"Returned"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Actions"})]})}),e.jsx(je,{children:ye?e.jsx(C,{children:e.jsx(t,{colSpan:9,align:"center",children:e.jsx(ce,{size:24})})}):ue.length===0?e.jsx(C,{children:e.jsx(t,{colSpan:9,align:"center",children:"No transactions found"})}):ue.map(m=>{var S;return e.jsxs(C,{children:[e.jsx(t,{children:e.jsx(s,{component:"span",sx:{cursor:"pointer",color:"primary.main","&:hover":{textDecoration:"underline"}},onClick:()=>Ne(m),children:m.transaction_reference})}),e.jsx(t,{children:ge(m.date)}),e.jsx(t,{children:((S=m.employee)==null?void 0:S.full_name)||"-"}),e.jsx(t,{children:m.purpose}),e.jsx(t,{children:m.expense}),e.jsx(t,{align:"right",children:L(m.amount_issued)}),e.jsx(t,{align:"right",children:L(m.amount_spent||0)}),e.jsx(t,{align:"right",children:L(m.amount_returned||0)}),e.jsx(t,{children:Ze(m.status)}),e.jsxs(t,{children:[e.jsx(K,{title:"View Receipt",children:e.jsx(N,{color:"primary",size:"small",onClick:()=>Ne(m),children:e.jsx(Be,{})})}),m.status==="issued"&&e.jsx(K,{title:"Settle",children:e.jsx(N,{color:"primary",size:"small",onClick:()=>Rr(m),children:e.jsx(He,{})})}),m.status==="settled"&&e.jsx(K,{title:"Approve",children:e.jsx(N,{color:"success",size:"small",onClick:()=>Xe(m.id,"transaction"),children:e.jsx(ke,{})})}),(m.status==="issued"||m.status==="settled")&&e.jsx(K,{title:"Cancel",children:e.jsx(N,{color:"error",size:"small",onClick:()=>Pr(m.id),children:e.jsx(mr,{})})})]})]},m.id)})})]})}),e.jsx(Is,{open:l,onClose:()=>p(!1),onSuccess:zr}),e.jsx(ks,{open:i,onClose:()=>x(!1),onSuccess:Wr,employees:Ye,balance:Ke||0}),e.jsx(pr,{open:E,onClose:()=>{j(!1),b(null)},onSuccess:kr,transaction:w}),e.jsx(ir,{open:z,onClose:()=>{P(!1),g(null)},fund:y}),e.jsx(lr,{open:I,onClose:()=>{T(!1),b(null)},transaction:w}),e.jsx(ir,{open:be,onClose:()=>{A(!1),Ue(null)},fund:jr,isNew:!0}),e.jsx(lr,{open:H,onClose:()=>{R(!1),Ge(null)},transaction:gr,isNew:!0})]})},Ns=({open:r,onClose:u,onSuccess:l,departments:p=[]})=>{const[i,x]=f.useState({full_name:"",position:"",department:"",email:"",phone_number:"",status:"active"}),[E,j]=f.useState({}),[I,T]=f.useState(""),{createEmployee:z,loading:P}=Ae(),w=c=>{const{name:h,value:D}=c.target;x(_=>({..._,[h]:D})),E[h]&&j(_=>({..._,[h]:null}))},b=()=>{const c={};return i.full_name.trim()||(c.full_name="Full name is required"),i.position.trim()||(c.position="Position is required"),!i.department.trim()&&!I.trim()&&(c.department="Department is required"),i.email&&!/^\S+@\S+\.\S+$/.test(i.email)&&(c.email="Invalid email address"),j(c),Object.keys(c).length===0},y=async c=>{if(c.preventDefault(),!!b())try{const h={...i,department:i.department==="new"?I:i.department};await z(h),g(!0)}catch(h){console.error("Error adding employee:",h)}},g=(c=!1)=>{x({full_name:"",position:"",department:"",email:"",phone_number:"",status:"active"}),T(""),j({}),c?l():u()};return e.jsxs(ae,{open:r,onClose:()=>g(),maxWidth:"sm",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(k,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(s,{variant:"h6",children:"Add Employee"}),e.jsx(N,{edge:"end",color:"inherit",onClick:()=>g(),"aria-label":"close",children:e.jsx(se,{})})]})}),e.jsxs("form",{onSubmit:y,children:[e.jsx(ie,{children:e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,required:!0,label:"Full Name",name:"full_name",value:i.full_name,onChange:w,error:!!E.full_name,helperText:E.full_name})}),e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(M,{fullWidth:!0,required:!0,label:"Position",name:"position",value:i.position,onChange:w,error:!!E.position,helperText:E.position})}),e.jsx(o,{item:!0,xs:12,md:6,children:e.jsxs(Y,{fullWidth:!0,error:!!E.department,required:!0,children:[e.jsx(Q,{children:"Department"}),e.jsxs(Z,{name:"department",value:i.department,onChange:w,label:"Department *",children:[p.map(c=>e.jsx(W,{value:c,children:c},c)),e.jsx(W,{value:"new",children:e.jsx("em",{children:"Add New Department"})})]}),E.department&&e.jsx(Te,{children:E.department})]})}),i.department==="new"&&e.jsx(o,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,required:!0,label:"New Department Name",value:I,onChange:c=>T(c.target.value),error:i.department==="new"&&!I.trim(),helperText:i.department==="new"&&!I.trim()?"New department name is required":""})}),e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(M,{fullWidth:!0,label:"Email",name:"email",type:"email",value:i.email,onChange:w,error:!!E.email,helperText:E.email})}),e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(M,{fullWidth:!0,label:"Phone Number",name:"phone_number",value:i.phone_number,onChange:w})}),e.jsx(o,{item:!0,xs:12,children:e.jsxs(Y,{fullWidth:!0,children:[e.jsx(Q,{children:"Status"}),e.jsxs(Z,{name:"status",value:i.status,onChange:w,label:"Status",children:[e.jsx(W,{value:"active",children:"Active"}),e.jsx(W,{value:"inactive",children:"Inactive"})]})]})})]})}),e.jsxs(oe,{children:[e.jsx(O,{onClick:()=>g(),color:"primary",disabled:P,children:"Cancel"}),e.jsx(O,{type:"submit",variant:"contained",color:"primary",disabled:P,startIcon:P?e.jsx(ce,{size:24}):null,children:P?"Adding...":"Add Employee"})]})]})]})},Cs=({open:r,onClose:u,onSuccess:l,employee:p,departments:i=[]})=>{const[x,E]=f.useState({full_name:"",position:"",department:"",email:"",phone_number:"",status:"active"}),[j,I]=f.useState({}),[T,z]=f.useState(""),{updateEmployee:P,loading:w}=Ae();f.useEffect(()=>{p&&E({full_name:p.full_name||"",position:p.position||"",department:p.department||"",email:p.email||"",phone_number:p.phone_number||"",status:p.status||"active"})},[p]);const b=h=>{const{name:D,value:_}=h.target;E(n=>({...n,[D]:_})),j[D]&&I(n=>({...n,[D]:null}))},y=()=>{const h={};return x.full_name.trim()||(h.full_name="Full name is required"),x.position.trim()||(h.position="Position is required"),!x.department.trim()&&!T.trim()&&(h.department="Department is required"),x.email&&!/^\S+@\S+\.\S+$/.test(x.email)&&(h.email="Invalid email address"),I(h),Object.keys(h).length===0},g=async h=>{if(h.preventDefault(),!(!p||!y()))try{const D={...x,department:x.department==="new"?T:x.department};await P(p.id,D),c(!0)}catch(D){console.error("Error updating employee:",D)}},c=(h=!1)=>{z(""),I({}),h?l():u()};return p?e.jsxs(ae,{open:r,onClose:()=>c(),maxWidth:"sm",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(k,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(s,{variant:"h6",children:"Edit Employee"}),e.jsx(N,{edge:"end",color:"inherit",onClick:()=>c(),"aria-label":"close",children:e.jsx(se,{})})]})}),e.jsxs("form",{onSubmit:g,children:[e.jsxs(ie,{children:[e.jsx(M,{margin:"dense",fullWidth:!0,label:"Employee Code",value:p.employee_code||"",disabled:!0}),e.jsxs(o,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(o,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,required:!0,label:"Full Name",name:"full_name",value:x.full_name,onChange:b,error:!!j.full_name,helperText:j.full_name})}),e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(M,{fullWidth:!0,required:!0,label:"Position",name:"position",value:x.position,onChange:b,error:!!j.position,helperText:j.position})}),e.jsx(o,{item:!0,xs:12,md:6,children:e.jsxs(Y,{fullWidth:!0,error:!!j.department,required:!0,children:[e.jsx(Q,{children:"Department"}),e.jsxs(Z,{name:"department",value:x.department,onChange:b,label:"Department *",children:[i.map(h=>e.jsx(W,{value:h,children:h},h)),e.jsx(W,{value:"new",children:e.jsx("em",{children:"Add New Department"})})]}),j.department&&e.jsx(Te,{children:j.department})]})}),x.department==="new"&&e.jsx(o,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,required:!0,label:"New Department Name",value:T,onChange:h=>z(h.target.value),error:x.department==="new"&&!T.trim(),helperText:x.department==="new"&&!T.trim()?"New department name is required":""})}),e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(M,{fullWidth:!0,label:"Email",name:"email",type:"email",value:x.email,onChange:b,error:!!j.email,helperText:j.email})}),e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(M,{fullWidth:!0,label:"Phone Number",name:"phone_number",value:x.phone_number,onChange:b})}),e.jsx(o,{item:!0,xs:12,children:e.jsxs(Y,{fullWidth:!0,children:[e.jsx(Q,{children:"Status"}),e.jsxs(Z,{name:"status",value:x.status,onChange:b,label:"Status",children:[e.jsx(W,{value:"active",children:"Active"}),e.jsx(W,{value:"inactive",children:"Inactive"})]})]})})]})]}),e.jsxs(oe,{children:[e.jsx(O,{onClick:()=>c(),color:"primary",disabled:w,children:"Cancel"}),e.jsx(O,{type:"submit",variant:"contained",color:"primary",disabled:w,startIcon:w?e.jsx(ce,{size:24}):null,children:w?"Updating...":"Update Employee"})]})]})]}):null},Ms=({open:r,onClose:u,employee:l})=>{const[p,i]=f.useState(new Date(new Date().getFullYear(),new Date().getMonth()-1,1).toISOString().split("T")[0]),[x,E]=f.useState(new Date().toISOString().split("T")[0]),[j,I]=f.useState("all"),[T,z]=f.useState(!1),[P,w]=f.useState(null),{transactions:b,getEmployeeTransactions:y,approveTransaction:g,cancelTransaction:c,loading:h}=fe();f.useEffect(()=>{r&&l&&D()},[r,l]);const D=async()=>{if(l)try{const A={status:j!=="all"?j:void 0,startDate:p,endDate:x};await y(l.id,A)}catch(A){console.error("Error loading employee transactions:",A)}},_=()=>{D()},n=async A=>{try{await g(A),D()}catch(H){console.error("Error approving transaction:",H)}},a=async A=>{try{const H=prompt("Please enter a reason for cancellation:");H&&(await c(A,H),D())}catch(H){console.error("Error cancelling transaction:",H)}},d=A=>{w(A),z(!0)},v=A=>{switch(A){case"approved":return e.jsx(B,{label:"Approved",color:"success",size:"small"});case"pending":return e.jsx(B,{label:"Pending",color:"warning",size:"small"});case"settled":return e.jsx(B,{label:"Settled",color:"info",size:"small"});case"issued":return e.jsx(B,{label:"Issued",color:"primary",size:"small"});case"cancelled":return e.jsx(B,{label:"Cancelled",color:"error",size:"small"});default:return e.jsx(B,{label:A,size:"small"})}},q=()=>b.reduce((A,H)=>A+parseFloat(H.amount_issued||0),0),ve=()=>b.reduce((A,H)=>A+parseFloat(H.amount_spent||0),0),be=()=>b.reduce((A,H)=>A+parseFloat(H.amount_returned||0),0);return l?e.jsxs(e.Fragment,{children:[e.jsxs(ae,{open:r,onClose:u,maxWidth:"md",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(k,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(s,{variant:"h6",children:[l.full_name,"'s Transactions"]}),e.jsx(N,{edge:"end",color:"inherit",onClick:u,"aria-label":"close",children:e.jsx(se,{})})]})}),e.jsxs(ie,{children:[e.jsx(V,{sx:{p:2,mb:3},children:e.jsxs(o,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(M,{fullWidth:!0,label:"Start Date",type:"date",value:p,onChange:A=>i(A.target.value),InputLabelProps:{shrink:!0},size:"small"})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(M,{fullWidth:!0,label:"End Date",type:"date",value:x,onChange:A=>E(A.target.value),InputLabelProps:{shrink:!0},size:"small",inputProps:{min:p}})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsxs(Y,{fullWidth:!0,size:"small",children:[e.jsx(Q,{children:"Status"}),e.jsxs(Z,{value:j,onChange:A=>I(A.target.value),label:"Status",children:[e.jsx(W,{value:"all",children:"All Status"}),e.jsx(W,{value:"issued",children:"Issued"}),e.jsx(W,{value:"settled",children:"Settled"}),e.jsx(W,{value:"approved",children:"Approved"}),e.jsx(W,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(O,{variant:"contained",color:"primary",fullWidth:!0,onClick:_,startIcon:e.jsx(Ve,{}),children:"Filter"})})]})}),e.jsx(k,{sx:{mb:3},children:e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{item:!0,xs:12,sm:4,children:e.jsxs(V,{sx:{p:2,textAlign:"center"},children:[e.jsx(s,{variant:"subtitle2",color:"textSecondary",children:"Total Issued"}),e.jsx(s,{variant:"h5",children:L(q())})]})}),e.jsx(o,{item:!0,xs:12,sm:4,children:e.jsxs(V,{sx:{p:2,textAlign:"center"},children:[e.jsx(s,{variant:"subtitle2",color:"textSecondary",children:"Total Spent"}),e.jsx(s,{variant:"h5",children:L(ve())})]})}),e.jsx(o,{item:!0,xs:12,sm:4,children:e.jsxs(V,{sx:{p:2,textAlign:"center"},children:[e.jsx(s,{variant:"subtitle2",color:"textSecondary",children:"Total Returned"}),e.jsx(s,{variant:"h5",children:L(be())})]})})]})}),e.jsx(he,{component:V,children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(C,{children:[e.jsx(t,{children:"Reference"}),e.jsx(t,{children:"Date"}),e.jsx(t,{children:"Purpose"}),e.jsx(t,{align:"right",children:"Issued"}),e.jsx(t,{align:"right",children:"Spent"}),e.jsx(t,{align:"right",children:"Returned"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Actions"})]})}),e.jsx(je,{children:h?e.jsx(C,{children:e.jsx(t,{colSpan:8,align:"center",children:e.jsx(ce,{size:24})})}):b.length===0?e.jsx(C,{children:e.jsx(t,{colSpan:8,align:"center",children:"No transactions found for this period"})}):b.map(A=>e.jsxs(C,{children:[e.jsx(t,{children:A.transaction_reference}),e.jsx(t,{children:ge(A.date)}),e.jsx(t,{children:A.purpose}),e.jsx(t,{align:"right",children:L(A.amount_issued)}),e.jsx(t,{align:"right",children:L(A.amount_spent||0)}),e.jsx(t,{align:"right",children:L(A.amount_returned||0)}),e.jsx(t,{children:v(A.status)}),e.jsxs(t,{children:[A.status==="issued"&&e.jsx(K,{title:"Settle",children:e.jsx(N,{color:"primary",size:"small",onClick:()=>d(A),children:e.jsx(He,{})})}),A.status==="settled"&&e.jsx(K,{title:"Approve",children:e.jsx(N,{color:"success",size:"small",onClick:()=>n(A.id),children:e.jsx(ke,{})})}),(A.status==="issued"||A.status==="settled")&&e.jsx(K,{title:"Cancel",children:e.jsx(N,{color:"error",size:"small",onClick:()=>a(A.id),children:e.jsx(mr,{})})})]})]},A.id))})]})})]}),e.jsx(oe,{children:e.jsx(O,{onClick:u,color:"primary",children:"Close"})})]}),e.jsx(pr,{open:T,onClose:()=>{z(!1),w(null)},onSuccess:()=>{z(!1),w(null),D()},transaction:P})]}):null},$s=()=>{const[r,u]=f.useState(""),[l,p]=f.useState("all"),[i,x]=f.useState("all"),[E,j]=f.useState(!1),[I,T]=f.useState(!1),[z,P]=f.useState(!1),[w,b]=f.useState(null),[y,g]=f.useState(!1),{employees:c,getAllEmployees:h,deleteEmployee:D,stats:_,loading:n}=Ae();f.useEffect(()=>{a()},[]);const a=async()=>{try{await h({search:r,status:l!=="all"?l:void 0,department:i!=="all"?i:void 0})}catch(R){console.error("Error loading employees:",R)}},d=()=>{a()},v=R=>{b(R),T(!0)},q=R=>{b(R),P(!0)},ve=async()=>{if(w)try{await D(w.id),g(!1),b(null),a()}catch(R){console.error("Error deleting employee:",R)}},be=R=>{b(R),g(!0)},A=()=>!_||!_.departments?[]:_.departments,H=R=>{switch(R){case"active":return e.jsx(B,{label:"Active",color:"success",size:"small"});case"inactive":return e.jsx(B,{label:"Inactive",color:"error",size:"small"});default:return e.jsx(B,{label:R,size:"small"})}};return e.jsxs(k,{children:[e.jsx(ee,{sx:{mb:3},children:e.jsx(re,{children:e.jsxs(o,{container:!0,spacing:3,children:[e.jsxs(o,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"h6",children:"Employees Management"}),e.jsx(s,{variant:"body2",color:"textSecondary",children:"Manage employees for petty cash transactions"})]}),e.jsx(o,{item:!0,xs:12,md:6,sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(O,{variant:"contained",color:"primary",startIcon:e.jsx(Ee,{}),onClick:()=>j(!0),children:"Add Employee"})})]})})}),e.jsx(V,{sx:{p:2,mb:3},children:e.jsxs(o,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(o,{item:!0,xs:12,md:4,children:e.jsx(M,{fullWidth:!0,placeholder:"Search name, code, position...",value:r,onChange:R=>u(R.target.value),onKeyPress:R=>R.key==="Enter"&&d(),InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(hr,{})})},size:"small"})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsxs(Y,{fullWidth:!0,size:"small",children:[e.jsx(Q,{children:"Status"}),e.jsxs(Z,{value:l,onChange:R=>p(R.target.value),label:"Status",children:[e.jsx(W,{value:"all",children:"All Status"}),e.jsx(W,{value:"active",children:"Active"}),e.jsx(W,{value:"inactive",children:"Inactive"})]})]})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsxs(Y,{fullWidth:!0,size:"small",children:[e.jsx(Q,{children:"Department"}),e.jsxs(Z,{value:i,onChange:R=>x(R.target.value),label:"Department",children:[e.jsx(W,{value:"all",children:"All Departments"}),A().map(R=>e.jsx(W,{value:R,children:R},R))]})]})}),e.jsx(o,{item:!0,xs:12,md:2,children:e.jsx(O,{variant:"contained",color:"primary",fullWidth:!0,onClick:d,startIcon:e.jsx(Ve,{}),children:"Filter"})})]})}),e.jsx(he,{component:V,children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(C,{children:[e.jsx(t,{children:"Employee Code"}),e.jsx(t,{children:"Full Name"}),e.jsx(t,{children:"Position"}),e.jsx(t,{children:"Department"}),e.jsx(t,{children:"Contact"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Actions"})]})}),e.jsx(je,{children:n?e.jsx(C,{children:e.jsx(t,{colSpan:7,align:"center",children:"Loading..."})}):c.length===0?e.jsx(C,{children:e.jsx(t,{colSpan:7,align:"center",children:"No employees found"})}):c.map(R=>e.jsxs(C,{children:[e.jsx(t,{children:R.employee_code}),e.jsx(t,{children:R.full_name}),e.jsx(t,{children:R.position}),e.jsx(t,{children:R.department}),e.jsx(t,{children:R.phone_number?e.jsxs("div",{children:[e.jsx("div",{children:R.phone_number}),e.jsx(s,{variant:"caption",color:"textSecondary",children:R.email})]}):R.email}),e.jsx(t,{children:H(R.status)}),e.jsxs(t,{children:[e.jsx(K,{title:"View Transactions",children:e.jsx(N,{color:"primary",size:"small",onClick:()=>q(R),children:e.jsx(Be,{})})}),e.jsx(K,{title:"Edit",children:e.jsx(N,{color:"info",size:"small",onClick:()=>v(R),children:e.jsx(He,{})})}),e.jsx(K,{title:"Delete",children:e.jsx(N,{color:"error",size:"small",onClick:()=>be(R),children:e.jsx(qe,{})})})]})]},R.id))})]})}),e.jsxs(ae,{open:y,onClose:()=>g(!1),children:[e.jsx(le,{children:"Confirm Delete"}),e.jsx(ie,{children:e.jsxs(ms,{children:['Are you sure you want to delete the employee "',w==null?void 0:w.full_name,'"? This action cannot be undone.']})}),e.jsxs(oe,{children:[e.jsx(O,{onClick:()=>g(!1),color:"primary",children:"Cancel"}),e.jsx(O,{onClick:ve,color:"error",children:"Delete"})]})]}),e.jsx(Ns,{open:E,onClose:()=>j(!1),onSuccess:()=>{j(!1),a()},departments:A()}),e.jsx(Cs,{open:I,onClose:()=>{T(!1),b(null)},onSuccess:()=>{T(!1),b(null),a()},employee:w,departments:A()}),e.jsx(Ms,{open:z,onClose:()=>{P(!1),b(null)},employee:w})]})},Os=({pettyCashStats:r,employeeStats:u,balance:l})=>{var p;return e.jsxs(k,{children:[e.jsxs(o,{container:!0,spacing:3,mb:2,children:[e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsx(s,{variant:"subtitle2",color:"textSecondary",children:"Fund Usage Rate"}),e.jsxs(s,{variant:"h4",children:[(r==null?void 0:r.total_funds)>0?Math.round((r.total_funds-r.available_balance)/r.total_funds*100):0,"%"]}),e.jsxs(k,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ps,{style:{color:"#ff4d4f",marginRight:8}}),e.jsxs(s,{variant:"body2",color:"error",children:["Used: ",L((r==null?void 0:r.total_funds)-(r==null?void 0:r.available_balance)||0)]})]})]})})}),e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsx(s,{variant:"subtitle2",color:"textSecondary",children:"Transaction Success Rate"}),e.jsxs(s,{variant:"h4",children:[(r==null?void 0:r.total_transactions)>0?Math.round(r.approved_transactions/r.total_transactions*100):0,"%"]}),e.jsxs(k,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ke,{style:{color:"#52c41a",marginRight:8}}),e.jsxs(s,{variant:"body2",color:"success.main",children:["Approved: ",(r==null?void 0:r.approved_transactions)||0," of ",(r==null?void 0:r.total_transactions)||0]})]})]})})}),e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsx(s,{variant:"subtitle2",color:"textSecondary",children:"Pending Actions"}),e.jsx(s,{variant:"h4",children:((r==null?void 0:r.pending_transactions)||0)+((r==null?void 0:r.settled_transactions)||0)}),e.jsxs(k,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(js,{style:{color:"#faad14",marginRight:8}}),e.jsxs(s,{variant:"body2",color:"warning.main",children:[(r==null?void 0:r.pending_transactions)||0," pending, ",(r==null?void 0:r.settled_transactions)||0," to approve"]})]})]})})}),e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsx(s,{variant:"subtitle2",color:"textSecondary",children:"Employee Engagement"}),e.jsx(s,{variant:"h4",children:u!=null&&u.active_employees?Math.round(((r==null?void 0:r.total_transactions)||0)/u.active_employees):0}),e.jsxs(k,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Le,{style:{color:"#1890ff",marginRight:8}}),e.jsx(s,{variant:"body2",color:"primary",children:"Avg. transactions per employee"})]})]})})})]}),e.jsxs(o,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsxs(ar,{direction:"row",spacing:2,alignItems:"center",sx:{mb:2},children:[e.jsx(_s,{style:{fontSize:24}}),e.jsx(s,{variant:"h6",children:"Petty Cash Statistics"})]}),e.jsx(Pe,{sx:{mb:2}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx(s,{variant:"subtitle2",color:"textSecondary",children:"Available Balance"}),e.jsx(s,{variant:"h5",children:L(l||0)})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx(s,{variant:"subtitle2",color:"textSecondary",children:"Total Funds"}),e.jsx(s,{variant:"h5",children:L((r==null?void 0:r.total_funds)||0)})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx(s,{variant:"subtitle2",color:"textSecondary",children:"Total Issued"}),e.jsx(s,{variant:"h5",color:"error",children:L((r==null?void 0:r.total_issued)||0)})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx(s,{variant:"subtitle2",color:"textSecondary",children:"Total Spent"}),e.jsx(s,{variant:"h5",color:"warning.main",children:L((r==null?void 0:r.total_spent)||0)})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx(s,{variant:"subtitle2",color:"textSecondary",children:"Total Returned"}),e.jsx(s,{variant:"h5",color:"success.main",children:L((r==null?void 0:r.total_returned)||0)})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx(s,{variant:"subtitle2",color:"textSecondary",children:"Pending Funds"}),e.jsx(s,{variant:"h5",color:"info.main",children:L((r==null?void 0:r.pending_funds)||0)})]})]})]})})}),e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsxs(ar,{direction:"row",spacing:2,alignItems:"center",sx:{mb:2},children:[e.jsx(Le,{style:{fontSize:24}}),e.jsx(s,{variant:"h6",children:"Employee Statistics"})]}),e.jsx(Pe,{sx:{mb:2}}),e.jsxs(o,{container:!0,spacing:1.5,children:[e.jsxs(o,{item:!0,xs:6,children:[e.jsx(s,{variant:"subtitle2",color:"textSecondary",children:"Total Employees"}),e.jsx(s,{variant:"h5",children:(u==null?void 0:u.total_employees)||0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx(s,{variant:"subtitle2",color:"textSecondary",children:"Active Employees"}),e.jsx(s,{variant:"h5",color:"success.main",children:(u==null?void 0:u.active_employees)||0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx(s,{variant:"subtitle2",color:"textSecondary",children:"Inactive Employees"}),e.jsx(s,{variant:"h5",color:"error",children:(u==null?void 0:u.inactive_employees)||0})]}),e.jsxs(o,{item:!0,xs:6,children:[e.jsx(s,{variant:"subtitle2",color:"textSecondary",children:"Total Departments"}),e.jsx(s,{variant:"h5",children:((p=u==null?void 0:u.departments)==null?void 0:p.length)||0})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx(s,{variant:"subtitle2",color:"textSecondary",gutterBottom:!0,children:"Active Rate"}),e.jsxs(k,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx(k,{sx:{flexGrow:1,mr:2},children:e.jsx(cs,{variant:"determinate",value:u!=null&&u.total_employees?u.active_employees/u.total_employees*100:0,sx:{height:10,borderRadius:5},color:"success"})}),e.jsxs(s,{variant:"body2",sx:{minWidth:"fit-content"},children:[u!=null&&u.total_employees?Math.round(u.active_employees/u.total_employees*100):0,"%"]})]})]})]})]})})})]}),e.jsxs(o,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Transaction Status"}),e.jsx(he,{children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(C,{children:[e.jsx(t,{children:"Status"}),e.jsx(t,{align:"right",children:"Count"}),e.jsx(t,{align:"right",children:"Percentage"})]})}),e.jsxs(je,{children:[e.jsxs(C,{children:[e.jsx(t,{children:e.jsx(B,{label:"Pending",color:"warning",size:"small"})}),e.jsx(t,{align:"right",children:(r==null?void 0:r.pending_transactions)||0}),e.jsxs(t,{align:"right",children:[(r==null?void 0:r.total_transactions)>0?((r==null?void 0:r.pending_transactions)/(r==null?void 0:r.total_transactions)*100).toFixed(1):0,"%"]})]}),e.jsxs(C,{children:[e.jsx(t,{children:e.jsx(B,{label:"Settled",color:"info",size:"small"})}),e.jsx(t,{align:"right",children:(r==null?void 0:r.settled_transactions)||0}),e.jsxs(t,{align:"right",children:[(r==null?void 0:r.total_transactions)>0?((r==null?void 0:r.settled_transactions)/(r==null?void 0:r.total_transactions)*100).toFixed(1):0,"%"]})]}),e.jsxs(C,{children:[e.jsx(t,{children:e.jsx(B,{label:"Approved",color:"success",size:"small"})}),e.jsx(t,{align:"right",children:(r==null?void 0:r.approved_transactions)||0}),e.jsxs(t,{align:"right",children:[(r==null?void 0:r.total_transactions)>0?((r==null?void 0:r.approved_transactions)/(r==null?void 0:r.total_transactions)*100).toFixed(1):0,"%"]})]}),e.jsxs(C,{children:[e.jsx(t,{children:e.jsx(B,{label:"Cancelled",color:"error",size:"small"})}),e.jsx(t,{align:"right",children:(r==null?void 0:r.cancelled_transactions)||0}),e.jsxs(t,{align:"right",children:[(r==null?void 0:r.total_transactions)>0?((r==null?void 0:r.cancelled_transactions)/(r==null?void 0:r.total_transactions)*100).toFixed(1):0,"%"]})]}),e.jsxs(C,{children:[e.jsx(t,{sx:{fontWeight:"bold"},children:"Total"}),e.jsx(t,{align:"right",sx:{fontWeight:"bold"},children:(r==null?void 0:r.total_transactions)||0}),e.jsx(t,{align:"right",sx:{fontWeight:"bold"},children:"100%"})]})]})]})})]})})}),e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Department Breakdown"}),u!=null&&u.departments&&u.departments.length>0?e.jsx(he,{children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(C,{children:[e.jsx(t,{children:"Department"}),e.jsx(t,{align:"right",children:"Employees"})]})}),e.jsx(je,{children:u.departments.map(i=>e.jsxs(C,{children:[e.jsx(t,{children:i}),e.jsx(t,{align:"right",children:"-"})]},i))})]})}):e.jsx(s,{variant:"body2",color:"textSecondary",align:"center",sx:{py:4},children:"No department data available"})]})})})]})]})};function Se(r){const{children:u,value:l,index:p,...i}=r;return e.jsx("div",{role:"tabpanel",hidden:l!==p,id:`petty-cash-tabpanel-${p}`,"aria-labelledby":`petty-cash-tab-${p}`,...i,children:l===p&&e.jsx(k,{children:u})})}const yn=()=>{const[r,u]=f.useState(0),[l,p]=f.useState(!1),{getBalance:i,getStats:x,balance:E,stats:j,loading:I}=fe(),{getEmployeeStats:T,stats:z,loading:P}=Ae();f.useEffect(()=>{if(l)return;(async()=>{if(!l)try{await Promise.all([i(),x(),T()]),p(!0)}catch(y){console.error("Error loading data:",y)}})()},[]);const w=(b,y)=>{u(y)};return e.jsxs(e.Fragment,{children:[e.jsx(k,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(xr,{value:r,onChange:w,"aria-label":"petty cash management tabs",textColor:"primary",indicatorColor:"primary",children:[e.jsx(_e,{icon:e.jsx(Fs,{}),iconPosition:"start",label:"Petty Cash",id:"petty-cash-tab-0"}),e.jsx(_e,{icon:e.jsx(Le,{}),iconPosition:"start",label:"Employees",id:"petty-cash-tab-1"}),e.jsx(_e,{icon:e.jsx(vs,{}),iconPosition:"start",label:"Statistics",id:"petty-cash-tab-2"})]})}),e.jsx(Se,{value:r,index:0,children:e.jsx(Ws,{})}),e.jsx(Se,{value:r,index:1,children:e.jsx($s,{})}),e.jsx(Se,{value:r,index:2,children:e.jsx(Os,{pettyCashStats:j,employeeStats:z,balance:E})})]})};export{yn as default};
