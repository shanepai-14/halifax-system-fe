import{r as i,a8 as _,a9 as A,j as e,aa as we,q as l,G as X,P as T,T as x,y as L,ab as Ie,D as Z,ac as Ce,H as q,Q as _e,S as ee,V as Ae,ad as ke,R as te,ae as Re,af as O,E as Te,F as ne,I as re,t as se}from"./index-CrSDUfpv.js";import{u as Le,a as $e,b as Ve,c as Pe,I as Oe}from"./useInventory-DQ3BTcx8.js";import{R as ce}from"./WarningOutlined-KI1wQ6s6.js";import{R as De}from"./MoneyCollectOutlined-BzngQVyv.js";import{C as ze}from"./Container-DMwzkbrP.js";import{T as Me,S as oe,c as D,d as z,e as M,a as u,b as n,f as N}from"./TextField-BZsMM0g7.js";import{R as Ne}from"./SearchOutlined-CtvaPbOD.js";import{I as ae,B as v}from"./InputLabel-CrBhOIEx.js";import{M as g}from"./MenuItem-D9v4Q_DO.js";import{R as Be}from"./ClearOutlined-CUwoYMK4.js";import{R as qe}from"./PlusOutlined-CS1xHgMf.js";import{A as Fe}from"./Alert-CrQwUFZY.js";import{R as Ee}from"./EyeOutlined-CPZxAXXA.js";import{R as He}from"./EditOutlined-Cnvvn_72.js";import{D as We}from"./Dialog-Ov5HwEb9.js";import{D as Ue,a as Ge}from"./DialogTitle-Cw6pjI73.js";import{S as j}from"./Skeleton-nksCSs6l.js";import"./Autocomplete-BZhk10t8.js";import"./Close-CNlkB0yM.js";import"./CloseOutlined-DSNBHcB9.js";import"./SaveOutlined-CbUBWhg3.js";var Qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"},Je=function(s,o){return i.createElement(_,A({},s,{ref:o,icon:Qe}))},le=i.forwardRef(Je),Ye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z"}}]},name:"info-circle",theme:"outlined"},Ke=function(s,o){return i.createElement(_,A({},s,{ref:o,icon:Ye}))},Xe=i.forwardRef(Ke),Ze={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},et=function(s,o){return i.createElement(_,A({},s,{ref:o,icon:Ze}))},tt=i.forwardRef(et),nt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M859.9 780H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM505.7 669a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V176c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8z"}}]},name:"vertical-align-bottom",theme:"outlined"},rt=function(s,o){return i.createElement(_,A({},s,{ref:o,icon:nt}))},st=i.forwardRef(rt),ot={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M859.9 168H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM518.3 355a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V848c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V509.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 355z"}}]},name:"vertical-align-top",theme:"outlined"},at=function(s,o){return i.createElement(_,A({},s,{ref:o,icon:ot}))},lt=i.forwardRef(at);const it=({inventoryData:p=[],stats:s={}})=>{const o={totalItems:s.totalItems||1254,totalValue:s.totalValue||187650.75,lowStockItems:s.lowStockItems||23,topSellingItems:s.topSellingItems||5,reorderNeeded:s.reorderNeeded||18,incomingStock:s.incomingStock||42,inventoryTurnover:s.inventoryTurnover||4.2,stockAccuracy:s.stockAccuracy||98.3},h=[{title:"Total Inventory",value:o.totalItems,icon:e.jsx(we,{style:{fontSize:24}}),color:"#1976d2",secondaryValue:`$${o.totalValue.toLocaleString("en-US",{maximumFractionDigits:2})}`,secondaryLabel:"Total Value"},{title:"Low Stock Items",value:o.lowStockItems,icon:e.jsx(ce,{style:{fontSize:24}}),color:"#f44336",secondaryValue:o.reorderNeeded,secondaryLabel:"Require Immediate Reorder",chip:{label:`${o.lowStockItems} items below threshold`,color:"error"}},{title:"Inventory Performance",value:`${o.stockAccuracy}%`,icon:e.jsx(Xe,{style:{fontSize:24}}),color:"#4caf50",progress:o.stockAccuracy,secondaryValue:o.inventoryTurnover,secondaryLabel:"Turnover Rate"},{title:"Stock Movement",value:o.topSellingItems,icon:e.jsx(De,{style:{fontSize:24}}),color:"#ff9800",secondaryValue:o.incomingStock,secondaryLabel:"Incoming Stock",stats:[{label:"Outgoing",value:28,icon:e.jsx(lt,{})},{label:"Incoming",value:42,icon:e.jsx(st,{})}]}];return e.jsx(l,{sx:{mb:4},children:e.jsx(X,{container:!0,spacing:3,children:h.map((a,b)=>e.jsx(X,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(T,{elevation:1,sx:{p:2,height:"100%",borderTop:`4px solid ${a.color}`,borderRadius:"4px",transition:"transform 0.3s, box-shadow 0.3s","&:hover":{transform:"translateY(-3px)",boxShadow:3}},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:a.title}),e.jsx(l,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:40,height:40,borderRadius:"50%",backgroundColor:`${a.color}20`},children:e.jsx(l,{sx:{color:a.color},children:a.icon})})]}),e.jsx(x,{variant:"h4",sx:{fontWeight:"bold",color:a.color,mb:1},children:a.value}),a.chip&&e.jsx(L,{label:a.chip.label,color:a.chip.color,size:"small",sx:{my:1}}),a.progress&&e.jsx(l,{sx:{mb:1},children:e.jsx(Ie,{variant:"determinate",value:a.progress,sx:{height:8,borderRadius:4,backgroundColor:`${a.color}30`,"& .MuiLinearProgress-bar":{backgroundColor:a.color}}})}),a.stats?e.jsxs(l,{sx:{mt:2},children:[e.jsx(Z,{sx:{my:1}}),e.jsx(Ce,{direction:"row",spacing:2,justifyContent:"space-between",children:a.stats.map((f,S)=>e.jsx(q,{title:f.label,children:e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(l,{sx:{mr:.5,color:"text.secondary"},children:f.icon}),e.jsx(x,{variant:"body2",children:f.value})]})},S))})]}):e.jsxs(l,{sx:{mt:"auto"},children:[e.jsx(Z,{sx:{my:1}}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(x,{variant:"body2",color:"text.secondary",children:a.secondaryLabel}),e.jsx(x,{variant:"body1",fontWeight:"medium",children:a.secondaryValue})]})]})]})},b))})})},ie={low:{color:"error",label:"Low Stock"},normal:{color:"success",label:"Normal"},overstocked:{color:"warning",label:"Overstocked"}},ct=[{value:"addition",label:"Addition"},{value:"reduction",label:"Reduction"},{value:"damage",label:"Damage"},{value:"loss",label:"Loss"},{value:"correction",label:"Correction"}],B=()=>e.jsxs(u,{children:[e.jsx(n,{children:e.jsx(j,{animation:"wave"})}),e.jsx(n,{children:e.jsx(j,{animation:"wave"})}),e.jsx(n,{children:e.jsx(j,{animation:"wave"})}),e.jsx(n,{children:e.jsx(j,{animation:"wave"})}),e.jsx(n,{children:e.jsx(j,{animation:"wave"})}),e.jsx(n,{children:e.jsx(j,{animation:"wave"})}),e.jsx(n,{align:"right",children:e.jsxs(l,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[e.jsx(j,{animation:"wave",variant:"circular",width:32,height:32}),e.jsx(j,{animation:"wave",variant:"circular",width:32,height:32})]})})]}),Lt=()=>{const p=_e(),[s,o]=i.useState(0),[h,a]=i.useState(10),[b,f]=i.useState(""),[S,F]=i.useState("All Categories"),[$,E]=i.useState("All Status"),[de,H]=i.useState(!1),[w,V]=i.useState(null),[k,ue]=i.useState(0),I=ee(Ae),W=ee(ke),{data:U=[],isLoading:xe,refetch:G}=Le(),{data:Q=[],isLoading:he}=$e(),{mutateAsync:me}=Ve(),{data:J=[],isLoading:je}=Pe(),y=te.useMemo(()=>U.map(t=>{const r=I.find(c=>c.id===t.product_id);return{...t,...r,status:ye(t.quantity,(r==null?void 0:r.reorder_level)||0)}}),[U,I]),pe=te.useMemo(()=>{const t=y.length,r=y.reduce((d,C)=>d+C.quantity*(C.cost_price||0),0),c=y.filter(d=>d.status==="low").length,m=y.filter(d=>d.quantity<=d.reorder_level*.7).length;return{totalItems:t,totalValue:r,lowStockItems:c,reorderNeeded:m,topSellingItems:5,incomingStock:42,inventoryTurnover:4.2,stockAccuracy:98.3}},[y]),R=y.filter(t=>{var d,C,K;const r=((d=t.product_name)==null?void 0:d.toLowerCase().includes(b.toLowerCase()))||((C=t.product_code)==null?void 0:C.toLowerCase().includes(b.toLowerCase())),c=S==="All Categories"||((K=t.product_category_id)==null?void 0:K.toString())===S,m=$==="All Status"||t.status===$.toLowerCase();return r&&c&&m});function ye(t,r){return t<=r?"low":t>r*3?"overstocked":"normal"}const ve=()=>{f(""),F("All Categories"),E("All Status")},Y=t=>{V(t),H(!0)},fe=t=>{V(t)},P=()=>{H(!1),V(null)},ge=async t=>{try{await me({id:t.id,quantity:t.quantity,adjustment_type:t.type,reason:t.reason,notes:t.notes}),se.success("Inventory adjustment recorded successfully"),G(),P()}catch(r){se.error("Error recording adjustment: "+(r.message||"Unknown error"))}},be=(t,r)=>{ue(r)},Se=t=>{p(`/app/inventory/${t}`)};return e.jsxs(ze,{maxWidth:"xxl",sx:{mt:0,px:"0!important"},children:[e.jsx(it,{inventoryData:y,stats:pe}),e.jsxs(l,{sx:{mb:4},children:[e.jsxs(Re,{value:k,onChange:be,sx:{mb:3},children:[e.jsx(O,{label:"Current Inventory"}),e.jsx(O,{label:"Adjustments History"}),e.jsx(O,{label:"Inventory Logs"})]}),k===0&&e.jsxs(e.Fragment,{children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,gap:2},children:[e.jsxs(l,{sx:{display:"flex",gap:2,flex:1},children:[e.jsx(Me,{placeholder:"Search product name or code",variant:"outlined",size:"small",value:b,onChange:t=>f(t.target.value),InputProps:{startAdornment:e.jsx(Te,{position:"start",children:e.jsx(Ne,{})})},sx:{minWidth:250}}),e.jsxs(ne,{size:"small",sx:{minWidth:200},children:[e.jsx(ae,{children:"Category"}),e.jsxs(oe,{value:S,onChange:t=>F(t.target.value),label:"Category",children:[e.jsx(g,{value:"All Categories",children:"All Categories"}),W.map(t=>e.jsx(g,{value:t.id.toString(),children:t.name},t.id))]})]}),e.jsxs(ne,{size:"small",sx:{minWidth:200},children:[e.jsx(ae,{children:"Stock Status"}),e.jsxs(oe,{value:$,onChange:t=>E(t.target.value),label:"Stock Status",children:[e.jsx(g,{value:"All Status",children:"All Status"}),e.jsx(g,{value:"Low",children:"Low Stock"}),e.jsx(g,{value:"Normal",children:"Normal"}),e.jsx(g,{value:"Overstocked",children:"Overstocked"})]})]})]}),e.jsxs(l,{children:[e.jsx(v,{variant:"text",color:"error",sx:{mr:1},onClick:ve,children:e.jsx(Be,{})}),e.jsx(v,{variant:"contained",color:"primary",startIcon:e.jsx(tt,{}),onClick:()=>G(),sx:{mr:1},children:"Refresh"}),e.jsx(v,{variant:"contained",color:"error",startIcon:e.jsx(qe,{}),onClick:()=>Y({product_id:null}),children:"New Adjustment"})]})]}),R.some(t=>t.status==="low")&&e.jsx(Fe,{severity:"warning",sx:{mb:2},icon:e.jsx(ce,{}),children:"Some products are below their reorder levels. Please check and restock as needed."}),e.jsx(D,{component:T,children:e.jsxs(z,{children:[e.jsx(M,{children:e.jsxs(u,{children:[e.jsx(n,{children:"Product Code"}),e.jsx(n,{children:"Product Name"}),e.jsx(n,{children:"Category"}),e.jsx(n,{children:"Current Qty"}),e.jsx(n,{children:"Reorder Level"}),e.jsx(n,{children:"Status"}),e.jsx(n,{align:"right",children:"Actions"})]})}),e.jsx(N,{children:xe?Array.from(Array(h)).map((t,r)=>e.jsx(B,{},r)):R.length===0?e.jsx(u,{children:e.jsx(n,{colSpan:7,align:"center",sx:{py:3},children:e.jsx(x,{variant:"body1",color:"text.secondary",children:"No inventory items found"})})}):R.slice(s*h,s*h+h).map(t=>{var r,c,m;return e.jsxs(u,{hover:!0,children:[e.jsx(n,{children:t.product_code}),e.jsx(n,{children:e.jsx(l,{sx:{display:"flex",alignItems:"center"},children:t.product_name})}),e.jsx(n,{children:((r=W.find(d=>d.id===t.product_category_id))==null?void 0:r.name)||"-"}),e.jsx(n,{children:t.quantity}),e.jsx(n,{children:t.reorder_level}),e.jsx(n,{children:e.jsx(L,{label:(c=ie[t.status])==null?void 0:c.label,color:(m=ie[t.status])==null?void 0:m.color,size:"small"})}),e.jsxs(n,{align:"right",children:[e.jsx(q,{title:"View Product Details",children:e.jsx(re,{onClick:()=>Se(t.product_id),children:e.jsx(Ee,{})})}),e.jsx(q,{title:"Adjust Inventory",children:e.jsx(re,{onClick:()=>Y(t),children:e.jsx(He,{})})})]})]},t.product_id)})})]})}),e.jsxs(l,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:[e.jsx(v,{disabled:s===0,onClick:()=>o(s-1),sx:{mr:1},children:"Previous"}),e.jsx(v,{disabled:s>=Math.ceil(R.length/h)-1,onClick:()=>o(s+1),children:"Next"})]})]}),k===1&&e.jsxs(e.Fragment,{children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(x,{variant:"h6",children:"Inventory Adjustments History"}),e.jsx(v,{variant:"outlined",startIcon:e.jsx(le,{}),onClick:()=>console.log("Download adjustments report"),children:"Export Report"})]}),e.jsx(D,{component:T,children:e.jsxs(z,{children:[e.jsx(M,{children:e.jsxs(u,{children:[e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Product"}),e.jsx(n,{children:"Adjustment Type"}),e.jsx(n,{children:"Quantity"}),e.jsx(n,{children:"Reason"}),e.jsx(n,{children:"Performed By"}),e.jsx(n,{children:"Notes"})]})}),e.jsx(N,{children:he?Array.from(Array(h)).map((t,r)=>e.jsx(B,{},r)):Q.length===0?e.jsx(u,{children:e.jsx(n,{colSpan:7,align:"center",sx:{py:3},children:e.jsx(x,{variant:"body1",color:"text.secondary",children:"No adjustment records found"})})}):Q.map(t=>{var c;const r=I.find(m=>m.id===t.product_id);return e.jsxs(u,{hover:!0,children:[e.jsx(n,{children:new Date(t.created_at).toLocaleString()}),e.jsx(n,{children:(r==null?void 0:r.product_name)||"Unknown Product"}),e.jsx(n,{children:e.jsx(L,{label:t.adjustment_type.charAt(0).toUpperCase()+t.adjustment_type.slice(1),color:t.adjustment_type==="addition"||t.adjustment_type==="return"?"success":t.adjustment_type==="correction"?"info":"error",size:"small"})}),e.jsx(n,{children:t.adjustment_type==="addition"||t.adjustment_type==="return"?`+${t.quantity}`:`-${t.quantity}`}),e.jsx(n,{children:t.reason}),e.jsx(n,{children:((c=t.user)==null?void 0:c.name)||"System"}),e.jsx(n,{children:t.notes||"-"})]},t.id)})})]})})]}),k===2&&e.jsxs(e.Fragment,{children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(x,{variant:"h6",children:"Inventory Transaction History"}),e.jsx(v,{variant:"outlined",startIcon:e.jsx(le,{}),onClick:()=>console.log("Download logs report"),children:"Export Logs"})]}),e.jsx(D,{component:T,children:e.jsxs(z,{children:[e.jsx(M,{children:e.jsxs(u,{children:[e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Product"}),e.jsx(n,{children:"Transaction Type"}),e.jsx(n,{children:"Quantity"}),e.jsx(n,{children:"Reference"}),e.jsx(n,{children:"Before"}),e.jsx(n,{children:"After"})]})}),e.jsx(N,{children:je?Array.from(Array(h)).map((t,r)=>e.jsx(B,{},r)):J.length===0?e.jsx(u,{children:e.jsx(n,{colSpan:7,align:"center",sx:{py:3},children:e.jsx(x,{variant:"body1",color:"text.secondary",children:"No inventory logs found"})})}):J.map(t=>{const r=I.find(c=>c.id===t.product_id);return e.jsxs(u,{hover:!0,children:[e.jsx(n,{children:new Date(t.created_at).toLocaleString()}),e.jsx(n,{children:(r==null?void 0:r.product_name)||"Unknown Product"}),e.jsx(n,{children:e.jsx(L,{label:t.transaction_type.charAt(0).toUpperCase()+t.transaction_type.slice(1),color:t.transaction_type==="purchase"||t.transaction_type==="adjustment_in"?"success":t.transaction_type==="sales"||t.transaction_type==="adjustment_out"?"error":"info",size:"small"})}),e.jsx(n,{children:t.transaction_type==="purchase"||t.transaction_type==="adjustment_in"?`+${t.quantity}`:`-${t.quantity}`}),e.jsx(n,{children:t.reference_type==="purchase_order"?`PO-${t.reference_id}`:t.reference_type==="sales_order"?`SO-${t.reference_id}`:t.reference_type==="adjustment"?`ADJ-${t.reference_id}`:t.reference_id}),e.jsx(n,{children:t.quantity_before}),e.jsx(n,{children:t.quantity_after})]},t.id)})})]})})]})]}),e.jsxs(We,{open:de,onClose:P,maxWidth:"md",fullWidth:!0,children:[e.jsx(Ue,{children:w!=null&&w.product_name?`Adjust Inventory: ${w.product_name}`:"New Inventory Adjustment"}),e.jsx(Ge,{children:e.jsx(Oe,{product:w,products:I,adjustmentTypes:ct,onSubmit:ge,onCancel:P,onSelectedProduct:fe})})]})]})};export{Lt as default};
