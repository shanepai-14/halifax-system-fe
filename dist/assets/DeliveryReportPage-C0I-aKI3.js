import{r as h,ar as de,as as ce,C as ze,j as e,L as r,T as t,X,F,ah as We,_ as Y,U as s,N as ae,P as B,Z as He,a4 as Ee,$ as le,K as re,a1 as Pe,a2 as Ie,a0 as xe,aJ as ge,a5 as ke,aU as Be,R as he,aV as Ne,ab as $e,aW as Ve,ac as Ue}from"./index-MFznN85Y.js";import{l as Ae}from"./index-Bcs7yvqa.js";import{f as oe,a as me}from"./dateUtils-eAGKzorV.js";import{D as Q}from"./Dialog-EsyIrAit.js";import{D as Z,a as ee}from"./DialogTitle-DU-OKhNB.js";import{D as ue}from"./DialogContentText-DxIWO7Tt.js";import{c as ne,d as G,e as ie,a as A,b as i,f as K,T as W,S as Qe,M as Ge}from"./TextField-DllOVEH5.js";import{D as te}from"./DialogActions-Cg7Nf5jf.js";import{R as Me}from"./PrinterOutlined-Bo66Gpy5.js";import{R as Te}from"./CloseOutlined-DFy-qra4.js";import{u as qe,R as Ke,P as Je}from"./PaymentReceipt-BMwcZ71I.js";import{I as Xe}from"./InputLabel-WGrZKIER.js";import{M as U}from"./MenuItem-C7K-2hg_.js";import{R as Ye}from"./SaveOutlined-CU_ZH1DE.js";import{f as je}from"./currencyFormat-th2sljt-.js";import{R as Ze}from"./DeleteOutlined-B6C8z9xI.js";import{R as et}from"./EditOutlined-TnIBObTg.js";import{R as tt}from"./CloseCircleOutlined-CdjBvOs9.js";import{R as Le,L as Fe}from"./HomeOutlined-C5a2KOqA.js";import{R as nt}from"./CheckCircleOutlined-DpnBWGV4.js";import{S as x}from"./Skeleton-BXQeoAq0.js";import{C as it}from"./Container-BReizEgd.js";import{R as st}from"./FileTextOutlined-B_hA-jfn.js";import{R as rt}from"./ArrowLeftOutlined-Bin7fTfD.js";import"./Close-DO7wEk0s.js";var at={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"}}]},name:"down",theme:"outlined"},lt=function(n,l){return h.createElement(de,ce({},n,{ref:l,icon:at}))},ot=h.forwardRef(lt),dt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M911.5 700.7a8 8 0 00-10.3-4.8L840 718.2V180c0-37.6-30.4-68-68-68H252c-37.6 0-68 30.4-68 68v538.2l-61.3-22.3c-.9-.3-1.8-.5-2.7-.5-4.4 0-8 3.6-8 8V763c0 3.3 2.1 6.3 5.3 7.5L501 910.1c7.1 2.6 14.8 2.6 21.9 0l383.8-139.5c3.2-1.2 5.3-4.2 5.3-7.5v-59.6c0-1-.2-1.9-.5-2.8zM512 837.5l-256-93.1V184h512v560.4l-256 93.1zM660.6 312h-54.5c-3 0-5.8 1.7-7.1 4.4l-84.7 168.8H511l-84.7-168.8a8 8 0 00-7.1-4.4h-55.7c-1.3 0-2.6.3-3.8 1-3.9 2.1-5.3 7-3.2 10.8l103.9 191.6h-57c-4.4 0-8 3.6-8 8v27.1c0 4.4 3.6 8 8 8h76v39h-76c-4.4 0-8 3.6-8 8v27.1c0 4.4 3.6 8 8 8h76V704c0 4.4 3.6 8 8 8h49.9c4.4 0 8-3.6 8-8v-63.5h76.3c4.4 0 8-3.6 8-8v-27.1c0-4.4-3.6-8-8-8h-76.3v-39h76.3c4.4 0 8-3.6 8-8v-27.1c0-4.4-3.6-8-8-8H564l103.7-191.6c.6-1.2 1-2.5 1-3.8-.1-4.3-3.7-7.9-8.1-7.9z"}}]},name:"money-collect",theme:"outlined"},ct=function(n,l){return h.createElement(de,ce({},n,{ref:l,icon:dt}))},xt=h.forwardRef(ct),ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"},mt=function(n,l){return h.createElement(de,ce({},n,{ref:l,icon:ht}))},ut=h.forwardRef(mt),jt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M890.5 755.3L537.9 269.2c-12.8-17.6-39-17.6-51.7 0L133.5 755.3A8 8 0 00140 768h75c5.1 0 9.9-2.5 12.9-6.6L512 369.8l284.1 391.6c3 4.1 7.8 6.6 12.9 6.6h75c6.5 0 10.3-7.4 6.5-12.7z"}}]},name:"up",theme:"outlined"},gt=function(n,l){return h.createElement(de,ce({},n,{ref:l,icon:jt}))},pt=h.forwardRef(gt);const yt=ze(e.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert"),ft=({open:o,onClose:n,returnItems:l,handleReturnQuantityChange:m,returnReason:w,setReturnReason:u,handleSubmitCreditMemo:D,returns:d=[]})=>{const[f,y]=h.useState([]);h.useEffect(()=>{if(l&&l.length>0){const a={};d&&d.length>0&&d.forEach(_=>{_.items.forEach(R=>{const p=R.product_id;a[p]||(a[p]=0),a[p]+=parseInt(R.quantity)})});const j=l.map(_=>{const R=_.product_id,p=a[R]||0,I=Math.max(0,_.max_quantity-p);return{..._,original_max_quantity:_.max_quantity,max_quantity:I,already_returned:p}});y(j)}else y([])},[l,d]);const b=f.some(a=>a.max_quantity>0),g=f.reduce((a,j)=>a+parseFloat(j.sold_price)*j.return_quantity,0);return e.jsxs(Q,{open:o,onClose:n,maxWidth:"md",fullWidth:!0,children:[e.jsx(Z,{children:"Create Credit Memo"}),e.jsxs(ee,{children:[e.jsx(ue,{children:"Specify the items and quantities to be returned. Only items that are part of this delivery report can be returned."}),d&&d.length>0&&e.jsxs(r,{sx:{mt:2,mb:2,p:2,bgcolor:"background.level2",borderRadius:1},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Previous Returns:"}),d.map((a,j)=>e.jsxs(r,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(X,{label:a.credit_memo_number,size:"small",color:"primary",variant:"outlined",sx:{mr:1}}),e.jsxs(t,{variant:"body2",children:[new Date(a.return_date).toLocaleDateString()," - ₱",parseFloat(a.refund_amount).toFixed(2)]})]},a.id))]}),e.jsx(ne,{sx:{mt:2},children:e.jsxs(G,{size:"small",children:[e.jsx(ie,{children:e.jsxs(A,{children:[e.jsx(i,{children:"Item"}),e.jsx(i,{children:"Code"}),e.jsx(i,{align:"right",children:"Price"}),e.jsx(i,{align:"center",children:"Original Qty"}),e.jsx(i,{align:"center",children:"Already Returned"}),e.jsx(i,{align:"center",children:"Available"}),e.jsx(i,{align:"center",children:"Return Quantity"}),e.jsx(i,{align:"right",children:"Total"})]})}),e.jsxs(K,{children:[f.map(a=>{var j,_;return e.jsxs(A,{sx:a.max_quantity===0?{backgroundColor:"rgba(0,0,0,0.04)"}:{},children:[e.jsx(i,{children:(j=a.product)==null?void 0:j.product_name}),e.jsx(i,{children:(_=a.product)==null?void 0:_.product_code}),e.jsxs(i,{align:"right",children:["₱",parseFloat(a.sold_price).toFixed(2)]}),e.jsx(i,{align:"center",children:a.original_max_quantity}),e.jsxs(i,{align:"center",children:[a.already_returned>0&&e.jsx(X,{label:a.already_returned,size:"small",color:"warning",variant:"outlined"}),a.already_returned===0&&"-"]}),e.jsx(i,{align:"center",children:a.max_quantity}),e.jsx(i,{align:"center",children:e.jsx(W,{type:"number",InputProps:{inputProps:{min:0,max:a.max_quantity}},value:a.return_quantity,onChange:R=>m(a.id,R.target.value,a.already_returned),size:"small",sx:{width:"80px"},disabled:a.max_quantity===0})}),e.jsxs(i,{align:"right",children:["₱",(parseFloat(a.sold_price)*a.return_quantity).toFixed(2)]})]},a.id)}),e.jsxs(A,{children:[e.jsx(i,{colSpan:7,align:"right",children:e.jsx(t,{variant:"subtitle2",children:"Total Return Amount:"})}),e.jsx(i,{align:"right",children:e.jsxs(t,{variant:"subtitle2",children:["₱",g.toFixed(2)]})})]})]})]})}),!b&&e.jsx(r,{sx:{mt:2,p:2,bgcolor:"error.lighter",borderRadius:1},children:e.jsx(t,{variant:"body2",color:"error.main",children:"All items have been fully returned. No further returns are possible."})}),e.jsx(W,{margin:"dense",id:"returnReason",label:"Reason for Return",multiline:!0,rows:3,fullWidth:!0,variant:"outlined",value:w,onChange:a=>u(a.target.value),sx:{mt:3},disabled:!b})]}),e.jsxs(te,{children:[e.jsx(F,{onClick:n,children:"Cancel"}),e.jsx(F,{onClick:D,variant:"contained",color:"primary",disabled:!b||g<=0,children:"Create Credit Memo"})]})]})},vt=({open:o,onClose:n,returns:l,report:m})=>{var d,f,y,b;const w=h.useRef(),u=Ae.useReactToPrint({contentRef:w}),D=(l==null?void 0:l.reduce((g,a)=>g+parseFloat(a.refund_amount),0))||0;return!l||l.length===0?null:e.jsx(We,{open:o,onClose:n,"aria-labelledby":"credit-memo-modal-title",children:e.jsxs(r,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"90%",maxWidth:"850px",maxHeight:"90vh",overflow:"auto",bgcolor:"background.paper",boxShadow:24,p:4},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(t,{id:"credit-memo-modal-title",variant:"h5",children:"Credit Memo Details"}),e.jsxs(r,{children:[e.jsx(F,{variant:"outlined",color:"primary",startIcon:e.jsx(Me,{}),onClick:u,sx:{mr:1},children:"Print"}),e.jsx(Y,{onClick:n,color:"default",children:e.jsx(Te,{})})]})]}),e.jsxs(r,{ref:w,sx:{p:2},children:[e.jsxs(s,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(s,{item:!0,xs:12,md:12,children:e.jsxs(r,{sx:{textAlign:"center",mb:2},children:[e.jsx(t,{variant:"h4",children:"CREDIT MEMO"}),e.jsxs(t,{variant:"body2",children:["DR #: ",m==null?void 0:m.invoice_number]})]})}),e.jsxs(s,{item:!0,xs:12,md:12,sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[e.jsx(t,{variant:"h6",children:"Halifax Glass & Aluminum Supply"}),e.jsx(t,{variant:"body2",children:"Malagamot Road, Panacan"}),e.jsx(t,{variant:"body2",children:"glasshalifax@gmail.com"}),e.jsx(t,{variant:"body2",children:"0939 924 3876"})]}),e.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[e.jsxs(t,{variant:"body2",children:[e.jsx("strong",{children:"Date:"})," ",oe(new Date)]}),e.jsxs(t,{variant:"subtitle2",children:[e.jsx("strong",{children:"Customer:"})," ",((d=m==null?void 0:m.customer)==null?void 0:d.business_name)||((f=m==null?void 0:m.customer)==null?void 0:f.customer_name)]}),e.jsxs(t,{variant:"body2",children:[e.jsx("strong",{children:"Address:"})," ",((y=m==null?void 0:m.customer)==null?void 0:y.business_address)||(m==null?void 0:m.address)]}),e.jsxs(t,{variant:"body2",children:[e.jsx("strong",{children:"Phone:"})," ",m==null?void 0:m.phone]})]})]})]}),e.jsx(ae,{sx:{my:2}}),l.map((g,a)=>e.jsxs(r,{sx:{mb:3},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(t,{variant:"subtitle1",children:["Credit Memo #",g.credit_memo_number]}),e.jsxs(t,{variant:"body2",children:[e.jsx("strong",{children:"Date:"})," ",oe(g.return_date)]})]}),e.jsx(ne,{component:B,variant:"outlined",sx:{mb:1},children:e.jsxs(G,{size:"small",children:[e.jsx(ie,{children:e.jsxs(A,{children:[e.jsx(i,{children:"Item"}),e.jsx(i,{children:"Code"}),e.jsx(i,{align:"right",children:"Price"}),e.jsx(i,{align:"center",children:"Quantity"}),e.jsx(i,{align:"right",children:"Total"}),e.jsx(i,{children:"Condition"}),e.jsx(i,{children:"Reason"})]})}),e.jsx(K,{children:g.items.map(j=>e.jsxs(A,{children:[e.jsx(i,{children:`Product #${j.product_id}`}),e.jsx(i,{children:`P-${j.product_id}`}),e.jsxs(i,{align:"right",children:["₱",parseFloat(j.price).toFixed(2)]}),e.jsx(i,{align:"center",children:j.quantity}),e.jsxs(i,{align:"right",children:["₱",parseFloat(j.subtotal).toFixed(2)]}),e.jsx(i,{children:j.condition}),e.jsx(i,{children:j.return_reason})]},j.id))})]})}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(s,{container:!0,spacing:0,sx:{maxWidth:"300px"},children:[e.jsx(s,{item:!0,xs:6,children:e.jsx(t,{variant:"body1",fontWeight:"bold",align:"right",children:"Refund Amount:"})}),e.jsx(s,{item:!0,xs:6,children:e.jsxs(t,{variant:"body1",fontWeight:"bold",align:"right",children:["₱",parseFloat(g.refund_amount).toFixed(2)]})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(t,{variant:"body2",align:"right",children:"Method:"})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(t,{variant:"body2",align:"right",children:g.refund_method.toUpperCase()})})]})}),a<l.length-1&&e.jsx(ae,{sx:{my:2}})]},g.id)),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsxs(s,{container:!0,spacing:0,sx:{maxWidth:"300px"},children:[e.jsx(s,{item:!0,xs:6,children:e.jsx(t,{variant:"h6",fontWeight:"bold",align:"right",children:"Total Refund:"})}),e.jsx(s,{item:!0,xs:6,children:e.jsxs(t,{variant:"h6",fontWeight:"bold",align:"right",children:["₱",D.toFixed(2)]})})]})}),((b=l[0])==null?void 0:b.remarks)&&e.jsxs(r,{sx:{mt:3},children:[e.jsx(t,{variant:"subtitle2",children:"Remarks:"}),e.jsx(t,{variant:"body2",children:l[0].remarks})]}),e.jsxs(s,{container:!0,spacing:2,sx:{mt:4,px:2,display:"flex",justifyContent:"space-between"},children:[e.jsx(s,{item:!0,xs:3,children:e.jsx(r,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:e.jsx(t,{variant:"caption",children:"Prepared By"})})}),e.jsx(s,{item:!0,xs:3,children:e.jsx(r,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:e.jsx(t,{variant:"caption",children:"Approved By"})})}),e.jsx(s,{item:!0,xs:3,children:e.jsx(r,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:e.jsx(t,{variant:"caption",children:"Customer Signature"})})})]})]})]})})},bt=({open:o,handleClose:n,sale:l,onSuccess:m})=>{var R;const w={payment_method:"cash",amount:"",reference_number:"",remarks:""},[u,D]=h.useState(w),[d,f]=h.useState({}),[y,b]=h.useState(!1),{createPayment:g}=qe();h.useEffect(()=>{o&&l&&(D({...w,amount:l.total-l.amount_received||0,received_by:l.customer_id}),f({}))},[o,l]);const a=()=>{const p={};return u.payment_method||(p.payment_method="Payment method is required"),u.payment_method==="cheque"&&!u.payment_date&&(p.payment_date="Payment date is required for cheque payments"),!u.amount||parseFloat(u.amount)<=0?p.amount="Amount must be greater than 0":parseFloat(u.amount)>parseFloat((l==null?void 0:l.total)||0)&&(p.amount="Amount cannot exceed the due amount"),u.payment_method==="cheque"&&!u.reference_number&&(p.reference_number="Reference number is required for cheque payments"),f(p),Object.keys(p).length===0},j=p=>{const{name:I,value:L}=p.target;D(T=>({...T,[I]:L})),d[I]&&f(T=>({...T,[I]:void 0}))},_=async()=>{var p,I;if(a())try{b(!0);const L={...u,amount:parseFloat(u.amount)},T=await g(l.id,L);T&&(m&&m(T),n())}catch(L){console.error("Error saving payment:",L),re.error(((I=(p=L.response)==null?void 0:p.data)==null?void 0:I.message)||"Failed to record payment")}finally{b(!1)}};return e.jsxs(Q,{open:o,onClose:n,maxWidth:"sm",fullWidth:!0,"aria-labelledby":"payment-dialog-title",children:[e.jsxs(Z,{id:"payment-dialog-title",sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(t,{variant:"h6",children:"Record Payment"}),e.jsx(Y,{"aria-label":"close",onClick:n,size:"small",children:e.jsx(Te,{})})]}),e.jsxs(ee,{dividers:!0,children:[l&&e.jsxs(r,{sx:{mb:3},children:[e.jsxs(t,{variant:"subtitle1",children:["Sale #",l.invoice_number]}),e.jsxs(s,{container:!0,spacing:1,children:[e.jsx(s,{item:!0,xs:6,children:e.jsxs(t,{variant:"body2",children:["Customer: ",((R=l.customer)==null?void 0:R.customer_name)||"Walk-in Customer"]})}),e.jsx(s,{item:!0,xs:6,children:e.jsxs(t,{variant:"body2",children:["Order Date: ",new Date(l.order_date).toLocaleDateString()]})}),e.jsx(s,{item:!0,xs:6,children:e.jsxs(t,{variant:"body2",children:["Total Amount: ₱",parseFloat(l.total).toFixed(2)]})}),e.jsx(s,{item:!0,xs:6,children:e.jsxs(t,{variant:"body2",color:"error",children:["Amount Due: ₱",parseFloat(l.total-l.amount_received||0).toFixed(2)]})})]})]}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(He,{fullWidth:!0,error:!!d.payment_method,children:[e.jsx(Xe,{id:"payment-method-label",children:"Payment Method *"}),e.jsxs(Qe,{labelId:"payment-method-label",name:"payment_method",value:u.payment_method,onChange:j,label:"Payment Method *",disabled:y,children:[e.jsx(U,{value:"cod",children:"Cash"}),e.jsx(U,{value:"cash",children:"Cash"}),e.jsx(U,{value:"cheque",children:"Cheque"}),e.jsx(U,{value:"online",children:"Online Payment"})]}),d.payment_method&&e.jsx(t,{variant:"caption",color:"error",children:d.payment_method})]})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(W,{fullWidth:!0,label:"Amount *",name:"amount",type:"number",value:u.amount,onChange:j,error:!!d.amount,helperText:d.amount,disabled:y,InputProps:{startAdornment:e.jsx(Ee,{position:"start",children:"₱"})}})}),u.payment_method==="cheque"&&e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(W,{fullWidth:!0,label:"Cheque Date *",name:"payment_date",type:"date",value:u.payment_date,onChange:j,error:!!d.payment_date,helperText:d.payment_date,InputLabelProps:{shrink:!0},required:!0})}),e.jsx(s,{item:!0,xs:12,md:u.payment_method==="cheque"?6:12,children:e.jsx(W,{fullWidth:!0,required:u.payment_method==="cheque",label:u.payment_method==="cheque"?"Reference Number *":"Reference Number",name:"reference_number",value:u.reference_number,onChange:j,error:!!d.reference_number,helperText:d.reference_number,disabled:y,placeholder:"Cheque/Transaction No."})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(W,{fullWidth:!0,label:"Remarks",name:"remarks",value:u.remarks,onChange:j,multiline:!0,rows:2,disabled:y})})]})]}),e.jsxs(te,{sx:{px:3,py:2},children:[e.jsx(F,{onClick:n,disabled:y,children:"Cancel"}),e.jsx(F,{variant:"contained",color:"primary",onClick:_,disabled:y,startIcon:y?e.jsx(le,{size:20,color:"inherit"}):e.jsx(Ye,{}),children:y?"Processing...":"Save Payment"})]})]})},Ct=({sale:o,onPaymentSuccess:n,disabled:l=!1})=>{const[m,w]=h.useState(!1),[u,D]=h.useState(!1),d=Pe(Ie),f=(d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="cashier",y=()=>{w(!0)},b=()=>{w(!1)},g=a=>{D(!1),w(!1),n&&n(a)};return f?o!=null&&o.is_paid?e.jsx(r,{sx:{display:"flex",alignItems:"center",gap:1},children:e.jsx(t,{variant:"body2",color:"success.main",fontWeight:"bold",children:"PAID"})}):e.jsxs(e.Fragment,{children:[e.jsx(F,{variant:"outlined",color:"success",startIcon:u?e.jsx(le,{size:20}):e.jsx(xt,{}),onClick:y,disabled:l||u,sx:{mr:1},children:u?"Processing...":"Pay Now"}),o&&o.amount_due>0&&e.jsxs(t,{variant:"body2",color:"error",sx:{ml:1,fontWeight:"medium"},children:["Due: ",je(o.amount_due)]}),e.jsx(bt,{open:m,handleClose:b,sale:o,onSuccess:g})]}):null},wt=({sale:o,onPaymentUpdate:n,setSelectedReceipt:l})=>{const[m,w]=h.useState([]),[u,D]=h.useState(!1),[d,f]=h.useState(null),[y,b]=h.useState(!1),[g,a]=h.useState(""),{getPaymentHistory:j,voidPayment:_,isLoading:R}=qe(),p=Pe(Ie),I=(p==null?void 0:p.role)==="admin"||(p==null?void 0:p.role)==="cashier";if(!I)return null;h.useEffect(()=>{o&&T()},[o]);const L=c=>{l({payment:{...c},sale:o})},T=async()=>{try{D(!0);const c=await j(o.id);w(c)}catch(c){console.error("Error fetching payment history:",c)}finally{D(!1)}},H=async()=>{var c,q;if(!g.trim()){re.error("Please provide a reason for voiding the payment");return}try{await _(d.id,g),T(),n&&n(),b(!1),a(""),f(null),re.success("Payment voided successfully")}catch(M){console.error("Error voiding payment:",M),re.error(((q=(c=M.response)==null?void 0:c.data)==null?void 0:q.message)||"Failed to void payment")}},N=c=>{f(c),b(!0)},O=()=>{b(!1),a(""),f(null)},$=c=>new Date(c).toLocaleString(),E=c=>c?new Date(c).toISOString().split("T")[0]:"-",J=c=>c==="completed"?e.jsx(X,{label:"Completed",color:"success",size:"small"}):c==="voided"?e.jsx(X,{label:"Voided",color:"error",size:"small"}):e.jsx(X,{label:c,size:"small"}),V=c=>({cash:"Cash",credit_card:"Credit Card",debit_card:"Debit Card",cheque:"Cheque",bank_transfer:"Bank Transfer",online:"Online Payment",mobile_payment:"Mobile Payment",store_credit:"Store Credit"})[c]||c;return u?e.jsx(r,{sx:{p:2},children:e.jsx(t,{variant:"body2",children:"Loading payment history..."})}):e.jsxs(e.Fragment,{children:[e.jsxs(r,{sx:{mb:2},children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Payment History"}),m.length===0?e.jsx(t,{variant:"body2",color:"text.secondary",children:"No payment records found for this sale."}):e.jsx(ne,{component:B,variant:"outlined",children:e.jsxs(G,{size:"small",children:[e.jsx(ie,{children:e.jsxs(A,{children:[e.jsx(i,{children:"Date"}),e.jsx(i,{children:"Method"}),e.jsx(i,{children:"Reference No."}),e.jsx(i,{align:"right",children:"Amount"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Received By"}),e.jsx(i,{align:"right",children:"Actions"})]})}),e.jsx(K,{children:m.map(c=>{var q;return e.jsxs(A,{children:[e.jsx(i,{children:$(c.created_at)}),e.jsx(i,{children:V(c.payment_method)}),e.jsx(i,{children:c.payment_method==="cheque"?`${c.reference_number||"-"} (${E(c.payment_date)})`:c.reference_number||"-"}),e.jsx(i,{align:"right",children:je(c.amount)}),e.jsx(i,{children:J(c.status)}),e.jsx(i,{children:((q=c.received_by)==null?void 0:q.customer_name)||"-"}),e.jsxs(i,{align:"right",children:[e.jsx(xe,{title:"View Receipt",children:e.jsx(Y,{size:"small",color:"primary",onClick:()=>L(c),children:e.jsx(Ke,{})})}),c.status==="completed"&&I&&e.jsx(xe,{title:"Void Payment",children:e.jsx(Y,{size:"small",color:"error",onClick:()=>N(c),children:e.jsx(Ze,{})})}),c.status==="voided"&&e.jsx(xe,{title:`Void reason: ${c.void_reason}`,children:e.jsx(r,{component:"span",sx:{ml:1,color:"text.secondary",fontSize:"0.75rem"},children:"(Voided)"})})]})]},c.id)})})]})})]}),e.jsxs(Q,{open:y,onClose:O,children:[e.jsx(Z,{children:"Void Payment"}),e.jsxs(ee,{children:[e.jsx(t,{variant:"body2",gutterBottom:!0,children:"Are you sure you want to void this payment? This action cannot be undone."}),d&&e.jsxs(r,{sx:{my:2},children:[e.jsxs(t,{variant:"body2",children:[e.jsx("strong",{children:"Payment Method:"})," ",V(d.payment_method)]}),e.jsxs(t,{variant:"body2",children:[e.jsx("strong",{children:"Amount:"})," ",je(d.amount)]}),e.jsxs(t,{variant:"body2",children:[e.jsx("strong",{children:"Date:"})," ",$(d.payment_date)]})]}),e.jsx(W,{label:"Reason for voiding payment",fullWidth:!0,multiline:!0,rows:3,value:g,onChange:c=>a(c.target.value),required:!0,margin:"dense",error:!g.trim(),helperText:g.trim()?"":"Reason is required"})]}),e.jsxs(te,{children:[e.jsx(F,{onClick:O,children:"Cancel"}),e.jsx(F,{onClick:H,color:"error",disabled:R||!g.trim(),children:R?"Processing...":"Void Payment"})]})]})]})},Dt=({sale:o,refresh:n})=>{const[l,m]=h.useState(null),w=!!l;console.log(o);const[u,D]=h.useState(!1),[d,f]=h.useState(""),[y,b]=h.useState(!1),[g,a]=h.useState(!1),[j,_]=h.useState(""),[R,p]=h.useState(!1),{cancelSale:I,updateDeliveryDate:L}=ge(),T=M=>{m(M.currentTarget)},H=()=>{m(null)},N=()=>{H(),D(!0)},O=()=>{D(!1),f("")},$=()=>{H(),console.log(o.delivery_date),_(me(o.delivery_date)),console.log(me(o.delivery_date)),a(!0)},E=()=>{a(!1),_("")},J=async()=>{if(d.trim()){b(!0);try{await I(o.id,d),n(o.id,!0),O()}catch(M){console.error("Error cancelling sale:",M)}finally{b(!1)}}},V=async()=>{if(j){p(!0);try{await L(o.id,j),n(o.id,!0),E()}catch(M){console.error("Error updating delivery date:",M)}finally{p(!1)}}},c=o.status==="cancelled"||o.status==="completed"||o.status==="returned",q=o.status==="cancelled"||o.status==="completed"||o.status==="returned";return e.jsxs(e.Fragment,{children:[e.jsx(Y,{"aria-label":"more","aria-controls":"sale-menu","aria-haspopup":"true",onClick:T,size:"small",children:e.jsx(yt,{})}),e.jsxs(Ge,{id:"sale-menu",anchorEl:l,keepMounted:!0,open:w,onClose:H,PaperProps:{style:{maxHeight:48*4.5,width:"20ch"}},children:[e.jsxs(U,{onClick:$,disabled:q,sx:{color:q?"text.disabled":"primary.main","&.Mui-disabled":{opacity:.6}},children:[e.jsx(et,{style:{marginRight:8}}),"Edit Delivery Date"]}),e.jsxs(U,{onClick:N,disabled:c,sx:{color:c?"text.disabled":"error.main","&.Mui-disabled":{opacity:.6}},children:[e.jsx(tt,{style:{marginRight:8}}),"Cancel Sale"]})]}),e.jsxs(Q,{open:g,onClose:E,"aria-labelledby":"delivery-date-dialog-title",maxWidth:"sm",fullWidth:!0,children:[e.jsx(Z,{id:"delivery-date-dialog-title",children:"Edit Delivery Date"}),e.jsxs(ee,{children:[e.jsxs(ue,{sx:{mb:2},children:["Edit the delivery date for sale #",o.invoice_number,"."]}),e.jsx(W,{autoFocus:!0,id:"new-delivery-date",label:"Delivery Date",type:"date",fullWidth:!0,value:j,onChange:M=>_(M.target.value),variant:"outlined",required:!0,InputLabelProps:{shrink:!0},inputProps:{min:me(new Date)},error:!j,helperText:j?"":"Delivery date is required",sx:{mt:1}})]}),e.jsxs(te,{children:[e.jsx(F,{onClick:E,color:"primary",children:"Cancel"}),e.jsx(F,{onClick:V,color:"primary",variant:"contained",disabled:!j||R,startIcon:R?e.jsx(le,{size:20,color:"inherit"}):null,children:R?"Saving...":"Save Changes"})]})]}),e.jsxs(Q,{open:u,onClose:O,"aria-labelledby":"cancel-sale-dialog-title",maxWidth:"sm",fullWidth:!0,children:[e.jsx(Z,{id:"cancel-sale-dialog-title",children:"Cancel Sale"}),e.jsxs(ee,{children:[e.jsxs(ue,{sx:{mb:2},children:["Are you sure you want to cancel sale #",o.invoice_number,"? This action cannot be undone."]}),e.jsx(W,{autoFocus:!0,id:"cancel-reason",label:"Reason for Cancellation",type:"text",fullWidth:!0,multiline:!0,rows:3,value:d,onChange:M=>f(M.target.value),variant:"outlined",required:!0,error:!d.trim(),helperText:d.trim()?"":"Reason is required"})]}),e.jsxs(te,{children:[e.jsx(F,{onClick:O,color:"primary",children:"Back"}),e.jsx(F,{onClick:J,color:"error",disabled:!d.trim()||y,startIcon:y?e.jsx(le,{size:20,color:"inherit"}):null,children:y?"Cancelling...":"Confirm Cancel"})]})]})]})},_t=({refresh:o,report:n})=>{var be,Ce,we,De,_e;const[l,m]=h.useState(!1),[w,u]=h.useState(!1),[D,d]=h.useState([]),[f,y]=h.useState(""),b=ke(),g=h.useRef(),[a,j]=h.useState(!1),[_,R]=h.useState(null),{createCreditMemo:p,markAsDelivered:I}=ge(),L=Be({typography:{fontFamily:'"Courier New", "Lucida Console", monospace',h1:{fontFamily:'"Courier New", "Lucida Console", monospace'},h2:{fontFamily:'"Courier New", "Lucida Console", monospace'},h3:{fontFamily:'"Courier New", "Lucida Console", monospace'},h4:{fontFamily:'"Courier New", "Lucida Console", monospace'},h5:{fontFamily:'"Courier New", "Lucida Console", monospace'},h6:{fontFamily:'"Courier New", "Lucida Console", monospace'},subtitle1:{fontFamily:'"Courier New", "Lucida Console", monospace'},subtitle2:{fontFamily:'"Courier New", "Lucida Console", monospace'},body1:{fontFamily:'"Courier New", "Lucida Console", monospace'},body2:{fontFamily:'"Courier New", "Lucida Console", monospace'},button:{fontFamily:'"Courier New", "Lucida Console", monospace'},caption:{fontFamily:'"Courier New", "Lucida Console", monospace'},overline:{fontFamily:'"Courier New", "Lucida Console", monospace'}}});he.useEffect(()=>{n&&n.items&&d(n.items.map(C=>({...C,return_quantity:0,max_quantity:C.quantity})))},[n]);const T=Ae.useReactToPrint({contentRef:g}),H=()=>{m(!0)},N=()=>{m(!1)},O=()=>{u(!0)},$=()=>{u(!1)},E=(C,k,S)=>{const v=Math.max(0,parseInt(k)||0);d(D.map(P=>{if(P.id===C){const z=P.max_quantity-(S||0);return{...P,return_quantity:Math.min(v,z)}}return P}))},J=async()=>{const C=D.filter(S=>S.return_quantity>0);if(C.length===0){alert("Please specify at least one item to return");return}const k=C.reduce((S,v)=>S+v.return_quantity*v.sold_price,0);try{const S={sale_id:n.id,remarks:f,refund_method:"cash",refund_amount:k,items:C.map(P=>({sale_item_id:P.id,product_id:P.product_id,quantity:P.return_quantity,price:P.sold_price}))};await p(S)&&(N(),o(n.id))}catch{}},V=async()=>{try{await I(n.id),o(n.id,!0)}catch(C){console.error("Error marking report as delivered:",C)}},c=((be=n==null?void 0:n.returns)==null?void 0:be.reduce((C,k)=>{var v;const S=((v=k.items)==null?void 0:v.reduce((P,z)=>P+parseFloat(z.quantity||0)*parseFloat(z.price||0),0))||0;return C+S},0))||0,q=async C=>{o(n.id,!0);const k={...n,...C.sale};R({payment:{...C},sale:{...k}})},M=()=>{j(!a)};if(!n)return e.jsxs(r,{sx:{p:4,textAlign:"center"},children:[e.jsx(t,{variant:"h5",children:"No delivery report data available"}),e.jsx(F,{variant:"contained",startIcon:e.jsx(Le,{}),onClick:()=>b("/dashboard"),sx:{mt:2},children:"Go to Dashboard"})]});const pe=n.items.reduce((C,k)=>C+parseFloat(k.sold_price)*k.quantity,0),ye=parseFloat(n.delivery_fee)||0,fe=parseFloat(n.cutting_charges)||0,ve=n.items.reduce((C,k)=>{const v=parseFloat(k.sold_price)*k.quantity*(parseFloat(k.discount)/100);return C+v},0),Oe=pe+ye+fe-ve;return e.jsxs(e.Fragment,{children:[e.jsxs(B,{elevation:2,sx:{p:3,mb:3},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(t,{variant:"h5",children:"Delivery Report Details"}),e.jsxs(r,{children:[e.jsx(Ct,{sale:n,onPaymentSuccess:q,disabled:n.status=="cancelled"||n.status=="completed"}),!n.is_delivered&&n.status!=="cancelled"&&e.jsx(F,{variant:"outlined",color:"success",startIcon:e.jsx(nt,{}),onClick:V,sx:{mr:1},children:"Mark Delivered"}),e.jsx(F,{variant:"outlined",color:"primary",startIcon:e.jsx(Me,{}),onClick:T,sx:{mr:1},children:"Print"}),e.jsx(F,{variant:"outlined",color:"secondary",startIcon:e.jsx(ut,{}),onClick:H,disabled:!1,children:"Create Credit Memo"}),e.jsx(Dt,{refresh:o,sale:n})]})]}),e.jsx(Ne,{theme:L,children:e.jsxs(r,{ref:g,sx:{p:2,minHeight:"100vh",display:"flex",flexDirection:"column",fontFamily:'"Courier New", "Lucida Console" '},children:[e.jsxs(s,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(s,{item:!0,xs:12,md:12,children:e.jsxs(r,{sx:{textAlign:"center",mb:2},children:[e.jsx(t,{variant:"h4",children:"DELIVERY REPORT"}),e.jsx(t,{variant:"h6",children:n.invoice_number})]})}),e.jsxs(s,{item:!0,xs:12,md:12,sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[e.jsx(t,{variant:"h5",children:"Halifax Glass & Aluminum Supply"}),e.jsx(t,{children:"Malagamot Road, Panacan"}),e.jsx(t,{children:"glasshalifax@gmail.com"}),e.jsx(t,{children:"0939 924 3876"})]}),e.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[e.jsxs(t,{children:[e.jsx("strong",{children:"Order Date:"})," ",oe(n.order_date)]}),e.jsxs(t,{children:[e.jsx("strong",{children:"Delivery Date:"})," ",oe(n.delivery_date)]}),e.jsxs(t,{children:[e.jsx("strong",{children:"Payment Method:"})," ",n.payment_method.toUpperCase()]}),e.jsxs(t,{children:[e.jsx("strong",{children:"Status:"})," ",n.status.toUpperCase()]})]})]})]}),e.jsx(s,{container:!0,spacing:2,justifyContent:"space-between",alignItems:"flex-start",children:e.jsx(s,{item:!0,xs:12,md:12,children:e.jsx(r,{sx:{mb:.5},children:e.jsx(G,{children:e.jsxs(K,{children:[e.jsxs(A,{children:[e.jsx(i,{sx:{border:"none",padding:"8px 8px 8px 0",width:"2.5%",verticalAlign:"top"},children:e.jsx(t,{fontSize:18,lineHeight:1,children:e.jsx("strong",{children:"Delivered to:"})})}),e.jsx(i,{sx:{border:"none",padding:"8px 16px 8px 0",width:"10.5%",verticalAlign:"top"},children:e.jsx(t,{fontSize:18,lineHeight:1,children:e.jsx("span",{style:{textDecoration:"underline"},children:((Ce=n.customer)==null?void 0:Ce.business_name)||((we=n.customer)==null?void 0:we.customer_name)})})}),e.jsx(i,{sx:{border:"none",padding:"8px 8px 8px 0",width:"0.5%",verticalAlign:"top"},children:e.jsx(t,{fontSize:18,lineHeight:1,children:e.jsx("strong",{children:"City:"})})}),e.jsx(i,{sx:{border:"none",padding:"8px 8px 8px 0",width:"12.5%",verticalAlign:"top"},children:e.jsx(t,{fontSize:18,lineHeight:1,children:e.jsx("span",{style:{textDecoration:"underline"},children:n.city})})})]}),e.jsxs(A,{children:[e.jsx(i,{sx:{border:"none",padding:"8px 8px 8px 0",width:"2.5%",verticalAlign:"top"},children:e.jsx(t,{fontSize:18,lineHeight:1,children:e.jsx("strong",{children:"Address:"})})}),e.jsx(i,{sx:{border:"none",padding:"8px 8px 8px 0",width:"10.5%",verticalAlign:"top"},children:e.jsx(t,{fontSize:18,lineHeight:1,children:e.jsx("span",{style:{textDecoration:"underline"},children:((De=n.customer)==null?void 0:De.business_address)||n.address})})}),e.jsx(i,{sx:{border:"none",padding:"8px 8px 8px 0",width:"0.5%",verticalAlign:"top"},children:e.jsx(t,{fontSize:18,lineHeight:1,children:e.jsx("strong",{children:"Phone:"})})}),e.jsx(i,{sx:{border:"none",padding:"8px 0",width:"12.5%",verticalAlign:"top"},children:e.jsx(t,{fontSize:18,lineHeight:1,children:e.jsx("span",{style:{textDecoration:"underline"},children:n.phone})})})]})]})})})})}),e.jsx(ae,{sx:{my:1}}),e.jsxs(r,{sx:{flex:1},children:[e.jsxs(r,{display:"flex",justifyContent:"space-between",children:[e.jsx(t,{variant:"subtitle1",gutterBottom:!0,children:"Order Items"}),n.term_days!==0&&n.term_days&&e.jsx(e.Fragment,{children:e.jsxs(t,{variant:"h6",children:[e.jsx("strong",{children:"Term :"})," ",n.term_days]})})]}),e.jsx(ne,{component:B,variant:"outlined",sx:{mb:2},children:e.jsxs(G,{size:"small",children:[e.jsx(ie,{children:e.jsxs(A,{children:[e.jsx(i,{align:"right",children:"Qty"}),e.jsx(i,{align:"left",width:"15px",children:"Unit"}),e.jsx(i,{align:"left",children:"Item"}),e.jsx(i,{align:"right",children:"Price"}),e.jsx(i,{align:"right",children:"Net Price"})]})}),e.jsx(K,{children:(()=>{const C=n.items.reduce((S,v)=>{var z,se;const P=((se=(z=v.product)==null?void 0:z.category)==null?void 0:se.name)||"Uncategorized";return S[P]||(S[P]=[]),S[P].push(v),S},{});return Object.keys(C).sort().map(S=>e.jsxs(he.Fragment,{children:[e.jsx(A,{sx:{border:"none"},children:e.jsx(i,{colSpan:4,sx:{fontWeight:"bold",fontSize:"1rem",fontStyle:"italic",py:0,border:"none"},children:S})}),C[S].map(v=>{var Re,Se;const P=parseFloat(v.sold_price)*v.quantity,z=P*(parseFloat(v.discount)/100),se=P-z;return e.jsxs(he.Fragment,{children:[e.jsxs(A,{sx:{py:.5,border:"none"},children:[e.jsx(i,{align:"right",sx:{py:.5,border:"none"},children:v.quantity}),e.jsx(i,{align:"left",sx:{py:.5,border:"none"},children:((Re=v.product.attribute)==null?void 0:Re.unit_of_measurement)??" "}),e.jsx(i,{align:"left",sx:{py:.5,border:"none"},children:(Se=v.product)==null?void 0:Se.product_name}),e.jsxs(i,{align:"right",sx:{py:.5,border:"none"},children:["₱",parseFloat(v.sold_price).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(i,{align:"right",sx:{py:.5,border:"none"},children:["₱",se.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),v.composition&&e.jsx(A,{children:e.jsx(i,{colSpan:4,sx:{pt:0,pb:2},children:e.jsxs(r,{sx:{pl:4,pr:2,pt:1,pb:1},children:[e.jsx(t,{variant:"subtitle2",color:"primary",children:"Composition:"}),e.jsx("div",{className:"composition-content",dangerouslySetInnerHTML:{__html:v.composition},style:{paddingLeft:"16px",margin:0}})]})})})]},v.id)})]},S))})()})]})}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(r,{sx:{display:"flex",flexDirection:"column",justifyContent:"flex-start"},children:[e.jsxs(t,{children:[e.jsx("strong",{children:"Delivery Status:"})," ",n.is_delivered?"Delivered":"Pending Delivery"]}),e.jsxs(t,{children:[e.jsx("strong",{children:"Encoded By:"})," ",(_e=n.user)==null?void 0:_e.name]})]}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(s,{container:!0,spacing:0,sx:{maxWidth:"400px"},children:[e.jsx(s,{item:!0,xs:6,children:e.jsx(t,{align:"right",children:"Subtotal:"})}),e.jsx(s,{item:!0,xs:6,children:e.jsxs(t,{align:"right",children:["₱",pe.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(t,{align:"right",children:"Delivery Fee:"})}),e.jsx(s,{item:!0,xs:6,children:e.jsxs(t,{align:"right",children:["₱",ye.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(t,{align:"right",children:"Cutting Charges:"})}),e.jsx(s,{item:!0,xs:6,children:e.jsxs(t,{align:"right",children:["₱",fe.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(t,{align:"right",children:"Discount:"})}),e.jsx(s,{item:!0,xs:6,children:e.jsxs(t,{align:"right",children:["₱",ve.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})}),n.returns&&n.returns.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(s,{item:!0,xs:6,children:e.jsx(t,{variant:"body2",align:"right",onClick:O,sx:{cursor:"pointer",color:"primary.main","&:hover":{textDecoration:"underline"}},children:"Credit Memo Total:"})}),e.jsx(s,{item:!0,xs:6,children:e.jsxs(t,{variant:"body2",align:"right",onClick:O,sx:{cursor:"pointer",color:"primary.main","&:hover":{textDecoration:"underline"}},children:["₱",c.toFixed(2)]})})]}),e.jsx(s,{item:!0,xs:6,children:e.jsx(t,{fontWeight:"bold",align:"right",fontSize:"1.2rem",children:"Total Amount:"})}),e.jsx(s,{item:!0,xs:6,children:e.jsxs(t,{fontWeight:"bold",align:"right",fontSize:"1.2rem",children:["₱",Oe.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})}),n.amount_received!=="0.00"&&n.amount_received&&e.jsxs(e.Fragment,{children:[e.jsx(s,{item:!0,xs:6,children:e.jsx(t,{align:"right",children:"Amount Received:"})}),e.jsx(s,{item:!0,xs:6,children:e.jsxs(t,{align:"right",children:["₱",parseFloat(n.amount_received).toFixed(2)]})})]}),n.change!=="0.00"&&n.change&&e.jsxs(e.Fragment,{children:[e.jsx(s,{item:!0,xs:6,children:e.jsx(t,{align:"right",children:"Change:"})}),e.jsx(s,{item:!0,xs:6,children:e.jsxs(t,{align:"right",children:["₱",parseFloat(n.change).toFixed(2)," ",typeof n.change]})})]})]})})]}),n.remarks&&e.jsxs(r,{sx:{mt:3},children:[e.jsx(t,{children:"Remarks:"}),e.jsx(t,{variant:"body2",children:n.remarks})]})]}),e.jsxs(r,{sx:{mt:"auto",pt:3},children:[e.jsxs(s,{container:!0,spacing:2,sx:{px:2,display:"flex",justifyContent:"space-between",mb:4},children:[e.jsx(s,{item:!0,xs:2.4,children:e.jsx(r,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center",minHeight:"60px"},children:e.jsx(t,{variant:"body2",children:"Prepared By"})})}),e.jsx(s,{item:!0,xs:2.4,children:e.jsx(r,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center",minHeight:"60px"},children:e.jsx(t,{variant:"body2",children:"Checked By"})})}),e.jsx(s,{item:!0,xs:2.4,children:e.jsx(r,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center",minHeight:"60px"},children:e.jsx(t,{variant:"body2",children:"Released By"})})})]}),e.jsxs(s,{container:!0,spacing:2,sx:{px:2,display:"flex",justifyContent:"center",gap:15,mb:4},children:[e.jsx(s,{item:!0,xs:2.4,children:e.jsx(r,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center",minHeight:"60px"},children:e.jsx(t,{variant:"body2",children:"Delivered By"})})}),e.jsx(s,{item:!0,xs:2.4,children:e.jsx(r,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center",minHeight:"60px"},children:e.jsx(t,{variant:"body2",children:"Received By"})})})]}),e.jsx(r,{sx:{textAlign:"center",mt:2,borderTop:"1px solid #e0e0e0",pt:2},children:e.jsx(t,{variant:"body2",fontWeight:"bold",children:"Note: This Office will not entertain any claim of shortage after receipt has been duly acknowledged"})})]})]})})]}),e.jsx(r,{sx:{mt:3,mb:2},children:e.jsx(F,{variant:"text",color:"primary",onClick:M,startIcon:a?e.jsx(pt,{}):e.jsx(ot,{}),children:a?"Hide Payment History":"Show Payment History"})}),a&&e.jsx(r,{sx:{mt:2},children:e.jsx(wt,{sale:n,onPaymentUpdate:q,setSelectedReceipt:R})}),_&&e.jsx(Q,{open:!!_,onClose:()=>R(null),maxWidth:"md",fullWidth:!0,children:e.jsx(Je,{paymentRecord:_,onClose:()=>R(null)})}),e.jsx(ft,{open:l,onClose:N,returnItems:D,handleReturnQuantityChange:E,returnReason:f,setReturnReason:y,handleSubmitCreditMemo:J,returns:n.returns}),n.returns&&n.returns.length>0&&e.jsx(vt,{open:w,onClose:$,returns:n.returns,report:n})]})},Rt=()=>{const o=n=>Array(n).fill(0).map((l,m)=>e.jsxs(A,{children:[e.jsx(i,{children:e.jsx(x,{animation:"wave",height:24})}),e.jsx(i,{children:e.jsx(x,{animation:"wave",height:24})}),e.jsx(i,{align:"right",children:e.jsx(x,{animation:"wave",height:24})}),e.jsx(i,{align:"center",children:e.jsx(x,{animation:"wave",height:24})}),e.jsx(i,{align:"right",children:e.jsx(x,{animation:"wave",height:24})}),e.jsx(i,{align:"right",children:e.jsx(x,{animation:"wave",height:24})})]},m));return e.jsxs(B,{elevation:2,sx:{p:3,mb:3},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(x,{animation:"wave",height:40,width:"40%"}),e.jsx(r,{children:e.jsx(x,{animation:"wave",variant:"rectangular",width:170,height:36,sx:{borderRadius:1}})})]}),e.jsxs(r,{sx:{p:2},children:[e.jsxs(s,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(s,{item:!0,xs:12,md:12,children:e.jsx(r,{sx:{textAlign:"center",mb:2},children:e.jsx(x,{animation:"wave",height:50,width:"50%",sx:{mx:"auto"}})})}),e.jsxs(s,{item:!0,xs:12,md:12,sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[e.jsx(x,{animation:"wave",height:30,width:200}),e.jsx(x,{animation:"wave",height:20,width:180}),e.jsx(x,{animation:"wave",height:20,width:160}),e.jsx(x,{animation:"wave",height:20,width:140})]}),e.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[e.jsx(x,{animation:"wave",height:20,width:150}),e.jsx(x,{animation:"wave",height:20,width:150}),e.jsx(x,{animation:"wave",height:20,width:150}),e.jsx(x,{animation:"wave",height:20,width:150})]})]})]}),e.jsxs(s,{container:!0,spacing:2,justifyContent:"space-between",alignItems:"flex-start",children:[e.jsx(s,{item:!0,xs:6,md:6,children:e.jsxs(r,{sx:{mb:1},children:[e.jsx(x,{animation:"wave",height:24,width:"80%"}),e.jsx(x,{animation:"wave",height:20,width:"70%"}),e.jsx(x,{animation:"wave",height:20,width:"50%"}),e.jsx(x,{animation:"wave",height:20,width:"60%"})]})}),e.jsx(s,{item:!0,xs:6,md:6,children:e.jsxs(r,{sx:{textAlign:"right"},children:[e.jsx(x,{animation:"wave",height:24,width:"60%",sx:{ml:"auto"}}),e.jsx(x,{animation:"wave",height:24,width:"40%",sx:{ml:"auto"}})]})})]}),e.jsx(ae,{sx:{my:1}}),e.jsx(x,{animation:"wave",height:28,width:"20%",sx:{mb:1}}),e.jsx(ne,{component:B,variant:"outlined",sx:{mb:2},children:e.jsxs(G,{size:"small",children:[e.jsx(ie,{children:e.jsxs(A,{children:[e.jsx(i,{children:e.jsx(x,{animation:"wave",height:24})}),e.jsx(i,{children:e.jsx(x,{animation:"wave",height:24})}),e.jsx(i,{align:"right",children:e.jsx(x,{animation:"wave",height:24})}),e.jsx(i,{align:"center",children:e.jsx(x,{animation:"wave",height:24})}),e.jsx(i,{align:"right",children:e.jsx(x,{animation:"wave",height:24})}),e.jsx(i,{align:"right",children:e.jsx(x,{animation:"wave",height:24})})]})}),e.jsx(K,{children:o(5)})]})}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(r,{sx:{display:"flex",flexDirection:"column",justifyContent:"flex-start"},children:[e.jsx(x,{animation:"wave",height:20,width:160}),e.jsx(x,{animation:"wave",height:20,width:140})]}),e.jsx(r,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(s,{container:!0,spacing:0,sx:{maxWidth:"400px"},children:[e.jsx(s,{item:!0,xs:6,children:e.jsx(x,{animation:"wave",height:20,width:"80%",sx:{ml:"auto"}})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(x,{animation:"wave",height:20,width:"60%",sx:{ml:"auto"}})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(x,{animation:"wave",height:20,width:"80%",sx:{ml:"auto"}})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(x,{animation:"wave",height:20,width:"60%",sx:{ml:"auto"}})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(x,{animation:"wave",height:24,width:"90%",sx:{ml:"auto"}})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(x,{animation:"wave",height:24,width:"70%",sx:{ml:"auto"}})})]})})]}),e.jsxs(s,{container:!0,spacing:2,sx:{mt:4,px:2,display:"flex",justifyContent:"space-between"},children:[e.jsx(s,{item:!0,xs:2.4,children:e.jsx(r,{sx:{borderTop:"1px solid #e0e0e0",pt:1,textAlign:"center"},children:e.jsx(x,{animation:"wave",height:20,width:"80%",sx:{mx:"auto"}})})}),e.jsx(s,{item:!0,xs:2.4,children:e.jsx(r,{sx:{borderTop:"1px solid #e0e0e0",pt:1,textAlign:"center"},children:e.jsx(x,{animation:"wave",height:20,width:"80%",sx:{mx:"auto"}})})}),e.jsx(s,{item:!0,xs:2.4,children:e.jsx(r,{sx:{borderTop:"1px solid #e0e0e0",pt:1,textAlign:"center"},children:e.jsx(x,{animation:"wave",height:20,width:"80%",sx:{mx:"auto"}})})})]}),e.jsxs(s,{container:!0,spacing:2,sx:{mt:4,px:2,display:"flex",justifyContent:"center",gap:30},children:[e.jsx(s,{item:!0,xs:2.4,children:e.jsx(r,{sx:{borderTop:"1px solid #e0e0e0",pt:1,textAlign:"center"},children:e.jsx(x,{animation:"wave",height:20,width:"80%",sx:{mx:"auto"}})})}),e.jsx(s,{item:!0,xs:2.4,children:e.jsx(r,{sx:{borderTop:"1px solid #e0e0e0",pt:1,textAlign:"center"},children:e.jsx(x,{animation:"wave",height:20,width:"80%",sx:{mx:"auto"}})})})]})]})]})},Yt=()=>{const{id:o}=$e(),n=Ve(),l=ke(),[m,w]=h.useState(!0),[u,D]=h.useState(null),{getSaleById:d}=ge(),f=async(b,g=!1)=>{g||w(!0);try{const a=await d(b);if(a)D(a);else return console.error("Delivery report not found"),null}catch(a){return console.error("Error fetching delivery report:",a),null}g||w(!1)};h.useEffect(()=>{(async()=>{var g;if((g=n.state)!=null&&g.reportData){D(n.state.reportData),w(!1);return}o&&f(o)})()},[o,n.state]);const y=()=>{l("/app/sales-list")};return e.jsxs(it,{maxWidth:"xxl",sx:{mt:4,mb:4},children:[e.jsxs(Ue,{sx:{mb:2},children:[e.jsxs(Fe,{underline:"hover",color:"inherit",sx:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>l("/app/dashboard"),children:[e.jsx(Le,{style:{marginRight:8}}),"Dashboard"]}),e.jsxs(Fe,{underline:"hover",color:"inherit",sx:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>l("/app/sales-list"),children:[e.jsx(st,{style:{marginRight:8}}),"Sales"]}),e.jsx(t,{color:"text.primary",children:"Delivery Report"})]}),e.jsx(r,{sx:{mb:2},children:e.jsx(F,{variant:"outlined",startIcon:e.jsx(rt,{}),onClick:y,children:"Back to Sales"})}),m?e.jsx(Rt,{}):u?e.jsx(_t,{refresh:f,report:u}):e.jsxs(B,{sx:{p:3,textAlign:"center"},children:[e.jsx(t,{variant:"h6",color:"error",children:"Delivery report not found or could not be loaded"}),e.jsx(F,{variant:"contained",sx:{mt:2},onClick:y,children:"Go to Sales List"})]})]})};export{Yt as default};
