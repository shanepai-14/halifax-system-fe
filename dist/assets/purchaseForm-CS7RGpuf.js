import{r as h,Q as G,_ as K,S as N,U as y,a9 as U,aa as V,V as J,ab as X,K as Y,j as e,q as C,I as T,T as S,G as u,t as v}from"./index-Cbx92YL5.js";import{a as Z}from"./usePurchaseOrders-BhKme9Q-.js";import{S as ee}from"./SupplierModal-DqlxSiJw.js";import{A as $,a as te}from"./AddCostTypeModal-xC7-E2Dn.js";import{C as re,T as p,R as A,c as se,d as ie,e as ae,a as P,b as d,f as le}from"./PlusOutlined-B1z4Aiu5.js";import{R as ne}from"./DeleteOutlined-Cm9Cm8TA.js";import{B as I}from"./InputLabel-BjZeBbUL.js";import"./index.esm-DtM3SGEC.js";import"./DialogTitle-BOS3CeUw.js";import"./FormControlLabel-KYudgUGV.js";var oe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},de=function(l,c){return h.createElement(G,K({},l,{ref:c,icon:oe}))},ue=h.forwardRef(de);const pe={supplier_id:"",po_date:new Date().toISOString().split("T")[0],remarks:"",items:[{product_id:"",requested_quantity:1,price:0}]},qe=()=>{const x=N(),[l,c]=h.useState(pe),[n,f]=h.useState({}),m=y(U),j=y(V),_=y(J);y(X);const[L,O]=h.useState(!1),[k,R]=h.useState(!1),M=Z(),z=Y(),E=async r=>{var s,i;r.preventDefault();const t={};if(l.supplier_id||(t.supplier_id="Supplier is required"),l.items.forEach((a,o)=>{a.product_id||(t[`items.${o}.product_id`]="Product is required"),a.attribute_id||(t[`items.${o}.attribute_id`]="Measurement is required"),(!a.requested_quantity||a.requested_quantity<=0)&&(t[`items.${o}.requested_quantity`]="Quantity must be greater than 0"),(!a.price||a.price<=0)&&(t[`items.${o}.price`]="Price must be greater than 0");const q=l.items.filter(Q=>Q.product_id===a.product_id).length;a.product_id&&q>1&&(t[`items.${o}.product_id`]="Duplicate product is not allowed")}),Object.keys(t).length>0){f(t),v.error("Please fill in all required fields correctly");return}try{await M.mutateAsync(l),x("/app/purchase"),v.success("Successfully Created Purchase Order")}catch(a){(i=(s=a.response)==null?void 0:s.data)!=null&&i.errors&&f(a.response.data.errors),v.error("Something went wrong please try again")}},B=async r=>{try{await z.mutateAsync(r),w()}catch(t){console.error("Error creating supplier:",t)}},D=()=>{O(!0)},w=()=>{O(!1)},b=r=>{c(t=>({...t,[r.target.name]:r.target.value}))},g=(r,t,s)=>{if(t==="product_id"&&s&&l.items.some((o,q)=>q!==r&&o.product_id===s)){f(o=>({...o,[`items.${r}.product_id`]:"This product is already added"}));return}const i=[...l.items];i[r]={...i[r],[t]:s},c(a=>({...a,items:i})),n[`items.${r}.${t}`]&&f(a=>{const o={...a};return delete o[`items.${r}.${t}`],o})},F=()=>{c(r=>({...r,items:[...r.items,{product_id:"",requested_quantity:1,price:0}]}))},W=r=>{if(l.items.length>1){const t=l.items.filter((s,i)=>i!==r);c(s=>({...s,items:t}))}},H=()=>l.items.reduce((r,t)=>r+t.price*t.requested_quantity,0);return e.jsxs(re,{maxWidth:"lg",sx:{mt:0,mb:4},children:[e.jsxs(C,{sx:{mb:4,display:"flex",alignItems:"center",gap:2},children:[e.jsx(T,{onClick:()=>x("/app/purchase"),children:e.jsx(ue,{})}),e.jsx(S,{variant:"h5",children:"Create Purchase Order"})]}),e.jsx("form",{onSubmit:E,children:e.jsxs(u,{container:!0,spacing:1,children:[e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx($,{size:"small",value:(_==null?void 0:_.find(r=>r.supplier_id===l.supplier_id))||null,onChange:(r,t)=>b({target:{name:"supplier_id",value:t?t.supplier_id:""}}),options:_||[],getOptionLabel:r=>r.supplier_name||"",isOptionEqualToValue:(r,t)=>r.supplier_id===t,renderInput:r=>e.jsx(p,{...r,fullWidth:!0,label:"Supplier",name:"supplier_id",error:!!n.supplier_id,helperText:n.supplier_id,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}}})})}),e.jsx(u,{item:!0,xs:"auto",sx:{paddingLeft:0},children:e.jsx(T,{sx:{marginLeft:"0px !important"},onClick:D,children:e.jsx(A,{})})}),e.jsx(u,{item:!0,xs:12,md:4,ml:7,children:e.jsx(p,{size:"small",fullWidth:!0,type:"date",name:"po_date",label:"PO Date",value:l.po_date,onChange:b,error:!!n.po_date,helperText:n.po_date,InputLabelProps:{shrink:!0}})}),e.jsxs(u,{item:!0,xs:12,children:[e.jsx(se,{children:e.jsxs(ie,{children:[e.jsx(ae,{children:e.jsxs(P,{children:[e.jsx(d,{children:"Product"}),e.jsx(d,{children:"Measurement"}),e.jsx(d,{children:"Quantity"}),e.jsx(d,{children:"Price"}),e.jsx(d,{children:"Total"}),e.jsx(d,{width:50})]})}),e.jsx(le,{children:l.items.map((r,t)=>e.jsxs(P,{children:[e.jsx(d,{children:e.jsx($,{size:"small",sx:{width:300},value:(m==null?void 0:m.find(s=>s.id===r.product_id))||null,onChange:(s,i)=>g(t,"product_id",i?i.id:""),options:(m==null?void 0:m.filter(s=>!l.items.some((i,a)=>a!==t&&i.product_id===s.id)))||[],getOptionLabel:s=>s.product_name||"",isOptionEqualToValue:(s,i)=>s.id===i,renderInput:s=>e.jsx(p,{...s,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!n[`items.${t}.product_id`],helperText:n[`items.${t}.product_id`]||"Required"})})}),e.jsx(d,{children:e.jsx($,{size:"small",sx:{width:200},value:(j==null?void 0:j.find(s=>s.id===r.attribute_id))||null,onChange:(s,i)=>g(t,"attribute_id",i?i.id:""),options:j||[],getOptionLabel:s=>`${s.attribute_name} (${s.unit_of_measurement})`||"",isOptionEqualToValue:(s,i)=>s.id===i,renderInput:s=>e.jsx(p,{...s,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!n[`items.${t}.attribute_id`],helperText:n[`items.${t}.attribute_id`]||"Required"})})}),e.jsx(d,{children:e.jsx(p,{size:"small",type:"number",value:r.requested_quantity,onChange:s=>g(t,"requested_quantity",s.target.value),error:!!n[`items.${t}.requested_quantity`],helperText:n[`items.${t}.requested_quantity`]||"Required",inputProps:{min:1}})}),e.jsx(d,{children:e.jsx(p,{size:"small",type:"number",value:r.price,onChange:s=>g(t,"price",s.target.value),error:!!n[`items.${t}.price`],helperText:n[`items.${t}.price`]||"Required",inputProps:{min:0,step:.01}})}),e.jsx(d,{sx:{verticalAlign:"top"},children:e.jsxs(S,{mt:1,children:["₱",(r.price*r.requested_quantity).toFixed(2)]})}),e.jsx(d,{sx:{verticalAlign:"top"},children:e.jsx(T,{size:"large",onClick:()=>W(t),disabled:l.items.length===1,children:e.jsx(ne,{})})})]},t))})]})}),e.jsxs(C,{sx:{mt:2,display:"flex",justifyContent:"space-between"},children:[e.jsx(I,{startIcon:e.jsx(A,{}),onClick:F,children:"Add Item"}),e.jsxs(S,{variant:"h6",children:["Total: ₱",H().toFixed(2)]})]})]}),e.jsx(u,{item:!0,xs:12,children:e.jsx(p,{fullWidth:!0,multiline:!0,rows:4,name:"remarks",label:"Remarks",value:l.remarks,onChange:b,error:!!n.remarks,helperText:n.remarks})}),e.jsx(u,{item:!0,xs:12,children:e.jsxs(C,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(I,{variant:"outlined",onClick:()=>x("/app/purchase"),children:"Cancel"}),e.jsx(I,{variant:"contained",type:"submit",disabled:M.isPending,children:"Create Purchase Order"})]})})]})}),e.jsx(ee,{open:L,handleClose:w,handleAddSupplier:B}),e.jsx(te,{open:k,handleClose:()=>R(!1)})]})};export{qe as default};
