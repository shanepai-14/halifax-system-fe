import{Q as H,r as _,S as g,V as K,W as N,U,X as V,K as X,j as e,q as C,I as T,T as S,G as u,t as $}from"./index-CwdxULia.js";import{a as J}from"./usePurchaseOrders-CvxAInY1.js";import{S as Y}from"./SupplierModal-Blgzym_H.js";import{A as Z}from"./AddCostTypeModal-Dh2mqUF0.js";import{C as ee,T as p,c as te,d as re,e as se,a as A,b as d,f as ie}from"./TextField-D4xNUZye.js";import{R as ae}from"./ArrowLeftOutlined-CVh0vRsp.js";import{A as I}from"./Autocomplete-m2D79vKy.js";import{R as k}from"./PlusOutlined-C9r6574-.js";import{R as oe}from"./DeleteOutlined-BMNaas36.js";import{B as O}from"./InputLabel-Br42E3Y_.js";import"./CloseOutlined-94mMzdd-.js";import"./index.esm-DxotE6pl.js";import"./DialogTitle-C_ZHovTT.js";import"./FormControlLabel-Bv3sfpQQ.js";import"./DialogActions-CZQp-NKp.js";const le={supplier_id:"",po_date:new Date().toISOString().split("T")[0],remarks:"",items:[{product_id:"",requested_quantity:1,price:0}]},Ce=()=>{const y=H(),[o,m]=_.useState(le),[l,h]=_.useState({}),c=g(K),x=g(N),j=g(U);g(V);const[R,v]=_.useState(!1),[w,z]=_.useState(!1),M=J(),E=X(),L=async r=>{var s,i;r.preventDefault();const t={};if(o.supplier_id||(t.supplier_id="Supplier is required"),o.items.forEach((a,n)=>{a.product_id||(t[`items.${n}.product_id`]="Product is required"),a.attribute_id||(t[`items.${n}.attribute_id`]="Measurement is required"),(!a.requested_quantity||a.requested_quantity<=0)&&(t[`items.${n}.requested_quantity`]="Quantity must be greater than 0"),(!a.price||a.price<=0)&&(t[`items.${n}.price`]="Price must be greater than 0");const q=o.items.filter(G=>G.product_id===a.product_id).length;a.product_id&&q>1&&(t[`items.${n}.product_id`]="Duplicate product is not allowed")}),Object.keys(t).length>0){h(t),$.error("Please fill in all required fields correctly");return}try{await M.mutateAsync(o),y("/app/purchase"),$.success("Successfully Created Purchase Order")}catch(a){(i=(s=a.response)==null?void 0:s.data)!=null&&i.errors&&h(a.response.data.errors),$.error("Something went wrong please try again")}},B=async r=>{try{await E.mutateAsync(r),P()}catch(t){console.error("Error creating supplier:",t)}},D=()=>{v(!0)},P=()=>{v(!1)},b=r=>{m(t=>({...t,[r.target.name]:r.target.value}))},f=(r,t,s)=>{if(t==="product_id"&&s&&o.items.some((n,q)=>q!==r&&n.product_id===s)){h(n=>({...n,[`items.${r}.product_id`]:"This product is already added"}));return}const i=[...o.items];i[r]={...i[r],[t]:s},m(a=>({...a,items:i})),l[`items.${r}.${t}`]&&h(a=>{const n={...a};return delete n[`items.${r}.${t}`],n})},F=()=>{m(r=>({...r,items:[...r.items,{product_id:"",requested_quantity:1,price:0}]}))},W=r=>{if(o.items.length>1){const t=o.items.filter((s,i)=>i!==r);m(s=>({...s,items:t}))}},Q=()=>o.items.reduce((r,t)=>r+t.price*t.requested_quantity,0);return e.jsxs(ee,{maxWidth:"lg",sx:{mt:0,mb:4},children:[e.jsxs(C,{sx:{mb:4,display:"flex",alignItems:"center",gap:2},children:[e.jsx(T,{onClick:()=>y("/app/purchase"),children:e.jsx(ae,{})}),e.jsx(S,{variant:"h5",children:"Create Purchase Order"})]}),e.jsx("form",{onSubmit:L,children:e.jsxs(u,{container:!0,spacing:1,children:[e.jsx(u,{item:!0,xs:12,md:6,children:e.jsx(I,{size:"small",value:(j==null?void 0:j.find(r=>r.supplier_id===o.supplier_id))||null,onChange:(r,t)=>b({target:{name:"supplier_id",value:t?t.supplier_id:""}}),options:j||[],getOptionLabel:r=>r.supplier_name||"",isOptionEqualToValue:(r,t)=>r.supplier_id===t,renderInput:r=>e.jsx(p,{...r,fullWidth:!0,label:"Supplier",name:"supplier_id",error:!!l.supplier_id,helperText:l.supplier_id,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}}})})}),e.jsx(u,{item:!0,xs:"auto",sx:{paddingLeft:0},children:e.jsx(T,{sx:{marginLeft:"0px !important"},onClick:D,children:e.jsx(k,{})})}),e.jsx(u,{item:!0,xs:12,md:4,ml:7,children:e.jsx(p,{size:"small",fullWidth:!0,type:"date",name:"po_date",label:"PO Date",value:o.po_date,onChange:b,error:!!l.po_date,helperText:l.po_date,InputLabelProps:{shrink:!0}})}),e.jsxs(u,{item:!0,xs:12,children:[e.jsx(te,{children:e.jsxs(re,{children:[e.jsx(se,{children:e.jsxs(A,{children:[e.jsx(d,{children:"Product"}),e.jsx(d,{children:"Measurement"}),e.jsx(d,{children:"Quantity"}),e.jsx(d,{children:"Price"}),e.jsx(d,{children:"Total"}),e.jsx(d,{width:50})]})}),e.jsx(ie,{children:o.items.map((r,t)=>e.jsxs(A,{children:[e.jsx(d,{children:e.jsx(I,{size:"small",sx:{width:300},value:(c==null?void 0:c.find(s=>s.id===r.product_id))||null,onChange:(s,i)=>f(t,"product_id",i?i.id:""),options:(c==null?void 0:c.filter(s=>!o.items.some((i,a)=>a!==t&&i.product_id===s.id)))||[],getOptionLabel:s=>s.product_name||"",isOptionEqualToValue:(s,i)=>s.id===i,renderInput:s=>e.jsx(p,{...s,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!l[`items.${t}.product_id`],helperText:l[`items.${t}.product_id`]||"Required"})})}),e.jsx(d,{children:e.jsx(I,{size:"small",sx:{width:200},value:(x==null?void 0:x.find(s=>s.id===r.attribute_id))||null,onChange:(s,i)=>f(t,"attribute_id",i?i.id:""),options:x||[],getOptionLabel:s=>`${s.attribute_name} (${s.unit_of_measurement})`||"",isOptionEqualToValue:(s,i)=>s.id===i,renderInput:s=>e.jsx(p,{...s,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!l[`items.${t}.attribute_id`],helperText:l[`items.${t}.attribute_id`]||"Required"})})}),e.jsx(d,{children:e.jsx(p,{size:"small",type:"number",value:r.requested_quantity,onChange:s=>f(t,"requested_quantity",s.target.value),error:!!l[`items.${t}.requested_quantity`],helperText:l[`items.${t}.requested_quantity`]||"Required",inputProps:{min:1}})}),e.jsx(d,{children:e.jsx(p,{size:"small",type:"number",value:r.price,onChange:s=>f(t,"price",s.target.value),error:!!l[`items.${t}.price`],helperText:l[`items.${t}.price`]||"Required",inputProps:{min:0,step:.01}})}),e.jsx(d,{sx:{verticalAlign:"top"},children:e.jsxs(S,{mt:1,children:["₱",(r.price*r.requested_quantity).toFixed(2)]})}),e.jsx(d,{sx:{verticalAlign:"top"},children:e.jsx(T,{size:"large",onClick:()=>W(t),disabled:o.items.length===1,children:e.jsx(oe,{})})})]},t))})]})}),e.jsxs(C,{sx:{mt:2,display:"flex",justifyContent:"space-between"},children:[e.jsx(O,{startIcon:e.jsx(k,{}),onClick:F,children:"Add Item"}),e.jsxs(S,{variant:"h6",children:["Total: ₱",Q().toFixed(2)]})]})]}),e.jsx(u,{item:!0,xs:12,children:e.jsx(p,{fullWidth:!0,multiline:!0,rows:4,name:"remarks",label:"Remarks",value:o.remarks,onChange:b,error:!!l.remarks,helperText:l.remarks})}),e.jsx(u,{item:!0,xs:12,children:e.jsxs(C,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(O,{variant:"outlined",onClick:()=>y("/app/purchase"),children:"Cancel"}),e.jsx(O,{variant:"contained",type:"submit",disabled:M.isPending,children:"Create Purchase Order"})]})})]})}),e.jsx(Y,{open:R,handleClose:P,handleAddSupplier:B}),e.jsx(Z,{open:w,handleClose:()=>z(!1)})]})};export{Ce as default};
