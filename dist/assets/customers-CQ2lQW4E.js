import{r as m,ab as k,as as O,at as B,j as e,T as E,N as T,U as h,E as g,_ as X,a3 as Y,au as Z,K as A,a2 as ee,P as se,aq as ae}from"./index-DBE16dNJ.js";import{c as W}from"./cities-nh0Rcspy.js";import{D as $}from"./Dialog-BvoaxRAS.js";import{D as z,a as M}from"./DialogTitle-CU-uubLr.js";import{R as ne}from"./CloseOutlined-qRPlR-rb.js";import{T as j,c as te,d as re,e as ie,a as P,b as a,f as le}from"./TextField-BFvUv3jz.js";import{A as oe}from"./Autocomplete-BRNXh9KJ.js";import{D as F}from"./DialogActions-Nr9b4A4d.js";import"./sweetalert2.esm.all-D3pEHXw3.js";import{C as de}from"./Container-cTwkHjtL.js";import{R as ce}from"./SearchOutlined-BlgNFUGN.js";import{R as me}from"./ClearOutlined-B-ftIHsm.js";import{R as ue}from"./PlusOutlined-BkP6xSvd.js";import{R as xe}from"./EditOutlined-BSIDgwAm.js";import{R as he}from"./DeleteOutlined-Ddhxq8nB.js";import{T as je}from"./TablePagination-GD8yE7AD.js";import{D as pe}from"./DialogContentText-1ExWrGYM.js";import{S as u}from"./Skeleton-CNLfianP.js";import"./InputLabel-CmvkQMfU.js";import"./Close-4yUZz1CE.js";import"./KeyboardArrowRight-Iobha7Dt.js";import"./LastPage-C_a6dSiX.js";import"./MenuItem-BDmkg4Sd.js";const Ce=({open:y,handleClose:p,customer:l=null,handleSuccess:_})=>{const w={customer_name:"",contact_number:"",email:"",address:"",city:"",business_name:"",business_address:""},[i,C]=m.useState(w),[t,f]=m.useState({}),r=k(O),{createCustomer:S,updateCustomer:D}=B(),x=!!l;m.useEffect(()=>{y&&(C(l?{customer_name:l.customer_name||"",contact_number:l.contact_number||"",email:l.email||"",address:l.address||"",city:l.city||"",business_name:l.business_name||"",business_address:l.business_address||""}:w),f({}))},[y,l]);const b=()=>{const n={};return i.customer_name.trim()||(n.customer_name="Customer name is required"),i.email&&!/\S+@\S+\.\S+/.test(i.email)&&(n.email="Email address is invalid"),f(n),Object.keys(n).length===0},c=n=>{const{name:o,value:d}=n.target;C(v=>({...v,[o]:d})),t[o]&&f(v=>({...v,[o]:void 0}))},R=async()=>{var n,o;if(b())try{let d;x?d=await D(l.id,i):d=await S(i),_&&_(d),p()}catch(d){console.error("Error saving customer:",d),(o=(n=d.response)==null?void 0:n.data)!=null&&o.errors&&f(d.response.data.errors)}};return e.jsxs($,{open:y,onClose:p,maxWidth:"md",fullWidth:!0,"aria-labelledby":"customer-dialog-title",children:[e.jsxs(z,{id:"customer-dialog-title",sx:{m:0,p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(E,{variant:"h6",children:x?"Edit Customer":"Add New Customer"}),e.jsx(T,{"aria-label":"close",onClick:p,size:"small",children:e.jsx(ne,{})})]}),e.jsx(M,{dividers:!0,children:e.jsxs(h,{container:!0,spacing:2,children:[e.jsx(h,{item:!0,xs:12,children:e.jsx(j,{fullWidth:!0,label:"Customer Name *",name:"customer_name",value:i.customer_name,onChange:c,error:!!t.customer_name,helperText:t.customer_name,disabled:r,required:!0})}),e.jsx(h,{item:!0,xs:12,md:6,children:e.jsx(j,{fullWidth:!0,label:"Business Name",name:"business_name",value:i.business_name,onChange:c,error:!!t.business_name,helperText:t.business_name,disabled:r})}),e.jsx(h,{item:!0,xs:12,md:6,children:e.jsx(j,{fullWidth:!0,label:"Business Address",name:"business_address",value:i.business_address,onChange:c,error:!!t.business_address,helperText:t.business_address,disabled:r})}),e.jsx(h,{item:!0,xs:12,md:6,children:e.jsx(j,{fullWidth:!0,label:"Contact Number",name:"contact_number",value:i.contact_number,onChange:c,error:!!t.contact_number,helperText:t.contact_number,disabled:r})}),e.jsx(h,{item:!0,xs:12,md:6,children:e.jsx(j,{fullWidth:!0,label:"Email",name:"email",type:"email",value:i.email,onChange:c,error:!!t.email,helperText:t.email,disabled:r})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(j,{fullWidth:!0,label:"Address",name:"address",value:i.address,onChange:c,error:!!t.address,helperText:t.address,disabled:r,multiline:!0,rows:2})}),e.jsx(h,{item:!0,xs:12,md:6,children:e.jsx(oe,{fullWidth:!0,options:W,getOptionLabel:n=>`${n.name}`,value:W.find(n=>n.name===i.city)||null,onChange:(n,o)=>{c({target:{name:"city",value:o?o.name:""}})},isOptionEqualToValue:(n,o)=>n.name===o.name,renderInput:n=>e.jsx(j,{...n,label:"City",name:"city",size:"normal",slotProps:{inputLabel:{sx:{top:"1px"}}},error:!!t.city,helperText:t.city,disabled:r})})})]})}),e.jsxs(F,{sx:{px:3,py:2},children:[e.jsx(g,{onClick:p,disabled:r,children:"Cancel"}),e.jsx(g,{variant:"contained",color:"primary",onClick:R,disabled:r,startIcon:r&&e.jsx(X,{size:20,color:"inherit"}),children:r?"Saving...":x?"Update":"Save"})]})]})},fe=()=>e.jsxs(P,{children:[e.jsx(a,{children:e.jsx(u,{animation:"wave"})}),e.jsx(a,{children:e.jsx(u,{animation:"wave"})}),e.jsx(a,{children:e.jsx(u,{animation:"wave"})}),e.jsx(a,{children:e.jsx(u,{animation:"wave"})}),e.jsx(a,{children:e.jsx(u,{animation:"wave"})}),e.jsx(a,{children:e.jsx(u,{animation:"wave"})}),e.jsx(a,{children:e.jsx(u,{animation:"wave"})}),e.jsx(a,{align:"right",children:e.jsxs(A,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[e.jsx(u,{animation:"wave",variant:"circular",width:32,height:32}),e.jsx(u,{animation:"wave",variant:"circular",width:32,height:32})]})})]}),Fe=()=>{const y=Y(),p=k(Z),l=k(O),{getAllCustomers:_,deleteCustomer:w}=B(),[i,C]=m.useState(0),[t,f]=m.useState(10),[r,S]=m.useState(""),[D,x]=m.useState(!1),[b,c]=m.useState(null),[R,n]=m.useState(!1),[o,d]=m.useState(null),v=(s,N)=>{C(N)},q=s=>{f(parseInt(s.target.value,10)),C(0)},H=s=>{c(s),x(!0)},U=async()=>{try{await w(b.id),x(!1),c(null)}catch(s){console.error("Error deleting customer:",s)}},V=()=>{S("")},G=()=>{d(null),n(!0)},K=s=>{d(s),n(!0)},J=()=>{n(!1)},Q=()=>{_()},L=s=>{y(`/app/customer/${s}/purchase-history`)},I=p.filter(s=>s.customer_name.toLowerCase().includes(r.toLowerCase())||s.business_name&&s.business_name.toLowerCase().includes(r.toLowerCase())||s.email&&s.email.toLowerCase().includes(r.toLowerCase())||s.contact_number&&s.contact_number.toLowerCase().includes(r.toLowerCase())||s.city&&s.city.toLowerCase().includes(r.toLowerCase()));return e.jsxs(de,{maxWidth:"xxl",sx:{mt:0,px:"0!important"},children:[e.jsxs(A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,gap:2},children:[e.jsx(A,{sx:{display:"flex",gap:2,flex:1},children:e.jsx(j,{placeholder:"Search customers",variant:"outlined",size:"small",value:r,onChange:s=>S(s.target.value),InputProps:{startAdornment:e.jsx(ee,{position:"start",children:e.jsx(ce,{})})},sx:{minWidth:300}})}),e.jsxs(A,{children:[e.jsx(g,{variant:"text",color:"error",sx:{mr:1},onClick:V,children:e.jsx(me,{})}),e.jsx(g,{variant:"contained",color:"primary",startIcon:e.jsx(ue,{}),onClick:G,children:"Add Customer"})]})]}),e.jsx(te,{component:se,children:e.jsxs(re,{children:[e.jsx(ie,{children:e.jsxs(P,{children:[e.jsx(a,{children:"Name"}),e.jsx(a,{children:"Business Name"}),e.jsx(a,{children:"Business Address"}),e.jsx(a,{children:"Contact Number"}),e.jsx(a,{children:"Email"}),e.jsx(a,{children:"Address"}),e.jsx(a,{children:"City"}),e.jsx(a,{align:"right",children:"Actions"})]})}),e.jsxs(le,{children:[l?[...Array(t)].map((s,N)=>e.jsx(fe,{},N)):I.slice(i*t,i*t+t).map(s=>e.jsxs(P,{children:[e.jsx(a,{children:e.jsx(E,{sx:{cursor:"pointer","&:hover":{color:"primary.main",textDecoration:"underline"}},onClick:()=>L(s.id),children:s.customer_name})}),e.jsx(a,{children:s.business_name||"N/A"}),e.jsx(a,{children:s.business_address||"N/A"}),e.jsx(a,{children:s.contact_number||"N/A"}),e.jsx(a,{children:s.email||"N/A"}),e.jsx(a,{children:s.address||"N/A"}),e.jsx(a,{children:s.city||"N/A"}),e.jsxs(a,{align:"right",children:[e.jsx(T,{onClick:()=>L(s.id),color:"primary",title:"View Purchase History",children:e.jsx(ae,{style:{fontSize:20}})}),e.jsx(T,{onClick:()=>K(s),children:e.jsx(xe,{style:{fontSize:20}})}),e.jsx(T,{onClick:()=>H(s),children:e.jsx(he,{style:{fontSize:20,color:"red"}})})]})]},s.id)),!l&&I.length===0&&e.jsx(P,{children:e.jsx(a,{colSpan:8,align:"center",children:e.jsx(E,{variant:"body1",sx:{py:2},children:"No customers found"})})})]})]})}),e.jsx(je,{rowsPerPageOptions:[5,10,25],component:"div",count:I.length,rowsPerPage:t,page:i,onPageChange:v,onRowsPerPageChange:q}),e.jsxs($,{open:D,onClose:()=>x(!1),children:[e.jsx(z,{children:"Confirm Delete"}),e.jsx(M,{children:e.jsxs(pe,{children:['Are you sure you want to delete the customer "',b==null?void 0:b.customer_name,'"? This action cannot be undone.']})}),e.jsxs(F,{children:[e.jsx(g,{onClick:()=>x(!1),children:"Cancel"}),e.jsx(g,{onClick:U,color:"error",children:"Delete"})]})]}),e.jsx(Ce,{open:R,handleClose:J,customer:o,handleSuccess:Q})]})};export{Fe as default};
