import{a as X,g as Z,ad as ze,ae as De,s as z,e as oe,m as ee,r as y,u as te,j as e,c as K,b as re,i as rt,T,W as st,d as ne,af as it,ag as ke,I as Y,ah as at,Q as ot,S as ge,a9 as nt,aa as lt,ab as ct,q as B,E as Ie,P as pe,G as M,t as ie}from"./index-BCpXsV6C.js";import{S as _e}from"./sweetalert2.esm.all-D3pEHXw3.js";import{b as dt,c as pt,d as ut,e as mt}from"./usePurchaseOrders-BKhE2XbM.js";import{l as ht,P as xt,a as vt}from"./Print-Cplue5lw.js";import{g as ft}from"./fileHelper-DtQg9PBz.js";import{A as me,a as gt}from"./AddCostTypeModal-B2_DtN7l.js";import{c as ye,d as Ce,e as Se,a as A,b as p,f as $e,T as I,R as he,C as _t}from"./PlusOutlined-BjNBVFEH.js";import{R as we}from"./DeleteOutlined-CLqsTrHe.js";import{B as J}from"./InputLabel-bc7xF69S.js";import{L as jt}from"./Link-d7vLeWqf.js";import{D as bt,a as yt,b as Ct,c as St}from"./DialogTitle-B4sgs6DV.js";import{S as ae}from"./Skeleton-DKxh-0uw.js";import"./index.esm-2pZQCYfY.js";import"./FormControlLabel-CkuKjNQO.js";function $t(t){return X("MuiCircularProgress",t)}Z("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);const G=44,Pe=ze`
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
`,Le=ze`
  0% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: 0;
  }

  50% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -15px;
  }

  100% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -125px;
  }
`,wt=typeof Pe!="string"?De`
        animation: ${Pe} 1.4s linear infinite;
      `:null,Pt=typeof Le!="string"?De`
        animation: ${Le} 1.4s ease-in-out infinite;
      `:null,Lt=t=>{const{classes:a,variant:r,color:d,disableShrink:f}=t,b={root:["root",r,`color${oe(d)}`],svg:["svg"],circle:["circle",`circle${oe(r)}`,f&&"circleDisableShrink"]};return re(b,$t,a)},qt=z("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver:(t,a)=>{const{ownerState:r}=t;return[a.root,a[r.variant],a[`color${oe(r.color)}`]]}})(ee(({theme:t})=>({display:"inline-block",variants:[{props:{variant:"determinate"},style:{transition:t.transitions.create("transform")}},{props:{variant:"indeterminate"},style:wt||{animation:`${Pe} 1.4s linear infinite`}},...Object.entries(t.palette).filter(rt()).map(([a])=>({props:{color:a},style:{color:(t.vars||t).palette[a].main}}))]}))),Rt=z("svg",{name:"MuiCircularProgress",slot:"Svg",overridesResolver:(t,a)=>a.svg})({display:"block"}),Tt=z("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver:(t,a)=>{const{ownerState:r}=t;return[a.circle,a[`circle${oe(r.variant)}`],r.disableShrink&&a.circleDisableShrink]}})(ee(({theme:t})=>({stroke:"currentColor",variants:[{props:{variant:"determinate"},style:{transition:t.transitions.create("stroke-dashoffset")}},{props:{variant:"indeterminate"},style:{strokeDasharray:"80px, 200px",strokeDashoffset:0}},{props:({ownerState:a})=>a.variant==="indeterminate"&&!a.disableShrink,style:Pt||{animation:`${Le} 1.4s ease-in-out infinite`}}]}))),Me=y.forwardRef(function(a,r){const d=te({props:a,name:"MuiCircularProgress"}),{className:f,color:b="primary",disableShrink:c=!1,size:u=40,style:S,thickness:j=3.6,value:_=0,variant:g="indeterminate",...v}=d,x={...d,color:b,disableShrink:c,size:u,thickness:j,value:_,variant:g},q=Lt(x),h={},$={},R={};if(g==="determinate"){const P=2*Math.PI*((G-j)/2);h.strokeDasharray=P.toFixed(3),R["aria-valuenow"]=Math.round(_),h.strokeDashoffset=`${((100-_)/100*P).toFixed(3)}px`,$.transform="rotate(-90deg)"}return e.jsx(qt,{className:K(q.root,f),style:{width:u,height:u,...$,...S},ownerState:x,ref:r,role:"progressbar",...R,...v,children:e.jsx(Rt,{className:q.svg,ownerState:x,viewBox:`${G/2} ${G/2} ${G} ${G}`,children:e.jsx(Tt,{className:q.circle,style:h,ownerState:x,cx:G,cy:G,r:(G-j)/2,fill:"none",strokeWidth:j})})})});function kt(t){return X("MuiDialogContentText",t)}Z("MuiDialogContentText",["root"]);const It=t=>{const{classes:a}=t,d=re({root:["root"]},kt,a);return{...a,...d}},Mt=z(T,{shouldForwardProp:t=>st(t)||t==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(t,a)=>a.root})({}),At=y.forwardRef(function(a,r){const d=te({props:a,name:"MuiDialogContentText"}),{children:f,className:b,...c}=d,u=It(c);return e.jsx(Mt,{component:"p",variant:"body1",color:"textSecondary",ref:r,ownerState:c,className:K(u.root,b),...d,classes:u})}),xe=y.createContext({}),Re=y.createContext({});function zt(t){return X("MuiStep",t)}Z("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const Dt=t=>{const{classes:a,orientation:r,alternativeLabel:d,completed:f}=t;return re({root:["root",r,d&&"alternativeLabel",f&&"completed"]},zt,a)},Nt=z("div",{name:"MuiStep",slot:"Root",overridesResolver:(t,a)=>{const{ownerState:r}=t;return[a.root,a[r.orientation],r.alternativeLabel&&a.alternativeLabel,r.completed&&a.completed]}})({variants:[{props:{orientation:"horizontal"},style:{paddingLeft:8,paddingRight:8}},{props:{alternativeLabel:!0},style:{flex:1,position:"relative"}}]}),Ot=y.forwardRef(function(a,r){const d=te({props:a,name:"MuiStep"}),{active:f,children:b,className:c,component:u="div",completed:S,disabled:j,expanded:_=!1,index:g,last:v,...x}=d,{activeStep:q,connector:h,alternativeLabel:$,orientation:R,nonLinear:P}=y.useContext(xe);let[D=!1,E=!1,O=!1]=[f,S,j];q===g?D=f!==void 0?f:!0:!P&&q>g?E=S!==void 0?S:!0:!P&&q<g&&(O=j!==void 0?j:!0);const H=y.useMemo(()=>({index:g,last:v,expanded:_,icon:g+1,active:D,completed:E,disabled:O}),[g,v,_,D,E,O]),C={...d,active:D,orientation:R,alternativeLabel:$,completed:E,disabled:O,expanded:_,component:u},V=Dt(C),W=e.jsxs(Nt,{as:u,className:K(V.root,c),ref:r,ownerState:C,...x,children:[h&&$&&g!==0?h:null,b]});return e.jsx(Re.Provider,{value:H,children:h&&!$&&g!==0?e.jsxs(y.Fragment,{children:[h,W]}):W})}),Ft=ne(e.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"}),"CheckCircle"),Et=ne(e.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}),"Warning");function Wt(t){return X("MuiStepIcon",t)}const je=Z("MuiStepIcon",["root","active","completed","error","text"]);var Ae;const Ut=t=>{const{classes:a,active:r,completed:d,error:f}=t;return re({root:["root",r&&"active",d&&"completed",f&&"error"],text:["text"]},Wt,a)},be=z(it,{name:"MuiStepIcon",slot:"Root",overridesResolver:(t,a)=>a.root})(ee(({theme:t})=>({display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),color:(t.vars||t).palette.text.disabled,[`&.${je.completed}`]:{color:(t.vars||t).palette.primary.main},[`&.${je.active}`]:{color:(t.vars||t).palette.primary.main},[`&.${je.error}`]:{color:(t.vars||t).palette.error.main}}))),Bt=z("text",{name:"MuiStepIcon",slot:"Text",overridesResolver:(t,a)=>a.text})(ee(({theme:t})=>({fill:(t.vars||t).palette.primary.contrastText,fontSize:t.typography.caption.fontSize,fontFamily:t.typography.fontFamily}))),Ht=y.forwardRef(function(a,r){const d=te({props:a,name:"MuiStepIcon"}),{active:f=!1,className:b,completed:c=!1,error:u=!1,icon:S,...j}=d,_={...d,active:f,completed:c,error:u},g=Ut(_);if(typeof S=="number"||typeof S=="string"){const v=K(b,g.root);return u?e.jsx(be,{as:Et,className:v,ref:r,ownerState:_,...j}):c?e.jsx(be,{as:Ft,className:v,ref:r,ownerState:_,...j}):e.jsxs(be,{className:v,ref:r,ownerState:_,...j,children:[Ae||(Ae=e.jsx("circle",{cx:"12",cy:"12",r:"12"})),e.jsx(Bt,{className:g.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:_,children:S})]})}return S});function Vt(t){return X("MuiStepLabel",t)}const Q=Z("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),Gt=t=>{const{classes:a,orientation:r,active:d,completed:f,error:b,disabled:c,alternativeLabel:u}=t;return re({root:["root",r,b&&"error",c&&"disabled",u&&"alternativeLabel"],label:["label",d&&"active",f&&"completed",b&&"error",c&&"disabled",u&&"alternativeLabel"],iconContainer:["iconContainer",d&&"active",f&&"completed",b&&"error",c&&"disabled",u&&"alternativeLabel"],labelContainer:["labelContainer",u&&"alternativeLabel"]},Vt,a)},Qt=z("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(t,a)=>{const{ownerState:r}=t;return[a.root,a[r.orientation]]}})({display:"flex",alignItems:"center",[`&.${Q.alternativeLabel}`]:{flexDirection:"column"},[`&.${Q.disabled}`]:{cursor:"default"},variants:[{props:{orientation:"vertical"},style:{textAlign:"left",padding:"8px 0"}}]}),Kt=z("span",{name:"MuiStepLabel",slot:"Label",overridesResolver:(t,a)=>a.label})(ee(({theme:t})=>({...t.typography.body2,display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),[`&.${Q.active}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${Q.completed}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${Q.alternativeLabel}`]:{marginTop:16},[`&.${Q.error}`]:{color:(t.vars||t).palette.error.main}}))),Yt=z("span",{name:"MuiStepLabel",slot:"IconContainer",overridesResolver:(t,a)=>a.iconContainer})({flexShrink:0,display:"flex",paddingRight:8,[`&.${Q.alternativeLabel}`]:{paddingRight:0}}),Jt=z("span",{name:"MuiStepLabel",slot:"LabelContainer",overridesResolver:(t,a)=>a.labelContainer})(ee(({theme:t})=>({width:"100%",color:(t.vars||t).palette.text.secondary,[`&.${Q.alternativeLabel}`]:{textAlign:"center"}}))),qe=y.forwardRef(function(a,r){const d=te({props:a,name:"MuiStepLabel"}),{children:f,className:b,componentsProps:c={},error:u=!1,icon:S,optional:j,slots:_={},slotProps:g={},StepIconComponent:v,StepIconProps:x,...q}=d,{alternativeLabel:h,orientation:$}=y.useContext(xe),{active:R,disabled:P,completed:D,icon:E}=y.useContext(Re),O=S||E;let H=v;O&&!H&&(H=Ht);const C={...d,active:R,alternativeLabel:h,completed:D,disabled:P,error:u,orientation:$},V=Gt(C),W={slots:_,slotProps:{stepIcon:x,...c,...g}},[le,se]=ke("label",{elementType:Kt,externalForwardedProps:W,ownerState:C}),[ce,ve]=ke("stepIcon",{elementType:H,externalForwardedProps:W,ownerState:C});return e.jsxs(Qt,{className:K(V.root,b),ref:r,ownerState:C,...q,children:[O||ce?e.jsx(Yt,{className:V.iconContainer,ownerState:C,children:e.jsx(ce,{completed:D,active:R,error:u,icon:O,...ve})}):null,e.jsxs(Jt,{className:V.labelContainer,ownerState:C,children:[f?e.jsx(le,{...se,className:K(V.label,se==null?void 0:se.className),children:f}):null,j]})]})});qe&&(qe.muiName="StepLabel");function Xt(t){return X("MuiStepConnector",t)}Z("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const Zt=t=>{const{classes:a,orientation:r,alternativeLabel:d,active:f,completed:b,disabled:c}=t,u={root:["root",r,d&&"alternativeLabel",f&&"active",b&&"completed",c&&"disabled"],line:["line",`line${oe(r)}`]};return re(u,Xt,a)},er=z("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(t,a)=>{const{ownerState:r}=t;return[a.root,a[r.orientation],r.alternativeLabel&&a.alternativeLabel,r.completed&&a.completed]}})({flex:"1 1 auto",variants:[{props:{orientation:"vertical"},style:{marginLeft:12}},{props:{alternativeLabel:!0},style:{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"}}]}),tr=z("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(t,a)=>{const{ownerState:r}=t;return[a.line,a[`line${oe(r.orientation)}`]]}})(ee(({theme:t})=>{const a=t.palette.mode==="light"?t.palette.grey[400]:t.palette.grey[600];return{display:"block",borderColor:t.vars?t.vars.palette.StepConnector.border:a,variants:[{props:{orientation:"horizontal"},style:{borderTopStyle:"solid",borderTopWidth:1}},{props:{orientation:"vertical"},style:{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24}}]}})),rr=y.forwardRef(function(a,r){const d=te({props:a,name:"MuiStepConnector"}),{className:f,...b}=d,{alternativeLabel:c,orientation:u="horizontal"}=y.useContext(xe),{active:S,disabled:j,completed:_}=y.useContext(Re),g={...d,alternativeLabel:c,orientation:u,active:S,completed:_,disabled:j},v=Zt(g);return e.jsx(er,{className:K(v.root,f),ref:r,ownerState:g,...b,children:e.jsx(tr,{className:v.line,ownerState:g})})});function sr(t){return X("MuiStepper",t)}Z("MuiStepper",["root","horizontal","vertical","nonLinear","alternativeLabel"]);const ir=t=>{const{orientation:a,nonLinear:r,alternativeLabel:d,classes:f}=t;return re({root:["root",a,r&&"nonLinear",d&&"alternativeLabel"]},sr,f)},ar=z("div",{name:"MuiStepper",slot:"Root",overridesResolver:(t,a)=>{const{ownerState:r}=t;return[a.root,a[r.orientation],r.alternativeLabel&&a.alternativeLabel,r.nonLinear&&a.nonLinear]}})({display:"flex",variants:[{props:{orientation:"horizontal"},style:{flexDirection:"row",alignItems:"center"}},{props:{orientation:"vertical"},style:{flexDirection:"column"}},{props:{alternativeLabel:!0},style:{alignItems:"flex-start"}}]}),or=e.jsx(rr,{}),nr=y.forwardRef(function(a,r){const d=te({props:a,name:"MuiStepper"}),{activeStep:f=0,alternativeLabel:b=!1,children:c,className:u,component:S="div",connector:j=or,nonLinear:_=!1,orientation:g="horizontal",...v}=d,x={...d,nonLinear:_,alternativeLabel:b,orientation:g,component:S},q=ir(x),h=y.Children.toArray(c).filter(Boolean),$=h.map((P,D)=>y.cloneElement(P,{index:D,last:D+1===h.length,...P.props})),R=y.useMemo(()=>({activeStep:f,alternativeLabel:b,connector:j,nonLinear:_,orientation:g}),[f,b,j,_,g]);return e.jsx(xe.Provider,{value:R,children:e.jsx(ar,{as:S,ownerState:x,className:K(q.root,u),ref:r,...v,children:$})})}),lr=ne(e.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBackOutlined"),cr=ne(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"}),"CancelOutlined"),dr=ne(e.jsx("path",{d:"M18 15v3H6v-3H4v3c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-3zm-1-4-1.41-1.41L13 12.17V4h-2v8.17L8.41 9.59 7 11l5 5z"}),"FileDownloadOutlined"),pr=ne(e.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),ur=({products:t,attributes:a,receivedItems:r,onItemChange:d,onAddItem:f,onRemoveItem:b,errors:c={},disabled:u=!1,status:S})=>{const j=S==="completed",_=S==="cancelled";console.log("errors : ",c);const g=()=>r.reduce((v,x)=>v+x.cost_price*x.received_quantity,0);return e.jsx(e.Fragment,{children:e.jsx(ye,{sx:{mt:4},children:e.jsxs(Ce,{size:"small",children:[e.jsxs(Se,{children:[e.jsx(A,{children:e.jsx(p,{colSpan:j?7:8,children:e.jsx(T,{variant:"h5",children:"Received Items"})})}),e.jsxs(A,{children:[e.jsx(p,{children:"Product"}),e.jsx(p,{children:"Received Qty"}),e.jsx(p,{children:"Cost Price"}),e.jsx(p,{children:"Walk-in Price"}),e.jsx(p,{children:"Wholesale Price"}),e.jsx(p,{children:"Regular Price"}),e.jsx(p,{children:"Total"}),!u&&e.jsx(p,{width:50})]})]}),e.jsxs($e,{children:[r.map((v,x)=>{var q;return e.jsxs(A,{children:[e.jsx(p,{sx:{verticalAlign:"top"},children:!j&&!_?e.jsx(me,{value:(t==null?void 0:t.find(h=>h.id===v.product_id))||null,onChange:(h,$)=>d(x,"product_id",$?$.id:""),options:(t==null?void 0:t.filter(h=>!r.some(($,R)=>R!==x&&$.product_id===h.id)))||[],size:"small",sx:{width:300},getOptionLabel:h=>h.product_name||"",isOptionEqualToValue:(h,$)=>h.id===$,disabled:u,renderInput:h=>e.jsx(I,{...h,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!c[`received_items.${x}.product_id`],helperText:c[`received_items.${x}.product_id`]||"Required"})}):((q=t==null?void 0:t.find(h=>h.id===v.product_id))==null?void 0:q.product_name)||""}),e.jsx(p,{sx:{verticalAlign:"top"},children:!j&&!_?e.jsx(I,{type:"number",value:v.received_quantity,onChange:h=>d(x,"received_quantity",h.target.value),error:!!c[`received_items.${x}.received_quantity`],helperText:c[`received_items.${x}.received_quantity`]||"Required",inputProps:{min:0,step:"0.01"},disabled:u,size:"small"}):v.received_quantity}),e.jsx(p,{sx:{verticalAlign:"top"},children:!j&&!_?e.jsx(I,{type:"number",value:v.cost_price,onChange:h=>d(x,"cost_price",h.target.value),error:!!c[`received_items.${x}.cost_price`],helperText:c[`received_items.${x}.cost_price`]||"Required",inputProps:{min:0,step:"0.01"},disabled:u,size:"small"}):`₱${v.cost_price}`}),e.jsx(p,{sx:{verticalAlign:"top"},children:!j&&!_?e.jsx(I,{type:"number",value:v.walk_in_price,onChange:h=>d(x,"walk_in_price",h.target.value),error:!!c[`received_items.${x}.walk_in_price`],helperText:c[`received_items.${x}.walk_in_price`]||"Required",inputProps:{min:0,step:"0.01"},disabled:u,size:"small"}):`₱${v.walk_in_price}`}),e.jsx(p,{sx:{verticalAlign:"top"},children:!j&&!_?e.jsx(I,{type:"number",value:v.wholesale_price,onChange:h=>d(x,"wholesale_price",h.target.value),error:!!c[`received_items.${x}.wholesale_price`],helperText:c[`received_items.${x}.wholesale_price`]||"Required",inputProps:{min:0,step:"0.01"},disabled:u,size:"small"}):`₱${v.wholesale_price}`}),e.jsx(p,{sx:{verticalAlign:"top"},children:!j&&!_?e.jsx(I,{type:"number",value:v.regular_price,onChange:h=>d(x,"regular_price",h.target.value),error:!!c[`received_items.${x}.regular_price`],helperText:c[`received_items.${x}.regular_price`]||"Required",inputProps:{min:0,step:"0.01"},disabled:u,size:"small"}):`₱${v.regular_price}`}),e.jsxs(p,{sx:{verticalAlign:"top"},children:["₱",(v.cost_price*v.received_quantity).toFixed(2)]}),!u&&!j&&!_&&e.jsx(p,{sx:{verticalAlign:"top"},children:e.jsx(Y,{size:"large",onClick:()=>b(x),disabled:r.length===1,children:e.jsx(we,{})})})]},x)}),e.jsxs(A,{children:[e.jsx(p,{colSpan:5,sx:{border:"none"},children:e.jsx(J,{startIcon:e.jsx(he,{}),onClick:f,sx:{visibility:!u&&!j&&!_?"visible":"hidden"},children:"Add Received Item"})}),e.jsx(p,{children:e.jsx(T,{variant:"h5",children:"Total Received:"})}),e.jsxs(p,{children:["₱",g().toFixed(2)]})]})]})]})})})},mr=()=>e.jsxs(B,{children:[e.jsx(ae,{variant:"rectangular",width:40,height:40,sx:{mb:2}}),e.jsx(ae,{variant:"rectangular",height:60,sx:{mb:4}}),e.jsx(ae,{variant:"text",sx:{fontSize:"2rem",mb:2}}),e.jsxs(M,{container:!0,spacing:3,children:[e.jsxs(M,{item:!0,xs:12,children:[e.jsx(ae,{variant:"text",sx:{fontSize:"1.2rem",mb:1}}),e.jsx(ae,{variant:"text",sx:{fontSize:"1.2rem",mb:2}})]}),e.jsx(M,{item:!0,xs:12,children:e.jsx(ae,{variant:"rectangular",height:300})})]})]}),ue=[{label:"Pending",value:"pending"},{label:"Partially Received",value:"partially_received"},{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"}],Lr=()=>{var Te;const{id:t}=at(),a=ot(),[r,d]=y.useState({items:[],invoice:"",attachment:"",additional_costs:[],received_items:[]}),f=y.useRef(),b=ht.useReactToPrint({contentRef:f}),[c,u]=y.useState({}),[S,j]=y.useState(0),[_,g]=y.useState(!1),[v,x]=y.useState(""),[q,h]=y.useState(!1),$=ge(nt),R=ge(lt),P=ge(ct),[D,E]=y.useState(!1),[O,H]=y.useState(!1),{data:C,isLoading:V,refetch:W}=dt(t),le=pt(),se=ut(),ce=mt();y.useEffect(()=>{var s;if(C){d({...C,items:C.items.map(m=>({...m,received_quantity:m.received_quantity||0})),received_items:C.status==="partially_received"&&((s=C.received_items)==null?void 0:s.length)===0?[{product_id:"",attribute_id:"",received_quantity:0,cost_price:0,walk_in_price:0,term_price:0,wholesale_price:0,regular_price:0,remarks:""}]:C.received_items||[]});const i=ue.findIndex(m=>m.value===C.status);j(i)}},[C]);const ve=s=>{s.preventDefault();const i=document.createElement("a");i.href=ft(r.attachment),i.download=r.attachment.split("/").pop(),i.target="_blank",document.body.appendChild(i),i.click(),document.body.removeChild(i)},Ne=()=>{d(s=>({...s,additional_costs:[...s.additional_costs,{cost_type_id:"",amount:"",remarks:""}]}))},fe=(s,i,m)=>{if(i==="cost_type_id"&&m&&r.additional_costs.some((l,w)=>w!==s&&l.cost_type_id===m)){u(l=>({...l,[`additional_costs.${s}.cost_type_id`]:"This cost type is already added"}));return}const o=[...r.additional_costs];o[s]={...o[s],[i]:m},d(n=>({...n,additional_costs:o})),c[`additional_costs.${s}.${i}`]&&u(n=>{const l={...n};return delete l[`additional_costs.${s}.${i}`],l})},Oe=s=>{const i=r.additional_costs.filter((m,o)=>o!==s);d(m=>({...m,additional_costs:i}))},Fe=()=>{d(s=>({...s,items:[...s.items,{product_id:"",attribute_id:"",requested_quantity:1,price:0}]}))},Ee=s=>{if(r.items.length>1){const i=r.items.filter((o,n)=>n!==s);d(o=>({...o,items:i}));const m={...c};Object.keys(m).forEach(o=>{o.startsWith(`items.${s}`)&&delete m[o]}),u(m)}},We=async()=>{var i,m;const s={};if(L&&r.items.forEach((o,n)=>{o.product_id||(s[`items.${n}.product_id`]="Product is required"),o.attribute_id||(s[`items.${n}.attribute_id`]="Measurement is required"),(!o.requested_quantity||o.requested_quantity<=0)&&(s[`items.${n}.requested_quantity`]="Quantity must be greater than 0"),(!o.price||o.price<=0)&&(s[`items.${n}.price`]="Price must be greater than 0")}),F&&r.received_items.forEach((o,n)=>{o.product_id||(s[`received_items.${n}.product_id`]="Product is required"),(!o.received_quantity||Number(o.received_quantity)<=0)&&(s[`received_items.${n}.received_quantity`]="Received quantity must be greater than 0"),Object.entries({cost_price:"Cost price",walk_in_price:"Walk-in price",wholesale_price:"Wholesale price",regular_price:"Regular price"}).forEach(([w,U])=>{(!o[w]||Number(o[w])<=0)&&(s[`received_items.${n}.${w}`]=`${U} must be greater than 0`)})}),r.additional_costs.forEach((o,n)=>{o.cost_type_id||(s[`additional_costs.${n}.cost_type_id`]="Cost type is required"),(!o.amount||Number(o.amount)<=0)&&(s[`additional_costs.${n}.amount`]="Amount must be greater than 0")}),Object.keys(s).length>0){u(s),console.log(s),ie.error("Please fill in all required fields correctly");return}try{H(!0),await le.mutateAsync({id:t,data:r}),ie.success("Purchase Order updated successfully"),W()}catch(o){(m=(i=o.response)==null?void 0:i.data)!=null&&m.errors&&u(o.response.data.errors),ie.error("Something went wrong please try again")}finally{H(!1)}},Ue=()=>{let s="";r.status==="pending"?s="partially_received":r.status==="partially_received"&&(s="completed"),x(s),g(!0)},Be=()=>r.items.reduce((s,i)=>s+i.price*i.requested_quantity,0),He=()=>{const s=r.items.reduce((m,o)=>m+o.price*o.requested_quantity,0),i=r.additional_costs.reduce((m,o)=>m+(Number(o.amount)||0),0);return s+i},Ve=()=>r.additional_costs.reduce((i,m)=>i+(Number(m.amount)||0),0),Ge=()=>{const s=r.received_items.reduce((m,o)=>m+o.cost_price*o.received_quantity,0),i=r.additional_costs.reduce((m,o)=>m+(Number(o.amount)||0),0);return s+i},Qe=async()=>{var m,o;u({});let s=!1;const i={};if(L&&r.items.forEach((n,l)=>{n.product_id||(i[`items.${l}.product_id`]="Product is required",s=!0),n.attribute_id||(i[`items.${l}.attribute_id`]="Measurement is required",s=!0),(!n.requested_quantity||n.requested_quantity<=0)&&(i[`items.${l}.requested_quantity`]="Quantity must be greater than 0",s=!0),(!n.price||n.price<=0)&&(i[`items.${l}.price`]="Price must be greater than 0",s=!0)}),v==="completed"&&(r.invoice||(i.invoice="Invoice is required",s=!0),r.attachment||(i.attachment="Attachment is required",s=!0)),console.log(r.received_items),console.log(r),r.received_items.forEach((n,l)=>{console.log(n,l),n.product_id||(i[`received_items.${l}.product_id`]="Product is required",s=!0),(!n.received_quantity||Number(n.received_quantity)<=0)&&(i[`received_items.${l}.received_quantity`]="Received quantity must be greater than 0",s=!0),Object.entries({cost_price:"Cost price",walk_in_price:"Walk-in price",wholesale_price:"Wholesale price",regular_price:"Regular price"}).forEach(([U,tt])=>{(!n[U]||Number(n[U])<=0)&&(i[`received_items.${l}.${U}`]=`${tt} must be greater than 0`,s=!0)})}),r.additional_costs.forEach((n,l)=>{n.cost_type_id||(i[`additional_costs.${l}.cost_type_id`]="Cost type is required",s=!0),(!n.amount||Number(n.amount)<=0)&&(i[`additional_costs.${l}.amount`]="Amount must be greater than 0",s=!0)}),s){u(i),g(!1),ie.error("Please fill in all required fields correctly");return}try{h(!0),await le.mutateAsync({id:t,data:{...r,status:v}}),r.attachment instanceof File&&await ce.mutateAsync({id:t,file:r.attachment}),g(!1),ie.success("Purchase Order updated successfully"),W()}catch(n){(o=(m=n.response)==null?void 0:m.data)!=null&&o.errors&&(u(n.response.data.errors),ie.error("Something went wrong please try again")),h(!1),g(!1)}finally{h(!1)}},de=(s,i,m)=>{if(i==="product_id"&&m&&r.items.some((l,w)=>w!==s&&l.product_id===m)){u(l=>({...l,[`items.${s}.product_id`]:"This product is already added"}));return}const o=[...r.items];o[s]={...o[s],[i]:m},d(n=>({...n,items:o})),c[`items.${s}.${i}`]&&u(n=>{const l={...n};return delete l[`items.${s}.${i}`],l})},Ke=(s,i,m)=>{const o=[...r.received_items];o[s]={...o[s],[i]:m},d(n=>({...n,received_items:o})),c[`received_items.${s}.${i}`]&&u(n=>{const l={...n};return delete l[`received_items.${s}.${i}`],l})},Ye=()=>{const s={product_id:"",attribute_id:"",received_quantity:0,cost_price:0,walk_in_price:0,term_price:0,wholesale_price:0,regular_price:0,remarks:""};d(i=>({...i,received_items:[...i.received_items,s]}))},Je=s=>{if(r.received_items.length>1){const i=r.received_items.filter((o,n)=>n!==s);d(o=>({...o,received_items:i}));const m={...c};Object.keys(m).forEach(o=>{o.startsWith(`received_items.${s}`)&&delete m[o]}),u(m)}},L=r.status==="pending",F=r.status==="partially_received",k=r.status==="completed",N=r.status==="cancelled",Xe=()=>L?"Mark as Partially Received":F?"Mark as Completed":"",Ze=()=>v==="partially_received"?"Are you sure you want to mark this Purchase Order as partially received? This will allow you to start recording received quantities.":v==="completed"?"Are you sure you want to mark this Purchase Order as completed? This action cannot be undone.":"",et=()=>{_e.fire({title:"Are you sure?",text:"You want to cancel this purchase order? This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, cancel it!",cancelButtonText:"No, keep it"}).then(async s=>{if(s.isConfirmed)try{h(!0),await se.mutateAsync({id:t,status:"cancelled"}),_e.fire("Cancelled!","The purchase order has been cancelled.","success"),W()}catch{_e.fire("Error!","Failed to cancel the purchase order.","error")}finally{h(!1)}})};return V?e.jsx(mr,{}):e.jsxs(_t,{maxWidth:"xxl",sx:{mt:0,mb:4},children:[e.jsxs(B,{sx:{mb:4},children:[e.jsx(nr,{activeStep:S,sx:{mb:4},children:ue.map((s,i)=>e.jsx(Ot,{children:e.jsx(qe,{sx:{"& .MuiStepLabel-label":{color:S===3&&s.value==="cancelled"?"error.main":i===ue.length-1?"grey.400":"primary.primary"},"& .MuiStepIcon-root":{color:S===3&&s.value==="cancelled"?"error.main":i===ue.length-1?"grey.400":"primary.primary"}},children:s.label})},s.value))}),e.jsxs(B,{sx:{display:"flex",justifyContent:"space-between",mb:4},children:[e.jsx(Y,{onClick:()=>a("/app/purchase"),sx:{mb:2},color:"primary",children:e.jsx(lr,{})}),e.jsxs(B,{sx:{display:"flex",gap:2,justifyContent:"flex-end",mt:2},children:[e.jsx(Ie,{title:"Save Purchase Order",children:e.jsx(Y,{variant:"contained",color:"primary",onClick:We,disabled:O||!L&&!F,children:O?e.jsx(B,{children:e.jsx(Me,{size:"30px"})}):e.jsx(pr,{})})}),e.jsx(Ie,{title:"Print Purchase Order",children:e.jsx(Y,{onClick:b,color:"primary",children:e.jsx(xt,{})})})]}),e.jsx(vt,{purchaseOrder:C,contentRef:f})]}),e.jsx(pe,{elevation:0,sx:{p:0,mb:0},children:e.jsx(M,{container:!0,spacing:2,alignItems:"center",children:e.jsx(M,{item:!0,xs:12,md:8,children:e.jsxs(T,{variant:"h5",sx:{mb:1},children:["Purchase Order: ",C==null?void 0:C.po_number]})})})}),e.jsx(pe,{elevation:0,sx:{p:0,mb:3},children:e.jsxs(M,{container:!0,spacing:3,children:[e.jsx(M,{item:!0,xs:12,md:6,children:e.jsxs(T,{variant:"subtitle1",sx:{mb:2},children:["Supplier: ",(Te=C==null?void 0:C.supplier)==null?void 0:Te.supplier_name]})}),e.jsx(M,{item:!0,xs:12,md:6,sx:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(T,{variant:"subtitle1",children:["PO Date: ",new Date(C==null?void 0:C.po_date).toLocaleDateString()]})})]})}),(F||k||N)&&e.jsx(pe,{elevation:0,sx:{p:0,mb:3},children:e.jsxs(M,{container:!0,spacing:3,children:[e.jsx(M,{item:!0,xs:12,md:6,children:!k&&!N?e.jsx(I,{fullWidth:!0,label:"Invoice Number",name:"invoice",value:r.invoice,onChange:s=>d(i=>({...i,invoice:s.target.value})),error:!!c.invoice,helperText:c.invoice,required:!0,disabled:k,sx:{mb:2}}):e.jsxs(T,{children:["Invoice Number: ",r.invoice||""]})}),e.jsx(M,{item:!0,xs:12,md:6,children:r.attachment&&typeof r.attachment=="string"?e.jsxs(B,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(T,{children:"Current Attachment:"}),e.jsxs(jt,{href:"#",sx:{display:"flex",alignItems:"center",gap:1},onClick:ve,children:[e.jsx(dr,{})," Download Attachment"]})]}):e.jsx(I,{fullWidth:!0,type:"file",label:"Attachment",name:"attachment",InputLabelProps:{shrink:!0},inputProps:{accept:".pdf,.doc,.docx,.png,.jpg,.jpeg"},onChange:s=>{const i=s.target.files[0];if(i){if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/png","image/jpeg"].includes(i.type)){u(n=>({...n,attachment:"File must be PDF, DOC, DOCX, PNG, or JPG format"})),s.target.value="";return}const o=5*1024*1024;if(i.size>o){u(n=>({...n,attachment:"File size must be less than 5MB"})),s.target.value="";return}d(n=>({...n,attachment:i}))}},error:!!c.attachment,helperText:c.attachment,disabled:k,required:!0})})]})}),e.jsxs(pe,{elevation:0,sx:{p:0},children:[e.jsxs(M,{item:!0,xs:12,children:[e.jsx(ye,{children:e.jsxs(Ce,{children:[e.jsxs(Se,{children:[e.jsx(A,{children:e.jsx(p,{colSpan:L?6:5,children:e.jsx(T,{variant:"h5",children:"Requested Items"})})}),e.jsxs(A,{children:[e.jsx(p,{children:"Product"}),e.jsx(p,{children:"Measurement"}),e.jsx(p,{children:"Request Quantity"}),e.jsx(p,{children:"Price"}),e.jsx(p,{children:"Total"}),L&&e.jsx(p,{width:50})]})]}),e.jsxs($e,{children:[r.items.map((s,i)=>{var m,o,n;return e.jsxs(A,{children:[e.jsx(p,{sx:{verticalAlign:"top"},children:L?e.jsx(me,{size:"small",sx:{width:300},value:($==null?void 0:$.find(l=>l.id===s.product_id))||null,onChange:(l,w)=>de(i,"product_id",w?w.id:""),options:($==null?void 0:$.filter(l=>!r.items.some((w,U)=>U!==i&&w.product_id===l.id)))||[],getOptionLabel:l=>l.product_name||"",isOptionEqualToValue:(l,w)=>l.id===w,renderInput:l=>e.jsx(I,{...l,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!c[`items.${i}.product_id`],helperText:c[`items.${i}.product_id`]||"Required"})}):(m=s.product)==null?void 0:m.product_name}),e.jsx(p,{sx:{verticalAlign:"top"},children:L?e.jsx(me,{size:"small",sx:{width:300},value:(R==null?void 0:R.find(l=>l.id===s.attribute_id))||null,onChange:(l,w)=>de(i,"attribute_id",w?w.id:""),options:(R==null?void 0:R.filter(l=>!r.items.some((w,U)=>U!==i&&w.attribute_id===l.id)))||[],getOptionLabel:l=>`${l.attribute_name} (${l.unit_of_measurement})`||"",isOptionEqualToValue:(l,w)=>l.id===w,renderInput:l=>e.jsx(I,{...l,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!c[`items.${i}.attribute_id`],helperText:c[`items.${i}.attribute_id`]||"Required"})}):`${(o=s.attribute)==null?void 0:o.attribute_name} (${(n=s.attribute)==null?void 0:n.unit_of_measurement})`}),e.jsx(p,{sx:{verticalAlign:"top"},children:L?e.jsx(I,{type:"number",value:s.requested_quantity,onChange:l=>de(i,"requested_quantity",l.target.value),error:!!c[`items.${i}.requested_quantity`],helperText:c[`items.${i}.requested_quantity`]||"Required",inputProps:{min:1},disabled:!L,size:"small"}):s.requested_quantity}),e.jsx(p,{sx:{verticalAlign:"top"},children:L?e.jsx(I,{type:"number",value:s.price,onChange:l=>de(i,"price",l.target.value),error:!!c[`items.${i}.price`],helperText:c[`items.${i}.price`]||"Required",inputProps:{min:0,step:.01},disabled:!L,size:"small"}):`₱${s.price}`}),e.jsxs(p,{sx:{verticalAlign:"top"},children:["₱",(s.price*s.requested_quantity).toFixed(2)]}),L&&e.jsx(p,{sx:{verticalAlign:"top"},children:e.jsx(Y,{onClick:()=>Ee(i),disabled:r.items.length===1,children:e.jsx(we,{})})})]},i)}),e.jsxs(A,{children:[e.jsx(p,{colSpan:3,children:e.jsx(J,{sx:{visibility:L?"visible":"hidden"},startIcon:e.jsx(he,{}),onClick:Fe,children:"Add Item"})}),e.jsx(p,{verticalAlign:"left",children:e.jsx(T,{variant:"h5",textAlign:"left",children:"Total Requested: "})}),e.jsx(p,{children:e.jsxs(T,{variant:"h5",children:["₱",Be().toFixed(2)]})})]})]})]})}),e.jsx(B,{sx:{mt:2,display:"flex",justifyContent:"flex-end"}}),!L&&e.jsx(ur,{products:$,attributes:R,receivedItems:r.received_items,onItemChange:Ke,onAddItem:Ye,onRemoveItem:Je,errors:c,disabled:k,status:r.status})]}),e.jsx(M,{item:!0,xs:12,children:e.jsx(ye,{children:e.jsxs(Ce,{children:[e.jsxs(Se,{children:[e.jsx(A,{children:e.jsxs(p,{colSpan:k||N?3:4,children:[" ",e.jsxs(T,{variant:"h5",sx:{mt:4,mb:1},children:["Additional Costs",e.jsx(Y,{sx:{marginLeft:"0px !important"},onClick:()=>E(!0),children:e.jsx(he,{})})]})]})}),e.jsxs(A,{children:[e.jsx(p,{children:"Cost Type"}),e.jsx(p,{children:"Amount"}),e.jsx(p,{children:"Remarks"}),!k&&!N&&e.jsx(p,{width:50})]})]}),e.jsxs($e,{children:[r.additional_costs.map((s,i)=>{var m;return e.jsxs(A,{children:[e.jsx(p,{children:!k&&!N?e.jsx(me,{size:"small",value:(P==null?void 0:P.find(o=>o.cost_type_id===s.cost_type_id))||null,onChange:(o,n)=>fe(i,"cost_type_id",n?n.cost_type_id:""),options:(P==null?void 0:P.filter(o=>o.is_active&&!r.additional_costs.some((n,l)=>l!==i&&n.cost_type_id===o.cost_type_id)))||[],getOptionLabel:o=>o.name||"",isOptionEqualToValue:(o,n)=>o.cost_type_id===n,disabled:!L&&!F,renderInput:o=>e.jsx(I,{...o,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!c[`additional_costs.${i}.cost_type_id`],helperText:c[`additional_costs.${i}.cost_type_id`]||"Required"})}):((m=P==null?void 0:P.find(o=>o.cost_type_id===s.cost_type_id))==null?void 0:m.name)||""}),e.jsx(p,{children:!k&&!N?e.jsx(I,{size:"small",type:"number",value:s.amount,onChange:o=>fe(i,"amount",o.target.value),error:!!c[`additional_costs.${i}.amount`],helperText:c[`additional_costs.${i}.amount`]||"Required",inputProps:{min:0,step:.01},disabled:!L&&!F}):s.amount}),e.jsx(p,{sx:{verticalAlign:"top"},children:!k&&!N?e.jsx(I,{size:"small",value:s.remarks||"",onChange:o=>fe(i,"remarks",o.target.value),fullWidth:!0,disabled:!L&&!F}):s.remarks||""}),!k&&!N&&e.jsx(p,{sx:{verticalAlign:"top"},children:e.jsx(Y,{size:"large",onClick:()=>Oe(i),disabled:!L&&!F,children:e.jsx(we,{})})})]},i)}),e.jsxs(A,{children:[e.jsx(p,{sx:{border:"none"},colSpan:!k&&!N?2:1,children:e.jsx(J,{startIcon:e.jsx(he,{}),onClick:Ne,sx:{visibility:!k&&!N?"visible":"hidden"},children:"Add Additional Cost"})}),e.jsx(p,{children:e.jsx(T,{variant:"h5",textAlign:"right",children:"Total Cost:"})}),e.jsx(p,{children:e.jsxs(T,{variant:"h5",children:["₱",Ve().toFixed(2)]})})]}),e.jsxs(A,{children:[e.jsx(p,{sx:{border:"none"},colSpan:!k&&!N?2:1}),e.jsx(p,{sx:{verticalAlign:"right"},children:e.jsx(T,{variant:"h5",textAlign:"right",children:"Total Requested with Costs:"})}),e.jsx(p,{children:e.jsxs(T,{variant:"h5",children:["₱",He().toFixed(2)]})})]}),e.jsxs(A,{children:[e.jsx(p,{sx:{border:"none"},colSpan:!k&&!N?2:1}),e.jsx(p,{sx:{verticalAlign:"right"},children:e.jsx(T,{variant:"h5",textAlign:"right",children:"Total Received with Costs:"})}),e.jsx(p,{children:e.jsxs(T,{variant:"h5",children:["₱",Ge().toFixed(2)]})})]})]})]})})}),e.jsx(M,{item:!0,xs:12,md:4,children:e.jsxs(B,{sx:{display:"flex",mt:4,justifyContent:"flex-end",gap:2},children:[F&&e.jsx(J,{variant:"contained",onClick:et,disabled:q,color:"error",startIcon:e.jsx(cr,{}),sx:{minWidth:200},children:"Cancel Order"}),(L||F)&&!q&&e.jsx(J,{variant:"contained",onClick:Ue,disabled:le.isPending,color:"primary",sx:{minWidth:200},children:Xe()})]})})]})]}),e.jsxs(bt,{open:_,onClose:()=>g(!1),PaperProps:{sx:{borderRadius:2,minWidth:"500px",padding:2,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)"}},children:[e.jsx(yt,{sx:{fontSize:"1.5rem",fontWeight:600,color:"#333",pb:1},children:"Confirm Status Update"}),e.jsx(Ct,{sx:{pt:2},children:e.jsx(At,{sx:{fontSize:"1.1rem",color:"#555",lineHeight:1.5},children:Ze()})}),e.jsxs(St,{sx:{padding:3,paddingTop:2,gap:2},children:[e.jsx(J,{onClick:()=>g(!1),sx:{fontSize:"1rem",minWidth:"100px",textTransform:"none"},children:"Cancel"}),e.jsx(J,{onClick:Qe,variant:"contained",color:"primary",disabled:q,sx:{fontSize:"1rem",minWidth:"100px",textTransform:"none",boxShadow:2},children:q?e.jsxs(B,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Me,{size:20,color:"inherit"}),e.jsx("span",{children:"Updating..."})]}):"Confirm"})]})]}),e.jsx(gt,{open:D,handleClose:()=>E(!1)})]})};export{Lr as default};
