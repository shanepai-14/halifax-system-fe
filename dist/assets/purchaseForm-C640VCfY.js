import{K as Q,r as _,Z as g,$ as H,a0 as K,_ as Z,a1 as J,N as U,j as e,v as q,I as T,T as S,G as p,l as $,t as I}from"./index-VYacBzdn.js";import{a as V}from"./usePurchaseOrders-NTer0GSH.js";import{S as X}from"./SupplierModal-GurUfyiW.js";import{A as Y}from"./AddCostTypeModal-Cq3Tgk5W.js";import{C as ee}from"./Container-g1D49Be8.js";import{R as te}from"./ArrowLeftOutlined-D9j3WHTr.js";import{A as v}from"./Autocomplete-CTmCWFbU.js";import{T as u}from"./TextField-DcFzWKp_.js";import{R as A}from"./PlusOutlined-NVaeiLU6.js";import{b as re,c as se,d as ie,T as k,a as d,e as ae}from"./TableRow-F8UK-irz.js";import{R as oe}from"./DeleteOutlined-CknXjhA9.js";import"./CloseOutlined-BzQ1yUQH.js";import"./index.esm-B7XaB91D.js";import"./Dialog-KIaZwdXs.js";import"./DialogTitle-sNzQWAp3.js";import"./FormControlLabel-B-MBKEXQ.js";import"./DialogActions-Cf0C3-gn.js";import"./Close-aB77mB-e.js";import"./InputLabel-Cn1m3Ebo.js";const le={supplier_id:"",po_date:new Date().toISOString().split("T")[0],remarks:"",items:[{product_id:"",requested_quantity:1,price:0}]},Ie=()=>{const y=Q(),[o,m]=_.useState(le),[l,h]=_.useState({}),c=g(H),x=g(K),j=g(Z);g(J);const[R,O]=_.useState(!1),[w,z]=_.useState(!1),M=V(),E=U(),L=async r=>{var s,i;r.preventDefault();const t={};if(o.supplier_id||(t.supplier_id="Supplier is required"),o.items.forEach((a,n)=>{a.product_id||(t[`items.${n}.product_id`]="Product is required"),a.attribute_id||(t[`items.${n}.attribute_id`]="Measurement is required"),(!a.requested_quantity||a.requested_quantity<=0)&&(t[`items.${n}.requested_quantity`]="Quantity must be greater than 0"),(!a.price||a.price<=0)&&(t[`items.${n}.price`]="Price must be greater than 0");const C=o.items.filter(N=>N.product_id===a.product_id).length;a.product_id&&C>1&&(t[`items.${n}.product_id`]="Duplicate product is not allowed")}),Object.keys(t).length>0){h(t),I.error("Please fill in all required fields correctly");return}try{await M.mutateAsync(o),y("/app/purchase"),I.success("Successfully Created Purchase Order")}catch(a){(i=(s=a.response)==null?void 0:s.data)!=null&&i.errors&&h(a.response.data.errors),I.error("Something went wrong please try again")}},D=async r=>{try{await E.mutateAsync(r),P()}catch(t){console.error("Error creating supplier:",t)}},F=()=>{O(!0)},P=()=>{O(!1)},b=r=>{m(t=>({...t,[r.target.name]:r.target.value}))},f=(r,t,s)=>{if(t==="product_id"&&s&&o.items.some((n,C)=>C!==r&&n.product_id===s)){h(n=>({...n,[`items.${r}.product_id`]:"This product is already added"}));return}const i=[...o.items];i[r]={...i[r],[t]:s},m(a=>({...a,items:i})),l[`items.${r}.${t}`]&&h(a=>{const n={...a};return delete n[`items.${r}.${t}`],n})},B=()=>{m(r=>({...r,items:[...r.items,{product_id:"",requested_quantity:1,price:0}]}))},W=r=>{if(o.items.length>1){const t=o.items.filter((s,i)=>i!==r);m(s=>({...s,items:t}))}},G=()=>o.items.reduce((r,t)=>r+t.price*t.requested_quantity,0);return e.jsxs(ee,{maxWidth:"lg",sx:{mt:0,mb:4},children:[e.jsxs(q,{sx:{mb:4,display:"flex",alignItems:"center",gap:2},children:[e.jsx(T,{onClick:()=>y("/app/purchase"),children:e.jsx(te,{})}),e.jsx(S,{variant:"h5",children:"Create Purchase Order"})]}),e.jsx("form",{onSubmit:L,children:e.jsxs(p,{container:!0,spacing:1,children:[e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(v,{size:"small",value:(j==null?void 0:j.find(r=>r.supplier_id===o.supplier_id))||null,onChange:(r,t)=>b({target:{name:"supplier_id",value:t?t.supplier_id:""}}),options:j||[],getOptionLabel:r=>r.supplier_name||"",isOptionEqualToValue:(r,t)=>r.supplier_id===t,renderInput:r=>e.jsx(u,{...r,fullWidth:!0,label:"Supplier",name:"supplier_id",error:!!l.supplier_id,helperText:l.supplier_id,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},slotProps:{inputLabel:{sx:{top:"1px"}}}})})}),e.jsx(p,{item:!0,xs:"auto",sx:{paddingLeft:0},children:e.jsx(T,{sx:{marginLeft:"0px !important"},onClick:F,children:e.jsx(A,{})})}),e.jsx(p,{item:!0,xs:12,md:4,ml:7,children:e.jsx(u,{size:"small",fullWidth:!0,type:"date",name:"po_date",label:"PO Date",value:o.po_date,onChange:b,error:!!l.po_date,helperText:l.po_date,InputLabelProps:{shrink:!0}})}),e.jsxs(p,{item:!0,xs:12,children:[e.jsx(re,{children:e.jsxs(se,{children:[e.jsx(ie,{children:e.jsxs(k,{children:[e.jsx(d,{children:"Product"}),e.jsx(d,{children:"Measurement"}),e.jsx(d,{children:"Quantity"}),e.jsx(d,{children:"Price"}),e.jsx(d,{children:"Total"}),e.jsx(d,{width:50})]})}),e.jsx(ae,{children:o.items.map((r,t)=>e.jsxs(k,{children:[e.jsx(d,{children:e.jsx(v,{size:"small",sx:{width:300},value:(c==null?void 0:c.find(s=>s.id===r.product_id))||null,onChange:(s,i)=>f(t,"product_id",i?i.id:""),options:(c==null?void 0:c.filter(s=>!o.items.some((i,a)=>a!==t&&i.product_id===s.id)))||[],getOptionLabel:s=>s.product_name||"",isOptionEqualToValue:(s,i)=>s.id===i,renderInput:s=>e.jsx(u,{...s,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!l[`items.${t}.product_id`],helperText:l[`items.${t}.product_id`]||"Required"})})}),e.jsx(d,{children:e.jsx(v,{size:"small",sx:{width:200},value:(x==null?void 0:x.find(s=>s.id===r.attribute_id))||null,onChange:(s,i)=>f(t,"attribute_id",i?i.id:""),options:x||[],getOptionLabel:s=>`${s.attribute_name} (${s.unit_of_measurement})`||"",isOptionEqualToValue:(s,i)=>s.id===i,renderInput:s=>e.jsx(u,{...s,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!l[`items.${t}.attribute_id`],helperText:l[`items.${t}.attribute_id`]||"Required"})})}),e.jsx(d,{children:e.jsx(u,{size:"small",type:"number",value:r.requested_quantity,onChange:s=>f(t,"requested_quantity",s.target.value),error:!!l[`items.${t}.requested_quantity`],helperText:l[`items.${t}.requested_quantity`]||"Required",inputProps:{min:1}})}),e.jsx(d,{children:e.jsx(u,{size:"small",type:"number",value:r.price,onChange:s=>f(t,"price",s.target.value),error:!!l[`items.${t}.price`],helperText:l[`items.${t}.price`]||"Required",inputProps:{min:0,step:.01}})}),e.jsx(d,{sx:{verticalAlign:"top"},children:e.jsxs(S,{mt:1,children:["₱",(r.price*r.requested_quantity).toFixed(2)]})}),e.jsx(d,{sx:{verticalAlign:"top"},children:e.jsx(T,{size:"large",onClick:()=>W(t),disabled:o.items.length===1,children:e.jsx(oe,{})})})]},t))})]})}),e.jsxs(q,{sx:{mt:2,display:"flex",justifyContent:"space-between"},children:[e.jsx($,{startIcon:e.jsx(A,{}),onClick:B,children:"Add Item"}),e.jsxs(S,{variant:"h6",children:["Total: ₱",G().toFixed(2)]})]})]}),e.jsx(p,{item:!0,xs:12,children:e.jsx(u,{fullWidth:!0,multiline:!0,rows:4,name:"remarks",label:"Remarks",value:o.remarks,onChange:b,error:!!l.remarks,helperText:l.remarks})}),e.jsx(p,{item:!0,xs:12,children:e.jsxs(q,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx($,{variant:"outlined",onClick:()=>y("/app/purchase"),children:"Cancel"}),e.jsx($,{variant:"contained",type:"submit",disabled:M.isPending,children:"Create Purchase Order"})]})})]})}),e.jsx(X,{open:R,handleClose:P,handleAddSupplier:D}),e.jsx(Y,{open:w,handleClose:()=>z(!1)})]})};export{Ie as default};
