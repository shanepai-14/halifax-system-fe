import{r as u,a8 as Ce,a9 as we,j as e,G as g,P as y,q as r,T as a,aa as Se,D as T,Q as Ie,S as X,V as _e,ab as Ae,R as Y,ac as Re,ad as $,E as ke,F as Z,y as F,H as ee,I as te,t as se}from"./index-BH4OZBNn.js";import{u as Te,a as Le,b as Pe,c as De,d as $e,I as Fe}from"./useInventory-gjelOzKi.js";import{R as oe}from"./WarningOutlined-B-HjqL1l.js";import{S as c}from"./Skeleton-udNI9PE0.js";import{C as Ne}from"./Container-Ccg0UrpZ.js";import{T as We,S as ne,c as N,d as W,e as q,a as h,b as s,f as z}from"./TextField-DF5xaGpt.js";import{R as qe}from"./SearchOutlined-CK5kM7w4.js";import{I as re,B as v}from"./InputLabel-BCuRqJ6g.js";import{M as C}from"./MenuItem-BzYG3h4A.js";import{R as ze}from"./ClearOutlined-D2Mqx3gw.js";import{R as Ve}from"./ReloadOutlined-BCZQ9NYD.js";import{R as Oe}from"./PlusOutlined-BtYhiO4s.js";import{A as Be}from"./Alert-D-pbdCV0.js";import{R as Ee}from"./EyeOutlined-eti8W485.js";import{R as He}from"./EditOutlined-DXtQLGvw.js";import{R as ae}from"./DownloadOutlined-1nzBAnRe.js";import{D as Me}from"./Dialog-y_FGqvyx.js";import{D as Ge,a as Ue}from"./DialogTitle-BZJ-XtUd.js";import"./Autocomplete-gVGXcdNK.js";import"./Close-CubJlotr.js";import"./CloseOutlined-D7Yyhn4D.js";import"./SaveOutlined-DhTrkmo0.js";var Qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M740 161c-61.8 0-112 50.2-112 112 0 50.1 33.1 92.6 78.5 106.9v95.9L320 602.4V318.1c44.2-15 76-56.9 76-106.1 0-61.8-50.2-112-112-112s-112 50.2-112 112c0 49.2 31.8 91 76 106.1V706c-44.2 15-76 56.9-76 106.1 0 61.8 50.2 112 112 112s112-50.2 112-112c0-49.2-31.8-91-76-106.1v-27.8l423.5-138.7a50.52 50.52 0 0034.9-48.2V378.2c42.9-15.8 73.6-57 73.6-105.2 0-61.8-50.2-112-112-112zm-504 51a48.01 48.01 0 0196 0 48.01 48.01 0 01-96 0zm96 600a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm408-491a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"branches",theme:"outlined"},Je=function(i,m){return u.createElement(Ce,we({},i,{ref:m,icon:Qe}))},Ke=u.forwardRef(Je);const Xe=({inventoryData:_=[],stats:i={},isLoading:m=!1})=>{const x=o=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2,maximumFractionDigits:2}).format(o||0),A=()=>e.jsxs(y,{sx:{p:2,height:"100%"},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(c,{width:120,height:30}),e.jsx(c,{variant:"circular",width:40,height:40})]}),e.jsx(c,{width:80,height:60}),e.jsx(T,{sx:{my:2}}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(c,{width:100,height:24}),e.jsx(c,{width:80,height:24})]})]}),b=i.categoriesWithValue?Object.entries(i.categoriesWithValue).sort(([,o],[,j])=>j.value-o.value).map(([o,j])=>({id:o,...j})):[];return e.jsxs(e.Fragment,{children:[e.jsxs(g,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(g,{item:!0,xs:12,sm:6,md:6,children:m?e.jsx(A,{}):e.jsxs(y,{elevation:1,sx:{p:2,height:"100%",borderTop:"4px solid #1976d2",borderRadius:"4px"},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[e.jsx(a,{variant:"subtitle2",color:"text.secondary",children:"Total Inventory"}),e.jsx(r,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:40,height:40,borderRadius:"50%",backgroundColor:"rgba(25, 118, 210, 0.12)"},children:e.jsx(r,{sx:{color:"#1976d2"},children:e.jsx(Se,{style:{fontSize:24}})})})]}),e.jsx(a,{variant:"h4",sx:{fontWeight:"bold",color:"#1976d2",mb:1},children:i.totalItems||_.length}),e.jsxs(r,{sx:{mt:"auto"},children:[e.jsx(T,{sx:{my:1}}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:"Total Value"}),e.jsx(a,{variant:"body1",fontWeight:"medium",children:x(i.totalValue||0)})]})]})]})}),e.jsx(g,{item:!0,xs:12,sm:6,md:6,children:m?e.jsx(A,{}):e.jsxs(y,{elevation:1,sx:{p:2,height:"100%",borderTop:"4px solid #f44336",borderRadius:"4px"},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[e.jsx(a,{variant:"subtitle2",color:"text.secondary",children:"Low Stock Items"}),e.jsx(r,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:40,height:40,borderRadius:"50%",backgroundColor:"rgba(244, 67, 54, 0.12)"},children:e.jsx(r,{sx:{color:"#f44336"},children:e.jsx(oe,{style:{fontSize:24}})})})]}),e.jsx(a,{variant:"h4",sx:{fontWeight:"bold",color:"#f44336",mb:1},children:i.lowStockItems||0}),e.jsxs(r,{sx:{mt:"auto"},children:[e.jsx(T,{sx:{my:1}}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:"Require Reorder"}),e.jsx(a,{variant:"body1",fontWeight:"medium",children:i.reorderNeeded||0})]})]})]})})]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Ke,{style:{fontSize:20,marginRight:8,color:"#4caf50"}}),e.jsx(a,{variant:"h6",children:"Inventory by Category"}),e.jsxs(a,{variant:"body2",color:"text.secondary",sx:{ml:2},children:["(",i.categoryCount||0," categories)"]})]}),e.jsx(g,{container:!0,spacing:2,children:m?Array.from(new Array(4)).map((o,j)=>e.jsx(g,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(A,{})},j)):b.length>0?b.map(o=>e.jsx(g,{item:!0,xs:12,sm:6,md:4,lg:4,children:e.jsxs(y,{elevation:1,sx:{p:2,height:"100%",borderLeft:"4px solid #4caf50",borderRadius:"4px"},children:[e.jsx(a,{variant:"subtitle2",noWrap:!0,title:o.name,sx:{mb:1},children:o.name}),e.jsx(a,{variant:"h5",sx:{fontWeight:"bold",color:"#4caf50",mb:1},children:x(o.value)}),e.jsxs(r,{sx:{mt:"auto"},children:[e.jsx(T,{sx:{my:1}}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:"Items"}),e.jsx(a,{variant:"body1",children:o.count})]})]})]})},o.id)):e.jsx(g,{item:!0,xs:12,children:e.jsx(y,{sx:{p:3,textAlign:"center"},children:e.jsx(a,{color:"text.secondary",children:"No category data available"})})})})]})},ie={low:{color:"error",label:"Low Stock"},normal:{color:"success",label:"Normal"},overstocked:{color:"warning",label:"Overstocked"}},Ye=[{value:"addition",label:"Addition"},{value:"reduction",label:"Reduction"},{value:"damage",label:"Damage"},{value:"loss",label:"Loss"},{value:"correction",label:"Correction"}],V=()=>e.jsxs(h,{children:[e.jsx(s,{children:e.jsx(c,{animation:"wave"})}),e.jsx(s,{children:e.jsx(c,{animation:"wave"})}),e.jsx(s,{children:e.jsx(c,{animation:"wave"})}),e.jsx(s,{children:e.jsx(c,{animation:"wave"})}),e.jsx(s,{children:e.jsx(c,{animation:"wave"})}),e.jsx(s,{children:e.jsx(c,{animation:"wave"})}),e.jsx(s,{align:"right",children:e.jsxs(r,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[e.jsx(c,{animation:"wave",variant:"circular",width:32,height:32}),e.jsx(c,{animation:"wave",variant:"circular",width:32,height:32})]})})]}),bt=()=>{const _=Ie(),[i,m]=u.useState(0),[x,A]=u.useState(10),[b,o]=u.useState(""),[j,O]=u.useState("All Categories"),[L,B]=u.useState("All Status"),[le,E]=u.useState(!1),[w,P]=u.useState(null),[R,ce]=u.useState(0),S=X(_e),H=X(Ae),{data:M=[],isLoading:de,refetch:G}=Te(),{data:U=[],isLoading:xe}=Le(),{mutateAsync:he}=Pe(),{data:Q=[],isLoading:ue}=De(),{data:je={},isLoading:me}=$e(),f=Y.useMemo(()=>M.map(t=>{const n=S.find(l=>l.id===t.product_id);return{...t,...n,status:pe(t.quantity,(n==null?void 0:n.reorder_level)||0)}}),[M,S]);Y.useMemo(()=>{const t=f.length,n=f.reduce((d,I)=>d+I.quantity*(I.cost_price||0),0),l=f.filter(d=>d.status==="low").length,p=f.filter(d=>d.quantity<=d.reorder_level*.7).length;return{totalItems:t,totalValue:n,lowStockItems:l,reorderNeeded:p,topSellingItems:5,incomingStock:42,inventoryTurnover:4.2,stockAccuracy:98.3}},[f]);const k=f.filter(t=>{var d,I,K;const n=((d=t.product_name)==null?void 0:d.toLowerCase().includes(b.toLowerCase()))||((I=t.product_code)==null?void 0:I.toLowerCase().includes(b.toLowerCase())),l=j==="All Categories"||((K=t.product_category_id)==null?void 0:K.toString())===j,p=L==="All Status"||t.status===L.toLowerCase();return n&&l&&p});function pe(t,n){return t<=n?"low":t>n*3?"overstocked":"normal"}const ye=()=>{o(""),O("All Categories"),B("All Status")},J=t=>{P(t),E(!0)},fe=t=>{P(t)},D=()=>{E(!1),P(null)},ge=async t=>{try{await he({id:t.id,quantity:t.quantity,adjustment_type:t.type,reason:t.reason,notes:t.notes}),se.success("Inventory adjustment recorded successfully"),G(),D()}catch(n){se.error("Error recording adjustment: "+(n.message||"Unknown error"))}},ve=(t,n)=>{ce(n)},be=t=>{_(`/app/inventory/${t}`)};return e.jsxs(Ne,{maxWidth:"xxl",sx:{mt:0,px:"0!important"},children:[e.jsx(Xe,{inventoryData:f,stats:je,isLoading:me}),e.jsxs(r,{sx:{mb:4},children:[e.jsxs(Re,{value:R,onChange:ve,sx:{mb:3},children:[e.jsx($,{label:"Current Inventory"}),e.jsx($,{label:"Adjustments History"}),e.jsx($,{label:"Inventory Logs"})]}),R===0&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,gap:2},children:[e.jsxs(r,{sx:{display:"flex",gap:2,flex:1},children:[e.jsx(We,{placeholder:"Search product name or code",variant:"outlined",size:"small",value:b,onChange:t=>o(t.target.value),InputProps:{startAdornment:e.jsx(ke,{position:"start",children:e.jsx(qe,{})})},sx:{minWidth:250}}),e.jsxs(Z,{size:"small",sx:{minWidth:200},children:[e.jsx(re,{children:"Category"}),e.jsxs(ne,{value:j,onChange:t=>O(t.target.value),label:"Category",children:[e.jsx(C,{value:"All Categories",children:"All Categories"}),H.map(t=>e.jsx(C,{value:t.id.toString(),children:t.name},t.id))]})]}),e.jsxs(Z,{size:"small",sx:{minWidth:200},children:[e.jsx(re,{children:"Stock Status"}),e.jsxs(ne,{value:L,onChange:t=>B(t.target.value),label:"Stock Status",children:[e.jsx(C,{value:"All Status",children:"All Status"}),e.jsx(C,{value:"Low",children:"Low Stock"}),e.jsx(C,{value:"Normal",children:"Normal"}),e.jsx(C,{value:"Overstocked",children:"Overstocked"})]})]})]}),e.jsxs(r,{children:[e.jsx(v,{variant:"text",color:"error",sx:{mr:1},onClick:ye,children:e.jsx(ze,{})}),e.jsx(v,{variant:"contained",color:"primary",startIcon:e.jsx(Ve,{}),onClick:()=>G(),sx:{mr:1},children:"Refresh"}),e.jsx(v,{variant:"contained",color:"error",startIcon:e.jsx(Oe,{}),onClick:()=>J({product_id:null}),children:"New Adjustment"})]})]}),k.some(t=>t.status==="low")&&e.jsx(Be,{severity:"warning",sx:{mb:2},icon:e.jsx(oe,{}),children:"Some products are below their reorder levels. Please check and restock as needed."}),e.jsx(N,{component:y,children:e.jsxs(W,{children:[e.jsx(q,{children:e.jsxs(h,{children:[e.jsx(s,{children:"Product Code"}),e.jsx(s,{children:"Product Name"}),e.jsx(s,{children:"Category"}),e.jsx(s,{children:"Current Qty"}),e.jsx(s,{children:"Reorder Level"}),e.jsx(s,{children:"Status"}),e.jsx(s,{align:"right",children:"Actions"})]})}),e.jsx(z,{children:de?Array.from(Array(x)).map((t,n)=>e.jsx(V,{},n)):k.length===0?e.jsx(h,{children:e.jsx(s,{colSpan:7,align:"center",sx:{py:3},children:e.jsx(a,{variant:"body1",color:"text.secondary",children:"No inventory items found"})})}):k.slice(i*x,i*x+x).map(t=>{var n,l,p;return e.jsxs(h,{hover:!0,children:[e.jsx(s,{children:t.product_code}),e.jsx(s,{children:e.jsx(r,{sx:{display:"flex",alignItems:"center"},children:t.product_name})}),e.jsx(s,{children:((n=H.find(d=>d.id===t.product_category_id))==null?void 0:n.name)||"-"}),e.jsx(s,{children:t.quantity}),e.jsx(s,{children:t.reorder_level}),e.jsx(s,{children:e.jsx(F,{label:(l=ie[t.status])==null?void 0:l.label,color:(p=ie[t.status])==null?void 0:p.color,size:"small"})}),e.jsxs(s,{align:"right",children:[e.jsx(ee,{title:"View Product Details",children:e.jsx(te,{onClick:()=>be(t.product_id),children:e.jsx(Ee,{})})}),e.jsx(ee,{title:"Adjust Inventory",children:e.jsx(te,{onClick:()=>J(t),children:e.jsx(He,{})})})]})]},t.product_id)})})]})}),e.jsxs(r,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:[e.jsx(v,{disabled:i===0,onClick:()=>m(i-1),sx:{mr:1},children:"Previous"}),e.jsx(v,{disabled:i>=Math.ceil(k.length/x)-1,onClick:()=>m(i+1),children:"Next"})]})]}),R===1&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(a,{variant:"h6",children:"Inventory Adjustments History"}),e.jsx(v,{variant:"outlined",startIcon:e.jsx(ae,{}),onClick:()=>console.log("Download adjustments report"),children:"Export Report"})]}),e.jsx(N,{component:y,children:e.jsxs(W,{children:[e.jsx(q,{children:e.jsxs(h,{children:[e.jsx(s,{children:"Date"}),e.jsx(s,{children:"Product"}),e.jsx(s,{children:"Adjustment Type"}),e.jsx(s,{children:"Quantity"}),e.jsx(s,{children:"Reason"}),e.jsx(s,{children:"Performed By"}),e.jsx(s,{children:"Notes"})]})}),e.jsx(z,{children:xe?Array.from(Array(x)).map((t,n)=>e.jsx(V,{},n)):U.length===0?e.jsx(h,{children:e.jsx(s,{colSpan:7,align:"center",sx:{py:3},children:e.jsx(a,{variant:"body1",color:"text.secondary",children:"No adjustment records found"})})}):U.map(t=>{var l;const n=S.find(p=>p.id===t.product_id);return e.jsxs(h,{hover:!0,children:[e.jsx(s,{children:new Date(t.created_at).toLocaleString()}),e.jsx(s,{children:(n==null?void 0:n.product_name)||"Unknown Product"}),e.jsx(s,{children:e.jsx(F,{label:t.adjustment_type.charAt(0).toUpperCase()+t.adjustment_type.slice(1),color:t.adjustment_type==="addition"||t.adjustment_type==="return"?"success":t.adjustment_type==="correction"?"info":"error",size:"small"})}),e.jsx(s,{children:t.adjustment_type==="addition"||t.adjustment_type==="return"?`+${t.quantity}`:`-${t.quantity}`}),e.jsx(s,{children:t.reason}),e.jsx(s,{children:((l=t.user)==null?void 0:l.name)||"System"}),e.jsx(s,{children:t.notes||"-"})]},t.id)})})]})})]}),R===2&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(a,{variant:"h6",children:"Inventory Transaction History"}),e.jsx(v,{variant:"outlined",startIcon:e.jsx(ae,{}),onClick:()=>console.log("Download logs report"),children:"Export Logs"})]}),e.jsx(N,{component:y,children:e.jsxs(W,{children:[e.jsx(q,{children:e.jsxs(h,{children:[e.jsx(s,{children:"Date"}),e.jsx(s,{children:"Product"}),e.jsx(s,{children:"Transaction Type"}),e.jsx(s,{children:"Quantity"}),e.jsx(s,{children:"Reference"}),e.jsx(s,{children:"Before"}),e.jsx(s,{children:"After"})]})}),e.jsx(z,{children:ue?Array.from(Array(x)).map((t,n)=>e.jsx(V,{},n)):Q.length===0?e.jsx(h,{children:e.jsx(s,{colSpan:7,align:"center",sx:{py:3},children:e.jsx(a,{variant:"body1",color:"text.secondary",children:"No inventory logs found"})})}):Q.map(t=>{const n=S.find(l=>l.id===t.product_id);return e.jsxs(h,{hover:!0,children:[e.jsx(s,{children:new Date(t.created_at).toLocaleString()}),e.jsx(s,{children:(n==null?void 0:n.product_name)||"Unknown Product"}),e.jsx(s,{children:e.jsx(F,{label:t.transaction_type.charAt(0).toUpperCase()+t.transaction_type.slice(1),color:t.transaction_type==="purchase"||t.transaction_type==="adjustment_in"?"success":t.transaction_type==="sales"||t.transaction_type==="adjustment_out"?"error":"info",size:"small"})}),e.jsx(s,{children:t.transaction_type==="purchase"||t.transaction_type==="adjustment_in"?`+${t.quantity}`:`-${t.quantity}`}),e.jsx(s,{children:t.reference_type==="purchase_order"?`PO-${t.reference_id}`:t.reference_type==="sales_order"?`SO-${t.reference_id}`:t.reference_type==="adjustment"?`ADJ-${t.reference_id}`:t.reference_id}),e.jsx(s,{children:t.quantity_before}),e.jsx(s,{children:t.quantity_after})]},t.id)})})]})})]})]}),e.jsxs(Me,{open:le,onClose:D,maxWidth:"md",fullWidth:!0,children:[e.jsx(Ge,{children:w!=null&&w.product_name?`Adjust Inventory: ${w.product_name}`:"New Inventory Adjustment"}),e.jsx(Ue,{children:e.jsx(Fe,{product:w,products:S,adjustmentTypes:Ye,onSubmit:ge,onCancel:D,onSelectedProduct:fe})})]})]})};export{bt as default};
