import{V as w,K as F,ak as O,r as h,j as e,M as S,Y as E,T as r,af as z,l as C,v as n,X as $,P as o,G as l,D as L,z as V}from"./index-VYacBzdn.js";import{f as d,a as P}from"./currencyFormat-BsuV9MhS.js";import{L as I}from"./Link-C_3rcFug.js";import{R as q}from"./HomeOutlined-BL0nYU_M.js";import{R as G}from"./TeamOutlined-Cr4RwS31.js";import{R as M}from"./LeftOutlined-BDNxeg2Q.js";import{b as U,c as K,d as Q,T as m,a as i,e as X}from"./TableRow-F8UK-irz.js";const te=()=>{var b,y,g,v,f,_;const{customerId:x}=w(),c=F(),{getCustomerPurchaseHistory:k}=O(),[B,j]=h.useState(!0),[a,R]=h.useState({customer:null,items:[]});h.useEffect(()=>{x&&(async()=>{try{j(!0);const s=await k(x);R(s)}catch(s){console.error("Error fetching purchase history:",s)}finally{j(!1)}})()},[x]);const u=a.items.reduce((t,s)=>(t[s.invoice_number]||(t[s.invoice_number]={sale_id:s.sale_id,invoice_number:s.invoice_number,order_date:s.order_date,delivery_date:s.delivery_date,status:s.status,items:[]}),t[s.invoice_number].items.push(s),t),{}),T=t=>{let s;switch(t){case"completed":s="success";break;case"pending":s="warning";break;case"cancelled":s="error";break;case"partially_paid":s="info";break;case"unpaid":s="default";break;default:s="default"}return e.jsx(V,{label:t.replace("_"," ").toUpperCase(),color:s,size:"small"})},p=t=>{c(`/app/delivery-report/${t}`)},A=()=>{c("/app/customer")},D=a.items.reduce((t,s)=>t+parseFloat(s.total),0),H=a.items.reduce((t,s)=>t+parseInt(s.quantity),0);return e.jsxs(S,{children:[e.jsxs(E,{sx:{mb:2},children:[e.jsxs(I,{underline:"hover",color:"inherit",sx:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>c("/app/dashboard"),children:[e.jsx(q,{style:{marginRight:8}}),"Dashboard"]}),e.jsxs(I,{underline:"hover",color:"inherit",sx:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>c("/app/customer"),children:[e.jsx(G,{style:{marginRight:8}}),"Customers"]}),e.jsxs(r,{color:"text.primary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(z,{style:{marginRight:8}}),"Purchase History"]})]}),e.jsx(C,{variant:"outlined",startIcon:e.jsx(M,{}),onClick:A,sx:{mb:3},children:"Back to Customers"}),B?e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px"},children:e.jsx($,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(o,{sx:{p:3,mb:4},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,children:"Customer Details"}),e.jsxs(l,{container:!0,spacing:2,children:[e.jsxs(l,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"subtitle1",children:"Name:"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:((b=a.customer)==null?void 0:b.customer_name)||"N/A"}),((y=a.customer)==null?void 0:y.business_name)&&e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"subtitle1",children:"Business:"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:a.customer.business_name})]}),e.jsx(r,{variant:"subtitle1",children:"Contact Number:"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:((g=a.customer)==null?void 0:g.contact_number)||"N/A"})]}),e.jsxs(l,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"subtitle1",children:"Email:"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:((v=a.customer)==null?void 0:v.email)||"N/A"}),e.jsx(r,{variant:"subtitle1",children:"Address:"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:((f=a.customer)==null?void 0:f.address)||"N/A"}),e.jsx(r,{variant:"subtitle1",children:"City:"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:((_=a.customer)==null?void 0:_.city)||"N/A"})]})]})]}),e.jsxs(o,{sx:{p:3,mb:4},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,children:"Purchase Summary"}),e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{item:!0,xs:12,sm:4,children:e.jsxs(n,{sx:{p:2,border:"1px solid #e0e0e0",borderRadius:1,textAlign:"center"},children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Total Orders"}),e.jsx(r,{variant:"h4",sx:{my:1},children:Object.keys(u).length})]})}),e.jsx(l,{item:!0,xs:12,sm:4,children:e.jsxs(n,{sx:{p:2,border:"1px solid #e0e0e0",borderRadius:1,textAlign:"center"},children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Total Items Purchased"}),e.jsx(r,{variant:"h4",sx:{my:1},children:H})]})}),e.jsx(l,{item:!0,xs:12,sm:4,children:e.jsxs(n,{sx:{p:2,border:"1px solid #e0e0e0",borderRadius:1,textAlign:"center"},children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Total Purchase Amount"}),e.jsx(r,{variant:"h4",sx:{my:1},children:d(D)})]})})]})]}),e.jsxs(o,{sx:{p:3},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,children:"Purchase History"}),Object.keys(u).length>0?Object.values(u).map(t=>e.jsxs(n,{sx:{mb:4},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(n,{children:[e.jsxs(r,{variant:"h6",sx:{color:"primary.main",cursor:"pointer"},onClick:()=>p(t.sale_id),children:["Invoice: ",t.invoice_number]}),e.jsxs(r,{variant:"body2",children:["Order Date: ",P(t.order_date)," | Delivery Date: ",P(t.delivery_date)]})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[T(t.status),e.jsx(C,{variant:"outlined",size:"small",onClick:()=>p(t.sale_id),children:"View Details"})]})]}),e.jsx(U,{component:o,variant:"outlined",children:e.jsxs(K,{size:"small",children:[e.jsx(Q,{children:e.jsxs(m,{children:[e.jsx(i,{children:"Product"}),e.jsx(i,{children:"Code"}),e.jsx(i,{align:"right",children:"Unit Price"}),e.jsx(i,{align:"center",children:"Quantity"}),e.jsx(i,{align:"right",children:"Discount"}),e.jsx(i,{align:"right",children:"Total"})]})}),e.jsxs(X,{children:[t.items.map(s=>e.jsxs(m,{children:[e.jsx(i,{children:s.product_name}),e.jsx(i,{children:s.product_code}),e.jsx(i,{align:"right",children:d(s.price)}),e.jsx(i,{align:"center",children:s.quantity}),e.jsxs(i,{align:"right",children:[parseFloat(s.discount).toFixed(2),"%"]}),e.jsx(i,{align:"right",children:d(s.total)})]},s.item_id)),e.jsxs(m,{children:[e.jsx(i,{colSpan:4}),e.jsx(i,{align:"right",children:e.jsx(r,{variant:"subtitle2",children:"Order Total:"})}),e.jsx(i,{align:"right",children:e.jsx(r,{variant:"subtitle2",children:d(t.items.reduce((s,N)=>s+parseFloat(N.total),0))})})]})]})]})}),e.jsx(L,{sx:{my:4}})]},t.invoice_number)):e.jsx(n,{sx:{p:4,textAlign:"center"},children:e.jsx(r,{variant:"body1",color:"text.secondary",children:"No purchase history found for this customer."})})]})]})]})};export{te as default};
