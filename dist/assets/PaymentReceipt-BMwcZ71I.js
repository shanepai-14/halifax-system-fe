import{r as f,ar as $,as as N,C as z,j as e,aK as q,a1 as _,b2 as O,b3 as U,b4 as Y,b5 as V,aZ as G,b6 as K,b7 as B,Y as C,b8 as W,b9 as L,K as u,ba as Q,bb as Z,bc as J,bd as X,be as ee,bf as te,a0 as D,F as T,L as x,T as s,P as H,U as o,N as se}from"./index-MFznN85Y.js";import{l as re}from"./index-Bcs7yvqa.js";import{C as ne}from"./Close-DO7wEk0s.js";import{f as w}from"./dateUtils-eAGKzorV.js";import{f as R}from"./currencyFormat-th2sljt-.js";import{R as ae}from"./PrinterOutlined-Bo66Gpy5.js";import{R as ce}from"./CloseOutlined-DFy-qra4.js";import{c as ie,d as oe,e as le,a as M,b as j,f as de}from"./TextField-DllOVEH5.js";var me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-40 824H232V687h97.9c11.6 32.8 32 62.3 59.1 84.7 34.5 28.5 78.2 44.3 123 44.3s88.5-15.7 123-44.3c27.1-22.4 47.5-51.9 59.1-84.7H792v-63H643.6l-5.2 24.7C626.4 708.5 573.2 752 512 752s-114.4-43.5-126.5-103.3l-5.2-24.7H232V136h560v752zM320 341h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0 160h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}}]},name:"container",theme:"outlined"},he=function(P,l){return f.createElement($,N({},P,{ref:l,icon:me}))},Re=f.forwardRef(he);const xe=z(e.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),ue=()=>{const c=q(),[P,l]=f.useState(!1),[g,p]=f.useState(null),b=_(O),r=_(U),n=_(Y),E=_(V),I=_(G),v=_(K);return{payments:b,currentPayment:r,isLoading:P||n,error:g||E,filters:I,stats:v,completePayment:async h=>{var i,a;try{const t=await C.put(`/payments/${h}/complete`);if(t.data.status==="success")return u.success("Payment marked as completed"),t.data.data;if(t.data.status==="info")return u.info(t.data.message),null}catch(t){throw console.error("Error completing payment:",t),u.error(((a=(i=t.response)==null?void 0:i.data)==null?void 0:a.message)||"Failed to complete payment"),t}},getAllPayments:async(h={})=>{var i,a;try{c(B());const t=await C.get("/payments",{params:h});return c(W(t.data.data)),t.data.data}catch(t){return console.error("Error fetching payments:",t),c(L(t.message)),u.error(((a=(i=t.response)==null?void 0:i.data)==null?void 0:a.message)||"Failed to fetch payments"),[]}},getPaymentById:async h=>{var i,a;try{c(B());const t=await C.get(`/payments/${h}`);return c(Q(t.data.data)),t.data.data}catch(t){return console.error("Error fetching payment:",t),c(L(t.message)),u.error(((a=(i=t.response)==null?void 0:i.data)==null?void 0:a.message)||"Failed to fetch payment"),null}},createPayment:async(h,i)=>{var a,t;try{l(!0),p(null),c(Z());const d=await C.post(`/payments/${h}`,i);return c(J(d.data.data)),u.success("Payment recorded successfully"),d.data.data}catch(d){throw console.error("Error creating payment:",d),p(d.message||"Failed to create payment"),c(X(d.message||"Failed to create payment")),u.error(((t=(a=d.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to record payment"),d}finally{l(!1)}},getPaymentHistory:async h=>{var i,a;try{return l(!0),p(null),(await C.get(`/payments/${h}/history`)).data.data}catch(t){return console.error("Error fetching payment history:",t),p(t.message||"Failed to fetch payment history"),u.error(((a=(i=t.response)==null?void 0:i.data)==null?void 0:a.message)||"Failed to fetch payment history"),[]}finally{l(!1)}},voidPayment:async(h,i)=>{var a,t;try{l(!0),p(null);const d=await C.put(`/payments/${h}/void`,{reason:i});return u.success("Payment voided successfully"),d.data.data}catch(d){throw console.error("Error voiding payment:",d),p(d.message||"Failed to void payment"),u.error(((t=(a=d.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to void payment"),d}finally{l(!1)}},getPaymentStats:async(h={})=>{var i,a;try{const t=await C.get("/payments/stats",{params:h});return c(ee(t.data.data)),t.data.data}catch(t){return console.error("Error fetching payment statistics:",t),u.error(((a=(i=t.response)==null?void 0:i.data)==null?void 0:a.message)||"Failed to fetch payment statistics"),null}},resetCurrentPayment:()=>{c(te())}}},pe=({payment:c,onSuccess:P,size:l="medium"})=>{const{completePayment:g}=ue(),[p,b]=f.useState(!1),[r,n]=f.useState(!1);if(!((c==null?void 0:c.status)==="pending"))return null;const I=()=>{b(!0)},v=()=>{b(!1)},A=async()=>{try{n(!0);const y=await g(c.id);if(y){const S={sale:{...y.sale},payment:{...y}};console.log("processedData",S),P(S)}}catch(y){console.error("Error in confirmation process:",y)}finally{n(!1),b(!1)}};return p?e.jsxs(e.Fragment,{children:[e.jsx(D,{title:"Yes, complete this payment",children:e.jsx(T,{variant:"contained",color:"success",size:l,onClick:A,disabled:r,startIcon:e.jsx(xe,{}),sx:{mr:1},children:r?"Processing...":"Yes"})}),e.jsx(D,{title:"No, cancel",children:e.jsx(T,{variant:"outlined",color:"error",size:l,onClick:v,disabled:r,startIcon:e.jsx(ne,{}),sx:{mr:1},children:"No"})})]}):e.jsx(T,{variant:"outlined",color:"primary",size:l,onClick:I,disabled:r,sx:{mr:1},children:"Complete"})},Te=({paymentRecord:c,onClose:P})=>{var v,A,y,S,F;const l=f.useRef(),[g,p]=f.useState(c),b=re.useReactToPrint({contentRef:l});if(!g||!g.payment||!g.sale)return null;const{payment:r,sale:n}=g,E=m=>({cash:"Cash",credit_card:"Credit Card",debit_card:"Debit Card",cheque:"Cheque",bank_transfer:"Bank Transfer",online:"Online Payment",mobile_payment:"Mobile Payment",store_credit:"Store Credit"})[m]||m,I=m=>{console.log("handlePaymentUpdated",m),p(m)};return e.jsxs(x,{sx:{p:2},children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(s,{variant:"h5",children:"Payment Receipt"}),e.jsxs(x,{children:[e.jsx(pe,{payment:r,onSuccess:I,size:"medium"}),e.jsx(T,{variant:"outlined",startIcon:e.jsx(ae,{}),onClick:b,sx:{mr:1},children:"Print"}),e.jsx(T,{variant:"outlined",startIcon:e.jsx(ce,{}),onClick:P,children:"Close"})]})]}),e.jsx(H,{elevation:0,sx:{mt:2},children:e.jsxs(x,{ref:l,sx:{p:4},children:[e.jsxs(x,{sx:{textAlign:"center",mb:2},children:[e.jsx(s,{variant:"h4",children:"PAYMENT RECEIPT"}),e.jsx(s,{variant:"h6",children:r.reference_number}),e.jsx(s,{variant:"body2",children:w(r.created_at)})]}),e.jsxs(o,{container:!0,spacing:2,sx:{mb:3},children:[e.jsxs(o,{item:!0,xs:6,md:6,children:[e.jsx(s,{children:"Halifax Glass & Aluminum Supply"}),e.jsx(s,{children:"Malagamot Road, Panacan"}),e.jsx(s,{children:"glasshalifax@gmail.com"}),e.jsx(s,{children:"0939 924 3876"})]}),e.jsxs(o,{item:!0,xs:6,md:6,sx:{textAlign:{xs:"right",md:"right"}},children:[e.jsxs(s,{children:[e.jsx("strong",{children:"Invoice #:"})," ",n.invoice_number]}),e.jsxs(s,{children:[e.jsx("strong",{children:"Order Date:"})," ",w(n.order_date)]}),e.jsxs(s,{children:[e.jsx("strong",{children:"Payment Status:"})," ",n.is_paid?"PAID":"PARTIALLY PAID"]})]})]}),e.jsxs(o,{container:!0,spacing:2,sx:{mb:3},children:[e.jsxs(o,{item:!0,xs:6,md:6,children:[e.jsx(s,{children:e.jsx("strong",{children:"Bill To:"})}),e.jsx(s,{children:((v=n.customer)==null?void 0:v.customer_name)||"Walk-in Customer"}),e.jsx(s,{children:((A=n.customer)==null?void 0:A.address)||n.address||"N/A"}),e.jsx(s,{children:((y=n.customer)==null?void 0:y.city)||n.city||"N/A"}),e.jsx(s,{children:((S=n.customer)==null?void 0:S.contact_number)||n.phone||"N/A"})]}),e.jsxs(o,{item:!0,xs:6,md:6,sx:{textAlign:{xs:"right",md:"right"}},children:[e.jsx(s,{children:e.jsx("strong",{children:"Payment Info:"})}),e.jsxs(s,{children:[e.jsx("strong",{children:"Method:"})," ",E(r.payment_method)]}),r.reference_number&&e.jsxs(s,{children:[e.jsx("strong",{children:"Reference #:"})," ",r.reference_number]}),r.payment_method==="cheque"&&e.jsxs(s,{children:[e.jsx("strong",{children:"Cheque Date"})," ",w(r.payment_date)]}),e.jsxs(s,{children:[e.jsx("strong",{children:"Received By:"})," ",((F=r.received_by)==null?void 0:F.customer_name)||"System"]}),e.jsxs(s,{children:[e.jsx("strong",{children:"Receipt Status:"})," ",r.status.charAt(0).toUpperCase()+r.status.slice(1)]})]})]}),e.jsxs(x,{sx:{mb:1},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Items Summary"}),e.jsx(ie,{component:H,variant:"outlined",children:e.jsxs(oe,{size:"small",children:[e.jsx(le,{children:e.jsxs(M,{children:[e.jsx(j,{children:"Item"}),e.jsx(j,{align:"right",children:"Qty"}),e.jsx(j,{align:"right",children:"Unit Price"}),e.jsx(j,{align:"right",children:"Subtotal"})]})}),e.jsx(de,{children:n.items.map(m=>{var k;return e.jsxs(M,{children:[e.jsx(j,{children:((k=m.product)==null?void 0:k.product_name)||`Product #${m.product_id}`}),e.jsx(j,{align:"right",children:m.quantity}),e.jsx(j,{align:"right",children:R(m.sold_price)}),e.jsx(j,{align:"right",children:R(m.total_sold_price)})]},m.id)})})]})})]}),e.jsx(se,{sx:{my:1}}),e.jsx(x,{sx:{mb:3},children:e.jsxs(o,{container:!0,spacing:1,children:[e.jsx(o,{item:!0,xs:6,children:e.jsx(s,{children:e.jsx("strong",{children:"Sale Total:"})})}),e.jsx(o,{item:!0,xs:6,sx:{textAlign:"right"},children:e.jsx(s,{children:R(n.total)})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(s,{children:e.jsx("strong",{children:"This Payment:"})})}),e.jsx(o,{item:!0,xs:6,sx:{textAlign:"right"},children:e.jsx(s,{sx:{fontWeight:"bold"},children:R(r.amount)})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(s,{children:e.jsx("strong",{children:"Remaining Balance:"})})}),e.jsx(o,{item:!0,xs:6,sx:{textAlign:"right"},children:e.jsx(s,{children:R(n.total-n.amount_received)})})]})}),(r.remarks||n.remarks)&&e.jsxs(x,{sx:{mb:3},children:[e.jsx(s,{gutterBottom:!0,children:"Notes:"}),e.jsx(s,{children:r.remarks||n.remarks})]}),e.jsx(x,{sx:{mt:4,pt:2},children:e.jsxs(o,{container:!0,spacing:6,children:[e.jsx(o,{item:!0,xs:6,children:e.jsx(x,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:e.jsx(s,{variant:"caption",children:"Customer Signature"})})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(x,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:e.jsx(s,{variant:"caption",children:"Authorized Signature"})})})]})}),e.jsx(x,{sx:{mt:4,textAlign:"center"},children:e.jsx(s,{children:"Thank you for your business!"})})]})})]})};export{Te as P,Re as R,ue as u};
