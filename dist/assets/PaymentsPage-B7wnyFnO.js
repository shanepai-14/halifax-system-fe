import{j as e,Q as Se,aA as De,S as Re,aU as we,r as d,G as r,C as b,x as y,T as a,q as f,E as U,I as F,F as X,P as Te,aV as ke,aW as Fe,aX as Ie,aY as Y,y as I}from"./index-BH4OZBNn.js";import{u as V,w as Ve}from"./xlsx-DjuO7_Ju.js";import{u as Me,R as Ae,P as We}from"./PaymentReceipt-BdLwKm-Q.js";import{a as _,b as s,T as C,S as J,c as ze,d as Ee,e as Oe,f as Be}from"./TextField-DF5xaGpt.js";import{S as c}from"./Skeleton-udNI9PE0.js";import{f as P,a as M}from"./currencyFormat-jXf0VaAX.js";import{C as qe}from"./Container-Ccg0UrpZ.js";import{R as $e}from"./SearchOutlined-CK5kM7w4.js";import{R as Le}from"./FilterOutlined-B7RjXU_G.js";import{I as Z,B as A}from"./InputLabel-BCuRqJ6g.js";import{M as x}from"./MenuItem-BzYG3h4A.js";import{R as Ne}from"./DeleteOutlined-Cvy3t7X2.js";import{T as Ge}from"./TablePagination-BG09ACF2.js";import{D as ee}from"./Dialog-y_FGqvyx.js";import"./index-B7bdO_rH.js";import"./Close-CC8NS6vF.js";import"./PrinterOutlined-BonXXaXm.js";import"./CloseOutlined-D7Yyhn4D.js";import"./LastPage-DzOnq2jV.js";const Ke=()=>e.jsxs(_,{children:[e.jsx(s,{children:e.jsx(c,{variant:"text",width:"90%",height:20})}),e.jsx(s,{children:e.jsx(c,{variant:"text",width:"90%",height:20})}),e.jsx(s,{children:e.jsx(c,{variant:"text",width:"90%",height:20})}),e.jsx(s,{children:e.jsx(c,{variant:"text",width:"90%",height:20})}),e.jsx(s,{children:e.jsx(c,{variant:"text",width:"90%",height:20})}),e.jsx(s,{align:"right",children:e.jsx(c,{variant:"text",width:"90%",height:20})}),e.jsx(s,{children:e.jsx(c,{variant:"rounded",width:70,height:22})}),e.jsx(s,{children:e.jsx(c,{variant:"text",width:"90%",height:20})}),e.jsx(s,{align:"right",children:e.jsx(c,{variant:"rounded",width:90,height:30})})]}),te=g=>({cash:"Cash",credit_card:"Credit Card",debit_card:"Debit Card",cheque:"Cheque",bank_transfer:"Bank Transfer",online:"Online Payment",mobile_payment:"Mobile Payment",store_credit:"Store Credit"})[g]||g,xt=()=>{var L,N,G,K;const g=Se(),m=De(),n=Re(we),{payments:l,isLoading:S,getAllPayments:se,getPaymentStats:ae,voidPayment:re}=Me(),[D,R]=d.useState(0),[v,ne]=d.useState(10),[ie,W]=d.useState(null),[oe,z]=d.useState(!1),[le,E]=d.useState(!1),[u,O]=d.useState(""),[j,B]=d.useState(null),[p,de]=d.useState({total_payments:0,total_amount:0,total_voided:0,voided_amount:0});d.useEffect(()=>{w()},[n.paymentMethodFilter,n.statusFilter,n.startDate,n.endDate]);const w=async()=>{const t={payment_method:n.paymentMethodFilter!=="all"?n.paymentMethodFilter:void 0,status:n.statusFilter!=="all"?n.statusFilter:void 0,date_from:n.startDate||void 0,date_to:n.endDate||void 0,search:n.searchTerm||void 0};await se(t);const o={date_from:t.date_from,date_to:t.date_to},h=await ae(o);h&&de(h)},ce=(t,o)=>{R(o)},he=t=>{ne(parseInt(t.target.value,10)),R(0)},xe=t=>{m(ke(t.target.value))},q=()=>{R(0),w()},me=t=>{t.key==="Enter"&&q()},ue=t=>{m(Fe(t.target.value))},je=t=>{m(Ie(t.target.value))},ve=t=>{m(Y({startDate:t.target.value,endDate:n.endDate}))},ge=t=>{m(Y({startDate:n.startDate,endDate:t.target.value}))},pe=t=>{g(`/app/delivery-report/${t}`)},be=t=>{const o={payment:t,sale:t.sale};W(o),z(!0)},$=()=>{z(!1),W(null)},ye=t=>{B(t),E(!0)},T=()=>{E(!1),O(""),B(null)},fe=async()=>{if(u.trim())try{await re(j.id,u),T(),w()}catch(t){console.error("Error voiding payment:",t)}},Ce=t=>t==="completed"?e.jsx(I,{label:"Completed",color:"success",size:"small"}):t==="voided"?e.jsx(I,{label:"Voided",color:"error",size:"small"}):e.jsx(I,{label:t,size:"small"}),Pe=()=>{if(!l||!l.data||l.data.length===0)return;const t=l.data.map(i=>{var H,Q;return{"Date & Time":M(i.payment_date),"Reference #":i.reference_number,"Invoice #":((H=i.sale)==null?void 0:H.invoice_number)||"",Customer:(Q=i.sale)!=null&&Q.customer?typeof i.sale.customer=="object"?i.sale.customer.customer_name:i.sale.customer:"Walk-in Customer",Method:te(i.payment_method),Amount:i.amount,Status:i.status,"Received By":typeof i.received_by=="object"?i.received_by.customer_name:i.received_by||"System"}}),o=V.json_to_sheet(t),h=V.book_new();V.book_append_sheet(h,o,"Payments");const _e=`Payments_Export_${new Date().toISOString().split("T")[0]}.xlsx`;Ve(h,_e)};return e.jsxs(qe,{maxWidth:"xxl",sx:{mt:0,p:"0!important"},children:[e.jsxs(r,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(r,{item:!0,xs:12,md:3,children:e.jsx(b,{children:e.jsxs(y,{children:[e.jsx(a,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:"Total Payments"}),e.jsx(a,{variant:"h4",children:p.total_payments||0}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"For the selected date range"})]})})}),e.jsx(r,{item:!0,xs:12,md:3,children:e.jsx(b,{children:e.jsxs(y,{children:[e.jsx(a,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:"Total Amount"}),e.jsx(a,{variant:"h4",children:P(p.total_amount||0)}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"For the selected date range"})]})})}),e.jsx(r,{item:!0,xs:12,md:3,children:e.jsx(b,{children:e.jsxs(y,{children:[e.jsx(a,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:"Voided Payments"}),e.jsx(a,{variant:"h4",children:p.total_voided||0}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"For the selected date range"})]})})}),e.jsx(r,{item:!0,xs:12,md:3,children:e.jsx(b,{children:e.jsxs(y,{children:[e.jsx(a,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:"Voided Amount"}),e.jsx(a,{variant:"h4",children:P(p.voided_amount||0)}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"For the selected date range"})]})})})]}),e.jsx(f,{sx:{mb:3},children:e.jsxs(r,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(r,{item:!0,xs:12,md:3,children:e.jsx(C,{fullWidth:!0,placeholder:"Search by reference or invoice",variant:"outlined",size:"small",value:n.searchTerm,onChange:xe,onKeyPress:me,InputProps:{startAdornment:e.jsx(U,{position:"start",children:e.jsx($e,{})}),endAdornment:e.jsx(U,{position:"end",children:e.jsx(F,{onClick:q,size:"small",children:e.jsx(Le,{})})})}})}),e.jsx(r,{item:!0,xs:6,md:2,children:e.jsxs(X,{fullWidth:!0,size:"small",children:[e.jsx(Z,{children:"Payment Method"}),e.jsxs(J,{value:n.paymentMethodFilter,onChange:ue,label:"Payment Method",children:[e.jsx(x,{value:"all",children:"All Methods"}),e.jsx(x,{value:"cod",children:"COD"}),e.jsx(x,{value:"cash",children:"Cash"}),e.jsx(x,{value:"cheque",children:"Cheque"}),e.jsx(x,{value:"online",children:"Online Payment"})]})]})}),e.jsx(r,{item:!0,xs:6,md:2,children:e.jsxs(X,{fullWidth:!0,size:"small",children:[e.jsx(Z,{children:"Status"}),e.jsxs(J,{value:n.statusFilter,onChange:je,label:"Status",children:[e.jsx(x,{value:"all",children:"All Status"}),e.jsx(x,{value:"completed",children:"Completed"}),e.jsx(x,{value:"voided",children:"Voided"})]})]})}),e.jsx(r,{item:!0,xs:6,md:2,children:e.jsx(C,{label:"Start Date",type:"date",value:n.startDate,onChange:ve,InputLabelProps:{shrink:!0},size:"small",fullWidth:!0})}),e.jsx(r,{item:!0,xs:6,md:2,children:e.jsx(C,{label:"End Date",type:"date",value:n.endDate,onChange:ge,InputLabelProps:{shrink:!0},size:"small",fullWidth:!0,inputProps:{min:n.startDate}})}),e.jsx(r,{item:!0,xs:6,md:1,children:e.jsx(A,{variant:"contained",size:"small",fullWidth:!0,onClick:Pe,children:"Export"})})]})}),e.jsx(ze,{component:Te,children:e.jsxs(Ee,{size:"small",children:[e.jsx(Oe,{children:e.jsxs(_,{children:[e.jsx(s,{children:"Date & Time"}),e.jsx(s,{children:"Reference #"}),e.jsx(s,{children:"Invoice #"}),e.jsx(s,{children:"Customer"}),e.jsx(s,{children:"Method"}),e.jsx(s,{align:"right",children:"Amount"}),e.jsx(s,{children:"Status"}),e.jsx(s,{children:"Received By"}),e.jsx(s,{align:"right",children:"Actions"})]})}),e.jsx(Be,{children:S?Array(v).fill(0).map((t,o)=>e.jsx(Ke,{},o)):l&&((L=l.data)==null?void 0:L.length)>0?(N=l.data)==null?void 0:N.slice(D*v,D*v+v).map(t=>{var o,h;return e.jsxs(_,{sx:{backgroundColor:t.status==="voided"?"#fff8f8":"inherit"},children:[e.jsx(s,{children:M(t.payment_date)}),e.jsx(s,{children:t.reference_number}),e.jsx(s,{children:e.jsx(a,{variant:"body2",sx:{cursor:"pointer",color:"primary.main","&:hover":{textDecoration:"underline"}},onClick:()=>{var k;return pe((k=t.sale)==null?void 0:k.id)},children:(o=t.sale)==null?void 0:o.invoice_number})}),e.jsx(s,{children:(h=t.sale)!=null&&h.customer?typeof t.sale.customer=="object"?t.sale.customer.customer_name:t.sale.customer:"Walk-in Customer"}),e.jsx(s,{children:te(t.payment_method)}),e.jsx(s,{align:"right",children:P(t.amount)}),e.jsx(s,{children:Ce(t.status)}),e.jsx(s,{children:typeof t.received_by=="object"?t.received_by.customer_name:t.received_by||"System"}),e.jsxs(s,{align:"right",children:[e.jsx(F,{size:"small",color:"primary",onClick:()=>be(t),title:"View Receipt",children:e.jsx(Ae,{})}),(t.status==="pending"||t.status==="completed")&&e.jsx(F,{size:"small",color:"error",onClick:()=>ye(t),title:"Void Payment",children:e.jsx(Ne,{})})]})]},t.id)}):e.jsx(_,{children:e.jsx(s,{colSpan:9,align:"center",children:e.jsx(a,{variant:"body1",sx:{py:2},children:"No payments found"})})})})]})}),e.jsx(Ge,{rowsPerPageOptions:[5,10,25,50],component:"div",count:l?(G=l.data)==null?void 0:G.length:0,rowsPerPage:v,page:D,onPageChange:ce,onRowsPerPageChange:he}),e.jsx(ee,{open:oe,onClose:$,maxWidth:"md",fullWidth:!0,children:e.jsx(We,{paymentRecord:ie,onClose:$})}),e.jsx(ee,{open:le,onClose:T,maxWidth:"sm",fullWidth:!0,children:e.jsxs(f,{sx:{p:3},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Void Payment"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"Are you sure you want to void this payment? This action cannot be undone."}),j&&e.jsx(f,{sx:{mb:3,p:2,bgcolor:"background.level1",borderRadius:1},children:e.jsxs(r,{container:!0,spacing:1,children:[e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",children:e.jsx("strong",{children:"Reference:"})})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",children:j.reference_number})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",children:e.jsx("strong",{children:"Invoice:"})})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",children:(K=j.sale)==null?void 0:K.invoice_number})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",children:e.jsx("strong",{children:"Amount:"})})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",children:P(j.amount)})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",children:e.jsx("strong",{children:"Date:"})})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",children:M(j.payment_date)})})]})}),e.jsx(C,{label:"Reason for voiding payment",fullWidth:!0,multiline:!0,rows:3,value:u,onChange:t=>O(t.target.value),required:!0,error:!u.trim(),helperText:u.trim()?"":"Reason is required",margin:"normal",sx:{mb:2}}),e.jsxs(f,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:[e.jsx(A,{onClick:T,sx:{mr:1},children:"Cancel"}),e.jsx(A,{variant:"contained",color:"error",onClick:fe,disabled:!u.trim()||S,children:S?"Processing...":"Void Payment"})]})]})})]})};export{xt as default};
