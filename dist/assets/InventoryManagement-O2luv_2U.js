import{r as i,a8 as q,a9 as B,j as e,aa as Ie,q as l,G as X,P as k,T as u,y as R,ab as Ce,D as Z,ac as we,H as M,Q as _e,S as ee,V as Ae,ad as ke,R as te,ae as Re,af as P,E as Te,F as ne,I as re,t as se}from"./index-Chkw8LpN.js";import{u as Le,a as $e,b as Pe,c as Ve,I as De}from"./useInventory-FRN0DOhl.js";import{R as ce}from"./WarningOutlined-3Nvk1Rhg.js";import{R as ze}from"./MoneyCollectOutlined-De_mapm4.js";import{C as Oe}from"./Container-BmsYVYg_.js";import{T as Ne,S as oe,c as V,d as D,e as z,a as x,b as n,f as O}from"./TextField-Czzb7ycq.js";import{R as Me}from"./SearchOutlined-K4PNmaK5.js";import{I as ae,B as y}from"./InputLabel-aB29g19v.js";import{M as f}from"./MenuItem-DKP--nxm.js";import{R as qe}from"./ClearOutlined-DihZjiGe.js";import{R as Be,a as le}from"./ReloadOutlined-CEK2A_kA.js";import{R as Fe}from"./PlusOutlined-1JNR4_VJ.js";import{A as Ee}from"./Alert-QgAfafU6.js";import{R as He}from"./EyeOutlined-D0GiIrrB.js";import{R as We}from"./EditOutlined-jQCM4PCc.js";import{D as Ue}from"./Dialog-ACxKU5r-.js";import{D as Ge,a as Qe}from"./DialogTitle-Ch3X7RlB.js";import{S as j}from"./Skeleton-6YVSzGd4.js";import"./Autocomplete-LFVe6RBn.js";import"./CloseOutlined-B2N1Ghrl.js";import"./SaveOutlined-Cm8_oIR-.js";var Je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z"}}]},name:"info-circle",theme:"outlined"},Ye=function(s,o){return i.createElement(q,B({},s,{ref:o,icon:Je}))},Ke=i.forwardRef(Ye),Xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M859.9 780H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM505.7 669a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V176c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8z"}}]},name:"vertical-align-bottom",theme:"outlined"},Ze=function(s,o){return i.createElement(q,B({},s,{ref:o,icon:Xe}))},et=i.forwardRef(Ze),tt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M859.9 168H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM518.3 355a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V848c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V509.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 355z"}}]},name:"vertical-align-top",theme:"outlined"},nt=function(s,o){return i.createElement(q,B({},s,{ref:o,icon:tt}))},rt=i.forwardRef(nt);const st=({inventoryData:g=[],stats:s={}})=>{const o={totalItems:s.totalItems||1254,totalValue:s.totalValue||187650.75,lowStockItems:s.lowStockItems||23,topSellingItems:s.topSellingItems||5,reorderNeeded:s.reorderNeeded||18,incomingStock:s.incomingStock||42,inventoryTurnover:s.inventoryTurnover||4.2,stockAccuracy:s.stockAccuracy||98.3},h=[{title:"Total Inventory",value:o.totalItems,icon:e.jsx(Ie,{style:{fontSize:24}}),color:"#1976d2",secondaryValue:`$${o.totalValue.toLocaleString("en-US",{maximumFractionDigits:2})}`,secondaryLabel:"Total Value"},{title:"Low Stock Items",value:o.lowStockItems,icon:e.jsx(ce,{style:{fontSize:24}}),color:"#f44336",secondaryValue:o.reorderNeeded,secondaryLabel:"Require Immediate Reorder",chip:{label:`${o.lowStockItems} items below threshold`,color:"error"}},{title:"Inventory Performance",value:`${o.stockAccuracy}%`,icon:e.jsx(Ke,{style:{fontSize:24}}),color:"#4caf50",progress:o.stockAccuracy,secondaryValue:o.inventoryTurnover,secondaryLabel:"Turnover Rate"},{title:"Stock Movement",value:o.topSellingItems,icon:e.jsx(ze,{style:{fontSize:24}}),color:"#ff9800",secondaryValue:o.incomingStock,secondaryLabel:"Incoming Stock",stats:[{label:"Outgoing",value:28,icon:e.jsx(rt,{})},{label:"Incoming",value:42,icon:e.jsx(et,{})}]}];return e.jsx(l,{sx:{mb:4},children:e.jsx(X,{container:!0,spacing:3,children:h.map((a,b)=>e.jsx(X,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(k,{elevation:1,sx:{p:2,height:"100%",borderTop:`4px solid ${a.color}`,borderRadius:"4px",transition:"transform 0.3s, box-shadow 0.3s","&:hover":{transform:"translateY(-3px)",boxShadow:3}},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[e.jsx(u,{variant:"subtitle2",color:"text.secondary",children:a.title}),e.jsx(l,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:40,height:40,borderRadius:"50%",backgroundColor:`${a.color}20`},children:e.jsx(l,{sx:{color:a.color},children:a.icon})})]}),e.jsx(u,{variant:"h4",sx:{fontWeight:"bold",color:a.color,mb:1},children:a.value}),a.chip&&e.jsx(R,{label:a.chip.label,color:a.chip.color,size:"small",sx:{my:1}}),a.progress&&e.jsx(l,{sx:{mb:1},children:e.jsx(Ce,{variant:"determinate",value:a.progress,sx:{height:8,borderRadius:4,backgroundColor:`${a.color}30`,"& .MuiLinearProgress-bar":{backgroundColor:a.color}}})}),a.stats?e.jsxs(l,{sx:{mt:2},children:[e.jsx(Z,{sx:{my:1}}),e.jsx(we,{direction:"row",spacing:2,justifyContent:"space-between",children:a.stats.map((v,S)=>e.jsx(M,{title:v.label,children:e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(l,{sx:{mr:.5,color:"text.secondary"},children:v.icon}),e.jsx(u,{variant:"body2",children:v.value})]})},S))})]}):e.jsxs(l,{sx:{mt:"auto"},children:[e.jsx(Z,{sx:{my:1}}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(u,{variant:"body2",color:"text.secondary",children:a.secondaryLabel}),e.jsx(u,{variant:"body1",fontWeight:"medium",children:a.secondaryValue})]})]})]})},b))})})},ie={low:{color:"error",label:"Low Stock"},normal:{color:"success",label:"Normal"},overstocked:{color:"warning",label:"Overstocked"}},ot=[{value:"addition",label:"Addition"},{value:"reduction",label:"Reduction"},{value:"damage",label:"Damage"},{value:"loss",label:"Loss"},{value:"correction",label:"Correction"}],N=()=>e.jsxs(x,{children:[e.jsx(n,{children:e.jsx(j,{animation:"wave"})}),e.jsx(n,{children:e.jsx(j,{animation:"wave"})}),e.jsx(n,{children:e.jsx(j,{animation:"wave"})}),e.jsx(n,{children:e.jsx(j,{animation:"wave"})}),e.jsx(n,{children:e.jsx(j,{animation:"wave"})}),e.jsx(n,{children:e.jsx(j,{animation:"wave"})}),e.jsx(n,{align:"right",children:e.jsxs(l,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[e.jsx(j,{animation:"wave",variant:"circular",width:32,height:32}),e.jsx(j,{animation:"wave",variant:"circular",width:32,height:32})]})})]}),At=()=>{const g=_e(),[s,o]=i.useState(0),[h,a]=i.useState(10),[b,v]=i.useState(""),[S,F]=i.useState("All Categories"),[T,E]=i.useState("All Status"),[de,H]=i.useState(!1),[I,L]=i.useState(null),[_,xe]=i.useState(0),C=ee(Ae),W=ee(ke),{data:U=[],isLoading:ue,refetch:G}=Le(),{data:Q=[],isLoading:he}=$e(),{mutateAsync:me}=Pe(),{data:J=[],isLoading:je}=Ve(),p=te.useMemo(()=>U.map(t=>{const r=C.find(c=>c.id===t.product_id);return{...t,...r,status:ye(t.quantity,(r==null?void 0:r.reorder_level)||0)}}),[U,C]),pe=te.useMemo(()=>{const t=p.length,r=p.reduce((d,w)=>d+w.quantity*(w.cost_price||0),0),c=p.filter(d=>d.status==="low").length,m=p.filter(d=>d.quantity<=d.reorder_level*.7).length;return{totalItems:t,totalValue:r,lowStockItems:c,reorderNeeded:m,topSellingItems:5,incomingStock:42,inventoryTurnover:4.2,stockAccuracy:98.3}},[p]),A=p.filter(t=>{var d,w,K;const r=((d=t.product_name)==null?void 0:d.toLowerCase().includes(b.toLowerCase()))||((w=t.product_code)==null?void 0:w.toLowerCase().includes(b.toLowerCase())),c=S==="All Categories"||((K=t.product_category_id)==null?void 0:K.toString())===S,m=T==="All Status"||t.status===T.toLowerCase();return r&&c&&m});function ye(t,r){return t<=r?"low":t>r*3?"overstocked":"normal"}const ve=()=>{v(""),F("All Categories"),E("All Status")},Y=t=>{L(t),H(!0)},fe=t=>{L(t)},$=()=>{H(!1),L(null)},ge=async t=>{try{await me({id:t.id,quantity:t.quantity,adjustment_type:t.type,reason:t.reason,notes:t.notes}),se.success("Inventory adjustment recorded successfully"),G(),$()}catch(r){se.error("Error recording adjustment: "+(r.message||"Unknown error"))}},be=(t,r)=>{xe(r)},Se=t=>{g(`/app/inventory/${t}`)};return e.jsxs(Oe,{maxWidth:"xxl",sx:{mt:0,px:"0!important"},children:[e.jsx(st,{inventoryData:p,stats:pe}),e.jsxs(l,{sx:{mb:4},children:[e.jsxs(Re,{value:_,onChange:be,sx:{mb:3},children:[e.jsx(P,{label:"Current Inventory"}),e.jsx(P,{label:"Adjustments History"}),e.jsx(P,{label:"Inventory Logs"})]}),_===0&&e.jsxs(e.Fragment,{children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,gap:2},children:[e.jsxs(l,{sx:{display:"flex",gap:2,flex:1},children:[e.jsx(Ne,{placeholder:"Search product name or code",variant:"outlined",size:"small",value:b,onChange:t=>v(t.target.value),InputProps:{startAdornment:e.jsx(Te,{position:"start",children:e.jsx(Me,{})})},sx:{minWidth:250}}),e.jsxs(ne,{size:"small",sx:{minWidth:200},children:[e.jsx(ae,{children:"Category"}),e.jsxs(oe,{value:S,onChange:t=>F(t.target.value),label:"Category",children:[e.jsx(f,{value:"All Categories",children:"All Categories"}),W.map(t=>e.jsx(f,{value:t.id.toString(),children:t.name},t.id))]})]}),e.jsxs(ne,{size:"small",sx:{minWidth:200},children:[e.jsx(ae,{children:"Stock Status"}),e.jsxs(oe,{value:T,onChange:t=>E(t.target.value),label:"Stock Status",children:[e.jsx(f,{value:"All Status",children:"All Status"}),e.jsx(f,{value:"Low",children:"Low Stock"}),e.jsx(f,{value:"Normal",children:"Normal"}),e.jsx(f,{value:"Overstocked",children:"Overstocked"})]})]})]}),e.jsxs(l,{children:[e.jsx(y,{variant:"text",color:"error",sx:{mr:1},onClick:ve,children:e.jsx(qe,{})}),e.jsx(y,{variant:"contained",color:"primary",startIcon:e.jsx(Be,{}),onClick:()=>G(),sx:{mr:1},children:"Refresh"}),e.jsx(y,{variant:"contained",color:"error",startIcon:e.jsx(Fe,{}),onClick:()=>Y({product_id:null}),children:"New Adjustment"})]})]}),A.some(t=>t.status==="low")&&e.jsx(Ee,{severity:"warning",sx:{mb:2},icon:e.jsx(ce,{}),children:"Some products are below their reorder levels. Please check and restock as needed."}),e.jsx(V,{component:k,children:e.jsxs(D,{children:[e.jsx(z,{children:e.jsxs(x,{children:[e.jsx(n,{children:"Product Code"}),e.jsx(n,{children:"Product Name"}),e.jsx(n,{children:"Category"}),e.jsx(n,{children:"Current Qty"}),e.jsx(n,{children:"Reorder Level"}),e.jsx(n,{children:"Status"}),e.jsx(n,{align:"right",children:"Actions"})]})}),e.jsx(O,{children:ue?Array.from(Array(h)).map((t,r)=>e.jsx(N,{},r)):A.length===0?e.jsx(x,{children:e.jsx(n,{colSpan:7,align:"center",sx:{py:3},children:e.jsx(u,{variant:"body1",color:"text.secondary",children:"No inventory items found"})})}):A.slice(s*h,s*h+h).map(t=>{var r,c,m;return e.jsxs(x,{hover:!0,children:[e.jsx(n,{children:t.product_code}),e.jsx(n,{children:e.jsx(l,{sx:{display:"flex",alignItems:"center"},children:t.product_name})}),e.jsx(n,{children:((r=W.find(d=>d.id===t.product_category_id))==null?void 0:r.name)||"-"}),e.jsx(n,{children:t.quantity}),e.jsx(n,{children:t.reorder_level}),e.jsx(n,{children:e.jsx(R,{label:(c=ie[t.status])==null?void 0:c.label,color:(m=ie[t.status])==null?void 0:m.color,size:"small"})}),e.jsxs(n,{align:"right",children:[e.jsx(M,{title:"View Product Details",children:e.jsx(re,{onClick:()=>Se(t.product_id),children:e.jsx(He,{})})}),e.jsx(M,{title:"Adjust Inventory",children:e.jsx(re,{onClick:()=>Y(t),children:e.jsx(We,{})})})]})]},t.product_id)})})]})}),e.jsxs(l,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:[e.jsx(y,{disabled:s===0,onClick:()=>o(s-1),sx:{mr:1},children:"Previous"}),e.jsx(y,{disabled:s>=Math.ceil(A.length/h)-1,onClick:()=>o(s+1),children:"Next"})]})]}),_===1&&e.jsxs(e.Fragment,{children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(u,{variant:"h6",children:"Inventory Adjustments History"}),e.jsx(y,{variant:"outlined",startIcon:e.jsx(le,{}),onClick:()=>console.log("Download adjustments report"),children:"Export Report"})]}),e.jsx(V,{component:k,children:e.jsxs(D,{children:[e.jsx(z,{children:e.jsxs(x,{children:[e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Product"}),e.jsx(n,{children:"Adjustment Type"}),e.jsx(n,{children:"Quantity"}),e.jsx(n,{children:"Reason"}),e.jsx(n,{children:"Performed By"}),e.jsx(n,{children:"Notes"})]})}),e.jsx(O,{children:he?Array.from(Array(h)).map((t,r)=>e.jsx(N,{},r)):Q.length===0?e.jsx(x,{children:e.jsx(n,{colSpan:7,align:"center",sx:{py:3},children:e.jsx(u,{variant:"body1",color:"text.secondary",children:"No adjustment records found"})})}):Q.map(t=>{var c;const r=C.find(m=>m.id===t.product_id);return e.jsxs(x,{hover:!0,children:[e.jsx(n,{children:new Date(t.created_at).toLocaleString()}),e.jsx(n,{children:(r==null?void 0:r.product_name)||"Unknown Product"}),e.jsx(n,{children:e.jsx(R,{label:t.adjustment_type.charAt(0).toUpperCase()+t.adjustment_type.slice(1),color:t.adjustment_type==="addition"||t.adjustment_type==="return"?"success":t.adjustment_type==="correction"?"info":"error",size:"small"})}),e.jsx(n,{children:t.adjustment_type==="addition"||t.adjustment_type==="return"?`+${t.quantity}`:`-${t.quantity}`}),e.jsx(n,{children:t.reason}),e.jsx(n,{children:((c=t.user)==null?void 0:c.name)||"System"}),e.jsx(n,{children:t.notes||"-"})]},t.id)})})]})})]}),_===2&&e.jsxs(e.Fragment,{children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(u,{variant:"h6",children:"Inventory Transaction History"}),e.jsx(y,{variant:"outlined",startIcon:e.jsx(le,{}),onClick:()=>console.log("Download logs report"),children:"Export Logs"})]}),e.jsx(V,{component:k,children:e.jsxs(D,{children:[e.jsx(z,{children:e.jsxs(x,{children:[e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Product"}),e.jsx(n,{children:"Transaction Type"}),e.jsx(n,{children:"Quantity"}),e.jsx(n,{children:"Reference"}),e.jsx(n,{children:"Before"}),e.jsx(n,{children:"After"})]})}),e.jsx(O,{children:je?Array.from(Array(h)).map((t,r)=>e.jsx(N,{},r)):J.length===0?e.jsx(x,{children:e.jsx(n,{colSpan:7,align:"center",sx:{py:3},children:e.jsx(u,{variant:"body1",color:"text.secondary",children:"No inventory logs found"})})}):J.map(t=>{const r=C.find(c=>c.id===t.product_id);return e.jsxs(x,{hover:!0,children:[e.jsx(n,{children:new Date(t.created_at).toLocaleString()}),e.jsx(n,{children:(r==null?void 0:r.product_name)||"Unknown Product"}),e.jsx(n,{children:e.jsx(R,{label:t.transaction_type.charAt(0).toUpperCase()+t.transaction_type.slice(1),color:t.transaction_type==="purchase"||t.transaction_type==="adjustment_in"?"success":t.transaction_type==="sales"||t.transaction_type==="adjustment_out"?"error":"info",size:"small"})}),e.jsx(n,{children:t.transaction_type==="purchase"||t.transaction_type==="adjustment_in"?`+${t.quantity}`:`-${t.quantity}`}),e.jsx(n,{children:t.reference_type==="purchase_order"?`PO-${t.reference_id}`:t.reference_type==="sales_order"?`SO-${t.reference_id}`:t.reference_type==="adjustment"?`ADJ-${t.reference_id}`:t.reference_id}),e.jsx(n,{children:t.quantity_before}),e.jsx(n,{children:t.quantity_after})]},t.id)})})]})})]})]}),e.jsxs(Ue,{open:de,onClose:$,maxWidth:"md",fullWidth:!0,children:[e.jsx(Ge,{children:I!=null&&I.product_name?`Adjust Inventory: ${I.product_name}`:"New Inventory Adjustment"}),e.jsx(Qe,{children:e.jsx(De,{product:I,products:C,adjustmentTypes:ot,onSubmit:ge,onCancel:$,onSelectedProduct:fe})})]})]})};export{At as default};
