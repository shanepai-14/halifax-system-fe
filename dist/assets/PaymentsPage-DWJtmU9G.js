import{j as e,K as De,aD as Re,Z as we,aW as Te,r as d,G as a,C as b,y as f,T as r,v as y,F as X,I as F,H as Y,l as I,P as ke,aX as Fe,aY as Ie,aZ as Me,a_ as J,z as M}from"./index-VYacBzdn.js";import{u as V,w as Ve}from"./xlsx-DjuO7_Ju.js";import{u as We,R as ze,P as Ae}from"./PaymentReceipt-CFPKKNoV.js";import{T as P,a as s,b as Ee,c as Oe,d as $e,e as Be}from"./TableRow-F8UK-irz.js";import{S as c}from"./Skeleton-wlVAb656.js";import{f as C,b as Q,a as W}from"./currencyFormat-BsuV9MhS.js";import{C as qe}from"./Container-g1D49Be8.js";import{T as _,S as U}from"./TextField-DcFzWKp_.js";import{R as Le}from"./SearchOutlined-CuhT5l3w.js";import{R as Ke}from"./FilterOutlined-9wKfeoPR.js";import{I as ee}from"./InputLabel-Cn1m3Ebo.js";import{M as x}from"./MenuItem--hotehpj.js";import{R as Ne}from"./DeleteOutlined-CknXjhA9.js";import{T as Ge}from"./TablePagination-Dq0YRuKk.js";import{D as te}from"./Dialog-KIaZwdXs.js";import"./index-akne5vGV.js";import"./Close-C8KEn5ze.js";import"./PrinterOutlined-Dc6m45c5.js";import"./CloseOutlined-BzQ1yUQH.js";import"./KeyboardArrowRight-CWBZhDWc.js";import"./LastPage-DIxfCoDv.js";const He=()=>e.jsxs(P,{children:[e.jsx(s,{children:e.jsx(c,{variant:"text",width:"90%",height:20})}),e.jsx(s,{children:e.jsx(c,{variant:"text",width:"90%",height:20})}),e.jsx(s,{children:e.jsx(c,{variant:"text",width:"90%",height:20})}),e.jsx(s,{children:e.jsx(c,{variant:"text",width:"90%",height:20})}),e.jsx(s,{children:e.jsx(c,{variant:"text",width:"90%",height:20})}),e.jsx(s,{align:"right",children:e.jsx(c,{variant:"text",width:"90%",height:20})}),e.jsx(s,{children:e.jsx(c,{variant:"rounded",width:70,height:22})}),e.jsx(s,{children:e.jsx(c,{variant:"text",width:"90%",height:20})}),e.jsx(s,{align:"right",children:e.jsx(c,{variant:"rounded",width:90,height:30})})]}),se=g=>({cash:"Cash",credit_card:"Credit Card",debit_card:"Debit Card",cheque:"Cheque",bank_transfer:"Bank Transfer",online:"Online Payment",mobile_payment:"Mobile Payment",store_credit:"Store Credit"})[g]||g,jt=()=>{var L,K,N,G;const g=De(),m=Re(),n=we(Te),{payments:l,isLoading:S,getAllPayments:re,getPaymentStats:ae,voidPayment:ne}=We(),[D,R]=d.useState(0),[v,ie]=d.useState(10),[oe,z]=d.useState(null),[le,A]=d.useState(!1),[de,E]=d.useState(!1),[u,O]=d.useState(""),[j,$]=d.useState(null),[p,ce]=d.useState({total_payments:0,total_amount:0,total_voided:0,voided_amount:0});d.useEffect(()=>{w()},[n.paymentMethodFilter,n.statusFilter,n.startDate,n.endDate]);const w=async()=>{const t={payment_method:n.paymentMethodFilter!=="all"?n.paymentMethodFilter:void 0,status:n.statusFilter!=="all"?n.statusFilter:void 0,date_from:n.startDate||void 0,date_to:n.endDate||void 0,search:n.searchTerm||void 0};await re(t);const o={date_from:t.date_from,date_to:t.date_to},h=await ae(o);h&&ce(h)},he=(t,o)=>{R(o)},xe=t=>{ie(parseInt(t.target.value,10)),R(0)},me=t=>{m(Fe(t.target.value))},B=()=>{R(0),w()},ue=t=>{t.key==="Enter"&&B()},je=t=>{m(Ie(t.target.value))},ve=t=>{m(Me(t.target.value))},ge=t=>{m(J({startDate:t.target.value,endDate:n.endDate}))},pe=t=>{m(J({startDate:n.startDate,endDate:t.target.value}))},be=t=>{g(`/app/delivery-report/${t}`)},fe=t=>{const o={payment:t,sale:t.sale};z(o),A(!0)},q=()=>{A(!1),z(null)},ye=t=>{$(t),E(!0)},T=()=>{E(!1),O(""),$(null)},Ce=async()=>{if(u.trim())try{await ne(j.id,u),T(),w()}catch(t){console.error("Error voiding payment:",t)}},_e=t=>t==="completed"?e.jsx(M,{label:"Completed",color:"success",size:"small"}):t==="voided"?e.jsx(M,{label:"Voided",color:"error",size:"small"}):e.jsx(M,{label:t,size:"small"}),Pe=()=>{if(!l||!l.data||l.data.length===0)return;const t=l.data.map(i=>{var H,Z;return{"Date & Time":Q(i.created_at),"Reference #":`${i.reference_number} (${W(i.payment_date)??""})`,"Invoice #":((H=i.sale)==null?void 0:H.invoice_number)||"",Customer:(Z=i.sale)!=null&&Z.customer?typeof i.sale.customer=="object"?i.sale.customer.customer_name:i.sale.customer:"Walk-in Customer",Method:se(i.payment_method),Amount:i.amount,Status:i.status,"Received By":typeof i.received_by=="object"?i.received_by.customer_name:i.received_by||"System"}}),o=V.json_to_sheet(t),h=V.book_new();V.book_append_sheet(h,o,"Payments");const Se=`Payments_Export_${new Date().toISOString().split("T")[0]}.xlsx`;Ve(h,Se)};return e.jsxs(qe,{maxWidth:"xxl",sx:{mt:0,p:"0!important"},children:[e.jsxs(a,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(b,{children:e.jsxs(f,{children:[e.jsx(r,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:"Total Payments"}),e.jsx(r,{variant:"h4",children:p.total_payments||0}),e.jsx(r,{variant:"caption",color:"text.secondary",children:"For the selected date range"})]})})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(b,{children:e.jsxs(f,{children:[e.jsx(r,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:"Total Amount"}),e.jsx(r,{variant:"h4",children:C(p.total_amount||0)}),e.jsx(r,{variant:"caption",color:"text.secondary",children:"For the selected date range"})]})})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(b,{children:e.jsxs(f,{children:[e.jsx(r,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:"Voided Payments"}),e.jsx(r,{variant:"h4",children:p.total_voided||0}),e.jsx(r,{variant:"caption",color:"text.secondary",children:"For the selected date range"})]})})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(b,{children:e.jsxs(f,{children:[e.jsx(r,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:"Voided Amount"}),e.jsx(r,{variant:"h4",children:C(p.voided_amount||0)}),e.jsx(r,{variant:"caption",color:"text.secondary",children:"For the selected date range"})]})})})]}),e.jsx(y,{sx:{mb:3},children:e.jsxs(a,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(_,{fullWidth:!0,placeholder:"Search by reference or invoice",variant:"outlined",size:"small",value:n.searchTerm,onChange:me,onKeyPress:ue,InputProps:{startAdornment:e.jsx(X,{position:"start",children:e.jsx(Le,{})}),endAdornment:e.jsx(X,{position:"end",children:e.jsx(F,{onClick:B,size:"small",children:e.jsx(Ke,{})})})}})}),e.jsx(a,{item:!0,xs:6,md:2,children:e.jsxs(Y,{fullWidth:!0,size:"small",children:[e.jsx(ee,{children:"Payment Method"}),e.jsxs(U,{value:n.paymentMethodFilter,onChange:je,label:"Payment Method",children:[e.jsx(x,{value:"all",children:"All Methods"}),e.jsx(x,{value:"cod",children:"COD"}),e.jsx(x,{value:"cash",children:"Cash"}),e.jsx(x,{value:"cheque",children:"Cheque"}),e.jsx(x,{value:"online",children:"Online Payment"})]})]})}),e.jsx(a,{item:!0,xs:6,md:2,children:e.jsxs(Y,{fullWidth:!0,size:"small",children:[e.jsx(ee,{children:"Status"}),e.jsxs(U,{value:n.statusFilter,onChange:ve,label:"Status",children:[e.jsx(x,{value:"all",children:"All Status"}),e.jsx(x,{value:"completed",children:"Completed"}),e.jsx(x,{value:"voided",children:"Voided"})]})]})}),e.jsx(a,{item:!0,xs:6,md:2,children:e.jsx(_,{label:"Start Date",type:"date",value:n.startDate,onChange:ge,InputLabelProps:{shrink:!0},size:"small",fullWidth:!0})}),e.jsx(a,{item:!0,xs:6,md:2,children:e.jsx(_,{label:"End Date",type:"date",value:n.endDate,onChange:pe,InputLabelProps:{shrink:!0},size:"small",fullWidth:!0,inputProps:{min:n.startDate}})}),e.jsx(a,{item:!0,xs:6,md:1,children:e.jsx(I,{variant:"contained",size:"small",fullWidth:!0,onClick:Pe,children:"Export"})})]})}),e.jsx(Ee,{component:ke,children:e.jsxs(Oe,{size:"small",children:[e.jsx($e,{children:e.jsxs(P,{children:[e.jsx(s,{children:"Date & Time"}),e.jsx(s,{children:"Reference #"}),e.jsx(s,{children:"Invoice #"}),e.jsx(s,{children:"Customer"}),e.jsx(s,{children:"Method"}),e.jsx(s,{align:"right",children:"Amount"}),e.jsx(s,{children:"Status"}),e.jsx(s,{children:"Received By"}),e.jsx(s,{align:"right",children:"Actions"})]})}),e.jsx(Be,{children:S?Array(v).fill(0).map((t,o)=>e.jsx(He,{},o)):l&&((L=l.data)==null?void 0:L.length)>0?(K=l.data)==null?void 0:K.slice(D*v,D*v+v).map(t=>{var o,h;return e.jsxs(P,{sx:{backgroundColor:t.status==="voided"?"#fff8f8":"inherit"},children:[e.jsx(s,{children:Q(t.created_at)}),e.jsx(s,{children:t.payment_method==="cheque"?`${t.reference_number||"-"} (${W(t.payment_date)})`:t.reference_number||"-"}),e.jsx(s,{children:e.jsx(r,{variant:"body2",sx:{cursor:"pointer",color:"primary.main","&:hover":{textDecoration:"underline"}},onClick:()=>{var k;return be((k=t.sale)==null?void 0:k.id)},children:(o=t.sale)==null?void 0:o.invoice_number})}),e.jsx(s,{children:(h=t.sale)!=null&&h.customer?typeof t.sale.customer=="object"?t.sale.customer.customer_name:t.sale.customer:"Walk-in Customer"}),e.jsx(s,{children:se(t.payment_method)}),e.jsx(s,{align:"right",children:C(t.amount)}),e.jsx(s,{children:_e(t.status)}),e.jsx(s,{children:typeof t.received_by=="object"?t.received_by.customer_name:t.received_by||"System"}),e.jsxs(s,{align:"right",children:[e.jsx(F,{size:"small",color:"primary",onClick:()=>fe(t),title:"View Receipt",children:e.jsx(ze,{})}),(t.status==="pending"||t.status==="completed")&&e.jsx(F,{size:"small",color:"error",onClick:()=>ye(t),title:"Void Payment",children:e.jsx(Ne,{})})]})]},t.id)}):e.jsx(P,{children:e.jsx(s,{colSpan:9,align:"center",children:e.jsx(r,{variant:"body1",sx:{py:2},children:"No payments found"})})})})]})}),e.jsx(Ge,{rowsPerPageOptions:[5,10,25,50],component:"div",count:l?(N=l.data)==null?void 0:N.length:0,rowsPerPage:v,page:D,onPageChange:he,onRowsPerPageChange:xe}),e.jsx(te,{open:le,onClose:q,maxWidth:"md",fullWidth:!0,children:e.jsx(Ae,{paymentRecord:oe,onClose:q})}),e.jsx(te,{open:de,onClose:T,maxWidth:"sm",fullWidth:!0,children:e.jsxs(y,{sx:{p:3},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Void Payment"}),e.jsx(r,{variant:"body2",sx:{mb:2},children:"Are you sure you want to void this payment? This action cannot be undone."}),j&&e.jsx(y,{sx:{mb:3,p:2,bgcolor:"background.level1",borderRadius:1},children:e.jsxs(a,{container:!0,spacing:1,children:[e.jsx(a,{item:!0,xs:6,children:e.jsx(r,{variant:"body2",children:e.jsx("strong",{children:"Reference:"})})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(r,{variant:"body2",children:j.reference_number})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(r,{variant:"body2",children:e.jsx("strong",{children:"Invoice:"})})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(r,{variant:"body2",children:(G=j.sale)==null?void 0:G.invoice_number})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(r,{variant:"body2",children:e.jsx("strong",{children:"Amount:"})})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(r,{variant:"body2",children:C(j.amount)})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(r,{variant:"body2",children:e.jsx("strong",{children:"Date:"})})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(r,{variant:"body2",children:W(j.payment_date)})})]})}),e.jsx(_,{label:"Reason for voiding payment",fullWidth:!0,multiline:!0,rows:3,value:u,onChange:t=>O(t.target.value),required:!0,error:!u.trim(),helperText:u.trim()?"":"Reason is required",margin:"normal",sx:{mb:2}}),e.jsxs(y,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:[e.jsx(I,{onClick:T,sx:{mr:1},children:"Cancel"}),e.jsx(I,{variant:"contained",color:"error",onClick:Ce,disabled:!u.trim()||S,children:S?"Processing...":"Void Payment"})]})]})})]})};export{jt as default};
