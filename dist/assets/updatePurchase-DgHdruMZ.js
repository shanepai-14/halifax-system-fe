import{a as X,g as Z,ad as Ae,ae as ze,s as D,e as ae,m as ee,r as j,u as te,j as e,c as Q,b as re,i as tt,T as R,W as rt,d as oe,af as st,ag as ke,I as Y,ah as it,Q as at,S as ve,a9 as ot,aa as nt,ab as lt,q as U,E as Te,P as ce,G as A,t as se}from"./index-DSrAcRxp.js";import{S as fe}from"./sweetalert2.esm.all-D3pEHXw3.js";import{b as ct,c as dt,d as pt,e as ut}from"./usePurchaseOrders-apmeEOhY.js";import{l as mt,P as ht,a as xt}from"./Print-DbSvrbOt.js";import{g as vt}from"./fileHelper-DtQg9PBz.js";import{A as de,a as ft}from"./AddCostTypeModal-C7wUCdvc.js";import{c as je,d as be,e as ye,a as z,b as c,f as Ce,T as I,R as pe,C as _t}from"./PlusOutlined-CKpybx2v.js";import{R as Se}from"./DeleteOutlined-Dzh2-pYC.js";import{B as J}from"./InputLabel-CmXbOXsa.js";import{L as gt}from"./Link-DdRKESVr.js";import{D as jt,a as bt,b as yt,c as Ct}from"./DialogTitle-BlGFaLHC.js";import{S as ie}from"./Skeleton-BYNNVDi_.js";import"./index.esm-DddEpk9o.js";import"./FormControlLabel-B0Bo-vhA.js";function St(t){return X("MuiCircularProgress",t)}Z("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);const V=44,we=Ae`
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
`,$e=Ae`
  0% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: 0;
  }

  50% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -15px;
  }

  100% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -125px;
  }
`,wt=typeof we!="string"?ze`
        animation: ${we} 1.4s linear infinite;
      `:null,$t=typeof $e!="string"?ze`
        animation: ${$e} 1.4s ease-in-out infinite;
      `:null,Pt=t=>{const{classes:a,variant:s,color:l,disableShrink:f}=t,g={root:["root",s,`color${ae(l)}`],svg:["svg"],circle:["circle",`circle${ae(s)}`,f&&"circleDisableShrink"]};return re(g,St,a)},Lt=D("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver:(t,a)=>{const{ownerState:s}=t;return[a.root,a[s.variant],a[`color${ae(s.color)}`]]}})(ee(({theme:t})=>({display:"inline-block",variants:[{props:{variant:"determinate"},style:{transition:t.transitions.create("transform")}},{props:{variant:"indeterminate"},style:wt||{animation:`${we} 1.4s linear infinite`}},...Object.entries(t.palette).filter(tt()).map(([a])=>({props:{color:a},style:{color:(t.vars||t).palette[a].main}}))]}))),Rt=D("svg",{name:"MuiCircularProgress",slot:"Svg",overridesResolver:(t,a)=>a.svg})({display:"block"}),kt=D("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver:(t,a)=>{const{ownerState:s}=t;return[a.circle,a[`circle${ae(s.variant)}`],s.disableShrink&&a.circleDisableShrink]}})(ee(({theme:t})=>({stroke:"currentColor",variants:[{props:{variant:"determinate"},style:{transition:t.transitions.create("stroke-dashoffset")}},{props:{variant:"indeterminate"},style:{strokeDasharray:"80px, 200px",strokeDashoffset:0}},{props:({ownerState:a})=>a.variant==="indeterminate"&&!a.disableShrink,style:$t||{animation:`${$e} 1.4s ease-in-out infinite`}}]}))),qe=j.forwardRef(function(a,s){const l=te({props:a,name:"MuiCircularProgress"}),{className:f,color:g="primary",disableShrink:n=!1,size:d=40,style:S,thickness:_=3.6,value:y=0,variant:p="indeterminate",...h}=l,T={...l,color:g,disableShrink:n,size:d,thickness:_,value:y,variant:p},v=Pt(T),b={},$={},k={};if(p==="determinate"){const P=2*Math.PI*((V-_)/2);b.strokeDasharray=P.toFixed(3),k["aria-valuenow"]=Math.round(y),b.strokeDashoffset=`${((100-y)/100*P).toFixed(3)}px`,$.transform="rotate(-90deg)"}return e.jsx(Lt,{className:Q(v.root,f),style:{width:d,height:d,...$,...S},ownerState:T,ref:s,role:"progressbar",...k,...h,children:e.jsx(Rt,{className:v.svg,ownerState:T,viewBox:`${V/2} ${V/2} ${V} ${V}`,children:e.jsx(kt,{className:v.circle,style:b,ownerState:T,cx:V,cy:V,r:(V-_)/2,fill:"none",strokeWidth:_})})})});function Tt(t){return X("MuiDialogContentText",t)}Z("MuiDialogContentText",["root"]);const qt=t=>{const{classes:a}=t,l=re({root:["root"]},Tt,a);return{...a,...l}},It=D(R,{shouldForwardProp:t=>rt(t)||t==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(t,a)=>a.root})({}),Mt=j.forwardRef(function(a,s){const l=te({props:a,name:"MuiDialogContentText"}),{children:f,className:g,...n}=l,d=qt(n);return e.jsx(It,{component:"p",variant:"body1",color:"textSecondary",ref:s,ownerState:n,className:Q(d.root,g),...l,classes:d})}),ue=j.createContext({}),Le=j.createContext({});function At(t){return X("MuiStep",t)}Z("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const zt=t=>{const{classes:a,orientation:s,alternativeLabel:l,completed:f}=t;return re({root:["root",s,l&&"alternativeLabel",f&&"completed"]},At,a)},Dt=D("div",{name:"MuiStep",slot:"Root",overridesResolver:(t,a)=>{const{ownerState:s}=t;return[a.root,a[s.orientation],s.alternativeLabel&&a.alternativeLabel,s.completed&&a.completed]}})({variants:[{props:{orientation:"horizontal"},style:{paddingLeft:8,paddingRight:8}},{props:{alternativeLabel:!0},style:{flex:1,position:"relative"}}]}),Nt=j.forwardRef(function(a,s){const l=te({props:a,name:"MuiStep"}),{active:f,children:g,className:n,component:d="div",completed:S,disabled:_,expanded:y=!1,index:p,last:h,...T}=l,{activeStep:v,connector:b,alternativeLabel:$,orientation:k,nonLinear:P}=j.useContext(ue);let[N=!1,E=!1,F=!1]=[f,S,_];v===p?N=f!==void 0?f:!0:!P&&v>p?E=S!==void 0?S:!0:!P&&v<p&&(F=_!==void 0?_:!0);const B=j.useMemo(()=>({index:p,last:h,expanded:y,icon:p+1,active:N,completed:E,disabled:F}),[p,h,y,N,E,F]),M={...l,active:N,orientation:k,alternativeLabel:$,completed:E,disabled:F,expanded:y,component:d},O=zt(M),C=e.jsxs(Dt,{as:d,className:Q(O.root,n),ref:s,ownerState:M,...T,children:[b&&$&&p!==0?b:null,g]});return e.jsx(Le.Provider,{value:B,children:b&&!$&&p!==0?e.jsxs(j.Fragment,{children:[b,C]}):C})}),Ot=oe(e.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"}),"CheckCircle"),Ft=oe(e.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}),"Warning");function Wt(t){return X("MuiStepIcon",t)}const _e=Z("MuiStepIcon",["root","active","completed","error","text"]);var Ie;const Et=t=>{const{classes:a,active:s,completed:l,error:f}=t;return re({root:["root",s&&"active",l&&"completed",f&&"error"],text:["text"]},Wt,a)},ge=D(st,{name:"MuiStepIcon",slot:"Root",overridesResolver:(t,a)=>a.root})(ee(({theme:t})=>({display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),color:(t.vars||t).palette.text.disabled,[`&.${_e.completed}`]:{color:(t.vars||t).palette.primary.main},[`&.${_e.active}`]:{color:(t.vars||t).palette.primary.main},[`&.${_e.error}`]:{color:(t.vars||t).palette.error.main}}))),Ut=D("text",{name:"MuiStepIcon",slot:"Text",overridesResolver:(t,a)=>a.text})(ee(({theme:t})=>({fill:(t.vars||t).palette.primary.contrastText,fontSize:t.typography.caption.fontSize,fontFamily:t.typography.fontFamily}))),Bt=j.forwardRef(function(a,s){const l=te({props:a,name:"MuiStepIcon"}),{active:f=!1,className:g,completed:n=!1,error:d=!1,icon:S,..._}=l,y={...l,active:f,completed:n,error:d},p=Et(y);if(typeof S=="number"||typeof S=="string"){const h=Q(g,p.root);return d?e.jsx(ge,{as:Ft,className:h,ref:s,ownerState:y,..._}):n?e.jsx(ge,{as:Ot,className:h,ref:s,ownerState:y,..._}):e.jsxs(ge,{className:h,ref:s,ownerState:y,..._,children:[Ie||(Ie=e.jsx("circle",{cx:"12",cy:"12",r:"12"})),e.jsx(Ut,{className:p.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:y,children:S})]})}return S});function Ht(t){return X("MuiStepLabel",t)}const G=Z("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),Vt=t=>{const{classes:a,orientation:s,active:l,completed:f,error:g,disabled:n,alternativeLabel:d}=t;return re({root:["root",s,g&&"error",n&&"disabled",d&&"alternativeLabel"],label:["label",l&&"active",f&&"completed",g&&"error",n&&"disabled",d&&"alternativeLabel"],iconContainer:["iconContainer",l&&"active",f&&"completed",g&&"error",n&&"disabled",d&&"alternativeLabel"],labelContainer:["labelContainer",d&&"alternativeLabel"]},Ht,a)},Gt=D("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(t,a)=>{const{ownerState:s}=t;return[a.root,a[s.orientation]]}})({display:"flex",alignItems:"center",[`&.${G.alternativeLabel}`]:{flexDirection:"column"},[`&.${G.disabled}`]:{cursor:"default"},variants:[{props:{orientation:"vertical"},style:{textAlign:"left",padding:"8px 0"}}]}),Qt=D("span",{name:"MuiStepLabel",slot:"Label",overridesResolver:(t,a)=>a.label})(ee(({theme:t})=>({...t.typography.body2,display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),[`&.${G.active}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${G.completed}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${G.alternativeLabel}`]:{marginTop:16},[`&.${G.error}`]:{color:(t.vars||t).palette.error.main}}))),Kt=D("span",{name:"MuiStepLabel",slot:"IconContainer",overridesResolver:(t,a)=>a.iconContainer})({flexShrink:0,display:"flex",paddingRight:8,[`&.${G.alternativeLabel}`]:{paddingRight:0}}),Yt=D("span",{name:"MuiStepLabel",slot:"LabelContainer",overridesResolver:(t,a)=>a.labelContainer})(ee(({theme:t})=>({width:"100%",color:(t.vars||t).palette.text.secondary,[`&.${G.alternativeLabel}`]:{textAlign:"center"}}))),Pe=j.forwardRef(function(a,s){const l=te({props:a,name:"MuiStepLabel"}),{children:f,className:g,componentsProps:n={},error:d=!1,icon:S,optional:_,slots:y={},slotProps:p={},StepIconComponent:h,StepIconProps:T,...v}=l,{alternativeLabel:b,orientation:$}=j.useContext(ue),{active:k,disabled:P,completed:N,icon:E}=j.useContext(Le),F=S||E;let B=h;F&&!B&&(B=Bt);const M={...l,active:k,alternativeLabel:b,completed:N,disabled:P,error:d,orientation:$},O=Vt(M),C={slots:y,slotProps:{stepIcon:T,...n,...p}},[me,H]=ke("label",{elementType:Qt,externalForwardedProps:C,ownerState:M}),[K,he]=ke("stepIcon",{elementType:B,externalForwardedProps:C,ownerState:M});return e.jsxs(Gt,{className:Q(O.root,g),ref:s,ownerState:M,...v,children:[F||K?e.jsx(Kt,{className:O.iconContainer,ownerState:M,children:e.jsx(K,{completed:N,active:k,error:d,icon:F,...he})}):null,e.jsxs(Yt,{className:O.labelContainer,ownerState:M,children:[f?e.jsx(me,{...H,className:Q(O.label,H==null?void 0:H.className),children:f}):null,_]})]})});Pe&&(Pe.muiName="StepLabel");function Jt(t){return X("MuiStepConnector",t)}Z("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const Xt=t=>{const{classes:a,orientation:s,alternativeLabel:l,active:f,completed:g,disabled:n}=t,d={root:["root",s,l&&"alternativeLabel",f&&"active",g&&"completed",n&&"disabled"],line:["line",`line${ae(s)}`]};return re(d,Jt,a)},Zt=D("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(t,a)=>{const{ownerState:s}=t;return[a.root,a[s.orientation],s.alternativeLabel&&a.alternativeLabel,s.completed&&a.completed]}})({flex:"1 1 auto",variants:[{props:{orientation:"vertical"},style:{marginLeft:12}},{props:{alternativeLabel:!0},style:{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"}}]}),er=D("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(t,a)=>{const{ownerState:s}=t;return[a.line,a[`line${ae(s.orientation)}`]]}})(ee(({theme:t})=>{const a=t.palette.mode==="light"?t.palette.grey[400]:t.palette.grey[600];return{display:"block",borderColor:t.vars?t.vars.palette.StepConnector.border:a,variants:[{props:{orientation:"horizontal"},style:{borderTopStyle:"solid",borderTopWidth:1}},{props:{orientation:"vertical"},style:{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24}}]}})),tr=j.forwardRef(function(a,s){const l=te({props:a,name:"MuiStepConnector"}),{className:f,...g}=l,{alternativeLabel:n,orientation:d="horizontal"}=j.useContext(ue),{active:S,disabled:_,completed:y}=j.useContext(Le),p={...l,alternativeLabel:n,orientation:d,active:S,completed:y,disabled:_},h=Xt(p);return e.jsx(Zt,{className:Q(h.root,f),ref:s,ownerState:p,...g,children:e.jsx(er,{className:h.line,ownerState:p})})});function rr(t){return X("MuiStepper",t)}Z("MuiStepper",["root","horizontal","vertical","nonLinear","alternativeLabel"]);const sr=t=>{const{orientation:a,nonLinear:s,alternativeLabel:l,classes:f}=t;return re({root:["root",a,s&&"nonLinear",l&&"alternativeLabel"]},rr,f)},ir=D("div",{name:"MuiStepper",slot:"Root",overridesResolver:(t,a)=>{const{ownerState:s}=t;return[a.root,a[s.orientation],s.alternativeLabel&&a.alternativeLabel,s.nonLinear&&a.nonLinear]}})({display:"flex",variants:[{props:{orientation:"horizontal"},style:{flexDirection:"row",alignItems:"center"}},{props:{orientation:"vertical"},style:{flexDirection:"column"}},{props:{alternativeLabel:!0},style:{alignItems:"flex-start"}}]}),ar=e.jsx(tr,{}),or=j.forwardRef(function(a,s){const l=te({props:a,name:"MuiStepper"}),{activeStep:f=0,alternativeLabel:g=!1,children:n,className:d,component:S="div",connector:_=ar,nonLinear:y=!1,orientation:p="horizontal",...h}=l,T={...l,nonLinear:y,alternativeLabel:g,orientation:p,component:S},v=sr(T),b=j.Children.toArray(n).filter(Boolean),$=b.map((P,N)=>j.cloneElement(P,{index:N,last:N+1===b.length,...P.props})),k=j.useMemo(()=>({activeStep:f,alternativeLabel:g,connector:_,nonLinear:y,orientation:p}),[f,g,_,y,p]);return e.jsx(ue.Provider,{value:k,children:e.jsx(ir,{as:S,ownerState:T,className:Q(v.root,d),ref:s,...h,children:$})})}),nr=oe(e.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBackOutlined"),lr=oe(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"}),"CancelOutlined"),cr=oe(e.jsx("path",{d:"M18 15v3H6v-3H4v3c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-3zm-1-4-1.41-1.41L13 12.17V4h-2v8.17L8.41 9.59 7 11l5 5z"}),"FileDownloadOutlined"),dr=oe(e.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),pr=({products:t,attributes:a,receivedItems:s,onItemChange:l,onAddItem:f,onRemoveItem:g,errors:n={},disabled:d=!1,status:S})=>{const _=S==="completed";console.log(_);const y=()=>s.reduce((p,h)=>p+h.cost_price*h.received_quantity,0);return e.jsx(e.Fragment,{children:e.jsx(je,{sx:{mt:4},children:e.jsxs(be,{size:"small",children:[e.jsxs(ye,{children:[e.jsx(z,{children:e.jsx(c,{colSpan:_?7:8,children:e.jsx(R,{variant:"h5",children:"Received Items"})})}),e.jsxs(z,{children:[e.jsx(c,{children:"Product"}),e.jsx(c,{children:"Received Qty"}),e.jsx(c,{children:"Cost Price"}),e.jsx(c,{children:"Walk-in Price"}),e.jsx(c,{children:"Wholesale Price"}),e.jsx(c,{children:"Regular Price"}),e.jsx(c,{children:"Total"}),!d&&e.jsx(c,{width:50})]})]}),e.jsxs(Ce,{children:[s.map((p,h)=>{var T;return e.jsxs(z,{children:[e.jsx(c,{sx:{verticalAlign:"top"},children:_?((T=t==null?void 0:t.find(v=>v.id===p.product_id))==null?void 0:T.product_name)||"":e.jsx(de,{value:(t==null?void 0:t.find(v=>v.id===p.product_id))||null,onChange:(v,b)=>l(h,"product_id",b?b.id:""),options:(t==null?void 0:t.filter(v=>!s.some((b,$)=>$!==h&&b.product_id===v.id)))||[],size:"small",sx:{width:300},getOptionLabel:v=>v.product_name||"",isOptionEqualToValue:(v,b)=>v.id===b,disabled:d,renderInput:v=>e.jsx(I,{...v,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!n[`received_items.${h}.product_id`],helperText:n[`received_items.${h}.product_id`]||"Required"})})}),e.jsx(c,{sx:{verticalAlign:"top"},children:_?p.received_quantity:e.jsx(I,{type:"number",value:p.received_quantity,onChange:v=>l(h,"received_quantity",v.target.value),error:!!n[`received_items.${h}.received_quantity`],helperText:n[`received_items.${h}.received_quantity`]||"Required",inputProps:{min:0,step:"0.01"},disabled:d,size:"small"})}),e.jsx(c,{sx:{verticalAlign:"top"},children:_?`₱${p.cost_price}`:e.jsx(I,{type:"number",value:p.cost_price,onChange:v=>l(h,"cost_price",v.target.value),error:!!n[`received_items.${h}.cost_price`],helperText:n[`received_items.${h}.cost_price`]||"Required",inputProps:{min:0,step:"0.01"},disabled:d,size:"small"})}),e.jsx(c,{sx:{verticalAlign:"top"},children:_?`₱${p.walk_in_price}`:e.jsx(I,{type:"number",value:p.walk_in_price,onChange:v=>l(h,"walk_in_price",v.target.value),error:!!n[`received_items.${h}.walk_in_price`],helperText:n[`received_items.${h}.walk_in_price`]||"Required",inputProps:{min:0,step:"0.01"},disabled:d,size:"small"})}),e.jsx(c,{children:_?`₱${p.wholesale_price}`:e.jsx(I,{type:"number",value:p.wholesale_price,onChange:v=>l(h,"wholesale_price",v.target.value),error:!!n[`received_items.${h}.wholesale_price`],helperText:n[`received_items.${h}.wholesale_price`]||"Required",inputProps:{min:0,step:"0.01"},disabled:d,size:"small"})}),e.jsx(c,{sx:{verticalAlign:"top"},children:_?`₱${p.regular_price}`:e.jsx(I,{type:"number",value:p.regular_price,onChange:v=>l(h,"regular_price",v.target.value),error:!!n[`received_items.${h}.regular_price`],helperText:n[`received_items.${h}.regular_price`]||"Required",inputProps:{min:0,step:"0.01"},disabled:d,size:"small"})}),e.jsxs(c,{sx:{verticalAlign:"top"},children:["₱",(p.cost_price*p.received_quantity).toFixed(2)]}),!d&&!_&&e.jsx(c,{sx:{verticalAlign:"top"},children:e.jsx(Y,{size:"large",onClick:()=>g(h),disabled:s.length===1,children:e.jsx(Se,{})})})]},h)}),e.jsxs(z,{children:[e.jsx(c,{colSpan:5,sx:{border:"none"},children:e.jsx(J,{startIcon:e.jsx(pe,{}),onClick:f,sx:{visibility:!d&&!_?"visible":"hidden"},children:"Add Received Item"})}),e.jsx(c,{children:e.jsx(R,{variant:"h5",children:"Total Received:"})}),e.jsxs(c,{children:["₱",y().toFixed(2)]})]})]})]})})})},ur=()=>e.jsxs(U,{children:[e.jsx(ie,{variant:"rectangular",width:40,height:40,sx:{mb:2}}),e.jsx(ie,{variant:"rectangular",height:60,sx:{mb:4}}),e.jsx(ie,{variant:"text",sx:{fontSize:"2rem",mb:2}}),e.jsxs(A,{container:!0,spacing:3,children:[e.jsxs(A,{item:!0,xs:12,children:[e.jsx(ie,{variant:"text",sx:{fontSize:"1.2rem",mb:1}}),e.jsx(ie,{variant:"text",sx:{fontSize:"1.2rem",mb:2}})]}),e.jsx(A,{item:!0,xs:12,children:e.jsx(ie,{variant:"rectangular",height:300})})]})]}),Me=[{label:"Pending",value:"pending"},{label:"Partially Received",value:"partially_received"},{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"}],Pr=()=>{var Re;const{id:t}=it(),a=at(),[s,l]=j.useState({items:[],invoice:"",attachment:"",additional_costs:[],received_items:[]}),f=j.useRef(),g=mt.useReactToPrint({contentRef:f}),[n,d]=j.useState({}),[S,_]=j.useState(0),[y,p]=j.useState(!1),[h,T]=j.useState(""),[v,b]=j.useState(!1),$=ve(ot),k=ve(nt),P=ve(lt),[N,E]=j.useState(!1),[F,B]=j.useState(!1),[M,O]=j.useState([{product_id:"",attribute_id:"",received_quantity:0,cost_price:0,walk_in_price:0,term_price:0,wholesale_price:0,regular_price:0,remarks:""}]),{data:C,isLoading:me,refetch:H}=ct(t),K=dt();pt();const he=ut();j.useEffect(()=>{if(C){l({...C,items:C.items.map(r=>({...r,received_quantity:r.received_quantity||0}))}),C.received_items&&C.received_items.length>0?O(C.received_items.map(r=>({received_item_id:r.received_item_id,po_id:r.po_id,product_id:r.product_id,attribute_id:r.attribute_id,received_quantity:r.received_quantity,cost_price:r.cost_price,walk_in_price:r.walk_in_price,term_price:r.term_price,wholesale_price:r.wholesale_price,regular_price:r.regular_price,remarks:r.remarks||"",product:r.product,attribute:r.attribute}))):O([{product_id:"",attribute_id:"",received_quantity:0,cost_price:0,walk_in_price:0,term_price:0,wholesale_price:0,regular_price:0,remarks:""}]);const i=Me.findIndex(r=>r.value===C.status);_(i)}},[C]);const De=i=>{i.preventDefault();const r=document.createElement("a");r.href=vt(s.attachment),r.download=s.attachment.split("/").pop(),r.target="_blank",document.body.appendChild(r),r.click(),document.body.removeChild(r)},Ne=()=>{l(i=>({...i,additional_costs:[...i.additional_costs,{cost_type_id:"",amount:"",remarks:""}]}))},xe=(i,r,x)=>{if(r==="cost_type_id"&&x&&s.additional_costs.some((m,w)=>w!==i&&m.cost_type_id===x)){d(m=>({...m,[`additional_costs.${i}.cost_type_id`]:"This cost type is already added"}));return}const o=[...s.additional_costs];o[i]={...o[i],[r]:x},l(u=>({...u,additional_costs:o})),n[`additional_costs.${i}.${r}`]&&d(u=>{const m={...u};return delete m[`additional_costs.${i}.${r}`],m})},Oe=i=>{const r=s.additional_costs.filter((x,o)=>o!==i);l(x=>({...x,additional_costs:r}))},Fe=()=>{l(i=>({...i,items:[...i.items,{product_id:"",attribute_id:"",requested_quantity:1,price:0}]}))},We=i=>{if(s.items.length>1){const r=s.items.filter((o,u)=>u!==i);l(o=>({...o,items:r}));const x={...n};Object.keys(x).forEach(o=>{o.startsWith(`items.${i}`)&&delete x[o]}),d(x)}},Ee=async()=>{var r,x;const i={};if(L&&s.items.forEach((o,u)=>{o.product_id||(i[`items.${u}.product_id`]="Product is required"),o.attribute_id||(i[`items.${u}.attribute_id`]="Measurement is required"),(!o.requested_quantity||o.requested_quantity<=0)&&(i[`items.${u}.requested_quantity`]="Quantity must be greater than 0"),(!o.price||o.price<=0)&&(i[`items.${u}.price`]="Price must be greater than 0")}),W&&(!s.received_items||s.received_items.length===0?i.received_items="At least one received item is required":s.received_items.forEach((o,u)=>{o.product_id||(i[`received_items.${u}.product_id`]="Product is required"),(!o.received_quantity||Number(o.received_quantity)<=0)&&(i[`received_items.${u}.received_quantity`]="Received quantity must be greater than 0"),Object.entries({cost_price:"Cost price",walk_in_price:"Walk-in price",wholesale_price:"Wholesale price",regular_price:"Regular price"}).forEach(([w,ne])=>{(!o[w]||Number(o[w])<=0)&&(i[`received_items.${u}.${w}`]=`${ne} must be greater than 0`)})})),s.additional_costs.forEach((o,u)=>{o.cost_type_id||(i[`additional_costs.${u}.cost_type_id`]="Cost type is required"),(!o.amount||Number(o.amount)<=0)&&(i[`additional_costs.${u}.amount`]="Amount must be greater than 0")}),Object.keys(i).length>0){d(i),console.log(i),se.error("Please fill in all required fields correctly");return}try{B(!0),await K.mutateAsync({id:t,data:s}),se.success("Purchase Order updated successfully"),H()}catch(o){(x=(r=o.response)==null?void 0:r.data)!=null&&x.errors&&d(o.response.data.errors),se.error("Something went wrong please try again")}finally{B(!1)}},Ue=()=>{let i="";s.status==="pending"?i="partially_received":s.status==="partially_received"&&(i="completed"),T(i),p(!0)},Be=()=>s.items.reduce((i,r)=>i+r.price*r.requested_quantity,0),He=()=>{const i=s.items.reduce((x,o)=>x+o.price*o.requested_quantity,0),r=s.additional_costs.reduce((x,o)=>x+(Number(o.amount)||0),0);return i+r},Ve=()=>s.additional_costs.reduce((r,x)=>r+(Number(x.amount)||0),0),Ge=()=>{const i=s.received_items.reduce((x,o)=>x+o.cost_price*o.received_quantity,0),r=s.additional_costs.reduce((x,o)=>x+(Number(o.amount)||0),0);return i+r},Qe=async()=>{var x,o;d({});let i=!1;const r={};if(h==="completed"&&(s.invoice||(r.invoice="Invoice is required",i=!0),s.attachment||(r.attachment="Attachment is required",i=!0),i)){d(r),p(!1),se.error("Please fill in all required fields correctly");return}try{b(!0),await K.mutateAsync({id:t,data:{...s,status:h}}),s.attachment instanceof File&&await he.mutateAsync({id:t,file:s.attachment}),p(!1),se.success("Purchase Order updated successfully"),H()}catch(u){(o=(x=u.response)==null?void 0:x.data)!=null&&o.errors&&(d(u.response.data.errors),se.error("Something went wrong please try again")),b(!1),p(!1)}finally{b(!1)}},le=(i,r,x)=>{if(r==="product_id"&&x&&s.items.some((m,w)=>w!==i&&m.product_id===x)){d(m=>({...m,[`items.${i}.product_id`]:"This product is already added"}));return}const o=[...s.items];o[i]={...o[i],[r]:x},l(u=>({...u,items:o})),n[`items.${i}.${r}`]&&d(u=>{const m={...u};return delete m[`items.${i}.${r}`],m})},Ke=(i,r,x)=>{const o=[...M];o[i]={...o[i],[r]:x},O(o),l(u=>({...u,received_items:o})),n[`received_items.${i}.${r}`]&&d(u=>{const m={...u};return delete m[`received_items.${i}.${r}`],m})},Ye=()=>{const i={product_id:"",attribute_id:"",received_quantity:0,cost_price:0,walk_in_price:0,term_price:0,wholesale_price:0,regular_price:0,remarks:""};O(r=>[...r,i]),l(r=>({...r,received_items:[...r.received_items,i]}))},Je=i=>{if(M.length>1){const r=M.filter((o,u)=>u!==i);O(r),l(o=>({...o,received_items:r}));const x={...n};Object.keys(x).forEach(o=>{o.startsWith(`received_items.${i}`)&&delete x[o]}),d(x)}},L=s.status==="pending",W=s.status==="partially_received",q=s.status==="completed",Xe=()=>L?"Mark as Partially Received":W?"Mark as Completed":"",Ze=()=>h==="partially_received"?"Are you sure you want to mark this Purchase Order as partially received? This will allow you to start recording received quantities.":h==="completed"?"Are you sure you want to mark this Purchase Order as completed? This action cannot be undone.":"",et=()=>{fe.fire({title:"Are you sure?",text:"You want to cancel this purchase order? This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, cancel it!",cancelButtonText:"No, keep it"}).then(async i=>{if(i.isConfirmed)try{b(!0),await K.mutateAsync({id:t,data:{...s,status:"cancelled"}}),fe.fire("Cancelled!","The purchase order has been cancelled.","success"),H()}catch{fe.fire("Error!","Failed to cancel the purchase order.","error")}finally{b(!1)}})};return me?e.jsx(ur,{}):e.jsxs(_t,{maxWidth:"xxl",sx:{mt:0,mb:4},children:[e.jsxs(U,{sx:{mb:4},children:[e.jsx(or,{activeStep:S,sx:{mb:4},children:Me.map(i=>e.jsx(Nt,{children:e.jsx(Pe,{children:i.label})},i.value))}),e.jsxs(U,{sx:{display:"flex",justifyContent:"space-between",mb:4},children:[e.jsx(Y,{onClick:()=>a("/app/purchase"),sx:{mb:2},color:"primary",children:e.jsx(nr,{})}),e.jsxs(U,{sx:{display:"flex",gap:2,justifyContent:"flex-end",mt:2},children:[e.jsx(Te,{title:"Save Purchase Order",children:e.jsx(Y,{variant:"contained",color:"primary",onClick:Ee,disabled:F||!L&&!W,children:F?e.jsx(U,{children:e.jsx(qe,{size:"30px"})}):e.jsx(dr,{})})}),e.jsx(Te,{title:"Print Purchase Order",children:e.jsx(Y,{onClick:g,color:"primary",children:e.jsx(ht,{})})})]}),e.jsx(xt,{purchaseOrder:C,contentRef:f})]}),e.jsx(ce,{elevation:0,sx:{p:0,mb:0},children:e.jsx(A,{container:!0,spacing:2,alignItems:"center",children:e.jsx(A,{item:!0,xs:12,md:8,children:e.jsxs(R,{variant:"h5",sx:{mb:1},children:["Purchase Order: ",C==null?void 0:C.po_number]})})})}),e.jsx(ce,{elevation:0,sx:{p:0,mb:3},children:e.jsxs(A,{container:!0,spacing:3,children:[e.jsx(A,{item:!0,xs:12,md:6,children:e.jsxs(R,{variant:"subtitle1",sx:{mb:2},children:["Supplier: ",(Re=C==null?void 0:C.supplier)==null?void 0:Re.supplier_name]})}),e.jsx(A,{item:!0,xs:12,md:6,sx:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(R,{variant:"subtitle1",children:["PO Date: ",new Date(C==null?void 0:C.po_date).toLocaleDateString()]})})]})}),(W||q)&&e.jsx(ce,{elevation:0,sx:{p:0,mb:3},children:e.jsxs(A,{container:!0,spacing:3,children:[e.jsx(A,{item:!0,xs:12,md:6,children:q?e.jsxs(R,{children:["Invoice Number: ",s.invoice||""]}):e.jsx(I,{fullWidth:!0,label:"Invoice Number",name:"invoice",value:s.invoice,onChange:i=>l(r=>({...r,invoice:i.target.value})),error:!!n.invoice,helperText:n.invoice,required:!0,disabled:q,sx:{mb:2}})}),e.jsx(A,{item:!0,xs:12,md:6,children:s.attachment&&typeof s.attachment=="string"?e.jsxs(U,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(R,{children:"Current Attachment:"}),e.jsxs(gt,{href:"#",sx:{display:"flex",alignItems:"center",gap:1},onClick:De,children:[e.jsx(cr,{})," Download Attachment"]})]}):e.jsx(I,{fullWidth:!0,type:"file",label:"Attachment",name:"attachment",InputLabelProps:{shrink:!0},inputProps:{accept:".pdf,.doc,.docx,.png,.jpg,.jpeg"},onChange:i=>{const r=i.target.files[0];if(r){if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/png","image/jpeg"].includes(r.type)){d(u=>({...u,attachment:"File must be PDF, DOC, DOCX, PNG, or JPG format"})),i.target.value="";return}const o=5*1024*1024;if(r.size>o){d(u=>({...u,attachment:"File size must be less than 5MB"})),i.target.value="";return}l(u=>({...u,attachment:r}))}},error:!!n.attachment,helperText:n.attachment,disabled:q,required:!0})})]})}),e.jsxs(ce,{elevation:0,sx:{p:0},children:[e.jsxs(A,{item:!0,xs:12,children:[e.jsx(je,{children:e.jsxs(be,{children:[e.jsxs(ye,{children:[e.jsx(z,{children:e.jsx(c,{colSpan:L?6:5,children:e.jsx(R,{variant:"h5",children:"Requested Items"})})}),e.jsxs(z,{children:[e.jsx(c,{children:"Product"}),e.jsx(c,{children:"Measurement"}),e.jsx(c,{children:"Request Quantity"}),e.jsx(c,{children:"Price"}),e.jsx(c,{children:"Total"}),L&&e.jsx(c,{width:50})]})]}),e.jsxs(Ce,{children:[s.items.map((i,r)=>{var x,o,u;return e.jsxs(z,{children:[e.jsx(c,{sx:{verticalAlign:"top"},children:L?e.jsx(de,{size:"small",sx:{width:300},value:($==null?void 0:$.find(m=>m.id===i.product_id))||null,onChange:(m,w)=>le(r,"product_id",w?w.id:""),options:($==null?void 0:$.filter(m=>!s.items.some((w,ne)=>ne!==r&&w.product_id===m.id)))||[],getOptionLabel:m=>m.product_name||"",isOptionEqualToValue:(m,w)=>m.id===w,renderInput:m=>e.jsx(I,{...m,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!n[`items.${r}.product_id`],helperText:n[`items.${r}.product_id`]||"Required"})}):(x=i.product)==null?void 0:x.product_name}),e.jsx(c,{sx:{verticalAlign:"top"},children:L?e.jsx(de,{size:"small",sx:{width:300},value:(k==null?void 0:k.find(m=>m.id===i.attribute_id))||null,onChange:(m,w)=>le(r,"attribute_id",w?w.id:""),options:(k==null?void 0:k.filter(m=>!s.items.some((w,ne)=>ne!==r&&w.attribute_id===m.id)))||[],getOptionLabel:m=>`${m.attribute_name} (${m.unit_of_measurement})`||"",isOptionEqualToValue:(m,w)=>m.id===w,renderInput:m=>e.jsx(I,{...m,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!n[`items.${r}.attribute_id`],helperText:n[`items.${r}.attribute_id`]||"Required"})}):`${(o=i.attribute)==null?void 0:o.attribute_name} (${(u=i.attribute)==null?void 0:u.unit_of_measurement})`}),e.jsx(c,{sx:{verticalAlign:"top"},children:L?e.jsx(I,{type:"number",value:i.requested_quantity,onChange:m=>le(r,"requested_quantity",m.target.value),error:!!n[`items.${r}.requested_quantity`],helperText:n[`items.${r}.requested_quantity`]||"Required",inputProps:{min:1},disabled:!L,size:"small"}):i.requested_quantity}),e.jsx(c,{sx:{verticalAlign:"top"},children:L?e.jsx(I,{type:"number",value:i.price,onChange:m=>le(r,"price",m.target.value),error:!!n[`items.${r}.price`],helperText:n[`items.${r}.price`]||"Required",inputProps:{min:0,step:.01},disabled:!L,size:"small"}):`₱${i.price}`}),e.jsxs(c,{sx:{verticalAlign:"top"},children:["₱",(i.price*i.requested_quantity).toFixed(2)]}),L&&e.jsx(c,{sx:{verticalAlign:"top"},children:e.jsx(Y,{onClick:()=>We(r),disabled:s.items.length===1,children:e.jsx(Se,{})})})]},r)}),e.jsxs(z,{children:[e.jsx(c,{colSpan:3,children:e.jsx(J,{sx:{visibility:L?"visible":"hidden"},startIcon:e.jsx(pe,{}),onClick:Fe,children:"Add Item"})}),e.jsx(c,{verticalAlign:"left",children:e.jsx(R,{variant:"h5",textAlign:"left",children:"Total Requested: "})}),e.jsx(c,{children:e.jsxs(R,{variant:"h5",children:["₱",Be().toFixed(2)]})})]})]})]})}),e.jsx(U,{sx:{mt:2,display:"flex",justifyContent:"flex-end"}}),!L&&e.jsx(pr,{products:$,attributes:k,receivedItems:M,onItemChange:Ke,onAddItem:Ye,onRemoveItem:Je,errors:n,disabled:q,status:s.status})]}),e.jsx(A,{item:!0,xs:12,children:e.jsx(je,{children:e.jsxs(be,{children:[e.jsxs(ye,{children:[e.jsx(z,{children:e.jsxs(c,{colSpan:q?3:4,children:[" ",e.jsxs(R,{variant:"h5",sx:{mt:4,mb:1},children:["Additional Costs",e.jsx(Y,{sx:{marginLeft:"0px !important"},onClick:()=>E(!0),children:e.jsx(pe,{})})]})]})}),e.jsxs(z,{children:[e.jsx(c,{children:"Cost Type"}),e.jsx(c,{children:"Amount"}),e.jsx(c,{children:"Remarks"}),!q&&e.jsx(c,{width:50})]})]}),e.jsxs(Ce,{children:[s.additional_costs.map((i,r)=>{var x;return e.jsxs(z,{children:[e.jsx(c,{children:q?((x=P==null?void 0:P.find(o=>o.cost_type_id===i.cost_type_id))==null?void 0:x.name)||"":e.jsx(de,{size:"small",value:(P==null?void 0:P.find(o=>o.cost_type_id===i.cost_type_id))||null,onChange:(o,u)=>xe(r,"cost_type_id",u?u.cost_type_id:""),options:(P==null?void 0:P.filter(o=>o.is_active&&!s.additional_costs.some((u,m)=>m!==r&&u.cost_type_id===o.cost_type_id)))||[],getOptionLabel:o=>o.name||"",isOptionEqualToValue:(o,u)=>o.cost_type_id===u,disabled:!L&&!W,renderInput:o=>e.jsx(I,{...o,fullWidth:!0,sx:{"& .MuiInputBase-root":{padding:"4px 8px"},"& .MuiFormLabel-root":{fontSize:"0.875rem"}},error:!!n[`additional_costs.${r}.cost_type_id`],helperText:n[`additional_costs.${r}.cost_type_id`]||"Required"})})}),e.jsx(c,{children:q?i.amount:e.jsx(I,{size:"small",type:"number",value:i.amount,onChange:o=>xe(r,"amount",o.target.value),error:!!n[`additional_costs.${r}.amount`],helperText:n[`additional_costs.${r}.amount`]||"Required",inputProps:{min:0,step:.01},disabled:!L&&!W})}),e.jsx(c,{sx:{verticalAlign:"top"},children:q?i.remarks||"":e.jsx(I,{size:"small",value:i.remarks||"",onChange:o=>xe(r,"remarks",o.target.value),fullWidth:!0,disabled:!L&&!W})}),!q&&e.jsx(c,{sx:{verticalAlign:"top"},children:e.jsx(Y,{size:"large",onClick:()=>Oe(r),disabled:!L&&!W,children:e.jsx(Se,{})})})]},r)}),e.jsxs(z,{children:[e.jsx(c,{sx:{border:"none"},colSpan:q?1:2,children:e.jsx(J,{startIcon:e.jsx(pe,{}),onClick:Ne,disabled:!L&&!W,sx:{visibility:q?"hidden":"visible"},children:"Add Additional Cost"})}),e.jsx(c,{children:e.jsx(R,{variant:"h5",textAlign:"right",children:"Total Cost:"})}),e.jsx(c,{children:e.jsxs(R,{variant:"h5",children:["₱",Ve().toFixed(2)]})})]}),e.jsxs(z,{children:[e.jsx(c,{sx:{border:"none"},colSpan:q?1:2}),e.jsx(c,{sx:{verticalAlign:"right"},children:e.jsx(R,{variant:"h5",textAlign:"right",children:"Total Requested with Costs:"})}),e.jsx(c,{children:e.jsxs(R,{variant:"h5",children:["₱",He().toFixed(2)]})})]}),e.jsxs(z,{children:[e.jsx(c,{sx:{border:"none"},colSpan:q?1:2}),e.jsx(c,{sx:{verticalAlign:"right"},children:e.jsx(R,{variant:"h5",textAlign:"right",children:"Total Received with Costs:"})}),e.jsx(c,{children:e.jsxs(R,{variant:"h5",children:["₱",Ge().toFixed(2)]})})]})]})]})})}),e.jsx(A,{item:!0,xs:12,md:4,children:e.jsxs(U,{sx:{display:"flex",mt:4,justifyContent:"flex-end",gap:2},children:[W&&e.jsx(J,{variant:"contained",onClick:et,disabled:v,color:"error",startIcon:e.jsx(lr,{}),sx:{minWidth:200},children:"Cancel Order"}),(L||W)&&!v&&e.jsx(J,{variant:"contained",onClick:Ue,disabled:K.isPending,color:"primary",sx:{minWidth:200},children:Xe()})]})})]})]}),e.jsxs(jt,{open:y,onClose:()=>p(!1),PaperProps:{sx:{borderRadius:2,minWidth:"500px",padding:2,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)"}},children:[e.jsx(bt,{sx:{fontSize:"1.5rem",fontWeight:600,color:"#333",pb:1},children:"Confirm Status Update"}),e.jsx(yt,{sx:{pt:2},children:e.jsx(Mt,{sx:{fontSize:"1.1rem",color:"#555",lineHeight:1.5},children:Ze()})}),e.jsxs(Ct,{sx:{padding:3,paddingTop:2,gap:2},children:[e.jsx(J,{onClick:()=>p(!1),sx:{fontSize:"1rem",minWidth:"100px",textTransform:"none"},children:"Cancel"}),e.jsx(J,{onClick:Qe,variant:"contained",color:"primary",disabled:v,sx:{fontSize:"1rem",minWidth:"100px",textTransform:"none",boxShadow:2},children:v?e.jsxs(U,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(qe,{size:20,color:"inherit"}),e.jsx("span",{children:"Updating..."})]}):"Confirm"})]})]}),e.jsx(ft,{open:N,handleClose:()=>E(!1)})]})};export{Pr as default};
