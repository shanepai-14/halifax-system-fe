import{r,a6 as te,a7 as ne,Q as pe,S as U,V as ye,aj as ve,j as e,q as i,ak as fe,al as I,E as ge,F as Q,P as R,T as p,y as k,H as G,I as J,t as K}from"./index-B4lmkI_6.js";import{u as _e,a as be,b as Ce,c as we,A as Se,R as Ae,I as Ie}from"./useInventory-BKGLpoGv.js";import{C as Re,T as ke,S as X,c as T,d as L,e as P,a as l,b as n,f as D}from"./TextField-CUtW5_1o.js";import{R as Te,M as j}from"./SearchOutlined-BYiwTQ9_.js";import{I as Y,B as x}from"./InputLabel-DSTZXsCg.js";import{R as Le}from"./ClearOutlined-DWlcCpxG.js";import{R as Pe}from"./PlusOutlined-BnjNWR0G.js";import{R as De}from"./EyeOutlined-pR4EkLyD.js";import{R as $e}from"./EditOutlined-BbBcElsO.js";import{D as Oe,a as Fe,b as Ne}from"./DialogTitle-D4SGgGov.js";import{S as c}from"./Skeleton-D0Q0LIOq.js";import"./Autocomplete-SQN_jJeH.js";import"./CloseOutlined-Dv1PHuEj.js";var qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"},ze=function(o,h){return r.createElement(te,ne({},o,{ref:h,icon:qe}))},Z=r.forwardRef(ze),Be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},Ee=function(o,h){return r.createElement(te,ne({},o,{ref:h,icon:Be}))},Ve=r.forwardRef(Ee);const ee={low:{color:"error",label:"Low Stock"},normal:{color:"success",label:"Normal"},overstocked:{color:"warning",label:"Overstocked"}},He=[{value:"addition",label:"Addition"},{value:"reduction",label:"Reduction"},{value:"damage",label:"Damage"},{value:"loss",label:"Loss"},{value:"return",label:"Return"},{value:"correction",label:"Correction"}],$=()=>e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(c,{animation:"wave"})}),e.jsx(n,{children:e.jsx(c,{animation:"wave"})}),e.jsx(n,{children:e.jsx(c,{animation:"wave"})}),e.jsx(n,{children:e.jsx(c,{animation:"wave"})}),e.jsx(n,{children:e.jsx(c,{animation:"wave"})}),e.jsx(n,{children:e.jsx(c,{animation:"wave"})}),e.jsx(n,{align:"right",children:e.jsxs(i,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[e.jsx(c,{animation:"wave",variant:"circular",width:32,height:32}),e.jsx(c,{animation:"wave",variant:"circular",width:32,height:32})]})})]}),at=()=>{const _=pe(),[o,h]=r.useState(0),[d,Me]=r.useState(10),[b,O]=r.useState(""),[C,F]=r.useState("All Categories"),[w,N]=r.useState("All Status"),[se,q]=r.useState(!1),[m,S]=r.useState(null),[y,re]=r.useState(0),v=U(ye),z=U(ve),{data:ae=[],isLoading:oe,refetch:B}=_e(),{data:E=[],isLoading:le}=be(),{mutateAsync:ie}=Ce(),{data:V=[],isLoading:ce}=we(),f=ae.map(t=>{const s=v.find(a=>a.id===t.product_id);return{...t,...s,status:de(t.quantity,(s==null?void 0:s.reorder_level)||0)}}).filter(t=>{var g,M,W;const s=((g=t.product_name)==null?void 0:g.toLowerCase().includes(b.toLowerCase()))||((M=t.product_code)==null?void 0:M.toLowerCase().includes(b.toLowerCase())),a=C==="All Categories"||((W=t.product_category_id)==null?void 0:W.toString())===C,u=w==="All Status"||t.status===w.toLowerCase();return s&&a&&u});function de(t,s){return t<=s?"low":t>s*3?"overstocked":"normal"}const xe=()=>{O(""),F("All Categories"),N("All Status")},H=t=>{S(t),q(!0)},he=t=>{S(t)},A=()=>{q(!1),S(null)},ue=async t=>{try{await ie({id:t.id,quantity:t.quantity,adjustment_type:t.type,reason:t.reason,notes:t.notes}),K.success("Inventory adjustment recorded successfully"),B(),A()}catch(s){K.error("Error recording adjustment: "+(s.message||"Unknown error"))}},je=(t,s)=>{re(s)},me=t=>{_(`/app/inventory/${t}`)};return e.jsxs(Re,{maxWidth:"xxl",sx:{mt:0,px:"0!important"},children:[e.jsxs(i,{sx:{mb:4},children:[e.jsxs(fe,{value:y,onChange:je,sx:{mb:3},children:[e.jsx(I,{label:"Current Inventory"}),e.jsx(I,{label:"Adjustments History"}),e.jsx(I,{label:"Inventory Logs"})]}),y===0&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,gap:2},children:[e.jsxs(i,{sx:{display:"flex",gap:2,flex:1},children:[e.jsx(ke,{placeholder:"Search product name or code",variant:"outlined",size:"small",value:b,onChange:t=>O(t.target.value),InputProps:{startAdornment:e.jsx(ge,{position:"start",children:e.jsx(Te,{})})},sx:{minWidth:250}}),e.jsxs(Q,{size:"small",sx:{minWidth:200},children:[e.jsx(Y,{children:"Category"}),e.jsxs(X,{value:C,onChange:t=>F(t.target.value),label:"Category",children:[e.jsx(j,{value:"All Categories",children:"All Categories"}),z.map(t=>e.jsx(j,{value:t.id.toString(),children:t.name},t.id))]})]}),e.jsxs(Q,{size:"small",sx:{minWidth:200},children:[e.jsx(Y,{children:"Stock Status"}),e.jsxs(X,{value:w,onChange:t=>N(t.target.value),label:"Stock Status",children:[e.jsx(j,{value:"All Status",children:"All Status"}),e.jsx(j,{value:"Low",children:"Low Stock"}),e.jsx(j,{value:"Normal",children:"Normal"}),e.jsx(j,{value:"Overstocked",children:"Overstocked"})]})]})]}),e.jsxs(i,{children:[e.jsx(x,{variant:"text",color:"error",sx:{mr:1},onClick:xe,children:e.jsx(Le,{})}),e.jsx(x,{variant:"contained",color:"primary",startIcon:e.jsx(Ve,{}),onClick:()=>B(),sx:{mr:1},children:"Refresh"}),e.jsx(x,{variant:"contained",color:"error",startIcon:e.jsx(Pe,{}),onClick:()=>H({product_id:null}),children:"New Adjustment"})]})]}),f.some(t=>t.status==="low")&&e.jsx(Se,{severity:"warning",sx:{mb:2},icon:e.jsx(Ae,{}),children:"Some products are below their reorder levels. Please check and restock as needed."}),e.jsx(T,{component:R,children:e.jsxs(L,{children:[e.jsx(P,{children:e.jsxs(l,{children:[e.jsx(n,{children:"Product Code"}),e.jsx(n,{children:"Product Name"}),e.jsx(n,{children:"Category"}),e.jsx(n,{children:"Current Qty"}),e.jsx(n,{children:"Reorder Level"}),e.jsx(n,{children:"Status"}),e.jsx(n,{align:"right",children:"Actions"})]})}),e.jsx(D,{children:oe?Array.from(Array(d)).map((t,s)=>e.jsx($,{},s)):f.length===0?e.jsx(l,{children:e.jsx(n,{colSpan:7,align:"center",sx:{py:3},children:e.jsx(p,{variant:"body1",color:"text.secondary",children:"No inventory items found"})})}):f.slice(o*d,o*d+d).map(t=>{var s,a,u;return e.jsxs(l,{hover:!0,children:[e.jsx(n,{children:t.product_code}),e.jsx(n,{children:e.jsx(i,{sx:{display:"flex",alignItems:"center"},children:t.product_name})}),e.jsx(n,{children:((s=z.find(g=>g.id===t.product_category_id))==null?void 0:s.name)||"-"}),e.jsx(n,{children:t.quantity}),e.jsx(n,{children:t.reorder_level}),e.jsx(n,{children:e.jsx(k,{label:(a=ee[t.status])==null?void 0:a.label,color:(u=ee[t.status])==null?void 0:u.color,size:"small"})}),e.jsxs(n,{align:"right",children:[e.jsx(G,{title:"View Product Details",children:e.jsx(J,{onClick:()=>me(t.product_id),children:e.jsx(De,{})})}),e.jsx(G,{title:"Adjust Inventory",children:e.jsx(J,{onClick:()=>H(t),children:e.jsx($e,{})})})]})]},t.product_id)})})]})}),e.jsxs(i,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:[e.jsx(x,{disabled:o===0,onClick:()=>h(o-1),sx:{mr:1},children:"Previous"}),e.jsx(x,{disabled:o>=Math.ceil(f.length/d)-1,onClick:()=>h(o+1),children:"Next"})]})]}),y===1&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(p,{variant:"h6",children:"Inventory Adjustments History"}),e.jsx(x,{variant:"outlined",startIcon:e.jsx(Z,{}),onClick:()=>console.log("Download adjustments report"),children:"Export Report"})]}),e.jsx(T,{component:R,children:e.jsxs(L,{children:[e.jsx(P,{children:e.jsxs(l,{children:[e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Product"}),e.jsx(n,{children:"Adjustment Type"}),e.jsx(n,{children:"Quantity"}),e.jsx(n,{children:"Reason"}),e.jsx(n,{children:"Performed By"}),e.jsx(n,{children:"Notes"})]})}),e.jsx(D,{children:le?Array.from(Array(d)).map((t,s)=>e.jsx($,{},s)):E.length===0?e.jsx(l,{children:e.jsx(n,{colSpan:7,align:"center",sx:{py:3},children:e.jsx(p,{variant:"body1",color:"text.secondary",children:"No adjustment records found"})})}):E.map(t=>{var a;const s=v.find(u=>u.id===t.product_id);return e.jsxs(l,{hover:!0,children:[e.jsx(n,{children:new Date(t.created_at).toLocaleString()}),e.jsx(n,{children:(s==null?void 0:s.product_name)||"Unknown Product"}),e.jsx(n,{children:e.jsx(k,{label:t.adjustment_type.charAt(0).toUpperCase()+t.adjustment_type.slice(1),color:t.adjustment_type==="addition"||t.adjustment_type==="return"?"success":t.adjustment_type==="correction"?"info":"error",size:"small"})}),e.jsx(n,{children:t.adjustment_type==="addition"||t.adjustment_type==="return"?`+${t.quantity}`:`-${t.quantity}`}),e.jsx(n,{children:t.reason}),e.jsx(n,{children:((a=t.user)==null?void 0:a.name)||"System"}),e.jsx(n,{children:t.notes||"-"})]},t.id)})})]})})]}),y===2&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(p,{variant:"h6",children:"Inventory Transaction History"}),e.jsx(x,{variant:"outlined",startIcon:e.jsx(Z,{}),onClick:()=>console.log("Download logs report"),children:"Export Logs"})]}),e.jsx(T,{component:R,children:e.jsxs(L,{children:[e.jsx(P,{children:e.jsxs(l,{children:[e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Product"}),e.jsx(n,{children:"Transaction Type"}),e.jsx(n,{children:"Quantity"}),e.jsx(n,{children:"Reference"}),e.jsx(n,{children:"Before"}),e.jsx(n,{children:"After"})]})}),e.jsx(D,{children:ce?Array.from(Array(d)).map((t,s)=>e.jsx($,{},s)):V.length===0?e.jsx(l,{children:e.jsx(n,{colSpan:7,align:"center",sx:{py:3},children:e.jsx(p,{variant:"body1",color:"text.secondary",children:"No inventory logs found"})})}):V.map(t=>{const s=v.find(a=>a.id===t.product_id);return e.jsxs(l,{hover:!0,children:[e.jsx(n,{children:new Date(t.created_at).toLocaleString()}),e.jsx(n,{children:(s==null?void 0:s.product_name)||"Unknown Product"}),e.jsx(n,{children:e.jsx(k,{label:t.transaction_type.charAt(0).toUpperCase()+t.transaction_type.slice(1),color:t.transaction_type==="purchase"||t.transaction_type==="adjustment_in"?"success":t.transaction_type==="sales"||t.transaction_type==="adjustment_out"?"error":"info",size:"small"})}),e.jsx(n,{children:t.transaction_type==="purchase"||t.transaction_type==="adjustment_in"?`+${t.quantity}`:`-${t.quantity}`}),e.jsx(n,{children:t.reference_type==="purchase_order"?`PO-${t.reference_id}`:t.reference_type==="sales_order"?`SO-${t.reference_id}`:t.reference_type==="adjustment"?`ADJ-${t.reference_id}`:t.reference_id}),e.jsx(n,{children:t.quantity_before}),e.jsx(n,{children:t.quantity_after})]},t.id)})})]})})]})]}),e.jsxs(Oe,{open:se,onClose:A,maxWidth:"md",fullWidth:!0,children:[e.jsx(Fe,{children:m!=null&&m.product_name?`Adjust Inventory: ${m.product_name}`:"New Inventory Adjustment"}),e.jsx(Ne,{children:e.jsx(Ie,{product:m,products:v,adjustmentTypes:He,onSubmit:ue,onCancel:A,onSelectedProduct:he})})]})]})};export{at as default};
