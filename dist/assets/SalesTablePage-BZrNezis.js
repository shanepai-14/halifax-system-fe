import{j as e,T as i,K as ee,aD as te,Z as ae,aE as se,ak as re,r as u,G as l,C as S,y as D,v as ie,F as T,I as R,H as I,l as ne,P as le,z as E,aF as oe,aG as de,aH as ce,aI as z}from"./index-VYacBzdn.js";import{D as he}from"./Download-75ooj2v2.js";import{u as C,w as xe}from"./xlsx-DjuO7_Ju.js";import{f as p,a as v}from"./currencyFormat-BsuV9MhS.js";import{T as g,a,b as ue,c as me,d as je,e as pe}from"./TableRow-F8UK-irz.js";import{S as o}from"./Skeleton-wlVAb656.js";import{C as ve}from"./Container-g1D49Be8.js";import{T as _,S as W}from"./TextField-DcFzWKp_.js";import{R as ge}from"./SearchOutlined-CuhT5l3w.js";import{R as fe}from"./FilterOutlined-9wKfeoPR.js";import{I as A}from"./InputLabel-Cn1m3Ebo.js";import{M as d}from"./MenuItem--hotehpj.js";import{R as be}from"./PlusOutlined-NVaeiLU6.js";import{T as ye}from"./TablePagination-Dq0YRuKk.js";import"./KeyboardArrowRight-CWBZhDWc.js";import"./LastPage-DIxfCoDv.js";const Se=({key:m})=>e.jsxs(g,{children:[e.jsx(a,{children:e.jsx(o,{width:100,height:24,variant:"text"})}),e.jsxs(a,{children:[e.jsx(o,{width:120,height:24,variant:"text"}),e.jsx(i,{variant:"caption",display:"block",children:e.jsx(o,{width:80,height:16,variant:"text"})})]}),e.jsx(a,{children:e.jsx(o,{width:80,height:32,variant:"rounded"})}),e.jsx(a,{children:e.jsx(o,{width:90,height:24,variant:"text"})}),e.jsx(a,{children:e.jsx(o,{width:90,height:24,variant:"text"})}),e.jsx(a,{children:e.jsx(o,{width:90,height:24,variant:"text"})}),e.jsx(a,{children:e.jsx(o,{width:60,height:24,variant:"text"})}),e.jsx(a,{align:"right",children:e.jsx(o,{width:80,height:24,variant:"text",sx:{ml:"auto"}})}),e.jsx(a,{align:"right",children:e.jsx(o,{width:80,height:24,variant:"text",sx:{ml:"auto"}})}),e.jsx(a,{children:e.jsx(o,{width:60,height:32,variant:"rounded"})})]},m),Ne=()=>{const m=ee(),h=te(),s=ae(se),{sales:c,getAllSales:O,getSalesStats:B}=re(),[f,b]=u.useState(0),[x,N]=u.useState(10),[L,w]=u.useState(!0),[y,M]=u.useState({total_sales:0,total_revenue:0,total_profit:0});u.useEffect(()=>{P()},[s.statusFilter,s.deliveredFilter,s.startDate,s.endDate]);const P=async()=>{w(!0);const t={status:s.statusFilter!=="all"?s.statusFilter:void 0,is_delivered:s.deliveredFilter!=="all"?s.deliveredFilter==="true":void 0,date_from:s.startDate||void 0,date_to:s.endDate||void 0,search:s.searchTerm||void 0};await O(t);const r={date_from:t.date_from,date_to:t.date_to},j=await B(r);j&&M(j),w(!1)},$=(t,r)=>{b(r)},G=t=>{N(parseInt(t.target.value,10)),b(0)},H=t=>{h(oe(t.target.value))},k=()=>{b(0),P()},K=t=>{t.key==="Enter"&&k()},U=t=>{h(de(t.target.value))},Y=t=>{h(ce(t.target.value))},V=t=>{h(z({startDate:t.target.value,endDate:s.endDate}))},Z=t=>{h(z({startDate:s.startDate,endDate:t.target.value}))},q=()=>{m("/app/sales")},J=t=>{m(`/app/delivery-report/${t}`)},Q=()=>{const t=C.book_new(),r=c.map(n=>{var F;return{"DR #":n.invoice_number,Customer:n.customer?n.customer.customer_name:"Walk-in Customer",Business:((F=n.customer)==null?void 0:F.business_name)||"-",Status:n.status,"Payment Method":n.payment_method,"Order Date":v(n.order_date),"Delivery Date":v(n.delivery_date),City:n.city||"-",Total:n.total,Received:n.amount_received,Delivered:n.is_delivered?"YES":"NO"}}),j=C.json_to_sheet(r);C.book_append_sheet(t,j,"Sales"),xe(t,`Sales_Export_${new Date().toISOString().split("T")[0]}.xlsx`)},X=t=>{let r;switch(t){case"completed":r="success";break;case"pending":r="warning";break;case"cancelled":r="error";break;case"partially_paid":r="info";break;case"unpaid":r="default";break;default:r="default"}return e.jsx(E,{label:t.replace("_"," ").toUpperCase(),color:r,size:"small"})};return e.jsxs(ve,{maxWidth:"xxl",sx:{mt:0,p:"0!important"},children:[e.jsxs(l,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(l,{item:!0,xs:12,md:4,children:e.jsx(S,{children:e.jsxs(D,{children:[e.jsx(i,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:"Total Sales"}),e.jsx(i,{variant:"h4",children:y.total_sales||0}),e.jsx(i,{variant:"caption",color:"text.secondary",children:"For the selected date range"})]})})}),e.jsx(l,{item:!0,xs:12,md:4,children:e.jsx(S,{children:e.jsxs(D,{children:[e.jsx(i,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:"Total Revenue"}),e.jsx(i,{variant:"h4",children:p(y.total_revenue||0)}),e.jsx(i,{variant:"caption",color:"text.secondary",children:"For the selected date range"})]})})}),e.jsx(l,{item:!0,xs:12,md:4,children:e.jsx(S,{children:e.jsxs(D,{children:[e.jsx(i,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:"Total Profit"}),e.jsx(i,{variant:"h4",children:p(y.total_profit||0)}),e.jsx(i,{variant:"caption",color:"text.secondary",children:"For the selected date range"})]})})})]}),e.jsx(ie,{sx:{mb:3},children:e.jsxs(l,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(l,{item:!0,xs:12,md:2,children:e.jsx(_,{fullWidth:!0,placeholder:"Search by DR number",variant:"outlined",size:"small",value:s.searchTerm,onChange:H,onKeyPress:K,InputProps:{startAdornment:e.jsx(T,{position:"start",children:e.jsx(ge,{})}),endAdornment:e.jsx(T,{position:"end",children:e.jsx(R,{onClick:k,size:"small",children:e.jsx(fe,{})})})}})}),e.jsx(l,{item:!0,xs:6,md:2,children:e.jsxs(I,{fullWidth:!0,size:"small",children:[e.jsx(A,{children:"Status"}),e.jsxs(W,{value:s.statusFilter,onChange:U,label:"Status",children:[e.jsx(d,{value:"all",children:"All Status"}),e.jsx(d,{value:"pending",children:"Pending"}),e.jsx(d,{value:"completed",children:"Completed"}),e.jsx(d,{value:"partially_paid",children:"Partially Paid"}),e.jsx(d,{value:"unpaid",children:"Unpaid"}),e.jsx(d,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx(l,{item:!0,xs:6,md:2,children:e.jsxs(I,{fullWidth:!0,size:"small",children:[e.jsx(A,{children:"Delivery Status"}),e.jsxs(W,{value:s.deliveredFilter,onChange:Y,label:"Delivery Status",children:[e.jsx(d,{value:"all",children:"All"}),e.jsx(d,{value:"true",children:"Delivered"}),e.jsx(d,{value:"false",children:"Not Delivered"})]})]})}),e.jsx(l,{item:!0,xs:6,md:2,children:e.jsx(_,{label:"Start Date",type:"date",value:s.startDate,onChange:V,InputLabelProps:{shrink:!0},size:"small",fullWidth:!0})}),e.jsx(l,{item:!0,xs:6,md:2,children:e.jsx(_,{label:"End Date",type:"date",value:s.endDate,onChange:Z,InputLabelProps:{shrink:!0},size:"small",fullWidth:!0,inputProps:{min:s.startDate}})}),e.jsxs(l,{item:!0,xs:12,md:2,display:"flex",children:[e.jsx(ne,{variant:"contained",color:"primary",startIcon:e.jsx(be,{}),onClick:q,fullWidth:!0,children:"Sale"}),e.jsx(R,{color:"primary",onClick:Q,size:"medium",sx:{border:"1px solid",borderColor:"primary.main",ml:1},title:"Export to Excel",children:e.jsx(he,{})})]})]})}),e.jsx(ue,{component:le,children:e.jsxs(me,{size:"small",children:[e.jsx(je,{children:e.jsxs(g,{children:[e.jsx(a,{children:"DR #"}),e.jsx(a,{children:"Customer"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Method"}),e.jsx(a,{children:"Order Date"}),e.jsx(a,{children:"Delivery Date"}),e.jsx(a,{children:"City"}),e.jsx(a,{align:"right",children:"Total"}),e.jsx(a,{align:"right",children:"Received"}),e.jsx(a,{children:"Delivered"})]})}),e.jsx(pe,{children:L?Array(x).fill(0).map((t,r)=>e.jsx(Se,{},r)):c&&c.length>0?c.slice(f*x,f*x+x).map(t=>e.jsxs(g,{children:[e.jsx(a,{children:e.jsx(i,{variant:"body1",fontWeight:"bold",sx:{cursor:"pointer",color:"blue",textDecoration:"underline"},onClick:()=>J(t.id),children:t.invoice_number})}),e.jsx(a,{children:t.customer?e.jsxs(e.Fragment,{children:[t.customer.customer_name,t.customer.business_name&&e.jsx(i,{variant:"caption",display:"block",sx:{color:"text.secondary"},children:t.customer.business_name})]}):"Walk-in Customer"}),e.jsx(a,{children:X(t.status)}),e.jsx(a,{children:t.payment_method.toUpperCase()}),e.jsx(a,{children:v(t.order_date)}),e.jsx(a,{children:v(t.delivery_date)}),e.jsx(a,{children:t.city||"-"}),e.jsx(a,{align:"right",children:p(t.total)}),e.jsx(a,{align:"right",children:p(t.amount_received)}),e.jsx(a,{children:e.jsx(E,{label:t.is_delivered?"YES":"NO",color:t.is_delivered?"success":"default",size:"small"})})]},t.id)):e.jsx(g,{children:e.jsx(a,{colSpan:10,align:"center",children:e.jsx(i,{variant:"body1",sx:{py:2},children:"No sales found"})})})})]})}),e.jsx(ye,{rowsPerPageOptions:[5,10,25,50],component:"div",count:c?c.length:0,rowsPerPage:x,page:f,onPageChange:$,onRowsPerPageChange:G})]})};export{Ne as default};
