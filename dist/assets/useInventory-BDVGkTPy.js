import{r as f,j as t,K as q,U as u,T as j,Z as A,ak as I,E as w,ao as l,ap as K,aq as R,Y as d,J as P}from"./index-7iJENN8l.js";import{A as S}from"./Autocomplete-qVp13U_M.js";import{T as x,S as W}from"./TextField-DjM1Uxpr.js";import{I as G,a as Q}from"./InputLabel-7T4gFri9.js";import{M as $}from"./MenuItem-HOt1CTeO.js";import{R as D}from"./CloseOutlined-D-4G2BZw.js";import{R as L}from"./SaveOutlined-BpiEpofG.js";const Y=({product:e,products:s,adjustmentTypes:a,onSubmit:v,onCancel:C,onSelectedProduct:F})=>{const[n,g]=f.useState({id:(e==null?void 0:e.id)||"",product_id:(e==null?void 0:e.id)||"",quantity:"",type:"addition",reason:"",notes:"",distribution_price:"",walk_in_price:"",wholesale_price:"",regular_price:""}),[i,b]=f.useState({});f.useEffect(()=>{e&&g(r=>({...r,id:e.id||"",product_id:e.id||""}))},[e]);const T=()=>{const r={};return n.product_id||(r.product_id="Product is required"),(!n.quantity||n.quantity<=0)&&(r.quantity="Quantity must be greater than 0"),n.reason||(r.reason="Reason is required"),n.type==="addition"&&((!n.distribution_price||n.distribution_price<=0)&&(r.distribution_price="Distribution price is required"),(!n.walk_in_price||n.walk_in_price<=0)&&(r.walk_in_price="Walk-in price is required")),b(r),Object.keys(r).length===0},y=r=>{const{name:o,value:c}=r.target;g(m=>{let p={...m,[o]:c};return o==="walk_in_price"&&(p.wholesale_price=c,p.regular_price=c),console.log("Updated formData:",p),p}),i[o]&&b(m=>{const p={...m};return delete p[o],p})},k=(r,o)=>{g(c=>({...c,product_id:o?o.id:"",id:o?o.id:""})),F(o),i.product_id&&b(c=>{const m={...c};return delete m.product_id,m})},E=r=>{r.preventDefault(),T()&&v(n)},h=e||s.find(r=>r.id===n.id),_=n.type==="addition";return t.jsx(q,{component:"form",onSubmit:E,sx:{mt:2},children:t.jsxs(u,{container:!0,spacing:3,children:[t.jsx(u,{item:!0,xs:12,children:t.jsx(S,{value:h||null,onChange:k,options:s||[],getOptionLabel:r=>r?`${r.product_code||""} ${r.product_name||""}`:"",isOptionEqualToValue:(r,o)=>r&&o?r.id===o.id:!1,renderInput:r=>t.jsx(x,{...r,fullWidth:!0,label:"Product",error:!!i.product_id,helperText:i.product_id,disabled:e!==null&&e.product_id})})}),h&&t.jsx(u,{item:!0,xs:12,children:t.jsxs(q,{sx:{mb:2,p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid #e0e0e0"},children:[t.jsx(j,{variant:"subtitle1",fontWeight:"bold",children:"Current Inventory:"}),t.jsxs(j,{children:["Product: ",h.product_name]}),t.jsxs(j,{children:["Current Quantity: ",h.quantity||0]}),t.jsxs(j,{children:["Reorder Level: ",h.reorder_level||"Not set"]})]})}),t.jsx(u,{item:!0,xs:12,md:6,children:t.jsxs(A,{fullWidth:!0,error:!!i.type,children:[t.jsx(G,{children:"Adjustment Type"}),t.jsx(W,{name:"type",value:n.type,onChange:y,label:"Adjustment Type",children:a.map(r=>t.jsx($,{value:r.value,children:r.label},r.value))}),i.type&&t.jsx(Q,{children:i.type})]})}),t.jsx(u,{item:!0,xs:12,md:6,children:t.jsx(x,{fullWidth:!0,label:"Quantity",name:"quantity",type:"number",value:n.quantity,onChange:y,error:!!i.quantity,helperText:i.quantity||"Enter quantity to adjust",InputProps:{inputProps:{min:1}}})}),t.jsx(u,{item:!0,xs:12,sx:{paddingTop:_==!0?"24px!important":"0!important"},children:t.jsx(I,{in:_,sx:{width:"100%"},children:t.jsxs(u,{container:!0,spacing:3,children:[t.jsx(u,{item:!0,xs:12,children:t.jsx(j,{variant:"subtitle2",children:"Pricing Information"})}),t.jsx(u,{item:!0,xs:12,md:6,children:t.jsx(x,{fullWidth:!0,label:"Distribution Price",name:"distribution_price",type:"number",value:n.distribution_price,onChange:y,error:!!i.distribution_price,helperText:i.distribution_price,required:_,InputProps:{inputProps:{min:0,step:"0.01"}}})}),t.jsx(u,{item:!0,xs:12,md:6,children:t.jsx(x,{fullWidth:!0,label:"Walk-in Price",name:"walk_in_price",type:"number",value:n.walk_in_price,onChange:y,error:!!i.walk_in_price,helperText:i.walk_in_price,required:_,InputProps:{inputProps:{min:0,step:"0.01"}}})})]})})}),t.jsx(u,{item:!0,xs:12,children:t.jsx(x,{fullWidth:!0,label:"Reason",name:"reason",value:n.reason,onChange:y,error:!!i.reason,helperText:i.reason||"Provide reason for this adjustment",required:!0})}),t.jsx(u,{item:!0,xs:12,children:t.jsx(x,{fullWidth:!0,label:"Additional Notes",name:"notes",value:n.notes,onChange:y,multiline:!0,rows:3,helperText:"Optional: Add any additional notes or details"})}),t.jsx(u,{item:!0,xs:12,children:t.jsxs(q,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2},children:[t.jsx(w,{variant:"outlined",color:"inherit",onClick:C,startIcon:t.jsx(D,{}),children:"Cancel"}),t.jsx(w,{type:"submit",variant:"contained",color:"primary",startIcon:t.jsx(L,{}),children:"Save Adjustment"})]})})]})})},Z=()=>l({queryKey:["inventory"],queryFn:async()=>(await d.get("/inventory")).data.data}),z=e=>l({queryKey:["inventory",e],queryFn:async()=>(await d.get(`/inventory/product/${e}`)).data.data,enabled:!!e}),X=()=>{const e=K();return R({mutationFn:async s=>(await d.post("/inventory/adjustments",s)).data,onSuccess:(s,a)=>{e.invalidateQueries(["inventory"]),e.invalidateQueries(["inventory",a.product_id]),e.invalidateQueries(["inventory-adjustments"]),e.invalidateQueries(["inventory-adjustments",a.product_id])},onError:s=>{var a,v;P.error(((v=(a=s.response)==null?void 0:a.data)==null?void 0:v.message)||"Failed to create adjustment")}})},V=(e={})=>l({queryKey:["inventory-adjustments",e],queryFn:async()=>(await d.get("/inventory/adjustments",{params:e})).data.data}),ee=e=>l({queryKey:["inventory-adjustments",e],queryFn:async()=>(await d.get(`/inventory/adjustments/product/${e}`)).data.data,enabled:!!e}),te=(e={})=>l({queryKey:["inventory-logs",e],queryFn:async()=>(await d.get("/inventory/logs",{params:e})).data.data}),re=e=>l({queryKey:["inventory-logs",e],queryFn:async()=>(await d.get(`/inventory/logs/product/${e}`)).data.data,enabled:!!e}),ne=e=>l({queryKey:["product-transactions",e],queryFn:async()=>(await d.get(`/inventory/transactions/product/${e}`)).data.data,enabled:!!e}),se=e=>l({queryKey:["product-reports",e],queryFn:async()=>(await d.get(`/inventory/report/product/${e}`)).data.data,enabled:!!e}),ie=()=>l({queryKey:["inventory-summary-stats"],queryFn:async()=>{var e,s;try{return(await d.get("/inventory/summary-stats")).data.data}catch(a){throw console.error("Error fetching inventory stats:",a),P.error(((s=(e=a.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to fetch inventory statistics"),a}}});export{Y as I,V as a,X as b,te as c,ie as d,z as e,ee as f,re as g,ne as h,se as i,Z as u};
