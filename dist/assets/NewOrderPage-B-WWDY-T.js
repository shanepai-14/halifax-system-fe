import{g as te,a as se,s as N,r as l,u as Me,ar as Pe,as as Ge,j as e,d as re,e as ne,c as Te,at as ze,m as ke,b as Q,au as Ne,h as xe,i as pe,av as Ue,aw as Ve,ao as Ye,a8 as U,a9 as V,ax as Ke,P as G,H as me,I as D,ay as Qe,q as j,E as qe,y as Ze,az as Je,T as p,G as z,C as Xe,x as et,F as je,D as L,S as fe,aj as tt,ad as st,aA as rt,Q as nt,aB as it}from"./index-DMPyTngB.js";import{l as ot}from"./index-OvYkGGpj.js";import{g as at}from"./fileHelper-DtQg9PBz.js";import{T as _,c as Fe,d as ie,e as oe,a as O,b as a,f as ae,S as lt}from"./TextField-DZyZK0vq.js";import{R as ct,M as X}from"./SearchOutlined-BojlxnqM.js";import{D as dt,a as ut,b as ht}from"./DialogTitle-P729Siqj.js";import{D as xt}from"./DialogActions-CI9nfQEj.js";import{B as ee,I as pt,F as mt}from"./InputLabel-Dma56rhx.js";import{R as ge}from"./PlusOutlined-B4UYib1W.js";import{C as ye}from"./CardMedia-BnzJDVv-.js";import{c as ve,a as B,j as be,k as jt,F as ft,b as gt,d as A}from"./index.esm-DGmbntZv.js";import{A as yt}from"./Autocomplete-CzNCDO1-.js";import{S as vt,F as H}from"./FormControlLabel-CqN4mVz0.js";import{R as bt}from"./DeleteOutlined-D-rIF22X.js";import{C as _e}from"./CircularProgress-CFXVLVCW.js";import{R as Ct}from"./SaveOutlined-Bo4ngWU2.js";import{S as wt}from"./Snackbar-Cw1LZrHl.js";import{A as Rt}from"./Alert-DScCzCRQ.js";import"./Close-CLv_2-i5.js";function St(t){return se("MuiFormGroup",t)}te("MuiFormGroup",["root","row","error"]);const It=t=>{const{classes:n,row:i,error:h}=t;return ne({root:["root",i&&"row",h&&"error"]},St,n)},Mt=N("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:i}=t;return[n.root,i.row&&n.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),Pt=l.forwardRef(function(n,i){const h=Me({props:n,name:"MuiFormGroup"}),{className:f,row:v=!1,...P}=h,b=Pe(),g=Ge({props:h,muiFormControl:b,states:["error"]}),o={...h,row:v,error:g.error},x=It(o);return e.jsx(Mt,{className:re(x.root,f),ownerState:o,ref:i,...P})}),Tt=Te(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),zt=Te(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),kt=N("span",{shouldForwardProp:ze})({position:"relative",display:"flex"}),qt=N(Tt)({transform:"scale(1)"}),Ft=N(zt)(ke(({theme:t})=>({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}}]})));function Oe(t){const{checked:n=!1,classes:i={},fontSize:h}=t,f={...t,checked:n};return e.jsxs(kt,{className:i.root,ownerState:f,children:[e.jsx(qt,{fontSize:h,className:i.background,ownerState:f}),e.jsx(Ft,{fontSize:h,className:i.dot,ownerState:f})]})}const De=l.createContext(void 0);function _t(){return l.useContext(De)}function Ot(t){return se("MuiRadio",t)}const Ce=te("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),Dt=t=>{const{classes:n,color:i,size:h}=t,f={root:["root",`color${Q(i)}`,h!=="medium"&&`size${Q(h)}`]};return{...n,...ne(f,Ot,n)}},At=N(vt,{shouldForwardProp:t=>ze(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:i}=t;return[n.root,i.size!=="medium"&&n[`size${Q(i.size)}`],n[`color${Q(i.color)}`]]}})(ke(({theme:t})=>({color:(t.vars||t).palette.text.secondary,[`&.${Ce.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:xe(t.palette.action.active,t.palette.action.hoverOpacity)}}},...Object.entries(t.palette).filter(pe()).map(([n])=>({props:{color:n,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[n].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:xe(t.palette[n].main,t.palette.action.hoverOpacity)}}})),...Object.entries(t.palette).filter(pe()).map(([n])=>({props:{color:n,disabled:!1},style:{[`&.${Ce.checked}`]:{color:(t.vars||t).palette[n].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function $t(t,n){return typeof n=="object"&&n!==null?t===n:String(t)===String(n)}const we=e.jsx(Oe,{checked:!0}),Re=e.jsx(Oe,{}),E=l.forwardRef(function(n,i){const h=Me({props:n,name:"MuiRadio"}),{checked:f,checkedIcon:v=we,color:P="primary",icon:b=Re,name:g,onChange:o,size:x="medium",className:I,disabled:T,disableRipple:c=!1,...d}=h,w=Pe();let y=T;w&&typeof y>"u"&&(y=w.disabled),y??(y=!1);const M={...h,disabled:y,disableRipple:c,color:P,size:x},C=Dt(M),s=_t();let m=f;const Y=Ne(o,s&&s.onChange);let $=g;return s&&(typeof m>"u"&&(m=$t(s.value,h.value)),typeof $>"u"&&($=s.name)),e.jsx(At,{type:"radio",icon:l.cloneElement(b,{fontSize:Re.props.fontSize??x}),checkedIcon:l.cloneElement(v,{fontSize:we.props.fontSize??x}),disabled:y,ownerState:M,classes:C,name:$,checked:m,onChange:Y,ref:i,className:re(C.root,I),...d})});function Wt(t){return se("MuiRadioGroup",t)}te("MuiRadioGroup",["root","row","error"]);const Bt=t=>{const{classes:n,row:i,error:h}=t;return ne({root:["root",i&&"row",h&&"error"]},Wt,n)},Ht=l.forwardRef(function(n,i){const{actions:h,children:f,className:v,defaultValue:P,name:b,onChange:g,value:o,...x}=n,I=l.useRef(null),T=Bt(n),[c,d]=Ue({controlled:o,default:P,name:"RadioGroup"});l.useImperativeHandle(h,()=>({focus:()=>{let C=I.current.querySelector("input:not(:disabled):checked");C||(C=I.current.querySelector("input:not(:disabled)")),C&&C.focus()}}),[]);const w=Ve(i,I),y=Ye(b),M=l.useMemo(()=>({name:y,onChange(C){d(C.target.value),g&&g(C,C.target.value)},value:c}),[y,g,d,c]);return e.jsx(De.Provider,{value:M,children:e.jsx(Pt,{role:"radiogroup",ref:w,className:re(T.root,v),...x,children:f})})});var Et={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zM464 544H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H212V612h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200z"}}]},name:"appstore",theme:"outlined"},Lt=function(n,i){return l.createElement(U,V({},n,{ref:i,icon:Et}))},Gt=l.forwardRef(Lt),Nt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 000 13.8z"}}]},name:"menu-fold",theme:"outlined"},Ut=function(n,i){return l.createElement(U,V({},n,{ref:i,icon:Nt}))},Vt=l.forwardRef(Ut),Yt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM142.4 642.1L298.7 519a8.84 8.84 0 000-13.9L142.4 381.9c-5.8-4.6-14.4-.5-14.4 6.9v246.3a8.9 8.9 0 0014.4 7z"}}]},name:"menu-unfold",theme:"outlined"},Kt=function(n,i){return l.createElement(U,V({},n,{ref:i,icon:Yt}))},Qt=l.forwardRef(Kt),Zt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},Jt=function(n,i){return l.createElement(U,V({},n,{ref:i,icon:Zt}))},Xt=l.forwardRef(Jt),es={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},ts=function(n,i){return l.createElement(U,V({},n,{ref:i,icon:es}))},ss=l.forwardRef(ts);const Se=({products:t,categories:n,onAddProduct:i,dialogOpen:h,selectedProduct:f,onCloseDialog:v,onMinimize:P,isMinimized:b})=>{const[g,o]=l.useState(""),[x,I]=l.useState("table"),[T,c]=l.useState(t),[d,w]=l.useState(null);l.useEffect(()=>{let s=t;d&&(s=s.filter(m=>m.category===d)),g&&(s=s.filter(m=>m.name.toLowerCase().includes(g.toLowerCase())||m.code.toLowerCase().includes(g.toLowerCase()))),c(s)},[g,t,d]);const y=()=>e.jsx(Fe,{sx:{maxHeight:"800px",overflowY:"auto"},children:e.jsxs(ie,{stickyHeader:!0,size:"small",children:[e.jsx(oe,{children:e.jsxs(O,{children:[e.jsx(a,{children:"Code"}),e.jsx(a,{children:"Name"}),e.jsx(a,{align:"right",children:"Regular $"}),e.jsx(a,{align:"right",children:"Walk In $"}),e.jsx(a,{align:"right",children:"Whole sale $"}),e.jsx(a,{align:"right",children:"Available"}),e.jsx(a,{align:"right",children:" "})]})}),e.jsxs(ae,{children:[T.map(s=>e.jsxs(O,{children:[e.jsx(a,{sx:{padding:"0px!important"},children:s.code}),e.jsx(a,{sx:{padding:"0px!important"},children:s.name}),e.jsxs(a,{align:"right",sx:{padding:"0px!important"},children:["₱",s.regular_price]}),e.jsxs(a,{align:"right",sx:{padding:"0px!important"},children:["₱",s.walk_in_price]}),e.jsxs(a,{align:"right",sx:{padding:"0px!important"},children:["₱",s.wholesale_price]}),e.jsx(a,{align:"right",sx:{padding:"0px!important"},children:parseInt(s.quantity,10)}),e.jsx(a,{align:"right",sx:{padding:"0px!important"},children:e.jsx(D,{color:"success",onClick:()=>i(s),disabled:s.quantity===0,children:e.jsx(ge,{})})})]},s.id)),T.length===0&&e.jsx(O,{children:e.jsx(a,{colSpan:5,align:"center",children:e.jsx(p,{variant:"body2",color:"textSecondary",children:"No products found"})})})]})]})}),M=()=>e.jsx(j,{sx:{height:"calc(100vh - 100px)",overflowY:"auto",p:1},children:e.jsxs(z,{container:!0,spacing:2,children:[T.map(s=>e.jsx(z,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(Xe,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[s.product_image?e.jsx(ye,{component:"img",image:at(s.product_image),sx:{height:100,bgcolor:s.quantity>0?"primary.white":"grey.300",display:"flex",alignItems:"center",justifyContent:"center",color:"white"}}):e.jsx(ye,{component:"div",sx:{height:100,bgcolor:s.quantity>0?"primary.light":"grey.300",display:"flex",alignItems:"center",justifyContent:"center",color:"white"},children:e.jsx(p,{variant:"h6",children:s.code})}),e.jsxs(et,{sx:{flexGrow:1},children:[e.jsx(p,{gutterBottom:!0,variant:"subtitle1",component:"div",children:s.name}),e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:1},children:[e.jsxs(p,{variant:"body2",color:"text.secondary",children:["Price: ₱",s.regular_price]}),e.jsxs(p,{variant:"body2",color:"text.secondary",children:["Stock: ",s.quantity]})]}),e.jsx(j,{sx:{mt:2},children:e.jsx(ee,{variant:"contained",color:"success",fullWidth:!0,startIcon:e.jsx(ge,{}),onClick:()=>i(s),disabled:s.quantity===0,children:"Add to Order"})})]})]})},s.id)),T.length===0&&e.jsx(z,{item:!0,xs:12,children:e.jsx(p,{variant:"body2",color:"textSecondary",align:"center",children:"No products found"})})]})}),C=()=>e.jsxs(j,{sx:{p:0,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(j,{sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(_,{fullWidth:!0,variant:"outlined",placeholder:"Search by name or code",size:"small",value:g,onChange:s=>o(s.target.value),InputProps:{startAdornment:e.jsx(qe,{position:"start",children:e.jsx(ct,{})})}}),e.jsx(me,{title:"Minimize",children:e.jsx(D,{onClick:P,color:"primary",children:e.jsx(Vt,{})})})]}),e.jsxs(j,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(j,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:n.map(s=>e.jsx(Ze,{label:`${s.name}`,onClick:()=>w(d===s.name?null:s.name),color:d===s.name?"primary":"default",variant:d===s.name?"filled":"outlined"},s.name))}),e.jsxs(j,{children:[e.jsx(D,{onClick:()=>I("table"),color:x==="table"?"primary":"default",children:e.jsx(Je,{})}),e.jsx(D,{onClick:()=>I("card"),color:x==="card"?"primary":"default",children:e.jsx(Gt,{})})]})]}),e.jsx(j,{sx:{flexGrow:1,overflow:"hidden"},children:x==="table"?e.jsx(y,{}):e.jsx(M,{})}),e.jsxs(dt,{open:h,onClose:v,children:[e.jsx(ut,{children:"Product Out of Stock"}),e.jsxs(ht,{children:['The product "',f==null?void 0:f.name,'" is currently out of stock.']}),e.jsx(xt,{children:e.jsx(ee,{onClick:v,children:"OK"})})]})]});return b?e.jsx(Ke,{in:b,children:e.jsx(G,{elevation:6,sx:{position:"absolute",top:25,left:35,zIndex:20,borderRadius:"50%",overflow:"visible",width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"primary.main",color:"white","&:hover":{opacity:.9}},children:e.jsx(me,{title:"Expand Products",children:e.jsx(D,{onClick:P,color:"inherit",sx:{width:"100%",height:"100%"},children:e.jsx(Qt,{})})})})}):e.jsx(Qe,{in:!b,children:e.jsx(G,{sx:{p:2,height:"100%"},children:e.jsx(C,{})})})},Ie=t=>t?new Date(t).toISOString().split("T")[0]:"",rs=ve().shape({customer:ve().nullable().required("Customer is required"),phone:B().required("Phone is required"),address:B().required("Address is required"),city:B().required("City is required"),orderDate:be().required("Order date is required"),deliveryDate:be().required("Delivery date is required").min(jt("orderDate"),"Delivery date must be after order date"),paymentMethod:B().required("Payment method is required"),customerType:B().required("Customer type is required")}),ns=l.forwardRef(({orderItems:t,totalPrice:n,customers:i,onSubmit:h,onRemoveProduct:f,onQuantityChange:v,onDiscountChange:P,onPrint:b,isSubmitting:g=!1},o)=>{const x={customer:null,phone:"",address:"",city:"",orderDate:Ie(new Date),deliveryDate:Ie(new Date(Date.now()+864e5)),paymentMethod:"cash",customerType:"walkin"},I=(c,d)=>{switch(d){case"walkin":return c.walk_in_price||c.regular_price;case"wholesale":return c.wholesale_price||c.regular_price;case"regular":default:return c.regular_price}},T=(c,d)=>{const w=I(c,d),y=Number(w)*c.quantity,M=parseFloat(c.discount)||0,C=y*(M/100);return y-C};return e.jsx(ft,{initialValues:x,validationSchema:rs,onSubmit:(c,{setSubmitting:d})=>{h(c)},children:({errors:c,touched:d,setFieldValue:w,values:y,isValid:M,dirty:C})=>e.jsxs(gt,{children:[e.jsx("div",{ref:o,children:e.jsxs(j,{sx:{width:"100%",border:o?"1px solid transparent":"none"},children:[e.jsx(j,{sx:{mb:0,textAlign:"center"},children:e.jsx(p,{variant:"h5",gutterBottom:!0,children:"DELIVERY REPORT"})}),e.jsxs(z,{container:!0,spacing:2,sx:{paddingTop:"0!important"},children:[e.jsx(z,{item:!0,xs:12,md:6,sx:{paddingTop:"0!important"},children:e.jsx(A,{name:"customer",component:yt,size:"small",options:i,getOptionLabel:s=>s.customer_name,renderInput:s=>e.jsx(_,{...s,label:"Customer",error:d.customer&&!!c.customer,helperText:d.customer&&c.customer,fullWidth:!0,margin:"normal"}),onChange:(s,m)=>{w("customer",m),w("phone",m?m.contact_number:""),w("address",m?m.address:""),w("city",m?m.city:"")}})}),e.jsx(z,{item:!0,xs:12,md:6,sx:{paddingTop:"0!important"},children:e.jsxs(je,{fullWidth:!0,margin:"normal",children:[e.jsx(pt,{id:"customer-type-label",children:"Customer Type"}),e.jsxs(A,{size:"small",as:lt,labelId:"customer-type-label",id:"customerType",name:"customerType",label:"Customer Type",value:y.customerType,onChange:s=>w("customerType",s.target.value),children:[e.jsx(X,{value:"regular",children:"Regular"}),e.jsx(X,{value:"walkin",children:"Walk-in"}),e.jsx(X,{value:"wholesale",children:"Wholesale"})]}),d.customerType&&c.customerType&&e.jsx(p,{color:"error",variant:"caption",children:c.customerType})]})}),e.jsx(z,{item:!0,xs:12,md:12,sx:{paddingTop:"0!important"},children:e.jsx(A,{as:_,name:"address",label:"Address",fullWidth:!0,margin:"normal",error:d.address&&!!c.address,helperText:d.address&&c.address})}),e.jsxs(z,{item:!0,xs:12,md:6,sx:{paddingTop:"0!important"},children:[e.jsx(A,{as:_,name:"phone",label:"Phone",fullWidth:!0,margin:"normal",error:d.phone&&!!c.phone,helperText:d.phone&&c.phone}),e.jsx(A,{as:_,name:"orderDate",label:"Order Date",type:"date",fullWidth:!0,margin:"normal",InputLabelProps:{shrink:!0},error:d.orderDate&&!!c.orderDate,helperText:d.orderDate&&c.orderDate})]}),e.jsxs(z,{item:!0,xs:12,md:6,sx:{paddingTop:"0!important"},children:[e.jsx(j,{children:e.jsx(A,{as:_,name:"city",label:"City",fullWidth:!0,margin:"normal",error:d.city&&!!c.city,helperText:d.city&&c.city})}),e.jsx(j,{children:e.jsx(A,{as:_,name:"deliveryDate",label:"Delivery Date",type:"date",fullWidth:!0,margin:"normal",InputLabelProps:{shrink:!0},error:d.deliveryDate&&!!c.deliveryDate,helperText:d.deliveryDate&&c.deliveryDate})})]}),e.jsx(z,{item:!0,xs:12,md:12,sx:{paddingTop:"0!important"},children:e.jsxs(je,{component:"fieldset",margin:"normal",fullWidth:!0,children:[e.jsx(mt,{component:"legend",children:"Payment Method"}),e.jsxs(Ht,{row:!0,name:"paymentMethod",value:y.paymentMethod,onChange:s=>w("paymentMethod",s.target.value),children:[e.jsx(H,{value:"cod",control:e.jsx(E,{}),label:"COD"}),e.jsx(H,{value:"cash",control:e.jsx(E,{}),label:"Cash"}),e.jsx(H,{value:"cheque",control:e.jsx(E,{}),label:"Cheque"}),e.jsx(H,{value:"online",control:e.jsx(E,{}),label:"Online Payment"}),e.jsx(H,{value:"term",control:e.jsx(E,{}),label:"Term"})]}),d.paymentMethod&&c.paymentMethod&&e.jsx(p,{color:"error",variant:"caption",children:c.paymentMethod})]})})]}),e.jsx(L,{sx:{my:2}}),e.jsx(p,{variant:"h6",gutterBottom:!0,children:"Order Items"}),e.jsx(Fe,{component:G,sx:{mb:2,maxHeight:"300px",overflow:"auto"},children:e.jsxs(ie,{size:"small",stickyHeader:!0,children:[e.jsx(oe,{children:e.jsxs(O,{children:[e.jsx(a,{children:"Product"}),e.jsx(a,{align:"right",children:"Price"}),e.jsx(a,{align:"center",children:"Quantity"}),e.jsx(a,{align:"right",children:"Discount (%)"}),e.jsx(a,{align:"right",children:"Subtotal"}),e.jsx(a,{align:"right"})]})}),e.jsx(ae,{children:t.length===0?e.jsx(O,{children:e.jsx(a,{colSpan:6,align:"center",children:"No items added to order"})}):t.map(s=>e.jsxs(O,{children:[e.jsx(a,{children:s.name}),e.jsxs(a,{align:"right",children:["₱",Number(I(s,y.customerType)).toFixed(2)]}),e.jsxs(a,{align:"center",sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:[e.jsx(D,{size:"small",onClick:()=>v(s.id,-1),children:e.jsx(Xt,{})}),e.jsx(_,{value:s.quantity,onChange:m=>v(s.id,0,parseInt(m.target.value)||0),onKeyDown:m=>{m.key==="ArrowLeft"&&v(s.id,-1),m.key==="ArrowRight"&&v(s.id,1)},inputProps:{style:{textAlign:"center",width:"40px"}},size:"small"}),e.jsx(D,{size:"small",onClick:()=>v(s.id,1),children:e.jsx(ss,{})})]}),e.jsx(a,{align:"right",children:e.jsx(_,{value:s.discount||0,onChange:m=>P(s.id,m.target.value),InputProps:{style:{textAlign:"right",width:"80px"},min:0,max:100,endAdornment:e.jsx(qe,{position:"end",children:"%"})},size:"small"})}),e.jsxs(a,{align:"right",children:["₱",T(s,y.customerType).toFixed(2)]}),e.jsx(a,{align:"right",children:e.jsx(D,{onClick:()=>f(s.id),children:e.jsx(bt,{})})})]},s.id))})]})}),e.jsxs(j,{sx:{mt:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(p,{variant:"body2",children:["Payment Method: ",y.paymentMethod.charAt(0).toUpperCase()+y.paymentMethod.slice(1)]}),e.jsxs(p,{variant:"h6",children:["Total Amount: ₱",t.reduce((s,m)=>s+T(m,y.customerType),0).toFixed(2)]})]})]})}),e.jsx(j,{sx:{mt:3},children:e.jsx(j,{sx:{mt:2,display:"flex",justifyContent:"center"},children:e.jsx(ee,{type:"submit",variant:"contained",color:"primary",size:"large",fullWidth:!0,startIcon:g?e.jsx(_e,{size:24,color:"inherit"}):e.jsx(Ct,{}),disabled:t.length===0||g||!M,children:g?"Submitting...":"Submit Delivery Report"})})})]})})}),is=({deliveryReportData:t,contentRef:n})=>{var v,P,b,g;if(!t||!t.orderItems)return null;const i=o=>{const x=o.price*o.quantity,I=parseFloat(o.discount)||0,T=x*(I/100);return x-T},h=()=>t.orderItems.reduce((o,x)=>o+i(x),0),f=o=>{if(!o)return"-";try{return new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch{return"-"}};return e.jsxs(j,{ref:n,sx:{display:"none","@media print":{display:"block",p:4,bgcolor:"white"}},children:[e.jsxs(j,{sx:{mb:4,textAlign:"center"},children:[e.jsx(p,{variant:"h4",sx:{mb:1,fontWeight:"bold"},children:"DELIVERY REPORT"}),e.jsxs(p,{variant:"h6",children:["DR #: ",t.invoiceNumber||"DR-"+Math.floor(1e5+Math.random()*9e5)]}),e.jsxs(p,{variant:"body1",children:["Date: ",f(t.orderDate)]})]}),e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",mb:4},children:[e.jsxs(j,{children:[e.jsx(p,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:"Customer Information:"}),e.jsx(p,{children:((v=t.customer)==null?void 0:v.name)||"-"}),e.jsx(p,{children:((P=t.customer)==null?void 0:P.address)||"-"}),e.jsxs(p,{children:["City: ",((b=t.customer)==null?void 0:b.city)||"-"]}),e.jsxs(p,{children:["Phone: ",((g=t.customer)==null?void 0:g.phone)||"-"]})]}),e.jsxs(j,{sx:{textAlign:"right"},children:[e.jsxs(p,{sx:{mb:1},children:[e.jsx("strong",{children:"Order Date:"})," ",f(t.orderDate)]}),e.jsxs(p,{sx:{mb:1},children:[e.jsx("strong",{children:"Delivery Date:"})," ",f(t.deliveryDate)]}),e.jsxs(p,{sx:{mb:1},children:[e.jsx("strong",{children:"Payment Method:"})," ",t.paymentMethod?t.paymentMethod.charAt(0).toUpperCase()+t.paymentMethod.slice(1):"Cash"]})]})]}),e.jsx(L,{sx:{mb:4}}),e.jsx(p,{variant:"h6",sx:{mb:2,fontWeight:"bold"},children:"Order Items"}),e.jsxs(ie,{sx:{mb:4},children:[e.jsx(oe,{children:e.jsxs(O,{sx:{backgroundColor:"#f5f5f5"},children:[e.jsx(a,{sx:{fontWeight:"bold"},children:"Product"}),e.jsx(a,{sx:{fontWeight:"bold"},children:"Code"}),e.jsx(a,{sx:{fontWeight:"bold"},children:"Price"}),e.jsx(a,{sx:{fontWeight:"bold"},children:"Quantity"}),e.jsx(a,{sx:{fontWeight:"bold"},children:"Discount"}),e.jsx(a,{sx:{fontWeight:"bold"},children:"Subtotal"})]})}),e.jsxs(ae,{children:[t.orderItems.map((o,x)=>e.jsxs(O,{children:[e.jsx(a,{children:o.name}),e.jsx(a,{children:o.code}),e.jsxs(a,{children:["₱",Number(o.price).toFixed(2)]}),e.jsx(a,{children:o.quantity}),e.jsxs(a,{children:[(parseFloat(o.discount)||0).toFixed(2),"%"]}),e.jsxs(a,{children:["₱",i(o).toFixed(2)]})]},x)),e.jsxs(O,{children:[e.jsx(a,{colSpan:5,sx:{textAlign:"right",fontWeight:"bold"},children:"Total:"}),e.jsxs(a,{sx:{fontWeight:"bold"},children:["₱",h().toFixed(2)]})]})]})]}),e.jsx(j,{sx:{display:"flex",justifyContent:"flex-end",mb:4},children:e.jsx(G,{elevation:1,sx:{p:2,width:"300px"},children:e.jsxs(p,{variant:"h6",sx:{fontWeight:"bold"},children:["Grand Total: ₱",h().toFixed(2)]})})}),e.jsx(j,{sx:{mt:6},children:e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",mt:8},children:[e.jsxs(j,{sx:{width:"200px"},children:[e.jsx(L,{}),e.jsx(p,{sx:{mt:1},children:"Prepared by"})]}),e.jsxs(j,{sx:{width:"200px"},children:[e.jsx(L,{}),e.jsx(p,{sx:{mt:1},children:"Checked by"})]}),e.jsxs(j,{sx:{width:"200px"},children:[e.jsx(L,{}),e.jsx(p,{sx:{mt:1},children:"Received by"})]})]})})]})},Ss=()=>{const t=fe(tt),n=fe(st),{inventory:i,getAllInventory:h,isInventoryLoading:f,createSale:v,isSalesLoading:P}=rt(),[b,g]=l.useState([]),[o,x]=l.useState([]),[I,T]=l.useState(0),[c,d]=l.useState(!1),[w,y]=l.useState(null),[M,C]=l.useState(null),[s,m]=l.useState(!1),[Y,$]=l.useState(!1),[Z,K]=l.useState({open:!1,message:"",type:"info"}),Ae=l.useRef(),le=l.useRef(),$e=nt();l.useEffect(()=>{h()},[]),l.useEffect(()=>{i&&i.length>0&&g(i)},[i]),l.useEffect(()=>{const r=o.reduce((R,u)=>{const S=Number(u.regular_price)*u.quantity,W=parseFloat(u.discount)||0,q=S*(W/100);return R+(S-q)},0);T(r)},[o]);const ce=()=>{m(!s)},We=ot.useReactToPrint({contentRef:le}),de=r=>{if(r.quantity>0){const R=o.find(u=>u.id===r.id);x(R?o.map(u=>u.id===r.id?{...u,quantity:u.quantity+1}:u):[...o,{...r,quantity:1,discount:0,distribution_price:r.distribution_price||r.cost_price||0}]),g(b.map(u=>u.id===r.id?{...u,quantity:u.quantity-1}:u))}else y(r),d(!0)},Be=r=>{const R=o.find(u=>u.id===r);R&&(x(o.filter(u=>u.id!==r)),g(b.map(u=>u.id===r?{...u,quantity:u.quantity+R.quantity}:u)))},He=(r,R,u=null)=>{x(o.map(S=>{if(S.id===r){const W=S.quantity,q=u!==null?u:Math.max(0,S.quantity+R);return g(b.map(k=>k.id===r?{...k,quantity:k.quantity+(W-q)}:k)),{...S,quantity:q}}return S}).filter(S=>S.quantity>0))},Ee=(r,R)=>{const u=R===""?0:Math.min(Math.max(0,parseFloat(R)||0),100);x(o.map(S=>S.id===r?{...S,discount:u}:S))},Le=async r=>{var R,u,S,W;if(o.length===0){K({open:!0,message:"Please add at least one item to the order",type:"error"});return}$(!0);try{const q={customer_id:(R=r.customer)==null?void 0:R.id,customer:{id:(u=r.customer)==null?void 0:u.id,customer_name:((S=r.customer)==null?void 0:S.customer_name)||"Walk-in Customer",contact_number:r.phone||"",email:((W=r.customer)==null?void 0:W.email)||"",address:r.address||"",city:r.city||""},customer_type:r.customerType,payment_method:r.paymentMethod,order_date:r.orderDate,delivery_date:r.deliveryDate,address:r.address,city:r.city,phone:r.phone,amount_received:0,items:o.map(F=>({product_id:F.id,quantity:F.quantity,distribution_price:F.distribution_price||F.cost_price||0,sold_price:J(F,r.customerType),discount:F.discount||0}))},k=await v(q);k&&(C({...r,invoice_number:k.invoice_number,id:k.id,orderItems:o.map(F=>({...F,price:J(F,r.customerType)}))}),K({open:!0,message:"Sale created successfully!",type:"success"}),x([]),h(),$e(`/app/delivery-report/${k.id}`,{state:{reportData:k}}),r.printAfterSubmit&&ue(M||r))}catch(q){console.error("Error creating sale:",q),K({open:!0,message:q.message||"Failed to create sale",type:"error"})}finally{$(!1)}},J=(r,R)=>{switch(R){case"walkin":return r.walk_in_price||r.regular_price;case"wholesale":return r.wholesale_price||r.regular_price;case"regular":default:return r.regular_price}},ue=r=>{const R={customer:r.customer,orderDate:r.orderDate,deliveryDate:r.deliveryDate,paymentMethod:r.paymentMethod,orderItems:o.map(u=>({...u,price:J(u,r.customerType)})),totalPrice:I,invoiceNumber:r.invoice_number||(M==null?void 0:M.invoice_number)||"DR-"+Math.floor(1e5+Math.random()*9e5)};C(R),setTimeout(()=>{We()},100)},he=()=>{K(r=>({...r,open:!1}))};return e.jsxs(e.Fragment,{children:[e.jsxs(z,{container:!0,spacing:2,sx:{position:"relative"},children:[!s&&e.jsx(z,{item:!0,xs:12,md:7,sx:{transition:"all 0.3s ease"},children:e.jsx(Se,{products:b,categories:n,onAddProduct:de,dialogOpen:c,selectedProduct:w,onCloseDialog:()=>d(!1),onMinimize:ce,isMinimized:s})}),e.jsx(z,{item:!0,xs:12,md:s?12:5,sx:{transition:"all 0.3s ease",zIndex:1},children:e.jsx(G,{sx:{p:2},children:e.jsx(ns,{ref:Ae,orderItems:o,totalPrice:I,customers:t,onSubmit:Le,onRemoveProduct:Be,onQuantityChange:He,onDiscountChange:Ee,onPrint:ue,isSubmitting:Y})})}),s&&e.jsx(Se,{products:b,categories:n,onAddProduct:de,dialogOpen:c,selectedProduct:w,onCloseDialog:()=>d(!1),onMinimize:ce,isMinimized:s})]}),e.jsx("div",{style:{display:"none"},children:e.jsx(is,{deliveryReportData:M,contentRef:le})}),e.jsx(it,{sx:{color:"#fff",zIndex:r=>r.zIndex.drawer+1},open:f||P||Y,children:e.jsx(_e,{color:"inherit"})}),e.jsx(wt,{open:Z.open,autoHideDuration:6e3,onClose:he,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(Rt,{onClose:he,severity:Z.type,sx:{width:"100%"},children:Z.message})})]})};export{Ss as default};
