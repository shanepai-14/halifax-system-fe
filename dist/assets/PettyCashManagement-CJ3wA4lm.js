import{r as g,ar as ze,as as We,aK as qe,a0 as G,bc as Rr,bd as kr,be as zr,bf as Wr,bg as Nr,bh as Cr,bi as ir,bj as Y,Y as $,bk as Br,bl as Q,J as I,bm as Mr,bn as $r,bo as Or,bp as er,bq as Sr,br as Be,bs as Lr,bt as qr,bu as Vr,bv as Hr,bw as Ur,bx as Gr,by as De,bz as Me,bA as Fe,bB as Kr,bC as Jr,bD as Yr,bE as rr,bF as nr,bG as sr,bH as Qr,bI as Xr,bJ as Zr,bK as en,j as e,K as P,T as n,N,a4 as te,E as B,_ as ce,Z as J,bL as rn,U as d,P as H,L as Pe,X as S,V as ee,W as re,bM as nn,bN as sn,bO as tn,bP as an,bQ as ln,$ as K,bR as tr,bS as on}from"./index-orFgd98j.js";import{u as $e,w as cn}from"./xlsx-DjuO7_Ju.js";import{D as ae}from"./Dialog-CJfNyQGa.js";import{D as le,a as ie}from"./DialogTitle-De1rQybo.js";import{R as ne}from"./CloseOutlined-D9DvhdUh.js";import{T as M,S as X,c as he,d as me,e as pe,a as C,b as t,f as je}from"./TextField-jw0UhpAo.js";import{R as Re}from"./DollarOutlined-COGJtBBm.js";import{D as oe}from"./DialogActions-HvuHVbtK.js";import{R as or}from"./SaveOutlined-DBuu_DsU.js";import{I as Z,a as Te}from"./InputLabel-IXyX-zKa.js";import{R as Ee}from"./PlusOutlined-Bx8cPzyP.js";import{M as W}from"./MenuItem-Bqy3fqba.js";import{R as Ve}from"./DeleteOutlined-6PPnVGIo.js";import{A as cr}from"./Alert-BsqrTYiS.js";import{A as dn}from"./Autocomplete-ZmdAGzbj.js";import{f as O}from"./currencyFormat-th2sljt-.js";import{l as dr}from"./index-CyGXfHoW.js";import{f as fe}from"./dateUtils-Dj0n6tHU.js";import{R as we}from"./PrinterOutlined-Dqt3zX8p.js";import{R as un}from"./ReloadOutlined-BxExwpAS.js";import{T as ur,a as _e}from"./Tabs-DtFV1JG9.js";import{R as xn}from"./DownloadOutlined-CsaOT7EI.js";import{R as xr}from"./SearchOutlined-Cm9d63e_.js";import{R as He}from"./FilterOutlined-C4CfMZxJ.js";import{R as Se}from"./EyeOutlined-CUs4NrWe.js";import{R as ke}from"./CheckCircleOutlined-BNCCC1_q.js";import{R as Ue}from"./EditOutlined-Bl5vMiFy.js";import{R as hr}from"./CloseCircleOutlined-BGVvjiVS.js";import{D as hn}from"./DialogContentText-B-Var3e7.js";import{a as mn,R as Le}from"./TeamOutlined-BiSKW-PW.js";import{R as pn}from"./WarningOutlined-JlcIYrzB.js";import"./Close-DGviKW4F.js";import"./KeyboardArrowRight-BS0A_AjO.js";var jn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-600-80h56c4.4 0 8-3.6 8-8V560c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v144c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V384c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v320c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V462c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v242c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V304c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v400c0 4.4 3.6 8 8 8z"}}]},name:"bar-chart",theme:"outlined"},gn=function(a,i){return g.createElement(ze,We({},a,{ref:i,icon:jn}))},fn=g.forwardRef(gn),vn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm47.7-395.2l-25.4-5.9V348.6c38 5.2 61.5 29 65.5 58.2.5 4 3.9 6.9 7.9 6.9h44.9c4.7 0 8.4-4.1 8-8.8-6.1-62.3-57.4-102.3-125.9-109.2V263c0-4.4-3.6-8-8-8h-28.1c-4.4 0-8 3.6-8 8v33c-70.8 6.9-126.2 46-126.2 119 0 67.6 49.8 100.2 102.1 112.7l24.7 6.3v142.7c-44.2-5.9-69-29.5-74.1-61.3-.6-3.8-4-6.6-7.9-6.6H363c-4.7 0-8.4 4-8 8.7 4.5 55 46.2 105.6 135.2 112.1V761c0 4.4 3.6 8 8 8h28.4c4.4 0 8-3.6 8-8.1l-.2-31.7c78.3-6.9 134.3-48.8 134.3-124-.1-69.4-44.2-100.4-109-116.4zm-68.6-16.2c-5.6-1.6-10.3-3.1-15-5-33.8-12.2-49.5-31.9-49.5-57.3 0-36.3 27.5-57 64.5-61.7v124zM534.3 677V543.3c3.1.9 5.9 1.6 8.8 2.2 47.3 14.4 63.2 34.4 63.2 65.1 0 39.1-29.4 62.6-72 66.4z"}}]},name:"dollar-circle",theme:"outlined"},bn=function(a,i){return g.createElement(ze,We({},a,{ref:i,icon:vn}))},yn=g.forwardRef(bn),_n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file",theme:"outlined"},En=function(a,i){return g.createElement(ze,We({},a,{ref:i,icon:_n}))},wn=g.forwardRef(En),Tn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 464H528V448h312v128zm0 264H184V184h656v200H496c-17.7 0-32 14.3-32 32v192c0 17.7 14.3 32 32 32h344v200zM580 512a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"wallet",theme:"outlined"},An=function(a,i){return g.createElement(ze,We({},a,{ref:i,icon:Tn}))},Dn=g.forwardRef(An);const ve=()=>{const r=qe(),a=G(Rr),i=G(kr),m=G(zr),o=G(Wr),j=G(Nr),E=G(Cr),b=G(ir);return{funds:a,transactions:i,stats:m,balance:o,loading:j,error:E,filters:b,getBalance:async()=>{var _,s;try{r(Y());const l=await $.get("/petty-cash/balance");return r(Br(l.data.data)),l.data.data}catch(l){return console.error("Error fetching petty cash balance:",l),r(Q(l.message)),I.error(((s=(_=l.response)==null?void 0:_.data)==null?void 0:s.message)||"Failed to fetch petty cash balance"),null}},getAllFunds:async(_={})=>{var s,l;try{r(Y());const h={search:_.search,status:_.status!=="all"?_.status:void 0,date_from:_.startDate,date_to:_.endDate,sort_by:_.sort_by||"date",sort_order:_.sort_order||"desc"},v=await $.get("/petty-cash/funds",{params:h});return r(Mr(v.data.data)),v.data.data}catch(h){return console.error("Error fetching petty cash funds:",h),r(Q(h.message)),I.error(((l=(s=h.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to fetch petty cash funds"),[]}},createFund:async _=>{var s,l;try{r(Y());const v={...(await $.post("/petty-cash/funds",_)).data.data};return r($r(v)),I.success("Petty cash fund created successfully"),v}catch(h){throw console.error("Error creating petty cash fund:",h),r(Q(h.message)),I.error(((l=(s=h.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to create petty cash fund"),h}},approveFund:async _=>{var s,l;try{r(Y());const v={...(await $.put(`/petty-cash/funds/${_}/approve`)).data.data};return r(Or(v)),I.success("Petty cash fund approved successfully"),v}catch(h){throw console.error("Error approving petty cash fund:",h),r(Q(h.message)),I.error(((l=(s=h.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to approve petty cash fund"),h}},getAllTransactions:async(_={})=>{var s,l;try{r(Y());const h={search:_.search,status:_.status!=="all"?_.status:void 0,employee_id:_.employeeId,date_from:_.startDate,date_to:_.endDate},v=await $.get("/petty-cash/transactions",{params:h});return r(er(v.data.data)),v.data.data}catch(h){return console.error("Error fetching petty cash transactions:",h),r(Q(h.message)),I.error(((l=(s=h.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to fetch petty cash transactions"),[]}},createTransaction:async _=>{var s,l;try{r(Y());let h;_ instanceof FormData?h=await $.post("/petty-cash/transactions",_,{headers:{"Content-Type":"multipart/form-data"}}):h=await $.post("/petty-cash/transactions",_);const v={...h.data.data,created_at:new Date().toISOString()};return r(Sr(v)),I.success("Petty cash transaction created successfully"),v}catch(h){throw console.error("Error creating petty cash transaction:",h),r(Q(h.message)),I.error(((l=(s=h.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to create petty cash transaction"),h}},settleTransaction:async(_,s)=>{var l,h;try{r(Y());let v;s instanceof FormData?v=await $.put(`/petty-cash/transactions/${_}/settle`,s,{headers:{"Content-Type":"multipart/form-data"}}):v=await $.put(`/petty-cash/transactions/${_}/settle`,s);const L={...v.data.data};return r(Be(L)),I.success("Petty cash transaction settled successfully"),L}catch(v){throw console.error("Error settling petty cash transaction:",v),r(Q(v.message)),I.error(((h=(l=v.response)==null?void 0:l.data)==null?void 0:h.message)||"Failed to settle petty cash transaction"),v}},approveTransaction:async _=>{var s,l;try{r(Y());const v={...(await $.put(`/petty-cash/transactions/${_}/approve`)).data.data};return r(Be(v)),I.success("Petty cash transaction approved successfully"),v}catch(h){throw console.error("Error approving petty cash transaction:",h),r(Q(h.message)),I.error(((l=(s=h.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to approve petty cash transaction"),h}},cancelTransaction:async(_,s)=>{var l,h;try{r(Y());const v=await $.put(`/petty-cash/transactions/${_}/cancel`,{reason:s});return r(Be(v.data.data)),I.success("Petty cash transaction cancelled successfully"),v.data.data}catch(v){throw console.error("Error cancelling petty cash transaction:",v),r(Q(v.message)),I.error(((h=(l=v.response)==null?void 0:l.data)==null?void 0:h.message)||"Failed to cancel petty cash transaction"),v}},getStats:async()=>{var _,s;try{r(Y());const l=await $.get("/petty-cash/stats");return r(Lr(l.data.data)),l.data.data}catch(l){return console.error("Error fetching petty cash stats:",l),r(Q(l.message)),I.error(((s=(_=l.response)==null?void 0:_.data)==null?void 0:s.message)||"Failed to fetch petty cash statistics"),null}},getEmployeeTransactions:async(_,s={})=>{var l,h;try{r(Y());const v={status:s.status!=="all"?s.status:void 0,date_from:s.startDate,date_to:s.endDate,sort_by:s.sort_by||"date",sort_order:s.sort_order||"desc"},L=await $.get(`/petty-cash/employees/${_}/transactions`,{params:v});return r(er(L.data.data)),L.data.data}catch(v){return console.error("Error fetching employee transactions:",v),r(Q(v.message)),I.error(((h=(l=v.response)==null?void 0:l.data)==null?void 0:h.message)||"Failed to fetch employee transactions"),[]}}}},Ae=()=>{const r=qe(),a=G(qr),i=G(Vr),m=G(Hr),o=G(Ur),j=G(Gr);return{employees:a,stats:i,loading:m,error:o,filters:j,getAllEmployees:async(f={})=>{var p,u;try{r(De());const c={search:f.search,status:f.status!=="all"?f.status:void 0,department:f.department!=="all"?f.department:void 0,sort_by:f.sort_by||"created_at",sort_order:f.sort_order||"desc"},F=await $.get("/employees",{params:c});return r(Me(F.data.data)),F.data.data}catch(c){return console.error("Error fetching employees:",c),r(Fe(c.message)),I.error(((u=(p=c.response)==null?void 0:p.data)==null?void 0:u.message)||"Failed to fetch employees"),[]}},getEmployeeById:async f=>{var p,u;try{r(De());const c=await $.get(`/employees/${f}`);return r(Me([c.data.data])),c.data.data}catch(c){return console.error("Error fetching employee:",c),r(Fe(c.message)),I.error(((u=(p=c.response)==null?void 0:p.data)==null?void 0:u.message)||"Failed to fetch employee"),null}},createEmployee:async f=>{var p,u;try{r(Kr());const c=await $.post("/employees",f);return r(Jr(c.data.data)),I.success("Employee created successfully"),c.data.data}catch(c){throw console.error("Error creating employee:",c),r(Yr(c.message)),I.error(((u=(p=c.response)==null?void 0:p.data)==null?void 0:u.message)||"Failed to create employee"),c}},updateEmployee:async(f,p)=>{var u,c;try{r(rr());const F=await $.put(`/employees/${f}`,p);return r(nr(F.data.data)),I.success("Employee updated successfully"),F.data.data}catch(F){throw console.error("Error updating employee:",F),r(sr(F.message)),I.error(((c=(u=F.response)==null?void 0:u.data)==null?void 0:c.message)||"Failed to update employee"),F}},deleteEmployee:async f=>{var p,u;try{return r(Qr()),await $.delete(`/employees/${f}`),r(Xr(f)),I.success("Employee deleted successfully"),!0}catch(c){throw console.error("Error deleting employee:",c),r(Zr(c.message)),I.error(((u=(p=c.response)==null?void 0:p.data)==null?void 0:u.message)||"Failed to delete employee"),c}},getEmployeeStats:async()=>{var f,p;try{r(De());const u=await $.get("/employees/stats");return r(en(u.data.data)),u.data.data}catch(u){return console.error("Error fetching employee statistics:",u),r(Fe(u.message)),I.error(((p=(f=u.response)==null?void 0:f.data)==null?void 0:p.message)||"Failed to fetch employee statistics"),null}},getTrashedEmployees:async()=>{var f,p;try{r(De());const u=await $.get("/employees/trashed");return r(Me(u.data.data)),u.data.data}catch(u){return console.error("Error fetching trashed employees:",u),r(Fe(u.message)),I.error(((p=(f=u.response)==null?void 0:f.data)==null?void 0:p.message)||"Failed to fetch trashed employees"),[]}},restoreEmployee:async f=>{var p,u;try{r(rr());const c=await $.post(`/employees/${f}/restore`);return r(nr(c.data.data)),I.success("Employee restored successfully"),c.data.data}catch(c){throw console.error("Error restoring employee:",c),r(sr(c.message)),I.error(((u=(p=c.response)==null?void 0:p.data)==null?void 0:u.message)||"Failed to restore employee"),c}}}},Fn=({open:r,onClose:a,onSuccess:i})=>{const[m,o]=g.useState({date:new Date().toISOString().split("T")[0],amount:"",description:""}),[j,E]=g.useState({}),{createFund:b,loading:A}=ve(),D=y=>{const{name:f,value:p}=y.target;o(u=>({...u,[f]:p})),j[f]&&E(u=>({...u,[f]:null}))},z=()=>{const y={};return m.date||(y.date="Date is required"),m.amount?parseFloat(m.amount)<=0&&(y.amount="Amount must be greater than 0"):y.amount="Amount is required",m.description.trim()||(y.description="Description is required"),E(y),Object.keys(y).length===0},k=async y=>{if(y.preventDefault(),!!z())try{const f={...m,amount:parseFloat(m.amount)},p=await b(f);w(!0,p)}catch(f){console.error("Error adding fund:",f)}},w=(y=!1,f=null)=>{o({date:new Date().toISOString().split("T")[0],amount:"",description:""}),E({}),y?i(f):a()};return e.jsxs(ae,{open:r,onClose:()=>w(),maxWidth:"sm",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(P,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(n,{variant:"h6",children:"Add Petty Cash Fund"}),e.jsx(N,{edge:"end",color:"inherit",onClick:()=>w(),"aria-label":"close",children:e.jsx(ne,{})})]})}),e.jsxs("form",{onSubmit:k,children:[e.jsxs(ie,{children:[e.jsx(M,{margin:"dense",fullWidth:!0,label:"Date",type:"date",name:"date",value:m.date,onChange:D,error:!!j.date,helperText:j.date,InputLabelProps:{shrink:!0}}),e.jsx(M,{margin:"dense",fullWidth:!0,label:"Amount",type:"number",name:"amount",value:m.amount,onChange:D,error:!!j.amount,helperText:j.amount,InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(Re,{})})}}),e.jsx(M,{margin:"dense",fullWidth:!0,label:"Description",name:"description",value:m.description,onChange:D,error:!!j.description,helperText:j.description,multiline:!0,rows:3})]}),e.jsxs(oe,{children:[e.jsx(B,{onClick:()=>w(),color:"primary",disabled:A,children:"Cancel"}),e.jsx(B,{type:"submit",variant:"contained",color:"primary",disabled:A,startIcon:A?e.jsx(ce,{size:24}):null,children:A?"Submitting...":"Add Fund"})]})]})]})},In=({value:r,onChange:a,error:i,helperText:m,name:o="purpose",label:j="Purpose *"})=>{const[E,b]=g.useState([]),[A,D]=g.useState(!1),[z,k]=g.useState(!1),[w,y]=g.useState("");g.useEffect(()=>{f()},[]);const f=async()=>{D(!0);try{const s=await $.get("/purposes");b(s.data.data)}catch(s){console.error("Error loading purposes:",s),I.error("Failed to load purposes")}finally{D(!1)}},p=s=>{console.log(s.target.value),a({target:{name:o,value:s.target.value}})},u=()=>{k(!0)},c=()=>{k(!1),y("")},F=async()=>{var s,l;if(!w.trim()){I.error("Purpose name cannot be empty");return}try{const v=(await $.post("/purposes",{name:w})).data.data;b([...E,v]),a({target:{name:o,value:v.id}}),I.success("Purpose created successfully"),k(!1),y("")}catch(h){console.error("Error creating purpose:",h),I.error(((l=(s=h.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to create purpose")}},_=async(s,l)=>{var h,v;l.stopPropagation();try{await $.delete(`/purposes/${s.id}`),b(E.filter(L=>L.id!==s.id)),r===s.id&&a({target:{name:o,value:""}}),I.success("Purpose deleted successfully")}catch(L){console.error("Error deleting purpose:",L),I.error(((v=(h=L.response)==null?void 0:h.data)==null?void 0:v.message)||"Failed to delete purpose")}};return e.jsx(e.Fragment,{children:z?e.jsxs(P,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[e.jsx(M,{fullWidth:!0,label:"New Purpose Name",value:w,onChange:s=>y(s.target.value),autoFocus:!0,size:"small",margin:"dense"}),e.jsx(N,{color:"primary",onClick:F,size:"small",sx:{mt:1},children:e.jsx(or,{})}),e.jsx(N,{onClick:c,size:"small",sx:{mt:1},children:e.jsx(ne,{})})]}):e.jsxs(J,{fullWidth:!0,error:!!i,margin:"dense",children:[e.jsx(Z,{id:`${o}-label`,children:j}),e.jsx(X,{labelId:`${o}-label`,value:r||"",onChange:p,label:j,disabled:A,endAdornment:e.jsx(te,{position:"end",children:e.jsx(N,{onClick:u,edge:"end",size:"small",sx:{mr:1},children:e.jsx(Ee,{})})}),renderValue:s=>{const l=E.find(h=>h.name===s);return(l==null?void 0:l.name)||""},children:E.length===0?e.jsx(W,{disabled:!0,children:A?"Loading...":"No purposes available"}):E.map(s=>e.jsxs(W,{value:s.name,sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:s.name}),e.jsx(N,{size:"small",color:"error",onClick:l=>_(s,l),children:e.jsx(Ve,{})})]},s.name))}),m&&e.jsx(Te,{children:m})]})})},Pn=({value:r,onChange:a,error:i,helperText:m,name:o="expense",label:j="Expense *"})=>{const[E,b]=g.useState([]),[A,D]=g.useState(!1),[z,k]=g.useState(!1),[w,y]=g.useState("");g.useEffect(()=>{f()},[]);const f=async()=>{D(!0);try{const s=await $.get("/expenses");b(s.data.data)}catch(s){console.error("Error loading expenses:",s),I.error("Failed to load expenses")}finally{D(!1)}},p=s=>{a({target:{name:o,value:s.target.value}})},u=()=>{k(!0)},c=()=>{k(!1),y("")},F=async()=>{var s,l;if(!w.trim()){I.error("Expense name cannot be empty");return}try{const v=(await $.post("/expenses",{name:w})).data.data;b([...E,v]),a({target:{name:o,value:v.id}}),I.success("Expense created successfully"),k(!1),y("")}catch(h){console.error("Error creating expense:",h),I.error(((l=(s=h.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to create expense")}},_=async(s,l)=>{var h,v;l.stopPropagation();try{await $.delete(`/expenses/${s.id}`),b(E.filter(L=>L.id!==s.id)),r===s.id&&a({target:{name:o,value:""}}),I.success("Expense deleted successfully")}catch(L){console.error("Error deleting expense:",L),I.error(((v=(h=L.response)==null?void 0:h.data)==null?void 0:v.message)||"Failed to delete expense")}};return e.jsx(e.Fragment,{children:z?e.jsxs(P,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[e.jsx(M,{fullWidth:!0,label:"New Expense Name",value:w,onChange:s=>y(s.target.value),autoFocus:!0,size:"small",margin:"dense"}),e.jsx(N,{color:"primary",onClick:F,size:"small",sx:{mt:1},children:e.jsx(or,{})}),e.jsx(N,{onClick:c,size:"small",sx:{mt:1},children:e.jsx(ne,{})})]}):e.jsxs(J,{fullWidth:!0,error:!!i,margin:"dense",children:[e.jsx(Z,{id:`${o}-label`,children:j}),e.jsx(X,{labelId:`${o}-label`,value:r||"",onChange:p,label:j,disabled:A,endAdornment:e.jsx(te,{position:"end",children:e.jsx(N,{onClick:u,edge:"end",size:"small",sx:{mr:1},children:e.jsx(Ee,{})})}),renderValue:s=>{const l=E.find(h=>h.name===s);return(l==null?void 0:l.name)||""},children:E.length===0?e.jsx(W,{disabled:!0,children:A?"Loading...":"No expenses available"}):E.map(s=>e.jsxs(W,{value:s.name,sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:s.name}),e.jsx(N,{size:"small",color:"error",onClick:l=>_(s,l),children:e.jsx(Ve,{})})]},s.name))}),m&&e.jsx(Te,{children:m})]})})},Rn=({open:r,onClose:a,onSuccess:i,employees:m,balance:o})=>{const[j,E]=g.useState({employee_id:"",purpose:"",expense:"",description:"",amount_issued:""}),[b,A]=g.useState({}),{createTransaction:D,loading:z}=ve(),k=p=>{const{name:u,value:c}=p.target;E(F=>({...F,[u]:c})),b[u]&&A(F=>({...F,[u]:null}))},w=()=>{const p={};return j.employee_id||(p.employee_id="Employee is required"),j.purpose.trim()||(p.purpose="Purpose is required"),j.expense.trim()||(p.expense="Expense is required"),j.amount_issued?parseFloat(j.amount_issued)<=0?p.amount_issued="Amount must be greater than 0":parseFloat(j.amount_issued)>o&&(p.amount_issued="Amount cannot exceed available balance"):p.amount_issued="Amount is required",A(p),Object.keys(p).length===0},y=async p=>{if(p.preventDefault(),!!w())try{const u={...j,amount_issued:parseFloat(j.amount_issued)},c=await D(u);f(!0,c)}catch(u){console.error("Error adding transaction:",u)}},f=(p=!1,u=null)=>{E({employee_id:"",purpose:"",expense:"",description:"",amount_issued:""}),A({}),p?i(u):a()};return e.jsxs(ae,{open:r,onClose:()=>f(),maxWidth:"sm",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(P,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(n,{variant:"h6",children:"New Petty Cash Transaction"}),e.jsx(N,{edge:"end",color:"inherit",onClick:()=>f(),"aria-label":"close",children:e.jsx(ne,{})})]})}),e.jsxs("form",{onSubmit:y,children:[e.jsxs(ie,{children:[e.jsxs(cr,{severity:"info",sx:{mb:2},children:["Available Balance: ",new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(o)]}),e.jsx(J,{fullWidth:!0,margin:"dense",error:!!b.employee_id,children:e.jsx(dn,{id:"employee-autocomplete",options:m||[],getOptionLabel:p=>`${p.full_name} - ${p.position}`,value:m.find(p=>p.id===j.employee_id)||null,onChange:(p,u)=>{k({target:{name:"employee_id",value:u?u.id:""}})},renderInput:p=>e.jsx(M,{...p,label:"Employee *",error:!!b.employee_id,helperText:b.employee_id,InputProps:{...p.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(te,{position:"start",children:e.jsx(rn,{})}),p.InputProps.startAdornment]})}}),noOptionsText:"No employees available",loading:m.length===0,loadingText:"Loading employees..."})}),e.jsx(In,{value:j.purpose,onChange:k,error:!!b.purpose,helperText:b.purpose,name:"purpose",label:"Purpose *"}),e.jsx(Pn,{value:j.expense,onChange:k,error:!!b.expense,helperText:b.expense,name:"expense",label:"Expense Type *"}),e.jsx(M,{margin:"dense",fullWidth:!0,label:"Description",name:"description",value:j.description,onChange:k,multiline:!0,rows:2}),e.jsx(M,{margin:"dense",fullWidth:!0,label:"Amount to Issue *",type:"number",name:"amount_issued",value:j.amount_issued,onChange:k,error:!!b.amount_issued,helperText:b.amount_issued,InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(Re,{})})}})]}),e.jsxs(oe,{children:[e.jsx(B,{onClick:()=>f(),color:"primary",disabled:z,children:"Cancel"}),e.jsx(B,{type:"submit",variant:"contained",color:"primary",disabled:z||!m.length,startIcon:z?e.jsx(ce,{size:24}):null,children:z?"Submitting...":"Create Transaction"})]})]})]})},mr=({open:r,onClose:a,onSuccess:i,transaction:m})=>{var _;const[o,j]=g.useState({amount_spent:"",amount_returned:"",remarks:"",receipt_attachment:null}),[E,b]=g.useState({}),[A,D]=g.useState(""),[z,k]=g.useState(0),{settleTransaction:w,loading:y}=ve();g.useEffect(()=>{m&&(j({amount_spent:"",amount_returned:"",remarks:"",receipt_attachment:null}),b({}),D(""))},[m]),g.useEffect(()=>{if(m&&o.amount_spent){const s=parseFloat(m.amount_issued),l=parseFloat(o.amount_spent)||0,h=s-l;k(h>=0?h:0),h>=0&&j(v=>({...v,amount_returned:Number(h)}))}},[o.amount_spent,m]);const f=s=>{const{name:l,value:h}=s.target;j(v=>({...v,[l]:h})),E[l]&&b(v=>({...v,[l]:null}))},p=s=>{const l=s.target.files[0];if(D(""),l){if(l.size>2*1024*1024){D("File size must be less than 2MB");return}if(!["image/jpeg","image/png","application/pdf"].includes(l.type)){D("Only JPG, PNG, and PDF files are allowed");return}j(v=>({...v,receipt_attachment:l}))}},u=()=>{const s={};if(o.amount_spent?parseFloat(o.amount_spent)<0?s.amount_spent="Amount spent cannot be negative":m&&parseFloat(o.amount_spent)>parseFloat(m.amount_issued)&&(s.amount_spent="Amount spent cannot exceed issued amount"):s.amount_spent="Amount spent is required",o.amount_returned===null||o.amount_returned===""||o.amount_returned===void 0?s.amount_returned="Amount returned is required":parseFloat(o.amount_returned)<0&&(s.amount_returned="Amount returned cannot be negative"),m&&o.amount_spent&&o.amount_returned&&!s.amount_spent&&!s.amount_returned){const l=parseFloat(m.amount_issued),h=parseFloat(o.amount_spent),v=parseFloat(o.amount_returned);Math.abs(h+v-l)>.01&&(s.amount_returned="Total of spent and returned must equal issued amount")}return b(s),Object.keys(s).length===0},c=async s=>{if(s.preventDefault(),!(!u()||A))try{let l;o.receipt_attachment?(l=new FormData,l.append("amount_spent",o.amount_spent),l.append("amount_returned",o.amount_returned),l.append("remarks",o.remarks),l.append("receipt_attachment",o.receipt_attachment)):l={amount_spent:parseFloat(o.amount_spent),amount_returned:parseFloat(o.amount_returned),remarks:o.remarks},await w(m.id,l),F(!0)}catch(l){console.error("Error settling transaction:",l)}},F=(s=!1)=>{j({amount_spent:"",amount_returned:"",remarks:"",receipt_attachment:null}),b({}),D(""),s?i(s):a()};return m?e.jsxs(ae,{open:r,onClose:()=>F(),maxWidth:"sm",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(P,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(n,{variant:"h6",children:"Settle Transaction"}),e.jsx(N,{edge:"end",color:"inherit",onClick:()=>F(),"aria-label":"close",children:e.jsx(ne,{})})]})}),e.jsxs("form",{onSubmit:c,children:[e.jsxs(ie,{children:[e.jsxs(cr,{severity:"info",sx:{mb:2},children:["Transaction Reference: ",m.transaction_reference,e.jsx("br",{}),"Employee: ",(_=m.employee)==null?void 0:_.full_name,e.jsx("br",{}),"Issued Amount: ",O(m.amount_issued)]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(M,{margin:"dense",fullWidth:!0,label:"Amount Spent *",type:"number",name:"amount_spent",value:o.amount_spent,onChange:f,error:!!E.amount_spent,helperText:E.amount_spent,InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(Re,{})})}})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(M,{margin:"dense",fullWidth:!0,label:"Amount Returned *",type:"number",name:"amount_returned",value:o.amount_returned,onChange:f,error:!!E.amount_returned,helperText:E.amount_returned,InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(Re,{})})}})})]}),o.amount_spent&&e.jsxs(n,{variant:"body2",color:"textSecondary",sx:{mt:1},children:["Remaining amount to be returned: ",O(z)]}),e.jsx(M,{margin:"dense",fullWidth:!0,label:"Remarks",name:"remarks",value:o.remarks,onChange:f,multiline:!0,rows:2}),e.jsxs(P,{sx:{mt:2},children:[e.jsx(n,{variant:"body2",gutterBottom:!0,children:"Receipt Attachment"}),e.jsxs(B,{variant:"outlined",component:"label",startIcon:e.jsx(wn,{}),fullWidth:!0,children:["Upload Receipt",e.jsx("input",{type:"file",hidden:!0,accept:"image/jpeg,image/png,application/pdf",onChange:p})]}),o.receipt_attachment&&e.jsxs(n,{variant:"caption",display:"block",sx:{mt:1},children:["Selected file: ",o.receipt_attachment.name]}),A&&e.jsx(Te,{error:!0,children:A})]})]}),e.jsxs(oe,{children:[e.jsx(B,{onClick:()=>F(),color:"primary",disabled:y,children:"Cancel"}),e.jsx(B,{type:"submit",variant:"contained",color:"primary",disabled:y,startIcon:y?e.jsx(ce,{size:24}):null,children:y?"Submitting...":"Settle Transaction"})]})]})]}):null},kn=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",ar=({open:r,onClose:a,transaction:i,isNew:m=!1})=>{var b,A,D,z,k,w,y;const o=g.useRef(),j=dr.useReactToPrint({contentRef:o});if(!i)return null;const E=f=>({issued:"ISSUED",settled:"SETTLED",approved:"APPROVED",cancelled:"CANCELLED"})[f]||f.toUpperCase();return e.jsxs(ae,{open:r,onClose:a,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsxs(le,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2},children:[e.jsx(n,{variant:"h6",children:m?"New Transaction Receipt":"Transaction Receipt"}),e.jsxs(P,{children:[e.jsx(N,{color:"primary",onClick:j,sx:{mr:1},children:e.jsx(we,{})}),e.jsx(N,{onClick:a,children:e.jsx(ne,{})})]})]}),e.jsx(ie,{dividers:!0,children:e.jsxs(P,{ref:o,sx:{p:3},children:[e.jsxs(P,{sx:{textAlign:"center",mb:3},children:[e.jsx(n,{variant:"h4",children:"PETTY CASH TRANSACTION"}),e.jsx(n,{variant:"h6",children:i.transaction_reference}),e.jsx(P,{sx:{display:"inline-block",border:1,borderColor:"divider",borderRadius:1,px:2,py:.5,mt:1,backgroundColor:i.status==="approved"?"success.light":i.status==="issued"?"primary.light":i.status==="settled"?"info.light":"error.light"},children:e.jsx(n,{variant:"subtitle1",fontWeight:"bold",children:E(i.status)})})]}),e.jsxs(d,{container:!0,spacing:2,sx:{mb:3},children:[e.jsxs(d,{item:!0,xs:6,children:[e.jsx(n,{children:"Halifax Glass & Aluminum Supply"}),e.jsx(n,{children:"Malagamot Road, Panacan"}),e.jsx(n,{children:"glasshalifax@gmail.com"}),e.jsx(n,{children:"0939 924 3876"})]}),e.jsxs(d,{item:!0,xs:6,sx:{textAlign:"right"},children:[e.jsxs(n,{children:[e.jsx("strong",{children:"Date:"})," ",kn(i.created_at)]}),e.jsxs(n,{children:[e.jsx("strong",{children:"Purpose:"})," ",i.purpose]}),e.jsxs(n,{children:[e.jsx("strong",{children:"Expense:"})," ",i.expense]}),i.status==="settled"||i.status==="approved"?e.jsxs(n,{children:[e.jsx("strong",{children:"Settled on:"})," ",fe(i.updated_at)]}):null]})]}),e.jsxs(H,{variant:"outlined",sx:{p:2,mb:3},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Employee Information"}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsxs(d,{item:!0,xs:6,children:[e.jsxs(n,{children:[e.jsx("strong",{children:"Name:"})," ",((b=i.employee)==null?void 0:b.full_name)||"N/A"]}),e.jsxs(n,{children:[e.jsx("strong",{children:"Position:"})," ",((A=i.employee)==null?void 0:A.position)||"N/A"]})]}),e.jsxs(d,{item:!0,xs:6,children:[e.jsxs(n,{children:[e.jsx("strong",{children:"Department:"})," ",((D=i.employee)==null?void 0:D.department)||"N/A"]}),e.jsxs(n,{children:[e.jsx("strong",{children:"Contact:"})," ",((z=i.employee)==null?void 0:z.phone_number)||"N/A"]})]})]})]}),e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Transaction Summary"}),e.jsx(he,{component:H,variant:"outlined",sx:{mb:3},children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(C,{children:[e.jsx(t,{children:e.jsx("strong",{children:"Description"})}),e.jsx(t,{align:"right",children:e.jsx("strong",{children:"Amount"})})]})}),e.jsxs(je,{children:[e.jsxs(C,{children:[e.jsx(t,{children:"Amount Issued"}),e.jsx(t,{align:"right",children:O(i.amount_issued)})]}),(i.status==="settled"||i.status==="approved")&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{children:[e.jsx(t,{children:"Amount Spent"}),e.jsx(t,{align:"right",children:O(i.amount_spent)})]}),e.jsxs(C,{children:[e.jsx(t,{children:"Amount Returned"}),e.jsx(t,{align:"right",children:O(i.amount_returned)})]})]})]})]})}),i.description&&e.jsxs(P,{sx:{mb:3},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Description"}),e.jsx(H,{variant:"outlined",sx:{p:2},children:e.jsx(n,{children:i.description})})]}),i.remarks&&e.jsxs(P,{sx:{mb:3},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Remarks"}),e.jsx(H,{variant:"outlined",sx:{p:2},children:e.jsx(n,{children:i.remarks})})]}),e.jsx(Pe,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:4,sx:{mt:3},children:[e.jsx(d,{item:!0,xs:4,children:e.jsxs(P,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:[e.jsx(n,{children:"Issued By"}),e.jsx(n,{variant:"caption",children:((k=i.issuer)==null?void 0:k.name)||"System User"})]})}),e.jsx(d,{item:!0,xs:4,children:e.jsxs(P,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:[e.jsx(n,{children:"Received By"}),e.jsx(n,{variant:"caption",children:((w=i.employee)==null?void 0:w.full_name)||"Employee"})]})}),e.jsx(d,{item:!0,xs:4,children:e.jsxs(P,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:[e.jsx(n,{children:"Approved By"}),e.jsx(n,{variant:"caption",children:i.status==="approved"?((y=i.approver)==null?void 0:y.name)||"Manager":""})]})})]}),e.jsx(P,{sx:{mt:4,textAlign:"center"},children:e.jsx(n,{variant:"caption",color:"textSecondary",children:"This document serves as an official record of petty cash disbursement."})})]})}),e.jsxs(oe,{sx:{p:2},children:[e.jsx(B,{variant:"outlined",startIcon:e.jsx(we,{}),onClick:j,children:"Print Receipt"}),e.jsx(B,{variant:"contained",onClick:a,children:"Close"})]})]})},Ie=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",lr=({open:r,onClose:a,fund:i,isNew:m=!1})=>{var b,A,D,z;const o=g.useRef(),j=dr.useReactToPrint({contentRef:o});if(!i)return null;const E=k=>{switch(k){case"approved":return e.jsx(S,{label:"APPROVED",color:"success"});case"pending":return e.jsx(S,{label:"PENDING",color:"warning"});case"rejected":return e.jsx(S,{label:"REJECTED",color:"error"});default:return e.jsx(S,{label:k.toUpperCase()})}};return e.jsxs(ae,{open:r,onClose:a,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsxs(le,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2},children:[e.jsx(n,{variant:"h6",children:m?"New Fund Receipt":"Fund Receipt"}),e.jsxs(P,{children:[e.jsx(N,{color:"primary",onClick:j,sx:{mr:1},children:e.jsx(we,{})}),e.jsx(N,{onClick:a,children:e.jsx(ne,{})})]})]}),e.jsx(ie,{dividers:!0,children:e.jsxs(P,{ref:o,sx:{p:3},children:[e.jsxs(P,{sx:{textAlign:"center",mb:3},children:[e.jsx(n,{variant:"h4",children:"PETTY CASH FUND"}),e.jsx(n,{variant:"h6",children:i.transaction_reference}),e.jsx(P,{sx:{mt:1},children:E(i.status)})]}),e.jsxs(d,{container:!0,spacing:2,sx:{mb:3},children:[e.jsxs(d,{item:!0,xs:6,children:[e.jsx(n,{children:"Halifax Glass & Aluminum Supply"}),e.jsx(n,{children:"Malagamot Road, Panacan"}),e.jsx(n,{children:"glasshalifax@gmail.com"}),e.jsx(n,{children:"0939 924 3876"})]}),e.jsxs(d,{item:!0,xs:6,sx:{textAlign:"right"},children:[e.jsxs(n,{children:[e.jsx("strong",{children:"Created on:"})," ",Ie(i.created_at)]}),i.status==="approved"&&e.jsxs(n,{children:[e.jsx("strong",{children:"Approved on:"})," ",Ie(i.updated_at)]})]})]}),e.jsxs(H,{variant:"outlined",sx:{p:3,mb:3,textAlign:"center",backgroundColor:i.status==="approved"?"success.light":"background.paper"},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Fund Amount"}),e.jsx(n,{variant:"h3",children:O(i.amount)})]}),e.jsxs(H,{variant:"outlined",sx:{p:2,mb:3},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Description"}),e.jsx(n,{children:i.description})]}),e.jsxs(d,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(d,{item:!0,xs:6,children:e.jsxs(H,{variant:"outlined",sx:{p:2,height:"100%"},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Created By"}),e.jsx(n,{children:((b=i.creator)==null?void 0:b.name)||"System User"}),e.jsx(n,{variant:"caption",color:"textSecondary",children:Ie(i.created_at)})]})}),e.jsx(d,{item:!0,xs:6,children:e.jsxs(H,{variant:"outlined",sx:{p:2,height:"100%"},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Approved By"}),i.status==="approved"?e.jsxs(e.Fragment,{children:[e.jsx(n,{children:((A=i.approver)==null?void 0:A.name)||"Manager"}),e.jsx(n,{variant:"caption",color:"textSecondary",children:Ie(i.updated_at)})]}):e.jsx(n,{color:"textSecondary",children:"Pending approval"})]})})]}),e.jsx(Pe,{sx:{my:3}}),e.jsxs(d,{container:!0,spacing:4,sx:{mt:3},children:[e.jsx(d,{item:!0,xs:6,children:e.jsxs(P,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:[e.jsx(n,{children:"Prepared By"}),e.jsx(n,{variant:"caption",children:((D=i.creator)==null?void 0:D.name)||"System User"})]})}),e.jsx(d,{item:!0,xs:6,children:e.jsxs(P,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:[e.jsx(n,{children:"Approved By"}),e.jsx(n,{variant:"caption",children:i.status==="approved"?((z=i.approver)==null?void 0:z.name)||"Manager":""})]})})]}),e.jsx(P,{sx:{mt:4,textAlign:"center"},children:e.jsx(n,{variant:"caption",color:"textSecondary",children:"This document serves as an official record of petty cash fund allocation."})})]})}),e.jsxs(oe,{sx:{p:2},children:[e.jsx(B,{variant:"outlined",startIcon:e.jsx(we,{}),onClick:j,children:"Print Receipt"}),e.jsx(B,{variant:"contained",onClick:a,children:"Close"})]})]})},zn=()=>{const r=qe(),[a,i]=g.useState(0),[m,o]=g.useState(!1),[j,E]=g.useState(!1),[b,A]=g.useState(!1),[D,z]=g.useState(!1),[k,w]=g.useState(!1),[y,f]=g.useState(null),[p,u]=g.useState(null),c=G(ir);console.log(c);const[F,_]=g.useState(!1),[s,l]=g.useState(!1),[h,v]=g.useState(null),[L,ge]=g.useState(null),[be,T]=g.useState(0),[q,R]=g.useState(!1),{funds:de,transactions:ue,balance:Ge,getBalance:pr,getAllFunds:jr,getAllTransactions:gr,approveFund:fr,approveTransaction:vr,cancelTransaction:br,loading:ye}=ve(),{employees:Ke,getAllEmployees:yr,loading:$n}=Ae();g.useEffect(()=>{xe(),yr()},[a,be]);const xe=async()=>{try{const x={search:c.search,status:c.status!=="all"?c.status:void 0,startDate:c.startDate,endDate:c.endDate,employeeId:c.employeeId!=="all"?c.employeeId:void 0};a===0?await gr(x):await jr(x),await pr()}catch(x){console.error("Error loading data:",x)}},_r=()=>{T(x=>x+1)},Je=()=>{xe()},Er=(x,V)=>{i(V)},Ye=async(x,V)=>{try{if(V==="fund"){const se=await fr(x);se&&(u(se),w(!0))}else{const se=await vr(x);se&&(f(se),z(!0))}xe()}catch(se){console.error("Error approving item:",se)}},wr=async x=>{try{const V=prompt("Please enter a reason for cancellation:");V&&(await br(x,V),xe())}catch(V){console.error("Error cancelling transaction:",V)}},Tr=x=>{f(x),A(!0)},Ar=async(x=!1)=>{x==!0&&(A(!1),z(!0),xe())},Ne=x=>{f(x),z(!0)},Ce=x=>{u(x),w(!0)},Dr=x=>{o(!1),v(x),_(!0),xe()},Fr=x=>{E(!1),ge(x),l(!0),xe()},Qe=x=>{switch(x){case"approved":return e.jsx(S,{label:"Approved",color:"success",size:"small"});case"pending":return e.jsx(S,{label:"Pending",color:"warning",size:"small"});case"settled":return e.jsx(S,{label:"Settled",color:"info",size:"small"});case"issued":return e.jsx(S,{label:"Issued",color:"primary",size:"small"});case"cancelled":return e.jsx(S,{label:"Cancelled",color:"error",size:"small"});case"rejected":return e.jsx(S,{label:"Rejected",color:"error",size:"small"});default:return e.jsx(S,{label:x,size:"small"})}},Ir=()=>{try{const x=a===0?ue:de;let V=[];a===0?(V.push(["Reference","Date","Employee","Purpose","Expense","Issued Amount","Spent Amount","Returned Amount","Status"]),x.forEach(U=>{var Ze;V.push([U.transaction_reference||"",fe(U.date)||"",((Ze=U.employee)==null?void 0:Ze.full_name)||"",U.purpose||"",U.expense||"",U.amount_issued||0,U.amount_spent||0,U.amount_returned||0,U.status||""])})):(V.push(["Reference","Date","Description","Amount","Status"]),x.forEach(U=>{V.push([U.transaction_reference||"",fe(U.date)||"",U.description||"",U.amount||0,U.status||""])}));const se=$e.aoa_to_sheet(V),Xe=$e.book_new();$e.book_append_sheet(Xe,se,a===0?"Transactions":"Funds");const Pr=`PettyCash_${a===0?"Transactions":"Funds"}_${new Date().toISOString().split("T")[0]}.xlsx`;cn(Xe,Pr),I.success(`${a===0?"Transactions":"Funds"} exported successfully`)}catch(x){console.error("Error exporting to Excel:",x),I.error("Failed to export data")}};return e.jsxs(P,{children:[e.jsx(ee,{sx:{mb:3},children:e.jsx(re,{children:e.jsxs(d,{container:!0,spacing:3,children:[e.jsxs(d,{item:!0,xs:12,md:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Current Balance"}),e.jsx(n,{variant:"h4",children:O(Ge||0)})]}),e.jsx(d,{item:!0,xs:12,md:6,sx:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(P,{children:[e.jsx(B,{variant:"outlined",color:"primary",startIcon:e.jsx(un,{}),onClick:_r,sx:{mr:2},disabled:ye,children:"Refresh"}),e.jsx(B,{variant:"contained",color:"primary",startIcon:e.jsx(Ee,{}),onClick:()=>o(!0),sx:{mr:2},children:"Add Funds"}),e.jsx(B,{variant:"contained",color:"secondary",startIcon:e.jsx(Ee,{}),onClick:()=>E(!0),children:"New Transaction"})]})})]})})}),e.jsxs(P,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(P,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(ur,{value:a,onChange:Er,"aria-label":"petty cash sub-tabs",textColor:"primary",indicatorColor:"primary",children:[e.jsx(_e,{label:"Transactions",id:"petty-cash-subtab-0"}),e.jsx(_e,{label:"Funds",id:"petty-cash-subtab-1"})]})}),e.jsxs(P,{children:[e.jsxs(B,{variant:q?"contained":"outlined",onClick:()=>R(!q),sx:{mr:2},size:"small",children:[q?"Hide":"Show"," Balance Trail"]}),e.jsx(B,{variant:"outlined",color:"primary",startIcon:e.jsx(we,{}),onClick:()=>{a===0&&ue.length>0?Ne(ue[0]):a===1&&de.length>0?Ce(de[0]):I.info("No records available to view")},sx:{mr:2},disabled:ye||(a===0?ue.length===0:de.length===0),children:"View Latest"}),e.jsx(B,{variant:"outlined",color:"primary",startIcon:e.jsx(xn,{}),onClick:Ir,disabled:ye||(a===0?ue.length===0:de.length===0),children:"Export to Excel"})]})]}),e.jsx(H,{sx:{p:2,mb:3},children:e.jsxs(d,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(M,{fullWidth:!0,placeholder:"Search",value:c.search,onChange:x=>r(nn(x.target.value)),onKeyPress:x=>x.key==="Enter"&&Je(),InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(xr,{})})},size:"small"})}),e.jsx(d,{item:!0,xs:12,md:2,children:e.jsxs(J,{fullWidth:!0,size:"small",children:[e.jsx(Z,{children:"Status"}),e.jsxs(X,{value:c.status,onChange:x=>r(sn(x.target.value)),label:"Status",children:[e.jsx(W,{value:"all",children:"All Status"}),e.jsx(W,{value:"pending",children:"Pending"}),e.jsx(W,{value:"approved",children:"Approved"}),a===0&&[e.jsx(W,{value:"issued",children:"Issued"},"issued"),e.jsx(W,{value:"settled",children:"Settled"},"settled"),e.jsx(W,{value:"cancelled",children:"Cancelled"},"cancelled")],a===1&&e.jsx(W,{value:"rejected",children:"Rejected"})]})]})}),a===0&&e.jsx(d,{item:!0,xs:12,md:2,children:e.jsxs(J,{fullWidth:!0,size:"small",children:[e.jsx(Z,{children:"Employee"}),e.jsxs(X,{value:c.employeeId,onChange:x=>r(tn({employeeId:x.target.value})),label:"Employee",children:[e.jsx(W,{value:"all",children:"All Employees"}),[...Ke.map(x=>e.jsx(W,{value:x.id,children:x.full_name},x.id))]]})]})}),e.jsx(d,{item:!0,xs:6,md:2,children:e.jsx(M,{label:"Start Date",type:"date",value:c.startDate,onChange:x=>r(an({startDate:x.target.value})),InputLabelProps:{shrink:!0},fullWidth:!0,size:"small"})}),e.jsx(d,{item:!0,xs:6,md:2,children:e.jsx(M,{label:"End Date",type:"date",value:c.endDate,onChange:x=>r(ln({endDate:x.target.value})),InputLabelProps:{shrink:!0},fullWidth:!0,size:"small",inputProps:{min:c.startDate}})}),e.jsx(d,{item:!0,xs:12,md:1,children:e.jsx(B,{variant:"contained",color:"primary",fullWidth:!0,onClick:Je,startIcon:e.jsx(He,{}),children:"Filter"})})]})}),a===1?e.jsx(he,{component:H,children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(C,{children:[e.jsx(t,{children:"Reference"}),e.jsx(t,{children:"Date"}),e.jsx(t,{children:"Description"}),e.jsx(t,{align:"right",children:"Amount"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Created By"}),e.jsx(t,{children:"Actions"})]})}),e.jsx(je,{children:ye?e.jsx(C,{children:e.jsx(t,{colSpan:7,align:"center",children:e.jsx(ce,{size:24})})}):de.length===0?e.jsx(C,{children:e.jsx(t,{colSpan:7,align:"center",children:"No funds found"})}):de.map(x=>{var V;return e.jsxs(C,{children:[e.jsx(t,{children:e.jsx(n,{component:"span",sx:{cursor:"pointer",color:"primary.main","&:hover":{textDecoration:"underline"}},onClick:()=>Ce(x),children:x.transaction_reference})}),e.jsx(t,{children:fe(x.date)}),e.jsx(t,{children:x.description}),e.jsx(t,{align:"right",children:O(x.amount)}),e.jsx(t,{children:Qe(x.status)}),e.jsx(t,{children:((V=x.creator)==null?void 0:V.name)||"-"}),e.jsxs(t,{children:[e.jsx(K,{title:"View Receipt",children:e.jsx(N,{color:"primary",size:"small",onClick:()=>Ce(x),children:e.jsx(Se,{})})}),x.status==="pending"&&e.jsx(K,{title:"Approve",children:e.jsx(N,{color:"success",size:"small",onClick:()=>Ye(x.id,"fund"),children:e.jsx(ke,{})})})]})]},x.id)})})]})}):e.jsx(he,{component:H,children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(C,{children:[e.jsx(t,{children:"Reference"}),e.jsx(t,{children:"Date"}),e.jsx(t,{children:"Employee"}),e.jsx(t,{children:"Purpose"}),e.jsx(t,{children:"Expense"}),e.jsx(t,{align:"right",children:"Issued"}),e.jsx(t,{align:"right",children:"Spent"}),e.jsx(t,{align:"right",children:"Returned"}),e.jsx(t,{children:"Status"}),q&&e.jsxs(e.Fragment,{children:[e.jsx(t,{align:"right",children:e.jsx("strong",{children:"Balance Before"})}),e.jsx(t,{align:"right",children:e.jsx("strong",{children:"Balance After"})})]}),e.jsx(t,{children:"Actions"})]})}),e.jsx(je,{children:ye?e.jsx(C,{children:e.jsx(t,{colSpan:9,align:"center",children:e.jsx(ce,{size:24})})}):ue.length===0?e.jsx(C,{children:e.jsx(t,{colSpan:9,align:"center",children:"No transactions found"})}):ue.map(x=>{var V;return e.jsxs(C,{children:[e.jsx(t,{children:e.jsx(n,{component:"span",sx:{cursor:"pointer",color:"primary.main","&:hover":{textDecoration:"underline"}},onClick:()=>Ne(x),children:x.transaction_reference})}),e.jsx(t,{children:fe(x.date)}),e.jsx(t,{children:((V=x.employee)==null?void 0:V.full_name)||"-"}),e.jsx(t,{children:x.purpose}),e.jsx(t,{children:x.expense}),e.jsx(t,{align:"right",children:O(x.amount_issued)}),e.jsx(t,{align:"right",children:O(x.amount_spent||0)}),e.jsx(t,{align:"right",children:O(x.amount_returned||0)}),e.jsx(t,{children:Qe(x.status)}),q&&e.jsxs(e.Fragment,{children:[e.jsx(t,{align:"right",children:e.jsx(n,{variant:"body2",color:"textSecondary",children:x.balance_before?O(x.balance_before):"-"})}),e.jsx(t,{align:"right",children:e.jsx(n,{variant:"body2",fontWeight:"bold",style:{color:(x.balance_after||0)>=0?"#52c41a":"#ff4d4f"},children:x.balance_after?O(x.balance_after):"-"})})]}),e.jsxs(t,{children:[e.jsx(K,{title:"View Receipt",children:e.jsx(N,{color:"primary",size:"small",onClick:()=>Ne(x),children:e.jsx(Se,{})})}),x.status==="issued"&&e.jsx(K,{title:"Settle",children:e.jsx(N,{color:"primary",size:"small",onClick:()=>Tr(x),children:e.jsx(Ue,{})})}),x.status==="settled"&&e.jsx(K,{title:"Approve",children:e.jsx(N,{color:"success",size:"small",onClick:()=>Ye(x.id,"transaction"),children:e.jsx(ke,{})})}),(x.status==="issued"||x.status==="settled")&&e.jsx(K,{title:"Cancel",children:e.jsx(N,{color:"error",size:"small",onClick:()=>wr(x.id),children:e.jsx(hr,{})})})]})]},x.id)})})]})}),e.jsx(Fn,{open:m,onClose:()=>o(!1),onSuccess:Dr}),e.jsx(Rn,{open:j,onClose:()=>E(!1),onSuccess:Fr,employees:Ke,balance:Ge||0}),e.jsx(mr,{open:b,onClose:()=>{A(!1),f(null)},onSuccess:Ar,transaction:y}),e.jsx(lr,{open:k,onClose:()=>{w(!1),u(null)},fund:p}),e.jsx(ar,{open:D,onClose:()=>{z(!1),f(null)},transaction:y}),e.jsx(lr,{open:F,onClose:()=>{_(!1),v(null)},fund:h,isNew:!0}),e.jsx(ar,{open:s,onClose:()=>{l(!1),ge(null)},transaction:L,isNew:!0})]})},Wn=({open:r,onClose:a,onSuccess:i,departments:m=[]})=>{const[o,j]=g.useState({full_name:"",position:"",department:"",email:"",phone_number:"",status:"active"}),[E,b]=g.useState({}),[A,D]=g.useState(""),{createEmployee:z,loading:k}=Ae(),w=u=>{const{name:c,value:F}=u.target;j(_=>({..._,[c]:F})),E[c]&&b(_=>({..._,[c]:null}))},y=()=>{const u={};return o.full_name.trim()||(u.full_name="Full name is required"),o.position.trim()||(u.position="Position is required"),!o.department.trim()&&!A.trim()&&(u.department="Department is required"),o.email&&!/^\S+@\S+\.\S+$/.test(o.email)&&(u.email="Invalid email address"),b(u),Object.keys(u).length===0},f=async u=>{if(u.preventDefault(),!!y())try{const c={...o,department:o.department==="new"?A:o.department};await z(c),p(!0)}catch(c){console.error("Error adding employee:",c)}},p=(u=!1)=>{j({full_name:"",position:"",department:"",email:"",phone_number:"",status:"active"}),D(""),b({}),u?i():a()};return e.jsxs(ae,{open:r,onClose:()=>p(),maxWidth:"sm",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(P,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(n,{variant:"h6",children:"Add Employee"}),e.jsx(N,{edge:"end",color:"inherit",onClick:()=>p(),"aria-label":"close",children:e.jsx(ne,{})})]})}),e.jsxs("form",{onSubmit:f,children:[e.jsx(ie,{children:e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,required:!0,label:"Full Name",name:"full_name",value:o.full_name,onChange:w,error:!!E.full_name,helperText:E.full_name})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(M,{fullWidth:!0,required:!0,label:"Position",name:"position",value:o.position,onChange:w,error:!!E.position,helperText:E.position})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(J,{fullWidth:!0,error:!!E.department,required:!0,children:[e.jsx(Z,{children:"Department"}),e.jsxs(X,{name:"department",value:o.department,onChange:w,label:"Department *",children:[m.map(u=>e.jsx(W,{value:u,children:u},u)),e.jsx(W,{value:"new",children:e.jsx("em",{children:"Add New Department"})})]}),E.department&&e.jsx(Te,{children:E.department})]})}),o.department==="new"&&e.jsx(d,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,required:!0,label:"New Department Name",value:A,onChange:u=>D(u.target.value),error:o.department==="new"&&!A.trim(),helperText:o.department==="new"&&!A.trim()?"New department name is required":""})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(M,{fullWidth:!0,label:"Email",name:"email",type:"email",value:o.email,onChange:w,error:!!E.email,helperText:E.email})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(M,{fullWidth:!0,label:"Phone Number",name:"phone_number",value:o.phone_number,onChange:w})}),e.jsx(d,{item:!0,xs:12,children:e.jsxs(J,{fullWidth:!0,children:[e.jsx(Z,{children:"Status"}),e.jsxs(X,{name:"status",value:o.status,onChange:w,label:"Status",children:[e.jsx(W,{value:"active",children:"Active"}),e.jsx(W,{value:"inactive",children:"Inactive"})]})]})})]})}),e.jsxs(oe,{children:[e.jsx(B,{onClick:()=>p(),color:"primary",disabled:k,children:"Cancel"}),e.jsx(B,{type:"submit",variant:"contained",color:"primary",disabled:k,startIcon:k?e.jsx(ce,{size:24}):null,children:k?"Adding...":"Add Employee"})]})]})]})},Nn=({open:r,onClose:a,onSuccess:i,employee:m,departments:o=[]})=>{const[j,E]=g.useState({full_name:"",position:"",department:"",email:"",phone_number:"",status:"active"}),[b,A]=g.useState({}),[D,z]=g.useState(""),{updateEmployee:k,loading:w}=Ae();g.useEffect(()=>{m&&E({full_name:m.full_name||"",position:m.position||"",department:m.department||"",email:m.email||"",phone_number:m.phone_number||"",status:m.status||"active"})},[m]);const y=c=>{const{name:F,value:_}=c.target;E(s=>({...s,[F]:_})),b[F]&&A(s=>({...s,[F]:null}))},f=()=>{const c={};return j.full_name.trim()||(c.full_name="Full name is required"),j.position.trim()||(c.position="Position is required"),!j.department.trim()&&!D.trim()&&(c.department="Department is required"),j.email&&!/^\S+@\S+\.\S+$/.test(j.email)&&(c.email="Invalid email address"),A(c),Object.keys(c).length===0},p=async c=>{if(c.preventDefault(),!(!m||!f()))try{const F={...j,department:j.department==="new"?D:j.department};await k(m.id,F),u(!0)}catch(F){console.error("Error updating employee:",F)}},u=(c=!1)=>{z(""),A({}),c?i():a()};return m?e.jsxs(ae,{open:r,onClose:()=>u(),maxWidth:"sm",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(P,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(n,{variant:"h6",children:"Edit Employee"}),e.jsx(N,{edge:"end",color:"inherit",onClick:()=>u(),"aria-label":"close",children:e.jsx(ne,{})})]})}),e.jsxs("form",{onSubmit:p,children:[e.jsxs(ie,{children:[e.jsx(M,{margin:"dense",fullWidth:!0,label:"Employee Code",value:m.employee_code||"",disabled:!0}),e.jsxs(d,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,required:!0,label:"Full Name",name:"full_name",value:j.full_name,onChange:y,error:!!b.full_name,helperText:b.full_name})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(M,{fullWidth:!0,required:!0,label:"Position",name:"position",value:j.position,onChange:y,error:!!b.position,helperText:b.position})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(J,{fullWidth:!0,error:!!b.department,required:!0,children:[e.jsx(Z,{children:"Department"}),e.jsxs(X,{name:"department",value:j.department,onChange:y,label:"Department *",children:[o.map(c=>e.jsx(W,{value:c,children:c},c)),e.jsx(W,{value:"new",children:e.jsx("em",{children:"Add New Department"})})]}),b.department&&e.jsx(Te,{children:b.department})]})}),j.department==="new"&&e.jsx(d,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,required:!0,label:"New Department Name",value:D,onChange:c=>z(c.target.value),error:j.department==="new"&&!D.trim(),helperText:j.department==="new"&&!D.trim()?"New department name is required":""})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(M,{fullWidth:!0,label:"Email",name:"email",type:"email",value:j.email,onChange:y,error:!!b.email,helperText:b.email})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(M,{fullWidth:!0,label:"Phone Number",name:"phone_number",value:j.phone_number,onChange:y})}),e.jsx(d,{item:!0,xs:12,children:e.jsxs(J,{fullWidth:!0,children:[e.jsx(Z,{children:"Status"}),e.jsxs(X,{name:"status",value:j.status,onChange:y,label:"Status",children:[e.jsx(W,{value:"active",children:"Active"}),e.jsx(W,{value:"inactive",children:"Inactive"})]})]})})]})]}),e.jsxs(oe,{children:[e.jsx(B,{onClick:()=>u(),color:"primary",disabled:w,children:"Cancel"}),e.jsx(B,{type:"submit",variant:"contained",color:"primary",disabled:w,startIcon:w?e.jsx(ce,{size:24}):null,children:w?"Updating...":"Update Employee"})]})]})]}):null},Cn=({open:r,onClose:a,employee:i})=>{const[m,o]=g.useState(new Date(new Date().getFullYear(),new Date().getMonth()-1,1).toISOString().split("T")[0]),[j,E]=g.useState(new Date().toISOString().split("T")[0]),[b,A]=g.useState("all"),[D,z]=g.useState(!1),[k,w]=g.useState(null),{transactions:y,getEmployeeTransactions:f,approveTransaction:p,cancelTransaction:u,loading:c}=ve();g.useEffect(()=>{r&&i&&F()},[r,i]);const F=async()=>{if(i)try{const T={status:b!=="all"?b:void 0,startDate:m,endDate:j};await f(i.id,T)}catch(T){console.error("Error loading employee transactions:",T)}},_=()=>{F()},s=async T=>{try{await p(T),F()}catch(q){console.error("Error approving transaction:",q)}},l=async T=>{try{const q=prompt("Please enter a reason for cancellation:");q&&(await u(T,q),F())}catch(q){console.error("Error cancelling transaction:",q)}},h=T=>{w(T),z(!0)},v=T=>{switch(T){case"approved":return e.jsx(S,{label:"Approved",color:"success",size:"small"});case"pending":return e.jsx(S,{label:"Pending",color:"warning",size:"small"});case"settled":return e.jsx(S,{label:"Settled",color:"info",size:"small"});case"issued":return e.jsx(S,{label:"Issued",color:"primary",size:"small"});case"cancelled":return e.jsx(S,{label:"Cancelled",color:"error",size:"small"});default:return e.jsx(S,{label:T,size:"small"})}},L=()=>y.reduce((T,q)=>T+parseFloat(q.amount_issued||0),0),ge=()=>y.reduce((T,q)=>T+parseFloat(q.amount_spent||0),0),be=()=>y.reduce((T,q)=>T+parseFloat(q.amount_returned||0),0);return i?e.jsxs(e.Fragment,{children:[e.jsxs(ae,{open:r,onClose:a,maxWidth:"md",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(P,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(n,{variant:"h6",children:[i.full_name,"'s Transactions"]}),e.jsx(N,{edge:"end",color:"inherit",onClick:a,"aria-label":"close",children:e.jsx(ne,{})})]})}),e.jsxs(ie,{children:[e.jsx(H,{sx:{p:2,mb:3},children:e.jsxs(d,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(M,{fullWidth:!0,label:"Start Date",type:"date",value:m,onChange:T=>o(T.target.value),InputLabelProps:{shrink:!0},size:"small"})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(M,{fullWidth:!0,label:"End Date",type:"date",value:j,onChange:T=>E(T.target.value),InputLabelProps:{shrink:!0},size:"small",inputProps:{min:m}})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsxs(J,{fullWidth:!0,size:"small",children:[e.jsx(Z,{children:"Status"}),e.jsxs(X,{value:b,onChange:T=>A(T.target.value),label:"Status",children:[e.jsx(W,{value:"all",children:"All Status"}),e.jsx(W,{value:"issued",children:"Issued"}),e.jsx(W,{value:"settled",children:"Settled"}),e.jsx(W,{value:"approved",children:"Approved"}),e.jsx(W,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(B,{variant:"contained",color:"primary",fullWidth:!0,onClick:_,startIcon:e.jsx(He,{}),children:"Filter"})})]})}),e.jsx(P,{sx:{mb:3},children:e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,sm:4,children:e.jsxs(H,{sx:{p:2,textAlign:"center"},children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Total Issued"}),e.jsx(n,{variant:"h5",children:O(L())})]})}),e.jsx(d,{item:!0,xs:12,sm:4,children:e.jsxs(H,{sx:{p:2,textAlign:"center"},children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Total Spent"}),e.jsx(n,{variant:"h5",children:O(ge())})]})}),e.jsx(d,{item:!0,xs:12,sm:4,children:e.jsxs(H,{sx:{p:2,textAlign:"center"},children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Total Returned"}),e.jsx(n,{variant:"h5",children:O(be())})]})})]})}),e.jsx(he,{component:H,children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(C,{children:[e.jsx(t,{children:"Reference"}),e.jsx(t,{children:"Date"}),e.jsx(t,{children:"Purpose"}),e.jsx(t,{align:"right",children:"Issued"}),e.jsx(t,{align:"right",children:"Spent"}),e.jsx(t,{align:"right",children:"Returned"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Actions"})]})}),e.jsx(je,{children:c?e.jsx(C,{children:e.jsx(t,{colSpan:8,align:"center",children:e.jsx(ce,{size:24})})}):y.length===0?e.jsx(C,{children:e.jsx(t,{colSpan:8,align:"center",children:"No transactions found for this period"})}):y.map(T=>e.jsxs(C,{children:[e.jsx(t,{children:T.transaction_reference}),e.jsx(t,{children:fe(T.date)}),e.jsx(t,{children:T.purpose}),e.jsx(t,{align:"right",children:O(T.amount_issued)}),e.jsx(t,{align:"right",children:O(T.amount_spent||0)}),e.jsx(t,{align:"right",children:O(T.amount_returned||0)}),e.jsx(t,{children:v(T.status)}),e.jsxs(t,{children:[T.status==="issued"&&e.jsx(K,{title:"Settle",children:e.jsx(N,{color:"primary",size:"small",onClick:()=>h(T),children:e.jsx(Ue,{})})}),T.status==="settled"&&e.jsx(K,{title:"Approve",children:e.jsx(N,{color:"success",size:"small",onClick:()=>s(T.id),children:e.jsx(ke,{})})}),(T.status==="issued"||T.status==="settled")&&e.jsx(K,{title:"Cancel",children:e.jsx(N,{color:"error",size:"small",onClick:()=>l(T.id),children:e.jsx(hr,{})})})]})]},T.id))})]})})]}),e.jsx(oe,{children:e.jsx(B,{onClick:a,color:"primary",children:"Close"})})]}),e.jsx(mr,{open:D,onClose:()=>{z(!1),w(null)},onSuccess:()=>{z(!1),w(null),F()},transaction:k})]}):null},Bn=()=>{const[r,a]=g.useState(""),[i,m]=g.useState("all"),[o,j]=g.useState("all"),[E,b]=g.useState(!1),[A,D]=g.useState(!1),[z,k]=g.useState(!1),[w,y]=g.useState(null),[f,p]=g.useState(!1),{employees:u,getAllEmployees:c,deleteEmployee:F,stats:_,loading:s}=Ae();g.useEffect(()=>{l()},[]);const l=async()=>{try{await c({search:r,status:i!=="all"?i:void 0,department:o!=="all"?o:void 0})}catch(R){console.error("Error loading employees:",R)}},h=()=>{l()},v=R=>{y(R),D(!0)},L=R=>{y(R),k(!0)},ge=async()=>{if(w)try{await F(w.id),p(!1),y(null),l()}catch(R){console.error("Error deleting employee:",R)}},be=R=>{y(R),p(!0)},T=()=>!_||!_.departments?[]:_.departments,q=R=>{switch(R){case"active":return e.jsx(S,{label:"Active",color:"success",size:"small"});case"inactive":return e.jsx(S,{label:"Inactive",color:"error",size:"small"});default:return e.jsx(S,{label:R,size:"small"})}};return e.jsxs(P,{children:[e.jsx(ee,{sx:{mb:3},children:e.jsx(re,{children:e.jsxs(d,{container:!0,spacing:3,children:[e.jsxs(d,{item:!0,xs:12,md:6,children:[e.jsx(n,{variant:"h6",children:"Employees Management"}),e.jsx(n,{variant:"body2",color:"textSecondary",children:"Manage employees for petty cash transactions"})]}),e.jsx(d,{item:!0,xs:12,md:6,sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(B,{variant:"contained",color:"primary",startIcon:e.jsx(Ee,{}),onClick:()=>b(!0),children:"Add Employee"})})]})})}),e.jsx(H,{sx:{p:2,mb:3},children:e.jsxs(d,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(M,{fullWidth:!0,placeholder:"Search name, code, position...",value:r,onChange:R=>a(R.target.value),onKeyPress:R=>R.key==="Enter"&&h(),InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(xr,{})})},size:"small"})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsxs(J,{fullWidth:!0,size:"small",children:[e.jsx(Z,{children:"Status"}),e.jsxs(X,{value:i,onChange:R=>m(R.target.value),label:"Status",children:[e.jsx(W,{value:"all",children:"All Status"}),e.jsx(W,{value:"active",children:"Active"}),e.jsx(W,{value:"inactive",children:"Inactive"})]})]})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsxs(J,{fullWidth:!0,size:"small",children:[e.jsx(Z,{children:"Department"}),e.jsxs(X,{value:o,onChange:R=>j(R.target.value),label:"Department",children:[e.jsx(W,{value:"all",children:"All Departments"}),T().map(R=>e.jsx(W,{value:R,children:R},R))]})]})}),e.jsx(d,{item:!0,xs:12,md:2,children:e.jsx(B,{variant:"contained",color:"primary",fullWidth:!0,onClick:h,startIcon:e.jsx(He,{}),children:"Filter"})})]})}),e.jsx(he,{component:H,children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(C,{children:[e.jsx(t,{children:"Employee Code"}),e.jsx(t,{children:"Full Name"}),e.jsx(t,{children:"Position"}),e.jsx(t,{children:"Department"}),e.jsx(t,{children:"Contact"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Actions"})]})}),e.jsx(je,{children:s?e.jsx(C,{children:e.jsx(t,{colSpan:7,align:"center",children:"Loading..."})}):u.length===0?e.jsx(C,{children:e.jsx(t,{colSpan:7,align:"center",children:"No employees found"})}):u.map(R=>e.jsxs(C,{children:[e.jsx(t,{children:R.employee_code}),e.jsx(t,{children:R.full_name}),e.jsx(t,{children:R.position}),e.jsx(t,{children:R.department}),e.jsx(t,{children:R.phone_number?e.jsxs("div",{children:[e.jsx("div",{children:R.phone_number}),e.jsx(n,{variant:"caption",color:"textSecondary",children:R.email})]}):R.email}),e.jsx(t,{children:q(R.status)}),e.jsxs(t,{children:[e.jsx(K,{title:"View Transactions",children:e.jsx(N,{color:"primary",size:"small",onClick:()=>L(R),children:e.jsx(Se,{})})}),e.jsx(K,{title:"Edit",children:e.jsx(N,{color:"info",size:"small",onClick:()=>v(R),children:e.jsx(Ue,{})})}),e.jsx(K,{title:"Delete",children:e.jsx(N,{color:"error",size:"small",onClick:()=>be(R),children:e.jsx(Ve,{})})})]})]},R.id))})]})}),e.jsxs(ae,{open:f,onClose:()=>p(!1),children:[e.jsx(le,{children:"Confirm Delete"}),e.jsx(ie,{children:e.jsxs(hn,{children:['Are you sure you want to delete the employee "',w==null?void 0:w.full_name,'"? This action cannot be undone.']})}),e.jsxs(oe,{children:[e.jsx(B,{onClick:()=>p(!1),color:"primary",children:"Cancel"}),e.jsx(B,{onClick:ge,color:"error",children:"Delete"})]})]}),e.jsx(Wn,{open:E,onClose:()=>b(!1),onSuccess:()=>{b(!1),l()},departments:T()}),e.jsx(Nn,{open:A,onClose:()=>{D(!1),y(null)},onSuccess:()=>{D(!1),y(null),l()},employee:w,departments:T()}),e.jsx(Cn,{open:z,onClose:()=>{k(!1),y(null)},employee:w})]})},Mn=({pettyCashStats:r,employeeStats:a,balance:i})=>{var m;return e.jsxs(P,{children:[e.jsxs(d,{container:!0,spacing:3,mb:2,children:[e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Fund Usage Rate"}),e.jsxs(n,{variant:"h4",children:[(r==null?void 0:r.total_funds)>0?Math.round((r.total_funds-r.available_balance)/r.total_funds*100):0,"%"]}),e.jsxs(P,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(mn,{style:{color:"#ff4d4f",marginRight:8}}),e.jsxs(n,{variant:"body2",color:"error",children:["Used: ",O((r==null?void 0:r.total_funds)-(r==null?void 0:r.available_balance)||0)]})]})]})})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Transaction Success Rate"}),e.jsxs(n,{variant:"h4",children:[(r==null?void 0:r.total_transactions)>0?Math.round(r.approved_transactions/r.total_transactions*100):0,"%"]}),e.jsxs(P,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ke,{style:{color:"#52c41a",marginRight:8}}),e.jsxs(n,{variant:"body2",color:"success.main",children:["Approved: ",(r==null?void 0:r.approved_transactions)||0," of ",(r==null?void 0:r.total_transactions)||0]})]})]})})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Pending Actions"}),e.jsx(n,{variant:"h4",children:((r==null?void 0:r.pending_transactions)||0)+((r==null?void 0:r.settled_transactions)||0)}),e.jsxs(P,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(pn,{style:{color:"#faad14",marginRight:8}}),e.jsxs(n,{variant:"body2",color:"warning.main",children:[(r==null?void 0:r.pending_transactions)||0," pending, ",(r==null?void 0:r.settled_transactions)||0," to approve"]})]})]})})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Employee Engagement"}),e.jsx(n,{variant:"h4",children:a!=null&&a.active_employees?Math.round(((r==null?void 0:r.total_transactions)||0)/a.active_employees):0}),e.jsxs(P,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Le,{style:{color:"#1890ff",marginRight:8}}),e.jsx(n,{variant:"body2",color:"primary",children:"Avg. transactions per employee"})]})]})})})]}),e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsxs(tr,{direction:"row",spacing:2,alignItems:"center",sx:{mb:2},children:[e.jsx(yn,{style:{fontSize:24}}),e.jsx(n,{variant:"h6",children:"Petty Cash Statistics"})]}),e.jsx(Pe,{sx:{mb:2}}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsxs(d,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Available Balance"}),e.jsx(n,{variant:"h5",children:O(i||0)})]}),e.jsxs(d,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Total Funds"}),e.jsx(n,{variant:"h5",children:O((r==null?void 0:r.total_funds)||0)})]}),e.jsxs(d,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Total Issued"}),e.jsx(n,{variant:"h5",color:"error",children:O((r==null?void 0:r.total_issued)||0)})]}),e.jsxs(d,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Total Spent"}),e.jsx(n,{variant:"h5",color:"warning.main",children:O((r==null?void 0:r.total_spent)||0)})]}),e.jsxs(d,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Total Returned"}),e.jsx(n,{variant:"h5",color:"success.main",children:O((r==null?void 0:r.total_returned)||0)})]}),e.jsxs(d,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Pending Funds"}),e.jsx(n,{variant:"h5",color:"info.main",children:O((r==null?void 0:r.pending_funds)||0)})]})]})]})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsxs(tr,{direction:"row",spacing:2,alignItems:"center",sx:{mb:2},children:[e.jsx(Le,{style:{fontSize:24}}),e.jsx(n,{variant:"h6",children:"Employee Statistics"})]}),e.jsx(Pe,{sx:{mb:2}}),e.jsxs(d,{container:!0,spacing:1.5,children:[e.jsxs(d,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Total Employees"}),e.jsx(n,{variant:"h5",children:(a==null?void 0:a.total_employees)||0})]}),e.jsxs(d,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Active Employees"}),e.jsx(n,{variant:"h5",color:"success.main",children:(a==null?void 0:a.active_employees)||0})]}),e.jsxs(d,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Inactive Employees"}),e.jsx(n,{variant:"h5",color:"error",children:(a==null?void 0:a.inactive_employees)||0})]}),e.jsxs(d,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Total Departments"}),e.jsx(n,{variant:"h5",children:((m=a==null?void 0:a.departments)==null?void 0:m.length)||0})]}),e.jsxs(d,{item:!0,xs:12,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",gutterBottom:!0,children:"Active Rate"}),e.jsxs(P,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx(P,{sx:{flexGrow:1,mr:2},children:e.jsx(on,{variant:"determinate",value:a!=null&&a.total_employees?a.active_employees/a.total_employees*100:0,sx:{height:10,borderRadius:5},color:"success"})}),e.jsxs(n,{variant:"body2",sx:{minWidth:"fit-content"},children:[a!=null&&a.total_employees?Math.round(a.active_employees/a.total_employees*100):0,"%"]})]})]})]})]})})})]}),e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Transaction Status"}),e.jsx(he,{children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(C,{children:[e.jsx(t,{children:"Status"}),e.jsx(t,{align:"right",children:"Count"}),e.jsx(t,{align:"right",children:"Percentage"})]})}),e.jsxs(je,{children:[e.jsxs(C,{children:[e.jsx(t,{children:e.jsx(S,{label:"Pending",color:"warning",size:"small"})}),e.jsx(t,{align:"right",children:(r==null?void 0:r.pending_transactions)||0}),e.jsxs(t,{align:"right",children:[(r==null?void 0:r.total_transactions)>0?((r==null?void 0:r.pending_transactions)/(r==null?void 0:r.total_transactions)*100).toFixed(1):0,"%"]})]}),e.jsxs(C,{children:[e.jsx(t,{children:e.jsx(S,{label:"Settled",color:"info",size:"small"})}),e.jsx(t,{align:"right",children:(r==null?void 0:r.settled_transactions)||0}),e.jsxs(t,{align:"right",children:[(r==null?void 0:r.total_transactions)>0?((r==null?void 0:r.settled_transactions)/(r==null?void 0:r.total_transactions)*100).toFixed(1):0,"%"]})]}),e.jsxs(C,{children:[e.jsx(t,{children:e.jsx(S,{label:"Approved",color:"success",size:"small"})}),e.jsx(t,{align:"right",children:(r==null?void 0:r.approved_transactions)||0}),e.jsxs(t,{align:"right",children:[(r==null?void 0:r.total_transactions)>0?((r==null?void 0:r.approved_transactions)/(r==null?void 0:r.total_transactions)*100).toFixed(1):0,"%"]})]}),e.jsxs(C,{children:[e.jsx(t,{children:e.jsx(S,{label:"Cancelled",color:"error",size:"small"})}),e.jsx(t,{align:"right",children:(r==null?void 0:r.cancelled_transactions)||0}),e.jsxs(t,{align:"right",children:[(r==null?void 0:r.total_transactions)>0?((r==null?void 0:r.cancelled_transactions)/(r==null?void 0:r.total_transactions)*100).toFixed(1):0,"%"]})]}),e.jsxs(C,{children:[e.jsx(t,{sx:{fontWeight:"bold"},children:"Total"}),e.jsx(t,{align:"right",sx:{fontWeight:"bold"},children:(r==null?void 0:r.total_transactions)||0}),e.jsx(t,{align:"right",sx:{fontWeight:"bold"},children:"100%"})]})]})]})})]})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Department Breakdown"}),a!=null&&a.departments&&a.departments.length>0?e.jsx(he,{children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(C,{children:[e.jsx(t,{children:"Department"}),e.jsx(t,{align:"right",children:"Employees"})]})}),e.jsx(je,{children:a.departments.map(o=>e.jsxs(C,{children:[e.jsx(t,{children:o}),e.jsx(t,{align:"right",children:"-"})]},o))})]})}):e.jsx(n,{variant:"body2",color:"textSecondary",align:"center",sx:{py:4},children:"No department data available"})]})})})]})]})};function Oe(r){const{children:a,value:i,index:m,...o}=r;return e.jsx("div",{role:"tabpanel",hidden:i!==m,id:`petty-cash-tabpanel-${m}`,"aria-labelledby":`petty-cash-tab-${m}`,...o,children:i===m&&e.jsx(P,{children:a})})}const vs=()=>{const[r,a]=g.useState(0),[i,m]=g.useState(!1),{getBalance:o,getStats:j,balance:E,stats:b,loading:A}=ve(),{getEmployeeStats:D,stats:z,loading:k}=Ae();g.useEffect(()=>{if(i)return;(async()=>{if(!i)try{await Promise.all([o(),j(),D()]),m(!0)}catch(f){console.error("Error loading data:",f)}})()},[]);const w=(y,f)=>{a(f)};return e.jsxs(e.Fragment,{children:[e.jsx(P,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(ur,{value:r,onChange:w,"aria-label":"petty cash management tabs",textColor:"primary",indicatorColor:"primary",children:[e.jsx(_e,{icon:e.jsx(Dn,{}),iconPosition:"start",label:"Petty Cash",id:"petty-cash-tab-0"}),e.jsx(_e,{icon:e.jsx(Le,{}),iconPosition:"start",label:"Employees",id:"petty-cash-tab-1"}),e.jsx(_e,{icon:e.jsx(fn,{}),iconPosition:"start",label:"Statistics",id:"petty-cash-tab-2"})]})}),e.jsx(Oe,{value:r,index:0,children:e.jsx(zn,{})}),e.jsx(Oe,{value:r,index:1,children:e.jsx(Bn,{})}),e.jsx(Oe,{value:r,index:2,children:e.jsx(Mn,{pettyCashStats:b,employeeStats:z,balance:E})})]})};export{vs as default};
