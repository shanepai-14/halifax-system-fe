import{Q as L,r as n,S as $,U as H,j as e,q as m,E as q,P as h,T as s,y as Q,H as w,I as C}from"./index-BH4OZBNn.js";import{R as V,E as G}from"./Receipt-kgPpP-Uf.js";import{P as J}from"./Print--sgFxDyO.js";import{l as K}from"./index-B7bdO_rH.js";import{b as X,c as Y,d as Z,P as ee}from"./PrintableRR-DE0TEAN7.js";import{C as ie}from"./Container-Ccg0UrpZ.js";import{T as g,c as ae,d as se,e as te,a as u,b as a,f as ne}from"./TextField-DF5xaGpt.js";import{R as re}from"./SearchOutlined-CK5kM7w4.js";import{M as p}from"./MenuItem-BzYG3h4A.js";import{B as T}from"./InputLabel-BCuRqJ6g.js";import{R as le}from"./ClearOutlined-D2Mqx3gw.js";import{T as oe}from"./TablePagination-BG09ACF2.js";import{S as c}from"./Skeleton-udNI9PE0.js";import{f as ce}from"./format-BzRktsyD.js";import"./LastPage-DzOnq2jV.js";const de=()=>e.jsxs(u,{children:[e.jsx(a,{children:e.jsx(c,{animation:"wave"})}),e.jsx(a,{children:e.jsx(c,{animation:"wave"})}),e.jsx(a,{children:e.jsx(c,{animation:"wave"})}),e.jsx(a,{children:e.jsx(c,{animation:"wave"})}),e.jsx(a,{align:"right",children:e.jsxs(m,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[e.jsx(c,{animation:"wave",variant:"circular",width:32,height:32}),e.jsx(c,{animation:"wave",variant:"circular",width:32,height:32}),e.jsx(c,{animation:"wave",variant:"circular",width:32,height:32})]})})]}),xe=({stats:t})=>t?e.jsxs(m,{sx:{display:"flex",flexWrap:"wrap",gap:2,mb:3},children:[e.jsxs(h,{elevation:1,sx:{p:2,minWidth:"200px",flex:1},children:[e.jsx(s,{variant:"h6",sx:{mb:1},children:"Total Reports"}),e.jsx(s,{variant:"h4",children:t.total_reports})]}),e.jsxs(h,{elevation:1,sx:{p:2,minWidth:"200px",flex:1},children:[e.jsx(s,{variant:"h6",sx:{mb:1},children:"Paid Reports"}),e.jsx(s,{variant:"h4",color:"success.main",children:t.paid_reports})]}),e.jsxs(h,{elevation:1,sx:{p:2,minWidth:"200px",flex:1},children:[e.jsx(s,{variant:"h6",sx:{mb:1},children:"Unpaid Reports"}),e.jsx(s,{variant:"h4",color:"error.main",children:t.unpaid_reports})]}),e.jsxs(h,{elevation:1,sx:{p:2,minWidth:"250px",flex:1},children:[e.jsx(s,{variant:"h6",sx:{mb:1},children:"Total Received Value"}),e.jsxs(s,{variant:"h4",children:["₱",Number(t.total_received_value).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}):null,Te=()=>{const t=L(),[f,S]=n.useState(0),[j,A]=n.useState(10),[d,P]=n.useState(""),[x,b]=n.useState("All"),[l,y]=n.useState("All"),[I,R]=n.useState({}),[F,k]=n.useState(null),_=n.useRef(),v=$(H),{data:o,isLoading:W,refetch:D}=X({search:d,supplier_id:x||void 0,is_paid:l==="paid"?!0:l==="unpaid"?!1:"All",per_page:j,page:f+1,...I}),{data:E}=Y(),B=Z();n.useEffect(()=>{const i={};d&&(i.search=d),x&&(i.supplier_id=x),l&&(i.is_paid=l==="paid"?!0:l==="unpaid"?!1:"All"),R(i)},[d,x,l]);const z=K.useReactToPrint({contentRef:_}),N=async(i,r)=>{try{await B.mutateAsync({id:i,isPaid:!r}),D()}catch{}},M=(i,r)=>{S(r)},U=i=>{A(parseInt(i.target.value,10)),S(0)},O=()=>{P(""),b("All"),y("All"),R({})};return e.jsxs(ie,{maxWidth:"xxl",sx:{mt:0,px:"0!important"},children:[e.jsx(xe,{stats:E}),e.jsxs(m,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,gap:2},children:[e.jsxs(m,{sx:{display:"flex",gap:2,flex:1},children:[e.jsx(g,{placeholder:"Search by Batch # or PO #",variant:"outlined",size:"small",value:d,onChange:i=>P(i.target.value),InputProps:{startAdornment:e.jsx(q,{position:"start",children:e.jsx(re,{})})},sx:{minWidth:250}}),e.jsxs(g,{select:!0,size:"small",value:x,onChange:i=>b(i.target.value),label:"Filter by Supplier",sx:{minWidth:200},children:[e.jsx(p,{value:"All",children:"All Suppliers"}),v==null?void 0:v.map(i=>e.jsx(p,{value:i.supplier_id,children:i.supplier_name},i.supplier_id))]}),e.jsxs(g,{select:!0,size:"small",value:l,onChange:i=>y(i.target.value),label:"Filter by Status",sx:{minWidth:200},children:[e.jsx(p,{value:"All",children:"All Status"}),e.jsx(p,{value:"paid",children:"Paid"}),e.jsx(p,{value:"unpaid",children:"Unpaid"})]})]}),e.jsxs(m,{children:[e.jsx(T,{variant:"text",color:"error",sx:{mr:1},onClick:O,children:e.jsx(le,{})}),e.jsx(T,{variant:"contained",color:"primary",startIcon:e.jsx(V,{}),onClick:()=>t("/app/purchase"),children:"Purchase Orders"})]})]}),e.jsx(ae,{component:h,children:e.jsxs(se,{children:[e.jsx(te,{children:e.jsxs(u,{children:[e.jsx(a,{children:"Batch Number"}),e.jsx(a,{children:"PO #"}),e.jsx(a,{children:"Supplier"}),e.jsx(a,{children:"Payment Status"}),e.jsx(a,{children:"Total"}),e.jsx(a,{align:"right",children:"Actions"})]})}),e.jsx(ne,{children:W?[...Array(j)].map((i,r)=>e.jsx(de,{},r)):!(o!=null&&o.data)||o.data.length===0?e.jsx(u,{children:e.jsx(a,{colSpan:6,align:"center",sx:{py:3},children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"No receiving reports found"})})}):o.data.map(i=>{var r;return e.jsxs(u,{children:[e.jsxs(a,{children:[e.jsx(s,{children:i.batch_number}),e.jsx(s,{variant:"caption",color:"text.secondary",children:ce(new Date(i.created_at),"MMM dd, yyyy")})]}),e.jsx(a,{children:e.jsx(s,{color:"primary",sx:{cursor:"pointer"},onClick:()=>t(`/app/purchase/${i.po_number}/edit`),children:i.po_number})}),e.jsx(a,{children:(r=i.supplier)==null?void 0:r.supplier_name}),e.jsxs(a,{children:[e.jsx(Q,{label:i.is_paid?"PAID":"UNPAID",color:i.is_paid?"success":"error",size:"small",onClick:()=>N(i.rr_id,i.is_paid),sx:{cursor:"pointer"}}),i.invoice&&e.jsxs(s,{variant:"caption",display:"block",color:"text.secondary",children:["Invoice: ",i.invoice]})]}),e.jsxs(a,{children:["₱",Number(i.total_amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(a,{align:"right",children:[e.jsx(w,{title:"Edit Report",children:e.jsx(C,{onClick:()=>t(`/app/purchase/${i.po_number}/edit`,{state:{reportId:i.rr_id}}),children:e.jsx(G,{style:{fontSize:18}})})}),e.jsx(w,{title:"Print Receiving Report",children:e.jsx(C,{onClick:()=>{k(i),setTimeout(z,100)},children:e.jsx(J,{style:{fontSize:18}})})})]})]},i.rr_id)})})]})}),o&&e.jsx(oe,{rowsPerPageOptions:[5,10,25,50],component:"div",count:o.total||0,rowsPerPage:j,page:f,onPageChange:M,onRowsPerPageChange:U}),e.jsx(ee,{receivingReport:F,contentRef:_})]})};export{Te as default};
