import{r as p,ad as ge,ae as fe,aD as or,Z as G,bl as Or,bm as Mr,bn as Sr,bo as $r,bp as Br,bq as Lr,br as Vr,bs as Y,a5 as M,bt as qr,bu as Q,t as F,bv as Hr,bw as Ur,bx as Gr,by as rr,bz as Kr,bA as Oe,bB as Jr,bC as Yr,bD as Qr,bE as Xr,bF as Zr,bG as en,bH as Ie,bI as Me,bJ as Pe,bK as rn,bL as nn,bM as sn,bN as nr,bO as sr,bP as tr,bQ as tn,bR as an,bS as ln,bT as on,j as e,v as z,T as n,I as W,F as te,l as S,X as ce,H as J,bU as cn,G as c,P as q,D as ze,z as B,C as ee,y as re,J as K,bV as ar,bW as dn,M as un}from"./index-VYacBzdn.js";import{u as Se,w as xn}from"./xlsx-DjuO7_Ju.js";import{D as ae}from"./Dialog-KIaZwdXs.js";import{D as le,a as ie}from"./DialogTitle-sNzQWAp3.js";import{R as ne}from"./CloseOutlined-BzQ1yUQH.js";import{T as O,S as X}from"./TextField-DcFzWKp_.js";import{D as oe}from"./DialogActions-Cf0C3-gn.js";import{R as cr}from"./SaveOutlined-B1L_Y8WW.js";import{I as Z,a as Ae}from"./InputLabel-Cn1m3Ebo.js";import{R as Te}from"./PlusOutlined-NVaeiLU6.js";import{M as C}from"./MenuItem--hotehpj.js";import{R as Ve}from"./DeleteOutlined-CknXjhA9.js";import{A as dr}from"./Alert-Bu5OWhU_.js";import{A as hn}from"./Autocomplete-CTmCWFbU.js";import{f as L,a as ve}from"./currencyFormat-BsuV9MhS.js";import{l as ur}from"./index-akne5vGV.js";import{R as De}from"./PrinterOutlined-Dc6m45c5.js";import{b as he,c as me,d as pe,T as N,a as t,e as je}from"./TableRow-F8UK-irz.js";import{R as mn}from"./ReloadOutlined-3Fa1UV-3.js";import{T as xr,a as we}from"./Tabs-Bx-oxw0i.js";import{R as pn}from"./DownloadOutlined-rKmcsLi2.js";import{R as hr}from"./SearchOutlined-CuhT5l3w.js";import{R as qe}from"./FilterOutlined-9wKfeoPR.js";import{R as Be}from"./EyeOutlined-DxhCRKYA.js";import{R as He}from"./EditOutlined-CdhJH0Bk.js";import{R as mr}from"./CloseCircleOutlined-Bag0VGDw.js";import{D as jn}from"./DialogContentText-D1_q2Iju.js";import{R as gn}from"./WarningOutlined-uBLJgBnp.js";import{R as Le}from"./TeamOutlined-Cr4RwS31.js";import"./Close-aB77mB-e.js";import"./KeyboardArrowRight-CWBZhDWc.js";var fn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 545.5L536.1 163a31.96 31.96 0 00-48.3 0L156 545.5a7.97 7.97 0 006 13.2h81c4.6 0 9-2 12.1-5.5L474 300.9V864c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V300.9l218.9 252.3c3 3.5 7.4 5.5 12.1 5.5h81c6.8 0 10.5-8 6-13.2z"}}]},name:"arrow-up",theme:"outlined"},vn=function(o,a){return p.createElement(ge,fe({},o,{ref:a,icon:fn}))},bn=p.forwardRef(vn),yn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-600-80h56c4.4 0 8-3.6 8-8V560c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v144c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V384c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v320c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V462c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v242c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V304c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v400c0 4.4 3.6 8 8 8z"}}]},name:"bar-chart",theme:"outlined"},_n=function(o,a){return p.createElement(ge,fe({},o,{ref:a,icon:yn}))},En=p.forwardRef(_n),wn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},Tn=function(o,a){return p.createElement(ge,fe({},o,{ref:a,icon:wn}))},ke=p.forwardRef(Tn),Dn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm47.7-395.2l-25.4-5.9V348.6c38 5.2 61.5 29 65.5 58.2.5 4 3.9 6.9 7.9 6.9h44.9c4.7 0 8.4-4.1 8-8.8-6.1-62.3-57.4-102.3-125.9-109.2V263c0-4.4-3.6-8-8-8h-28.1c-4.4 0-8 3.6-8 8v33c-70.8 6.9-126.2 46-126.2 119 0 67.6 49.8 100.2 102.1 112.7l24.7 6.3v142.7c-44.2-5.9-69-29.5-74.1-61.3-.6-3.8-4-6.6-7.9-6.6H363c-4.7 0-8.4 4-8 8.7 4.5 55 46.2 105.6 135.2 112.1V761c0 4.4 3.6 8 8 8h28.4c4.4 0 8-3.6 8-8.1l-.2-31.7c78.3-6.9 134.3-48.8 134.3-124-.1-69.4-44.2-100.4-109-116.4zm-68.6-16.2c-5.6-1.6-10.3-3.1-15-5-33.8-12.2-49.5-31.9-49.5-57.3 0-36.3 27.5-57 64.5-61.7v124zM534.3 677V543.3c3.1.9 5.9 1.6 8.8 2.2 47.3 14.4 63.2 34.4 63.2 65.1 0 39.1-29.4 62.6-72 66.4z"}}]},name:"dollar-circle",theme:"outlined"},An=function(o,a){return p.createElement(ge,fe({},o,{ref:a,icon:Dn}))},Fn=p.forwardRef(An),In={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm47.7-395.2l-25.4-5.9V348.6c38 5.2 61.5 29 65.5 58.2.5 4 3.9 6.9 7.9 6.9h44.9c4.7 0 8.4-4.1 8-8.8-6.1-62.3-57.4-102.3-125.9-109.2V263c0-4.4-3.6-8-8-8h-28.1c-4.4 0-8 3.6-8 8v33c-70.8 6.9-126.2 46-126.2 119 0 67.6 49.8 100.2 102.1 112.7l24.7 6.3v142.7c-44.2-5.9-69-29.5-74.1-61.3-.6-3.8-4-6.6-7.9-6.6H363c-4.7 0-8.4 4-8 8.7 4.5 55 46.2 105.6 135.2 112.1V761c0 4.4 3.6 8 8 8h28.4c4.4 0 8-3.6 8-8.1l-.2-31.7c78.3-6.9 134.3-48.8 134.3-124-.1-69.4-44.2-100.4-109-116.4zm-68.6-16.2c-5.6-1.6-10.3-3.1-15-5-33.8-12.2-49.5-31.9-49.5-57.3 0-36.3 27.5-57 64.5-61.7v124zM534.3 677V543.3c3.1.9 5.9 1.6 8.8 2.2 47.3 14.4 63.2 34.4 63.2 65.1 0 39.1-29.4 62.6-72 66.4z"}}]},name:"dollar",theme:"outlined"},Pn=function(o,a){return p.createElement(ge,fe({},o,{ref:a,icon:In}))},Ce=p.forwardRef(Pn),Rn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file",theme:"outlined"},zn=function(o,a){return p.createElement(ge,fe({},o,{ref:a,icon:Rn}))},kn=p.forwardRef(zn),Cn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 464H528V448h312v128zm0 264H184V184h656v200H496c-17.7 0-32 14.3-32 32v192c0 17.7 14.3 32 32 32h344v200zM580 512a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"wallet",theme:"outlined"},Wn=function(o,a){return p.createElement(ge,fe({},o,{ref:a,icon:Cn}))},Nn=p.forwardRef(Wn);const be=()=>{const r=or(),o=G(Or),a=G(Mr),j=G(Sr),i=G($r),x=G(Br),E=G(Lr),g=G(Vr);return{funds:o,transactions:a,stats:j,balance:i,loading:x,error:E,filters:g,getBalance:async()=>{var _,s;try{r(Y());const l=await M.get("/petty-cash/balance");return r(qr(l.data.data)),l.data.data}catch(l){return console.error("Error fetching petty cash balance:",l),r(Q(l.message)),F.error(((s=(_=l.response)==null?void 0:_.data)==null?void 0:s.message)||"Failed to fetch petty cash balance"),null}},getAllFunds:async(_={})=>{var s,l;try{r(Y());const u={search:g.search||_.search,status:g.status!=="all"?g.status:void 0,date_from:g.startDate||_.startDate,date_to:g.endDate||_.endDate,sort_by:_.sort_by||"date",sort_order:_.sort_order||"desc"},v=await M.get("/petty-cash/funds",{params:u});return r(Hr(v.data.data)),v.data.data}catch(u){return console.error("Error fetching petty cash funds:",u),r(Q(u.message)),F.error(((l=(s=u.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to fetch petty cash funds"),[]}},createFund:async _=>{var s,l;try{r(Y());const v={...(await M.post("/petty-cash/funds",_)).data.data};return r(Ur(v)),F.success("Petty cash fund created successfully"),v}catch(u){throw console.error("Error creating petty cash fund:",u),r(Q(u.message)),F.error(((l=(s=u.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to create petty cash fund"),u}},approveFund:async _=>{var s,l;try{r(Y());const v={...(await M.put(`/petty-cash/funds/${_}/approve`)).data.data};return r(Gr(v)),F.success("Petty cash fund approved successfully"),v}catch(u){throw console.error("Error approving petty cash fund:",u),r(Q(u.message)),F.error(((l=(s=u.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to approve petty cash fund"),u}},getAllTransactions:async(_={})=>{var s,l;try{r(Y());const u={search:g.search||_.search,status:g.status!=="all"?g.status:void 0,employee_id:g.employeeId||_.employeeId,date_from:g.startDate||_.startDate,date_to:g.endDate||_.endDate},v=await M.get("/petty-cash/transactions",{params:u});return r(rr(v.data.data)),v.data.data}catch(u){return console.error("Error fetching petty cash transactions:",u),r(Q(u.message)),F.error(((l=(s=u.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to fetch petty cash transactions"),[]}},createTransaction:async _=>{var s,l;try{r(Y());let u;_ instanceof FormData?u=await M.post("/petty-cash/transactions",_,{headers:{"Content-Type":"multipart/form-data"}}):u=await M.post("/petty-cash/transactions",_);const v={...u.data.data,created_at:new Date().toISOString()};return r(Kr(v)),F.success("Petty cash transaction created successfully"),v}catch(u){throw console.error("Error creating petty cash transaction:",u),r(Q(u.message)),F.error(((l=(s=u.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to create petty cash transaction"),u}},settleTransaction:async(_,s)=>{var l,u;try{r(Y());let v;s instanceof FormData?v=await M.put(`/petty-cash/transactions/${_}/settle`,s,{headers:{"Content-Type":"multipart/form-data"}}):v=await M.put(`/petty-cash/transactions/${_}/settle`,s);const V={...v.data.data};return r(Oe(V)),F.success("Petty cash transaction settled successfully"),V}catch(v){throw console.error("Error settling petty cash transaction:",v),r(Q(v.message)),F.error(((u=(l=v.response)==null?void 0:l.data)==null?void 0:u.message)||"Failed to settle petty cash transaction"),v}},approveTransaction:async _=>{var s,l;try{r(Y());const v={...(await M.put(`/petty-cash/transactions/${_}/approve`)).data.data};return r(Oe(v)),F.success("Petty cash transaction approved successfully"),v}catch(u){throw console.error("Error approving petty cash transaction:",u),r(Q(u.message)),F.error(((l=(s=u.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to approve petty cash transaction"),u}},cancelTransaction:async(_,s)=>{var l,u;try{r(Y());const v=await M.put(`/petty-cash/transactions/${_}/cancel`,{reason:s});return r(Oe(v.data.data)),F.success("Petty cash transaction cancelled successfully"),v.data.data}catch(v){throw console.error("Error cancelling petty cash transaction:",v),r(Q(v.message)),F.error(((u=(l=v.response)==null?void 0:l.data)==null?void 0:u.message)||"Failed to cancel petty cash transaction"),v}},getStats:async()=>{var _,s;try{r(Y());const l=await M.get("/petty-cash/stats");return r(Jr(l.data.data)),l.data.data}catch(l){return console.error("Error fetching petty cash stats:",l),r(Q(l.message)),F.error(((s=(_=l.response)==null?void 0:_.data)==null?void 0:s.message)||"Failed to fetch petty cash statistics"),null}},getEmployeeTransactions:async(_,s={})=>{var l,u;try{r(Y());const v={status:g.status!=="all"?g.status:void 0,date_from:g.startDate||s.startDate,date_to:g.endDate||s.endDate,sort_by:s.sort_by||"date",sort_order:s.sort_order||"desc"},V=await M.get(`/petty-cash/employees/${_}/transactions`,{params:v});return r(rr(V.data.data)),V.data.data}catch(v){return console.error("Error fetching employee transactions:",v),r(Q(v.message)),F.error(((u=(l=v.response)==null?void 0:l.data)==null?void 0:u.message)||"Failed to fetch employee transactions"),[]}}}},Fe=()=>{const r=or(),o=G(Yr),a=G(Qr),j=G(Xr),i=G(Zr),x=G(en);return{employees:o,stats:a,loading:j,error:i,filters:x,getAllEmployees:async(y={})=>{var f,d;try{r(Ie());const h={search:x.search||y.search,status:x.status!=="all"?x.status:void 0,department:x.department!=="all"?x.department:void 0,sort_by:y.sort_by||"created_at",sort_order:y.sort_order||"desc"},A=await M.get("/employees",{params:h});return r(Me(A.data.data)),A.data.data}catch(h){return console.error("Error fetching employees:",h),r(Pe(h.message)),F.error(((d=(f=h.response)==null?void 0:f.data)==null?void 0:d.message)||"Failed to fetch employees"),[]}},getEmployeeById:async y=>{var f,d;try{r(Ie());const h=await M.get(`/employees/${y}`);return r(Me([h.data.data])),h.data.data}catch(h){return console.error("Error fetching employee:",h),r(Pe(h.message)),F.error(((d=(f=h.response)==null?void 0:f.data)==null?void 0:d.message)||"Failed to fetch employee"),null}},createEmployee:async y=>{var f,d;try{r(rn());const h=await M.post("/employees",y);return r(nn(h.data.data)),F.success("Employee created successfully"),h.data.data}catch(h){throw console.error("Error creating employee:",h),r(sn(h.message)),F.error(((d=(f=h.response)==null?void 0:f.data)==null?void 0:d.message)||"Failed to create employee"),h}},updateEmployee:async(y,f)=>{var d,h;try{r(nr());const A=await M.put(`/employees/${y}`,f);return r(sr(A.data.data)),F.success("Employee updated successfully"),A.data.data}catch(A){throw console.error("Error updating employee:",A),r(tr(A.message)),F.error(((h=(d=A.response)==null?void 0:d.data)==null?void 0:h.message)||"Failed to update employee"),A}},deleteEmployee:async y=>{var f,d;try{return r(tn()),await M.delete(`/employees/${y}`),r(an(y)),F.success("Employee deleted successfully"),!0}catch(h){throw console.error("Error deleting employee:",h),r(ln(h.message)),F.error(((d=(f=h.response)==null?void 0:f.data)==null?void 0:d.message)||"Failed to delete employee"),h}},getEmployeeStats:async()=>{var y,f;try{r(Ie());const d=await M.get("/employees/stats");return r(on(d.data.data)),d.data.data}catch(d){return console.error("Error fetching employee statistics:",d),r(Pe(d.message)),F.error(((f=(y=d.response)==null?void 0:y.data)==null?void 0:f.message)||"Failed to fetch employee statistics"),null}},getTrashedEmployees:async()=>{var y,f;try{r(Ie());const d=await M.get("/employees/trashed");return r(Me(d.data.data)),d.data.data}catch(d){return console.error("Error fetching trashed employees:",d),r(Pe(d.message)),F.error(((f=(y=d.response)==null?void 0:y.data)==null?void 0:f.message)||"Failed to fetch trashed employees"),[]}},restoreEmployee:async y=>{var f,d;try{r(nr());const h=await M.post(`/employees/${y}/restore`);return r(sr(h.data.data)),F.success("Employee restored successfully"),h.data.data}catch(h){throw console.error("Error restoring employee:",h),r(tr(h.message)),F.error(((d=(f=h.response)==null?void 0:f.data)==null?void 0:d.message)||"Failed to restore employee"),h}}}},On=({open:r,onClose:o,onSuccess:a})=>{const[j,i]=p.useState({date:new Date().toISOString().split("T")[0],amount:"",description:""}),[x,E]=p.useState({}),{createFund:g,loading:I}=be(),T=b=>{const{name:y,value:f}=b.target;i(d=>({...d,[y]:f})),x[y]&&E(d=>({...d,[y]:null}))},k=()=>{const b={};return j.date||(b.date="Date is required"),j.amount?parseFloat(j.amount)<=0&&(b.amount="Amount must be greater than 0"):b.amount="Amount is required",j.description.trim()||(b.description="Description is required"),E(b),Object.keys(b).length===0},P=async b=>{if(b.preventDefault(),!!k())try{const y={...j,amount:parseFloat(j.amount)},f=await g(y);w(!0,f)}catch(y){console.error("Error adding fund:",y)}},w=(b=!1,y=null)=>{i({date:new Date().toISOString().split("T")[0],amount:"",description:""}),E({}),b?a(y):o()};return e.jsxs(ae,{open:r,onClose:()=>w(),maxWidth:"sm",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(z,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(n,{variant:"h6",children:"Add Petty Cash Fund"}),e.jsx(W,{edge:"end",color:"inherit",onClick:()=>w(),"aria-label":"close",children:e.jsx(ne,{})})]})}),e.jsxs("form",{onSubmit:P,children:[e.jsxs(ie,{children:[e.jsx(O,{margin:"dense",fullWidth:!0,label:"Date",type:"date",name:"date",value:j.date,onChange:T,error:!!x.date,helperText:x.date,InputLabelProps:{shrink:!0}}),e.jsx(O,{margin:"dense",fullWidth:!0,label:"Amount",type:"number",name:"amount",value:j.amount,onChange:T,error:!!x.amount,helperText:x.amount,InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(Ce,{})})}}),e.jsx(O,{margin:"dense",fullWidth:!0,label:"Description",name:"description",value:j.description,onChange:T,error:!!x.description,helperText:x.description,multiline:!0,rows:3})]}),e.jsxs(oe,{children:[e.jsx(S,{onClick:()=>w(),color:"primary",disabled:I,children:"Cancel"}),e.jsx(S,{type:"submit",variant:"contained",color:"primary",disabled:I,startIcon:I?e.jsx(ce,{size:24}):null,children:I?"Submitting...":"Add Fund"})]})]})]})},Mn=({value:r,onChange:o,error:a,helperText:j,name:i="purpose",label:x="Purpose *"})=>{const[E,g]=p.useState([]),[I,T]=p.useState(!1),[k,P]=p.useState(!1),[w,b]=p.useState("");p.useEffect(()=>{y()},[]);const y=async()=>{T(!0);try{const s=await M.get("/purposes");g(s.data.data)}catch(s){console.error("Error loading purposes:",s),F.error("Failed to load purposes")}finally{T(!1)}},f=s=>{console.log(s.target.value),o({target:{name:i,value:s.target.value}})},d=()=>{P(!0)},h=()=>{P(!1),b("")},A=async()=>{var s,l;if(!w.trim()){F.error("Purpose name cannot be empty");return}try{const v=(await M.post("/purposes",{name:w})).data.data;g([...E,v]),o({target:{name:i,value:v.id}}),F.success("Purpose created successfully"),P(!1),b("")}catch(u){console.error("Error creating purpose:",u),F.error(((l=(s=u.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to create purpose")}},_=async(s,l)=>{var u,v;l.stopPropagation();try{await M.delete(`/purposes/${s.id}`),g(E.filter(V=>V.id!==s.id)),r===s.id&&o({target:{name:i,value:""}}),F.success("Purpose deleted successfully")}catch(V){console.error("Error deleting purpose:",V),F.error(((v=(u=V.response)==null?void 0:u.data)==null?void 0:v.message)||"Failed to delete purpose")}};return e.jsx(e.Fragment,{children:k?e.jsxs(z,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[e.jsx(O,{fullWidth:!0,label:"New Purpose Name",value:w,onChange:s=>b(s.target.value),autoFocus:!0,size:"small",margin:"dense"}),e.jsx(W,{color:"primary",onClick:A,size:"small",sx:{mt:1},children:e.jsx(cr,{})}),e.jsx(W,{onClick:h,size:"small",sx:{mt:1},children:e.jsx(ne,{})})]}):e.jsxs(J,{fullWidth:!0,error:!!a,margin:"dense",children:[e.jsx(Z,{id:`${i}-label`,children:x}),e.jsx(X,{labelId:`${i}-label`,value:r||"",onChange:f,label:x,disabled:I,endAdornment:e.jsx(te,{position:"end",children:e.jsx(W,{onClick:d,edge:"end",size:"small",sx:{mr:1},children:e.jsx(Te,{})})}),renderValue:s=>{const l=E.find(u=>u.name===s);return(l==null?void 0:l.name)||""},children:E.length===0?e.jsx(C,{disabled:!0,children:I?"Loading...":"No purposes available"}):E.map(s=>e.jsxs(C,{value:s.name,sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:s.name}),e.jsx(W,{size:"small",color:"error",onClick:l=>_(s,l),children:e.jsx(Ve,{})})]},s.name))}),j&&e.jsx(Ae,{children:j})]})})},Sn=({value:r,onChange:o,error:a,helperText:j,name:i="expense",label:x="Expense *"})=>{const[E,g]=p.useState([]),[I,T]=p.useState(!1),[k,P]=p.useState(!1),[w,b]=p.useState("");p.useEffect(()=>{y()},[]);const y=async()=>{T(!0);try{const s=await M.get("/expenses");g(s.data.data)}catch(s){console.error("Error loading expenses:",s),F.error("Failed to load expenses")}finally{T(!1)}},f=s=>{o({target:{name:i,value:s.target.value}})},d=()=>{P(!0)},h=()=>{P(!1),b("")},A=async()=>{var s,l;if(!w.trim()){F.error("Expense name cannot be empty");return}try{const v=(await M.post("/expenses",{name:w})).data.data;g([...E,v]),o({target:{name:i,value:v.id}}),F.success("Expense created successfully"),P(!1),b("")}catch(u){console.error("Error creating expense:",u),F.error(((l=(s=u.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to create expense")}},_=async(s,l)=>{var u,v;l.stopPropagation();try{await M.delete(`/expenses/${s.id}`),g(E.filter(V=>V.id!==s.id)),r===s.id&&o({target:{name:i,value:""}}),F.success("Expense deleted successfully")}catch(V){console.error("Error deleting expense:",V),F.error(((v=(u=V.response)==null?void 0:u.data)==null?void 0:v.message)||"Failed to delete expense")}};return e.jsx(e.Fragment,{children:k?e.jsxs(z,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[e.jsx(O,{fullWidth:!0,label:"New Expense Name",value:w,onChange:s=>b(s.target.value),autoFocus:!0,size:"small",margin:"dense"}),e.jsx(W,{color:"primary",onClick:A,size:"small",sx:{mt:1},children:e.jsx(cr,{})}),e.jsx(W,{onClick:h,size:"small",sx:{mt:1},children:e.jsx(ne,{})})]}):e.jsxs(J,{fullWidth:!0,error:!!a,margin:"dense",children:[e.jsx(Z,{id:`${i}-label`,children:x}),e.jsx(X,{labelId:`${i}-label`,value:r||"",onChange:f,label:x,disabled:I,endAdornment:e.jsx(te,{position:"end",children:e.jsx(W,{onClick:d,edge:"end",size:"small",sx:{mr:1},children:e.jsx(Te,{})})}),renderValue:s=>{const l=E.find(u=>u.name===s);return(l==null?void 0:l.name)||""},children:E.length===0?e.jsx(C,{disabled:!0,children:I?"Loading...":"No expenses available"}):E.map(s=>e.jsxs(C,{value:s.name,sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:s.name}),e.jsx(W,{size:"small",color:"error",onClick:l=>_(s,l),children:e.jsx(Ve,{})})]},s.name))}),j&&e.jsx(Ae,{children:j})]})})},$n=({open:r,onClose:o,onSuccess:a,employees:j,balance:i})=>{const[x,E]=p.useState({employee_id:"",purpose:"",expense:"",description:"",amount_issued:""}),[g,I]=p.useState({}),{createTransaction:T,loading:k}=be(),P=f=>{const{name:d,value:h}=f.target;E(A=>({...A,[d]:h})),g[d]&&I(A=>({...A,[d]:null}))},w=()=>{const f={};return x.employee_id||(f.employee_id="Employee is required"),x.purpose.trim()||(f.purpose="Purpose is required"),x.expense.trim()||(f.expense="Expense is required"),x.amount_issued?parseFloat(x.amount_issued)<=0?f.amount_issued="Amount must be greater than 0":parseFloat(x.amount_issued)>i&&(f.amount_issued="Amount cannot exceed available balance"):f.amount_issued="Amount is required",I(f),Object.keys(f).length===0},b=async f=>{if(f.preventDefault(),!!w())try{const d={...x,amount_issued:parseFloat(x.amount_issued)},h=await T(d);y(!0,h)}catch(d){console.error("Error adding transaction:",d)}},y=(f=!1,d=null)=>{E({employee_id:"",purpose:"",expense:"",description:"",amount_issued:""}),I({}),f?a(d):o()};return e.jsxs(ae,{open:r,onClose:()=>y(),maxWidth:"sm",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(z,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(n,{variant:"h6",children:"New Petty Cash Transaction"}),e.jsx(W,{edge:"end",color:"inherit",onClick:()=>y(),"aria-label":"close",children:e.jsx(ne,{})})]})}),e.jsxs("form",{onSubmit:b,children:[e.jsxs(ie,{children:[e.jsxs(dr,{severity:"info",sx:{mb:2},children:["Available Balance: ",new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(i)]}),e.jsx(J,{fullWidth:!0,margin:"dense",error:!!g.employee_id,children:e.jsx(hn,{id:"employee-autocomplete",options:j||[],getOptionLabel:f=>`${f.full_name} - ${f.position}`,value:j.find(f=>f.id===x.employee_id)||null,onChange:(f,d)=>{P({target:{name:"employee_id",value:d?d.id:""}})},renderInput:f=>e.jsx(O,{...f,label:"Employee *",error:!!g.employee_id,helperText:g.employee_id,InputProps:{...f.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(te,{position:"start",children:e.jsx(cn,{})}),f.InputProps.startAdornment]})}}),noOptionsText:"No employees available",loading:j.length===0,loadingText:"Loading employees..."})}),e.jsx(Mn,{value:x.purpose,onChange:P,error:!!g.purpose,helperText:g.purpose,name:"purpose",label:"Purpose *"}),e.jsx(Sn,{value:x.expense,onChange:P,error:!!g.expense,helperText:g.expense,name:"expense",label:"Expense Type *"}),e.jsx(O,{margin:"dense",fullWidth:!0,label:"Description",name:"description",value:x.description,onChange:P,multiline:!0,rows:2}),e.jsx(O,{margin:"dense",fullWidth:!0,label:"Amount to Issue *",type:"number",name:"amount_issued",value:x.amount_issued,onChange:P,error:!!g.amount_issued,helperText:g.amount_issued,InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(Ce,{})})}})]}),e.jsxs(oe,{children:[e.jsx(S,{onClick:()=>y(),color:"primary",disabled:k,children:"Cancel"}),e.jsx(S,{type:"submit",variant:"contained",color:"primary",disabled:k||!j.length,startIcon:k?e.jsx(ce,{size:24}):null,children:k?"Submitting...":"Create Transaction"})]})]})]})},pr=({open:r,onClose:o,onSuccess:a,transaction:j})=>{var _;const[i,x]=p.useState({amount_spent:"",amount_returned:"",remarks:"",receipt_attachment:null}),[E,g]=p.useState({}),[I,T]=p.useState(""),[k,P]=p.useState(0),{settleTransaction:w,loading:b}=be();p.useEffect(()=>{j&&(x({amount_spent:"",amount_returned:"",remarks:"",receipt_attachment:null}),g({}),T(""))},[j]),p.useEffect(()=>{if(j&&i.amount_spent){const s=parseFloat(j.amount_issued),l=parseFloat(i.amount_spent)||0,u=s-l;P(u>=0?u:0),u>=0&&x(v=>({...v,amount_returned:Number(u)}))}},[i.amount_spent,j]);const y=s=>{const{name:l,value:u}=s.target;x(v=>({...v,[l]:u})),E[l]&&g(v=>({...v,[l]:null}))},f=s=>{const l=s.target.files[0];if(T(""),l){if(l.size>2*1024*1024){T("File size must be less than 2MB");return}if(!["image/jpeg","image/png","application/pdf"].includes(l.type)){T("Only JPG, PNG, and PDF files are allowed");return}x(v=>({...v,receipt_attachment:l}))}},d=()=>{const s={};if(i.amount_spent?parseFloat(i.amount_spent)<0?s.amount_spent="Amount spent cannot be negative":j&&parseFloat(i.amount_spent)>parseFloat(j.amount_issued)&&(s.amount_spent="Amount spent cannot exceed issued amount"):s.amount_spent="Amount spent is required",i.amount_returned===null||i.amount_returned===""||i.amount_returned===void 0?s.amount_returned="Amount returned is required":parseFloat(i.amount_returned)<0&&(s.amount_returned="Amount returned cannot be negative"),j&&i.amount_spent&&i.amount_returned&&!s.amount_spent&&!s.amount_returned){const l=parseFloat(j.amount_issued),u=parseFloat(i.amount_spent),v=parseFloat(i.amount_returned);Math.abs(u+v-l)>.01&&(s.amount_returned="Total of spent and returned must equal issued amount")}return g(s),Object.keys(s).length===0},h=async s=>{if(s.preventDefault(),!(!d()||I))try{let l;i.receipt_attachment?(l=new FormData,l.append("amount_spent",i.amount_spent),l.append("amount_returned",i.amount_returned),l.append("remarks",i.remarks),l.append("receipt_attachment",i.receipt_attachment)):l={amount_spent:parseFloat(i.amount_spent),amount_returned:parseFloat(i.amount_returned),remarks:i.remarks},await w(j.id,l),A(!0)}catch(l){console.error("Error settling transaction:",l)}},A=(s=!1)=>{x({amount_spent:"",amount_returned:"",remarks:"",receipt_attachment:null}),g({}),T(""),s?a():o()};return j?e.jsxs(ae,{open:r,onClose:()=>A(),maxWidth:"sm",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(z,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(n,{variant:"h6",children:"Settle Transaction"}),e.jsx(W,{edge:"end",color:"inherit",onClick:()=>A(),"aria-label":"close",children:e.jsx(ne,{})})]})}),e.jsxs("form",{onSubmit:h,children:[e.jsxs(ie,{children:[e.jsxs(dr,{severity:"info",sx:{mb:2},children:["Transaction Reference: ",j.transaction_reference,e.jsx("br",{}),"Employee: ",(_=j.employee)==null?void 0:_.full_name,e.jsx("br",{}),"Issued Amount: ",L(j.amount_issued)]}),e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(O,{margin:"dense",fullWidth:!0,label:"Amount Spent *",type:"number",name:"amount_spent",value:i.amount_spent,onChange:y,error:!!E.amount_spent,helperText:E.amount_spent,InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(Ce,{})})}})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(O,{margin:"dense",fullWidth:!0,label:"Amount Returned *",type:"number",name:"amount_returned",value:i.amount_returned,onChange:y,error:!!E.amount_returned,helperText:E.amount_returned,InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(Ce,{})})}})})]}),i.amount_spent&&e.jsxs(n,{variant:"body2",color:"textSecondary",sx:{mt:1},children:["Remaining amount to be returned: ",L(k)]}),e.jsx(O,{margin:"dense",fullWidth:!0,label:"Remarks",name:"remarks",value:i.remarks,onChange:y,multiline:!0,rows:2}),e.jsxs(z,{sx:{mt:2},children:[e.jsx(n,{variant:"body2",gutterBottom:!0,children:"Receipt Attachment"}),e.jsxs(S,{variant:"outlined",component:"label",startIcon:e.jsx(kn,{}),fullWidth:!0,children:["Upload Receipt",e.jsx("input",{type:"file",hidden:!0,accept:"image/jpeg,image/png,application/pdf",onChange:f})]}),i.receipt_attachment&&e.jsxs(n,{variant:"caption",display:"block",sx:{mt:1},children:["Selected file: ",i.receipt_attachment.name]}),I&&e.jsx(Ae,{error:!0,children:I})]})]}),e.jsxs(oe,{children:[e.jsx(S,{onClick:()=>A(),color:"primary",disabled:b,children:"Cancel"}),e.jsx(S,{type:"submit",variant:"contained",color:"primary",disabled:b,startIcon:b?e.jsx(ce,{size:24}):null,children:b?"Submitting...":"Settle Transaction"})]})]})]}):null},Bn=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",lr=({open:r,onClose:o,transaction:a,isNew:j=!1})=>{var g,I,T,k,P,w,b;const i=p.useRef(),x=ur.useReactToPrint({contentRef:i});if(!a)return null;const E=y=>({issued:"ISSUED",settled:"SETTLED",approved:"APPROVED",cancelled:"CANCELLED"})[y]||y.toUpperCase();return e.jsxs(ae,{open:r,onClose:o,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsxs(le,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2},children:[e.jsx(n,{variant:"h6",children:j?"New Transaction Receipt":"Transaction Receipt"}),e.jsxs(z,{children:[e.jsx(W,{color:"primary",onClick:x,sx:{mr:1},children:e.jsx(De,{})}),e.jsx(W,{onClick:o,children:e.jsx(ne,{})})]})]}),e.jsx(ie,{dividers:!0,children:e.jsxs(z,{ref:i,sx:{p:3},children:[e.jsxs(z,{sx:{textAlign:"center",mb:3},children:[e.jsx(n,{variant:"h4",children:"PETTY CASH TRANSACTION"}),e.jsx(n,{variant:"h6",children:a.transaction_reference}),e.jsx(z,{sx:{display:"inline-block",border:1,borderColor:"divider",borderRadius:1,px:2,py:.5,mt:1,backgroundColor:a.status==="approved"?"success.light":a.status==="issued"?"primary.light":a.status==="settled"?"info.light":"error.light"},children:e.jsx(n,{variant:"subtitle1",fontWeight:"bold",children:E(a.status)})})]}),e.jsxs(c,{container:!0,spacing:2,sx:{mb:3},children:[e.jsxs(c,{item:!0,xs:6,children:[e.jsx(n,{children:"Halifax Glass & Aluminum Supply"}),e.jsx(n,{children:"Malagamot Road, Panacan"}),e.jsx(n,{children:"glasshalifax@gmail.com"}),e.jsx(n,{children:"0939 924 3876"})]}),e.jsxs(c,{item:!0,xs:6,sx:{textAlign:"right"},children:[e.jsxs(n,{children:[e.jsx("strong",{children:"Date:"})," ",Bn(a.created_at)]}),e.jsxs(n,{children:[e.jsx("strong",{children:"Purpose:"})," ",a.purpose]}),e.jsxs(n,{children:[e.jsx("strong",{children:"Expense:"})," ",a.expense]}),a.status==="settled"||a.status==="approved"?e.jsxs(n,{children:[e.jsx("strong",{children:"Settled on:"})," ",ve(a.updated_at)]}):null]})]}),e.jsxs(q,{variant:"outlined",sx:{p:2,mb:3},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Employee Information"}),e.jsxs(c,{container:!0,spacing:2,children:[e.jsxs(c,{item:!0,xs:6,children:[e.jsxs(n,{children:[e.jsx("strong",{children:"Name:"})," ",((g=a.employee)==null?void 0:g.full_name)||"N/A"]}),e.jsxs(n,{children:[e.jsx("strong",{children:"Position:"})," ",((I=a.employee)==null?void 0:I.position)||"N/A"]})]}),e.jsxs(c,{item:!0,xs:6,children:[e.jsxs(n,{children:[e.jsx("strong",{children:"Department:"})," ",((T=a.employee)==null?void 0:T.department)||"N/A"]}),e.jsxs(n,{children:[e.jsx("strong",{children:"Contact:"})," ",((k=a.employee)==null?void 0:k.phone_number)||"N/A"]})]})]})]}),e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Transaction Summary"}),e.jsx(he,{component:q,variant:"outlined",sx:{mb:3},children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(N,{children:[e.jsx(t,{children:e.jsx("strong",{children:"Description"})}),e.jsx(t,{align:"right",children:e.jsx("strong",{children:"Amount"})})]})}),e.jsxs(je,{children:[e.jsxs(N,{children:[e.jsx(t,{children:"Amount Issued"}),e.jsx(t,{align:"right",children:L(a.amount_issued)})]}),(a.status==="settled"||a.status==="approved")&&e.jsxs(e.Fragment,{children:[e.jsxs(N,{children:[e.jsx(t,{children:"Amount Spent"}),e.jsx(t,{align:"right",children:L(a.amount_spent)})]}),e.jsxs(N,{children:[e.jsx(t,{children:"Amount Returned"}),e.jsx(t,{align:"right",children:L(a.amount_returned)})]})]})]})]})}),a.description&&e.jsxs(z,{sx:{mb:3},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Description"}),e.jsx(q,{variant:"outlined",sx:{p:2},children:e.jsx(n,{children:a.description})})]}),a.remarks&&e.jsxs(z,{sx:{mb:3},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Remarks"}),e.jsx(q,{variant:"outlined",sx:{p:2},children:e.jsx(n,{children:a.remarks})})]}),e.jsx(ze,{sx:{my:3}}),e.jsxs(c,{container:!0,spacing:4,sx:{mt:3},children:[e.jsx(c,{item:!0,xs:4,children:e.jsxs(z,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:[e.jsx(n,{children:"Issued By"}),e.jsx(n,{variant:"caption",children:((P=a.issuer)==null?void 0:P.name)||"System User"})]})}),e.jsx(c,{item:!0,xs:4,children:e.jsxs(z,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:[e.jsx(n,{children:"Received By"}),e.jsx(n,{variant:"caption",children:((w=a.employee)==null?void 0:w.full_name)||"Employee"})]})}),e.jsx(c,{item:!0,xs:4,children:e.jsxs(z,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:[e.jsx(n,{children:"Approved By"}),e.jsx(n,{variant:"caption",children:a.status==="approved"?((b=a.approver)==null?void 0:b.name)||"Manager":""})]})})]}),e.jsx(z,{sx:{mt:4,textAlign:"center"},children:e.jsx(n,{variant:"caption",color:"textSecondary",children:"This document serves as an official record of petty cash disbursement."})})]})}),e.jsxs(oe,{sx:{p:2},children:[e.jsx(S,{variant:"outlined",startIcon:e.jsx(De,{}),onClick:x,children:"Print Receipt"}),e.jsx(S,{variant:"contained",onClick:o,children:"Close"})]})]})},Re=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",ir=({open:r,onClose:o,fund:a,isNew:j=!1})=>{var g,I,T,k;const i=p.useRef(),x=ur.useReactToPrint({contentRef:i});if(!a)return null;const E=P=>{switch(P){case"approved":return e.jsx(B,{label:"APPROVED",color:"success"});case"pending":return e.jsx(B,{label:"PENDING",color:"warning"});case"rejected":return e.jsx(B,{label:"REJECTED",color:"error"});default:return e.jsx(B,{label:P.toUpperCase()})}};return e.jsxs(ae,{open:r,onClose:o,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsxs(le,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2},children:[e.jsx(n,{variant:"h6",children:j?"New Fund Receipt":"Fund Receipt"}),e.jsxs(z,{children:[e.jsx(W,{color:"primary",onClick:x,sx:{mr:1},children:e.jsx(De,{})}),e.jsx(W,{onClick:o,children:e.jsx(ne,{})})]})]}),e.jsx(ie,{dividers:!0,children:e.jsxs(z,{ref:i,sx:{p:3},children:[e.jsxs(z,{sx:{textAlign:"center",mb:3},children:[e.jsx(n,{variant:"h4",children:"PETTY CASH FUND"}),e.jsx(n,{variant:"h6",children:a.transaction_reference}),e.jsx(z,{sx:{mt:1},children:E(a.status)})]}),e.jsxs(c,{container:!0,spacing:2,sx:{mb:3},children:[e.jsxs(c,{item:!0,xs:6,children:[e.jsx(n,{children:"Halifax Glass & Aluminum Supply"}),e.jsx(n,{children:"Malagamot Road, Panacan"}),e.jsx(n,{children:"glasshalifax@gmail.com"}),e.jsx(n,{children:"0939 924 3876"})]}),e.jsxs(c,{item:!0,xs:6,sx:{textAlign:"right"},children:[e.jsxs(n,{children:[e.jsx("strong",{children:"Created on:"})," ",Re(a.created_at)]}),a.status==="approved"&&e.jsxs(n,{children:[e.jsx("strong",{children:"Approved on:"})," ",Re(a.updated_at)]})]})]}),e.jsxs(q,{variant:"outlined",sx:{p:3,mb:3,textAlign:"center",backgroundColor:a.status==="approved"?"success.light":"background.paper"},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Fund Amount"}),e.jsx(n,{variant:"h3",children:L(a.amount)})]}),e.jsxs(q,{variant:"outlined",sx:{p:2,mb:3},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Description"}),e.jsx(n,{children:a.description})]}),e.jsxs(c,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(c,{item:!0,xs:6,children:e.jsxs(q,{variant:"outlined",sx:{p:2,height:"100%"},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Created By"}),e.jsx(n,{children:((g=a.creator)==null?void 0:g.name)||"System User"}),e.jsx(n,{variant:"caption",color:"textSecondary",children:Re(a.created_at)})]})}),e.jsx(c,{item:!0,xs:6,children:e.jsxs(q,{variant:"outlined",sx:{p:2,height:"100%"},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Approved By"}),a.status==="approved"?e.jsxs(e.Fragment,{children:[e.jsx(n,{children:((I=a.approver)==null?void 0:I.name)||"Manager"}),e.jsx(n,{variant:"caption",color:"textSecondary",children:Re(a.updated_at)})]}):e.jsx(n,{color:"textSecondary",children:"Pending approval"})]})})]}),e.jsx(ze,{sx:{my:3}}),e.jsxs(c,{container:!0,spacing:4,sx:{mt:3},children:[e.jsx(c,{item:!0,xs:6,children:e.jsxs(z,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:[e.jsx(n,{children:"Prepared By"}),e.jsx(n,{variant:"caption",children:((T=a.creator)==null?void 0:T.name)||"System User"})]})}),e.jsx(c,{item:!0,xs:6,children:e.jsxs(z,{sx:{borderTop:"1px solid #000",pt:1,textAlign:"center"},children:[e.jsx(n,{children:"Approved By"}),e.jsx(n,{variant:"caption",children:a.status==="approved"?((k=a.approver)==null?void 0:k.name)||"Manager":""})]})})]}),e.jsx(z,{sx:{mt:4,textAlign:"center"},children:e.jsx(n,{variant:"caption",color:"textSecondary",children:"This document serves as an official record of petty cash fund allocation."})})]})}),e.jsxs(oe,{sx:{p:2},children:[e.jsx(S,{variant:"outlined",startIcon:e.jsx(De,{}),onClick:x,children:"Print Receipt"}),e.jsx(S,{variant:"contained",onClick:o,children:"Close"})]})]})},Ln=()=>{const[r,o]=p.useState(0),[a,j]=p.useState(!1),[i,x]=p.useState(!1),[E,g]=p.useState(!1),[I,T]=p.useState(!1),[k,P]=p.useState(!1),[w,b]=p.useState(null),[y,f]=p.useState(null),[d,h]=p.useState("all"),[A,_]=p.useState(""),[s,l]=p.useState("all"),[u,v]=p.useState(new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString().split("T")[0]),[V,ye]=p.useState(new Date().toISOString().split("T")[0]),[_e,D]=p.useState(!1),[H,R]=p.useState(!1),[jr,Ue]=p.useState(null),[gr,Ge]=p.useState(null),[fr,vr]=p.useState(0),{funds:de,transactions:ue,balance:Ke,getBalance:br,getAllFunds:yr,getAllTransactions:_r,approveFund:Er,approveTransaction:wr,cancelTransaction:Tr,settleTransaction:Dr,loading:Ee}=be(),{employees:Je,getAllEmployees:Ar,loading:Kn}=Fe();p.useEffect(()=>{xe(),Ar()},[r,fr]);const xe=async()=>{try{const m={search:A,status:s!=="all"?s:void 0,startDate:u,endDate:V,employeeId:d!=="all"?d:void 0};r===0?await _r(m):await yr(m),await br()}catch(m){console.error("Error loading data:",m)}},Fr=()=>{vr(m=>m+1)},Ye=()=>{xe()},Ir=(m,$)=>{o($)},Qe=async(m,$)=>{try{if($==="fund"){const se=await Er(m);se&&(f(se),P(!0))}else{const se=await wr(m);se&&(b(se),T(!0))}xe()}catch(se){console.error("Error approving item:",se)}},Pr=async m=>{try{const $=prompt("Please enter a reason for cancellation:");$&&(await Tr(m,$),xe())}catch($){console.error("Error cancelling transaction:",$)}},Rr=m=>{b(m),g(!0)},zr=async m=>{try{const $=await Dr(w.id,m);$&&(g(!1),b($),T(!0),xe())}catch($){console.error("Error settling transaction:",$)}},We=m=>{b(m),T(!0)},Ne=m=>{f(m),P(!0)},kr=m=>{j(!1),Ue(m),D(!0),xe()},Cr=m=>{x(!1),Ge(m),R(!0),xe()},Xe=m=>{switch(m){case"approved":return e.jsx(B,{label:"Approved",color:"success",size:"small"});case"pending":return e.jsx(B,{label:"Pending",color:"warning",size:"small"});case"settled":return e.jsx(B,{label:"Settled",color:"info",size:"small"});case"issued":return e.jsx(B,{label:"Issued",color:"primary",size:"small"});case"cancelled":return e.jsx(B,{label:"Cancelled",color:"error",size:"small"});case"rejected":return e.jsx(B,{label:"Rejected",color:"error",size:"small"});default:return e.jsx(B,{label:m,size:"small"})}},Wr=()=>{try{const m=r===0?ue:de;let $=[];r===0?($.push(["Reference","Date","Employee","Purpose","Expense","Issued Amount","Spent Amount","Returned Amount","Status"]),m.forEach(U=>{var er;$.push([U.transaction_reference||"",ve(U.date)||"",((er=U.employee)==null?void 0:er.full_name)||"",U.purpose||"",U.expense||"",U.amount_issued||0,U.amount_spent||0,U.amount_returned||0,U.status||""])})):($.push(["Reference","Date","Description","Amount","Status"]),m.forEach(U=>{$.push([U.transaction_reference||"",ve(U.date)||"",U.description||"",U.amount||0,U.status||""])}));const se=Se.aoa_to_sheet($),Ze=Se.book_new();Se.book_append_sheet(Ze,se,r===0?"Transactions":"Funds");const Nr=`PettyCash_${r===0?"Transactions":"Funds"}_${new Date().toISOString().split("T")[0]}.xlsx`;xn(Ze,Nr),F.success(`${r===0?"Transactions":"Funds"} exported successfully`)}catch(m){console.error("Error exporting to Excel:",m),F.error("Failed to export data")}};return e.jsxs(z,{children:[e.jsx(ee,{sx:{mb:3},children:e.jsx(re,{children:e.jsxs(c,{container:!0,spacing:3,children:[e.jsxs(c,{item:!0,xs:12,md:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Current Balance"}),e.jsx(n,{variant:"h4",children:L(Ke||0)})]}),e.jsx(c,{item:!0,xs:12,md:6,sx:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(z,{children:[e.jsx(S,{variant:"outlined",color:"primary",startIcon:e.jsx(mn,{}),onClick:Fr,sx:{mr:2},disabled:Ee,children:"Refresh"}),e.jsx(S,{variant:"contained",color:"primary",startIcon:e.jsx(Te,{}),onClick:()=>j(!0),sx:{mr:2},children:"Add Funds"}),e.jsx(S,{variant:"contained",color:"secondary",startIcon:e.jsx(Te,{}),onClick:()=>x(!0),children:"New Transaction"})]})})]})})}),e.jsxs(z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(z,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(xr,{value:r,onChange:Ir,"aria-label":"petty cash sub-tabs",textColor:"primary",indicatorColor:"primary",children:[e.jsx(we,{label:"Transactions",id:"petty-cash-subtab-0"}),e.jsx(we,{label:"Funds",id:"petty-cash-subtab-1"})]})}),e.jsxs(z,{children:[e.jsx(S,{variant:"outlined",color:"primary",startIcon:e.jsx(De,{}),onClick:()=>{r===0&&ue.length>0?We(ue[0]):r===1&&de.length>0?Ne(de[0]):F.info("No records available to view")},sx:{mr:2},disabled:Ee||(r===0?ue.length===0:de.length===0),children:"View Latest"}),e.jsx(S,{variant:"outlined",color:"primary",startIcon:e.jsx(pn,{}),onClick:Wr,disabled:Ee||(r===0?ue.length===0:de.length===0),children:"Export to Excel"})]})]}),e.jsx(q,{sx:{p:2,mb:3},children:e.jsxs(c,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(c,{item:!0,xs:12,md:3,children:e.jsx(O,{fullWidth:!0,placeholder:"Search",value:A,onChange:m=>_(m.target.value),onKeyPress:m=>m.key==="Enter"&&Ye(),InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(hr,{})})},size:"small"})}),e.jsx(c,{item:!0,xs:12,md:2,children:e.jsxs(J,{fullWidth:!0,size:"small",children:[e.jsx(Z,{children:"Status"}),e.jsxs(X,{value:s,onChange:m=>l(m.target.value),label:"Status",children:[e.jsx(C,{value:"all",children:"All Status"}),e.jsx(C,{value:"pending",children:"Pending"}),e.jsx(C,{value:"approved",children:"Approved"}),r===0&&[e.jsx(C,{value:"issued",children:"Issued"},"issued"),e.jsx(C,{value:"settled",children:"Settled"},"settled"),e.jsx(C,{value:"cancelled",children:"Cancelled"},"cancelled")],r===1&&e.jsx(C,{value:"rejected",children:"Rejected"})]})]})}),r===0&&e.jsx(c,{item:!0,xs:12,md:2,children:e.jsxs(J,{fullWidth:!0,size:"small",children:[e.jsx(Z,{children:"Employee"}),e.jsxs(X,{value:d,onChange:m=>h(m.target.value),label:"Employee",children:[e.jsx(C,{value:"all",children:"All Employees"}),[...Je.map(m=>e.jsx(C,{value:m.id,children:m.full_name},m.id))]]})]})}),e.jsx(c,{item:!0,xs:6,md:2,children:e.jsx(O,{label:"Start Date",type:"date",value:u,onChange:m=>v(m.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,size:"small"})}),e.jsx(c,{item:!0,xs:6,md:2,children:e.jsx(O,{label:"End Date",type:"date",value:V,onChange:m=>ye(m.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,size:"small",inputProps:{min:u}})}),e.jsx(c,{item:!0,xs:12,md:1,children:e.jsx(S,{variant:"contained",color:"primary",fullWidth:!0,onClick:Ye,startIcon:e.jsx(qe,{}),children:"Filter"})})]})}),r===1?e.jsx(he,{component:q,children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(N,{children:[e.jsx(t,{children:"Reference"}),e.jsx(t,{children:"Date"}),e.jsx(t,{children:"Description"}),e.jsx(t,{align:"right",children:"Amount"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Created By"}),e.jsx(t,{children:"Actions"})]})}),e.jsx(je,{children:Ee?e.jsx(N,{children:e.jsx(t,{colSpan:7,align:"center",children:e.jsx(ce,{size:24})})}):de.length===0?e.jsx(N,{children:e.jsx(t,{colSpan:7,align:"center",children:"No funds found"})}):de.map(m=>{var $;return e.jsxs(N,{children:[e.jsx(t,{children:e.jsx(n,{component:"span",sx:{cursor:"pointer",color:"primary.main","&:hover":{textDecoration:"underline"}},onClick:()=>Ne(m),children:m.transaction_reference})}),e.jsx(t,{children:ve(m.date)}),e.jsx(t,{children:m.description}),e.jsx(t,{align:"right",children:L(m.amount)}),e.jsx(t,{children:Xe(m.status)}),e.jsx(t,{children:(($=m.creator)==null?void 0:$.name)||"-"}),e.jsxs(t,{children:[e.jsx(K,{title:"View Receipt",children:e.jsx(W,{color:"primary",size:"small",onClick:()=>Ne(m),children:e.jsx(Be,{})})}),m.status==="pending"&&e.jsx(K,{title:"Approve",children:e.jsx(W,{color:"success",size:"small",onClick:()=>Qe(m.id,"fund"),children:e.jsx(ke,{})})})]})]},m.id)})})]})}):e.jsx(he,{component:q,children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(N,{children:[e.jsx(t,{children:"Reference"}),e.jsx(t,{children:"Date"}),e.jsx(t,{children:"Employee"}),e.jsx(t,{children:"Purpose"}),e.jsx(t,{children:"Expense"}),e.jsx(t,{align:"right",children:"Issued"}),e.jsx(t,{align:"right",children:"Spent"}),e.jsx(t,{align:"right",children:"Returned"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Actions"})]})}),e.jsx(je,{children:Ee?e.jsx(N,{children:e.jsx(t,{colSpan:9,align:"center",children:e.jsx(ce,{size:24})})}):ue.length===0?e.jsx(N,{children:e.jsx(t,{colSpan:9,align:"center",children:"No transactions found"})}):ue.map(m=>{var $;return e.jsxs(N,{children:[e.jsx(t,{children:e.jsx(n,{component:"span",sx:{cursor:"pointer",color:"primary.main","&:hover":{textDecoration:"underline"}},onClick:()=>We(m),children:m.transaction_reference})}),e.jsx(t,{children:ve(m.date)}),e.jsx(t,{children:(($=m.employee)==null?void 0:$.full_name)||"-"}),e.jsx(t,{children:m.purpose}),e.jsx(t,{children:m.expense}),e.jsx(t,{align:"right",children:L(m.amount_issued)}),e.jsx(t,{align:"right",children:L(m.amount_spent||0)}),e.jsx(t,{align:"right",children:L(m.amount_returned||0)}),e.jsx(t,{children:Xe(m.status)}),e.jsxs(t,{children:[e.jsx(K,{title:"View Receipt",children:e.jsx(W,{color:"primary",size:"small",onClick:()=>We(m),children:e.jsx(Be,{})})}),m.status==="issued"&&e.jsx(K,{title:"Settle",children:e.jsx(W,{color:"primary",size:"small",onClick:()=>Rr(m),children:e.jsx(He,{})})}),m.status==="settled"&&e.jsx(K,{title:"Approve",children:e.jsx(W,{color:"success",size:"small",onClick:()=>Qe(m.id,"transaction"),children:e.jsx(ke,{})})}),(m.status==="issued"||m.status==="settled")&&e.jsx(K,{title:"Cancel",children:e.jsx(W,{color:"error",size:"small",onClick:()=>Pr(m.id),children:e.jsx(mr,{})})})]})]},m.id)})})]})}),e.jsx(On,{open:a,onClose:()=>j(!1),onSuccess:kr}),e.jsx($n,{open:i,onClose:()=>x(!1),onSuccess:Cr,employees:Je,balance:Ke||0}),e.jsx(pr,{open:E,onClose:()=>{g(!1),b(null)},onSuccess:zr,transaction:w}),e.jsx(ir,{open:k,onClose:()=>{P(!1),f(null)},fund:y}),e.jsx(lr,{open:I,onClose:()=>{T(!1),b(null)},transaction:w}),e.jsx(ir,{open:_e,onClose:()=>{D(!1),Ue(null)},fund:jr,isNew:!0}),e.jsx(lr,{open:H,onClose:()=>{R(!1),Ge(null)},transaction:gr,isNew:!0})]})},Vn=({open:r,onClose:o,onSuccess:a,departments:j=[]})=>{const[i,x]=p.useState({full_name:"",position:"",department:"",email:"",phone_number:"",status:"active"}),[E,g]=p.useState({}),[I,T]=p.useState(""),{createEmployee:k,loading:P}=Fe(),w=d=>{const{name:h,value:A}=d.target;x(_=>({..._,[h]:A})),E[h]&&g(_=>({..._,[h]:null}))},b=()=>{const d={};return i.full_name.trim()||(d.full_name="Full name is required"),i.position.trim()||(d.position="Position is required"),!i.department.trim()&&!I.trim()&&(d.department="Department is required"),i.email&&!/^\S+@\S+\.\S+$/.test(i.email)&&(d.email="Invalid email address"),g(d),Object.keys(d).length===0},y=async d=>{if(d.preventDefault(),!!b())try{const h={...i,department:i.department==="new"?I:i.department};await k(h),f(!0)}catch(h){console.error("Error adding employee:",h)}},f=(d=!1)=>{x({full_name:"",position:"",department:"",email:"",phone_number:"",status:"active"}),T(""),g({}),d?a():o()};return e.jsxs(ae,{open:r,onClose:()=>f(),maxWidth:"sm",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(z,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(n,{variant:"h6",children:"Add Employee"}),e.jsx(W,{edge:"end",color:"inherit",onClick:()=>f(),"aria-label":"close",children:e.jsx(ne,{})})]})}),e.jsxs("form",{onSubmit:y,children:[e.jsx(ie,{children:e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{item:!0,xs:12,children:e.jsx(O,{fullWidth:!0,required:!0,label:"Full Name",name:"full_name",value:i.full_name,onChange:w,error:!!E.full_name,helperText:E.full_name})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(O,{fullWidth:!0,required:!0,label:"Position",name:"position",value:i.position,onChange:w,error:!!E.position,helperText:E.position})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsxs(J,{fullWidth:!0,error:!!E.department,required:!0,children:[e.jsx(Z,{children:"Department"}),e.jsxs(X,{name:"department",value:i.department,onChange:w,label:"Department *",children:[j.map(d=>e.jsx(C,{value:d,children:d},d)),e.jsx(C,{value:"new",children:e.jsx("em",{children:"Add New Department"})})]}),E.department&&e.jsx(Ae,{children:E.department})]})}),i.department==="new"&&e.jsx(c,{item:!0,xs:12,children:e.jsx(O,{fullWidth:!0,required:!0,label:"New Department Name",value:I,onChange:d=>T(d.target.value),error:i.department==="new"&&!I.trim(),helperText:i.department==="new"&&!I.trim()?"New department name is required":""})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(O,{fullWidth:!0,label:"Email",name:"email",type:"email",value:i.email,onChange:w,error:!!E.email,helperText:E.email})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(O,{fullWidth:!0,label:"Phone Number",name:"phone_number",value:i.phone_number,onChange:w})}),e.jsx(c,{item:!0,xs:12,children:e.jsxs(J,{fullWidth:!0,children:[e.jsx(Z,{children:"Status"}),e.jsxs(X,{name:"status",value:i.status,onChange:w,label:"Status",children:[e.jsx(C,{value:"active",children:"Active"}),e.jsx(C,{value:"inactive",children:"Inactive"})]})]})})]})}),e.jsxs(oe,{children:[e.jsx(S,{onClick:()=>f(),color:"primary",disabled:P,children:"Cancel"}),e.jsx(S,{type:"submit",variant:"contained",color:"primary",disabled:P,startIcon:P?e.jsx(ce,{size:24}):null,children:P?"Adding...":"Add Employee"})]})]})]})},qn=({open:r,onClose:o,onSuccess:a,employee:j,departments:i=[]})=>{const[x,E]=p.useState({full_name:"",position:"",department:"",email:"",phone_number:"",status:"active"}),[g,I]=p.useState({}),[T,k]=p.useState(""),{updateEmployee:P,loading:w}=Fe();p.useEffect(()=>{j&&E({full_name:j.full_name||"",position:j.position||"",department:j.department||"",email:j.email||"",phone_number:j.phone_number||"",status:j.status||"active"})},[j]);const b=h=>{const{name:A,value:_}=h.target;E(s=>({...s,[A]:_})),g[A]&&I(s=>({...s,[A]:null}))},y=()=>{const h={};return x.full_name.trim()||(h.full_name="Full name is required"),x.position.trim()||(h.position="Position is required"),!x.department.trim()&&!T.trim()&&(h.department="Department is required"),x.email&&!/^\S+@\S+\.\S+$/.test(x.email)&&(h.email="Invalid email address"),I(h),Object.keys(h).length===0},f=async h=>{if(h.preventDefault(),!(!j||!y()))try{const A={...x,department:x.department==="new"?T:x.department};await P(j.id,A),d(!0)}catch(A){console.error("Error updating employee:",A)}},d=(h=!1)=>{k(""),I({}),h?a():o()};return j?e.jsxs(ae,{open:r,onClose:()=>d(),maxWidth:"sm",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(z,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(n,{variant:"h6",children:"Edit Employee"}),e.jsx(W,{edge:"end",color:"inherit",onClick:()=>d(),"aria-label":"close",children:e.jsx(ne,{})})]})}),e.jsxs("form",{onSubmit:f,children:[e.jsxs(ie,{children:[e.jsx(O,{margin:"dense",fullWidth:!0,label:"Employee Code",value:j.employee_code||"",disabled:!0}),e.jsxs(c,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(c,{item:!0,xs:12,children:e.jsx(O,{fullWidth:!0,required:!0,label:"Full Name",name:"full_name",value:x.full_name,onChange:b,error:!!g.full_name,helperText:g.full_name})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(O,{fullWidth:!0,required:!0,label:"Position",name:"position",value:x.position,onChange:b,error:!!g.position,helperText:g.position})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsxs(J,{fullWidth:!0,error:!!g.department,required:!0,children:[e.jsx(Z,{children:"Department"}),e.jsxs(X,{name:"department",value:x.department,onChange:b,label:"Department *",children:[i.map(h=>e.jsx(C,{value:h,children:h},h)),e.jsx(C,{value:"new",children:e.jsx("em",{children:"Add New Department"})})]}),g.department&&e.jsx(Ae,{children:g.department})]})}),x.department==="new"&&e.jsx(c,{item:!0,xs:12,children:e.jsx(O,{fullWidth:!0,required:!0,label:"New Department Name",value:T,onChange:h=>k(h.target.value),error:x.department==="new"&&!T.trim(),helperText:x.department==="new"&&!T.trim()?"New department name is required":""})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(O,{fullWidth:!0,label:"Email",name:"email",type:"email",value:x.email,onChange:b,error:!!g.email,helperText:g.email})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(O,{fullWidth:!0,label:"Phone Number",name:"phone_number",value:x.phone_number,onChange:b})}),e.jsx(c,{item:!0,xs:12,children:e.jsxs(J,{fullWidth:!0,children:[e.jsx(Z,{children:"Status"}),e.jsxs(X,{name:"status",value:x.status,onChange:b,label:"Status",children:[e.jsx(C,{value:"active",children:"Active"}),e.jsx(C,{value:"inactive",children:"Inactive"})]})]})})]})]}),e.jsxs(oe,{children:[e.jsx(S,{onClick:()=>d(),color:"primary",disabled:w,children:"Cancel"}),e.jsx(S,{type:"submit",variant:"contained",color:"primary",disabled:w,startIcon:w?e.jsx(ce,{size:24}):null,children:w?"Updating...":"Update Employee"})]})]})]}):null},Hn=({open:r,onClose:o,employee:a})=>{const[j,i]=p.useState(new Date(new Date().getFullYear(),new Date().getMonth()-1,1).toISOString().split("T")[0]),[x,E]=p.useState(new Date().toISOString().split("T")[0]),[g,I]=p.useState("all"),[T,k]=p.useState(!1),[P,w]=p.useState(null),{transactions:b,getEmployeeTransactions:y,approveTransaction:f,cancelTransaction:d,loading:h}=be();p.useEffect(()=>{r&&a&&A()},[r,a]);const A=async()=>{if(a)try{const D={status:g!=="all"?g:void 0,startDate:j,endDate:x};await y(a.id,D)}catch(D){console.error("Error loading employee transactions:",D)}},_=()=>{A()},s=async D=>{try{await f(D),A()}catch(H){console.error("Error approving transaction:",H)}},l=async D=>{try{const H=prompt("Please enter a reason for cancellation:");H&&(await d(D,H),A())}catch(H){console.error("Error cancelling transaction:",H)}},u=D=>{w(D),k(!0)},v=D=>{switch(D){case"approved":return e.jsx(B,{label:"Approved",color:"success",size:"small"});case"pending":return e.jsx(B,{label:"Pending",color:"warning",size:"small"});case"settled":return e.jsx(B,{label:"Settled",color:"info",size:"small"});case"issued":return e.jsx(B,{label:"Issued",color:"primary",size:"small"});case"cancelled":return e.jsx(B,{label:"Cancelled",color:"error",size:"small"});default:return e.jsx(B,{label:D,size:"small"})}},V=()=>b.reduce((D,H)=>D+parseFloat(H.amount_issued||0),0),ye=()=>b.reduce((D,H)=>D+parseFloat(H.amount_spent||0),0),_e=()=>b.reduce((D,H)=>D+parseFloat(H.amount_returned||0),0);return a?e.jsxs(e.Fragment,{children:[e.jsxs(ae,{open:r,onClose:o,maxWidth:"md",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(z,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(n,{variant:"h6",children:[a.full_name,"'s Transactions"]}),e.jsx(W,{edge:"end",color:"inherit",onClick:o,"aria-label":"close",children:e.jsx(ne,{})})]})}),e.jsxs(ie,{children:[e.jsx(q,{sx:{p:2,mb:3},children:e.jsxs(c,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(c,{item:!0,xs:12,md:3,children:e.jsx(O,{fullWidth:!0,label:"Start Date",type:"date",value:j,onChange:D=>i(D.target.value),InputLabelProps:{shrink:!0},size:"small"})}),e.jsx(c,{item:!0,xs:12,md:3,children:e.jsx(O,{fullWidth:!0,label:"End Date",type:"date",value:x,onChange:D=>E(D.target.value),InputLabelProps:{shrink:!0},size:"small",inputProps:{min:j}})}),e.jsx(c,{item:!0,xs:12,md:3,children:e.jsxs(J,{fullWidth:!0,size:"small",children:[e.jsx(Z,{children:"Status"}),e.jsxs(X,{value:g,onChange:D=>I(D.target.value),label:"Status",children:[e.jsx(C,{value:"all",children:"All Status"}),e.jsx(C,{value:"issued",children:"Issued"}),e.jsx(C,{value:"settled",children:"Settled"}),e.jsx(C,{value:"approved",children:"Approved"}),e.jsx(C,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx(c,{item:!0,xs:12,md:3,children:e.jsx(S,{variant:"contained",color:"primary",fullWidth:!0,onClick:_,startIcon:e.jsx(qe,{}),children:"Filter"})})]})}),e.jsx(z,{sx:{mb:3},children:e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{item:!0,xs:12,sm:4,children:e.jsxs(q,{sx:{p:2,textAlign:"center"},children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Total Issued"}),e.jsx(n,{variant:"h5",children:L(V())})]})}),e.jsx(c,{item:!0,xs:12,sm:4,children:e.jsxs(q,{sx:{p:2,textAlign:"center"},children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Total Spent"}),e.jsx(n,{variant:"h5",children:L(ye())})]})}),e.jsx(c,{item:!0,xs:12,sm:4,children:e.jsxs(q,{sx:{p:2,textAlign:"center"},children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Total Returned"}),e.jsx(n,{variant:"h5",children:L(_e())})]})})]})}),e.jsx(he,{component:q,children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(N,{children:[e.jsx(t,{children:"Reference"}),e.jsx(t,{children:"Date"}),e.jsx(t,{children:"Purpose"}),e.jsx(t,{align:"right",children:"Issued"}),e.jsx(t,{align:"right",children:"Spent"}),e.jsx(t,{align:"right",children:"Returned"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Actions"})]})}),e.jsx(je,{children:h?e.jsx(N,{children:e.jsx(t,{colSpan:8,align:"center",children:e.jsx(ce,{size:24})})}):b.length===0?e.jsx(N,{children:e.jsx(t,{colSpan:8,align:"center",children:"No transactions found for this period"})}):b.map(D=>e.jsxs(N,{children:[e.jsx(t,{children:D.transaction_reference}),e.jsx(t,{children:ve(D.date)}),e.jsx(t,{children:D.purpose}),e.jsx(t,{align:"right",children:L(D.amount_issued)}),e.jsx(t,{align:"right",children:L(D.amount_spent||0)}),e.jsx(t,{align:"right",children:L(D.amount_returned||0)}),e.jsx(t,{children:v(D.status)}),e.jsxs(t,{children:[D.status==="issued"&&e.jsx(K,{title:"Settle",children:e.jsx(W,{color:"primary",size:"small",onClick:()=>u(D),children:e.jsx(He,{})})}),D.status==="settled"&&e.jsx(K,{title:"Approve",children:e.jsx(W,{color:"success",size:"small",onClick:()=>s(D.id),children:e.jsx(ke,{})})}),(D.status==="issued"||D.status==="settled")&&e.jsx(K,{title:"Cancel",children:e.jsx(W,{color:"error",size:"small",onClick:()=>l(D.id),children:e.jsx(mr,{})})})]})]},D.id))})]})})]}),e.jsx(oe,{children:e.jsx(S,{onClick:o,color:"primary",children:"Close"})})]}),e.jsx(pr,{open:T,onClose:()=>{k(!1),w(null)},onSuccess:()=>{k(!1),w(null),A()},transaction:P})]}):null},Un=()=>{const[r,o]=p.useState(""),[a,j]=p.useState("all"),[i,x]=p.useState("all"),[E,g]=p.useState(!1),[I,T]=p.useState(!1),[k,P]=p.useState(!1),[w,b]=p.useState(null),[y,f]=p.useState(!1),{employees:d,getAllEmployees:h,deleteEmployee:A,stats:_,loading:s}=Fe();p.useEffect(()=>{l()},[]);const l=async()=>{try{await h({search:r,status:a!=="all"?a:void 0,department:i!=="all"?i:void 0})}catch(R){console.error("Error loading employees:",R)}},u=()=>{l()},v=R=>{b(R),T(!0)},V=R=>{b(R),P(!0)},ye=async()=>{if(w)try{await A(w.id),f(!1),b(null),l()}catch(R){console.error("Error deleting employee:",R)}},_e=R=>{b(R),f(!0)},D=()=>!_||!_.departments?[]:_.departments,H=R=>{switch(R){case"active":return e.jsx(B,{label:"Active",color:"success",size:"small"});case"inactive":return e.jsx(B,{label:"Inactive",color:"error",size:"small"});default:return e.jsx(B,{label:R,size:"small"})}};return e.jsxs(z,{children:[e.jsx(ee,{sx:{mb:3},children:e.jsx(re,{children:e.jsxs(c,{container:!0,spacing:3,children:[e.jsxs(c,{item:!0,xs:12,md:6,children:[e.jsx(n,{variant:"h6",children:"Employees Management"}),e.jsx(n,{variant:"body2",color:"textSecondary",children:"Manage employees for petty cash transactions"})]}),e.jsx(c,{item:!0,xs:12,md:6,sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(S,{variant:"contained",color:"primary",startIcon:e.jsx(Te,{}),onClick:()=>g(!0),children:"Add Employee"})})]})})}),e.jsx(q,{sx:{p:2,mb:3},children:e.jsxs(c,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(c,{item:!0,xs:12,md:4,children:e.jsx(O,{fullWidth:!0,placeholder:"Search name, code, position...",value:r,onChange:R=>o(R.target.value),onKeyPress:R=>R.key==="Enter"&&u(),InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(hr,{})})},size:"small"})}),e.jsx(c,{item:!0,xs:12,md:3,children:e.jsxs(J,{fullWidth:!0,size:"small",children:[e.jsx(Z,{children:"Status"}),e.jsxs(X,{value:a,onChange:R=>j(R.target.value),label:"Status",children:[e.jsx(C,{value:"all",children:"All Status"}),e.jsx(C,{value:"active",children:"Active"}),e.jsx(C,{value:"inactive",children:"Inactive"})]})]})}),e.jsx(c,{item:!0,xs:12,md:3,children:e.jsxs(J,{fullWidth:!0,size:"small",children:[e.jsx(Z,{children:"Department"}),e.jsxs(X,{value:i,onChange:R=>x(R.target.value),label:"Department",children:[e.jsx(C,{value:"all",children:"All Departments"}),D().map(R=>e.jsx(C,{value:R,children:R},R))]})]})}),e.jsx(c,{item:!0,xs:12,md:2,children:e.jsx(S,{variant:"contained",color:"primary",fullWidth:!0,onClick:u,startIcon:e.jsx(qe,{}),children:"Filter"})})]})}),e.jsx(he,{component:q,children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(N,{children:[e.jsx(t,{children:"Employee Code"}),e.jsx(t,{children:"Full Name"}),e.jsx(t,{children:"Position"}),e.jsx(t,{children:"Department"}),e.jsx(t,{children:"Contact"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Actions"})]})}),e.jsx(je,{children:s?e.jsx(N,{children:e.jsx(t,{colSpan:7,align:"center",children:"Loading..."})}):d.length===0?e.jsx(N,{children:e.jsx(t,{colSpan:7,align:"center",children:"No employees found"})}):d.map(R=>e.jsxs(N,{children:[e.jsx(t,{children:R.employee_code}),e.jsx(t,{children:R.full_name}),e.jsx(t,{children:R.position}),e.jsx(t,{children:R.department}),e.jsx(t,{children:R.phone_number?e.jsxs("div",{children:[e.jsx("div",{children:R.phone_number}),e.jsx(n,{variant:"caption",color:"textSecondary",children:R.email})]}):R.email}),e.jsx(t,{children:H(R.status)}),e.jsxs(t,{children:[e.jsx(K,{title:"View Transactions",children:e.jsx(W,{color:"primary",size:"small",onClick:()=>V(R),children:e.jsx(Be,{})})}),e.jsx(K,{title:"Edit",children:e.jsx(W,{color:"info",size:"small",onClick:()=>v(R),children:e.jsx(He,{})})}),e.jsx(K,{title:"Delete",children:e.jsx(W,{color:"error",size:"small",onClick:()=>_e(R),children:e.jsx(Ve,{})})})]})]},R.id))})]})}),e.jsxs(ae,{open:y,onClose:()=>f(!1),children:[e.jsx(le,{children:"Confirm Delete"}),e.jsx(ie,{children:e.jsxs(jn,{children:['Are you sure you want to delete the employee "',w==null?void 0:w.full_name,'"? This action cannot be undone.']})}),e.jsxs(oe,{children:[e.jsx(S,{onClick:()=>f(!1),color:"primary",children:"Cancel"}),e.jsx(S,{onClick:ye,color:"error",children:"Delete"})]})]}),e.jsx(Vn,{open:E,onClose:()=>g(!1),onSuccess:()=>{g(!1),l()},departments:D()}),e.jsx(qn,{open:I,onClose:()=>{T(!1),b(null)},onSuccess:()=>{T(!1),b(null),l()},employee:w,departments:D()}),e.jsx(Hn,{open:k,onClose:()=>{P(!1),b(null)},employee:w})]})},Gn=({pettyCashStats:r,employeeStats:o,balance:a})=>{var j;return e.jsxs(z,{children:[e.jsxs(c,{container:!0,spacing:3,mb:2,children:[e.jsx(c,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Fund Usage Rate"}),e.jsxs(n,{variant:"h4",children:[(r==null?void 0:r.total_funds)>0?Math.round((r.total_funds-r.available_balance)/r.total_funds*100):0,"%"]}),e.jsxs(z,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(bn,{style:{color:"#ff4d4f",marginRight:8}}),e.jsxs(n,{variant:"body2",color:"error",children:["Used: ",L((r==null?void 0:r.total_funds)-(r==null?void 0:r.available_balance)||0)]})]})]})})}),e.jsx(c,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Transaction Success Rate"}),e.jsxs(n,{variant:"h4",children:[(r==null?void 0:r.total_transactions)>0?Math.round(r.approved_transactions/r.total_transactions*100):0,"%"]}),e.jsxs(z,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ke,{style:{color:"#52c41a",marginRight:8}}),e.jsxs(n,{variant:"body2",color:"success.main",children:["Approved: ",(r==null?void 0:r.approved_transactions)||0," of ",(r==null?void 0:r.total_transactions)||0]})]})]})})}),e.jsx(c,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Pending Actions"}),e.jsx(n,{variant:"h4",children:((r==null?void 0:r.pending_transactions)||0)+((r==null?void 0:r.settled_transactions)||0)}),e.jsxs(z,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(gn,{style:{color:"#faad14",marginRight:8}}),e.jsxs(n,{variant:"body2",color:"warning.main",children:[(r==null?void 0:r.pending_transactions)||0," pending, ",(r==null?void 0:r.settled_transactions)||0," to approve"]})]})]})})}),e.jsx(c,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Employee Engagement"}),e.jsx(n,{variant:"h4",children:o!=null&&o.active_employees?Math.round(((r==null?void 0:r.total_transactions)||0)/o.active_employees):0}),e.jsxs(z,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Le,{style:{color:"#1890ff",marginRight:8}}),e.jsx(n,{variant:"body2",color:"primary",children:"Avg. transactions per employee"})]})]})})})]}),e.jsxs(c,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsxs(ar,{direction:"row",spacing:2,alignItems:"center",sx:{mb:2},children:[e.jsx(Fn,{style:{fontSize:24}}),e.jsx(n,{variant:"h6",children:"Petty Cash Statistics"})]}),e.jsx(ze,{sx:{mb:2}}),e.jsxs(c,{container:!0,spacing:2,children:[e.jsxs(c,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Available Balance"}),e.jsx(n,{variant:"h5",children:L(a||0)})]}),e.jsxs(c,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Total Funds"}),e.jsx(n,{variant:"h5",children:L((r==null?void 0:r.total_funds)||0)})]}),e.jsxs(c,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Total Issued"}),e.jsx(n,{variant:"h5",color:"error",children:L((r==null?void 0:r.total_issued)||0)})]}),e.jsxs(c,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Total Spent"}),e.jsx(n,{variant:"h5",color:"warning.main",children:L((r==null?void 0:r.total_spent)||0)})]}),e.jsxs(c,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Total Returned"}),e.jsx(n,{variant:"h5",color:"success.main",children:L((r==null?void 0:r.total_returned)||0)})]}),e.jsxs(c,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Pending Funds"}),e.jsx(n,{variant:"h5",color:"info.main",children:L((r==null?void 0:r.pending_funds)||0)})]})]})]})})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsxs(ar,{direction:"row",spacing:2,alignItems:"center",sx:{mb:2},children:[e.jsx(Le,{style:{fontSize:24}}),e.jsx(n,{variant:"h6",children:"Employee Statistics"})]}),e.jsx(ze,{sx:{mb:2}}),e.jsxs(c,{container:!0,spacing:1.5,children:[e.jsxs(c,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Total Employees"}),e.jsx(n,{variant:"h5",children:(o==null?void 0:o.total_employees)||0})]}),e.jsxs(c,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Active Employees"}),e.jsx(n,{variant:"h5",color:"success.main",children:(o==null?void 0:o.active_employees)||0})]}),e.jsxs(c,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Inactive Employees"}),e.jsx(n,{variant:"h5",color:"error",children:(o==null?void 0:o.inactive_employees)||0})]}),e.jsxs(c,{item:!0,xs:6,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",children:"Total Departments"}),e.jsx(n,{variant:"h5",children:((j=o==null?void 0:o.departments)==null?void 0:j.length)||0})]}),e.jsxs(c,{item:!0,xs:12,children:[e.jsx(n,{variant:"subtitle2",color:"textSecondary",gutterBottom:!0,children:"Active Rate"}),e.jsxs(z,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx(z,{sx:{flexGrow:1,mr:2},children:e.jsx(dn,{variant:"determinate",value:o!=null&&o.total_employees?o.active_employees/o.total_employees*100:0,sx:{height:10,borderRadius:5},color:"success"})}),e.jsxs(n,{variant:"body2",sx:{minWidth:"fit-content"},children:[o!=null&&o.total_employees?Math.round(o.active_employees/o.total_employees*100):0,"%"]})]})]})]})]})})})]}),e.jsxs(c,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Transaction Status"}),e.jsx(he,{children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(N,{children:[e.jsx(t,{children:"Status"}),e.jsx(t,{align:"right",children:"Count"}),e.jsx(t,{align:"right",children:"Percentage"})]})}),e.jsxs(je,{children:[e.jsxs(N,{children:[e.jsx(t,{children:e.jsx(B,{label:"Pending",color:"warning",size:"small"})}),e.jsx(t,{align:"right",children:(r==null?void 0:r.pending_transactions)||0}),e.jsxs(t,{align:"right",children:[(r==null?void 0:r.total_transactions)>0?((r==null?void 0:r.pending_transactions)/(r==null?void 0:r.total_transactions)*100).toFixed(1):0,"%"]})]}),e.jsxs(N,{children:[e.jsx(t,{children:e.jsx(B,{label:"Settled",color:"info",size:"small"})}),e.jsx(t,{align:"right",children:(r==null?void 0:r.settled_transactions)||0}),e.jsxs(t,{align:"right",children:[(r==null?void 0:r.total_transactions)>0?((r==null?void 0:r.settled_transactions)/(r==null?void 0:r.total_transactions)*100).toFixed(1):0,"%"]})]}),e.jsxs(N,{children:[e.jsx(t,{children:e.jsx(B,{label:"Approved",color:"success",size:"small"})}),e.jsx(t,{align:"right",children:(r==null?void 0:r.approved_transactions)||0}),e.jsxs(t,{align:"right",children:[(r==null?void 0:r.total_transactions)>0?((r==null?void 0:r.approved_transactions)/(r==null?void 0:r.total_transactions)*100).toFixed(1):0,"%"]})]}),e.jsxs(N,{children:[e.jsx(t,{children:e.jsx(B,{label:"Cancelled",color:"error",size:"small"})}),e.jsx(t,{align:"right",children:(r==null?void 0:r.cancelled_transactions)||0}),e.jsxs(t,{align:"right",children:[(r==null?void 0:r.total_transactions)>0?((r==null?void 0:r.cancelled_transactions)/(r==null?void 0:r.total_transactions)*100).toFixed(1):0,"%"]})]}),e.jsxs(N,{children:[e.jsx(t,{sx:{fontWeight:"bold"},children:"Total"}),e.jsx(t,{align:"right",sx:{fontWeight:"bold"},children:(r==null?void 0:r.total_transactions)||0}),e.jsx(t,{align:"right",sx:{fontWeight:"bold"},children:"100%"})]})]})]})})]})})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(ee,{children:e.jsxs(re,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Department Breakdown"}),o!=null&&o.departments&&o.departments.length>0?e.jsx(he,{children:e.jsxs(me,{size:"small",children:[e.jsx(pe,{children:e.jsxs(N,{children:[e.jsx(t,{children:"Department"}),e.jsx(t,{align:"right",children:"Employees"})]})}),e.jsx(je,{children:o.departments.map(i=>e.jsxs(N,{children:[e.jsx(t,{children:i}),e.jsx(t,{align:"right",children:"-"})]},i))})]})}):e.jsx(n,{variant:"body2",color:"textSecondary",align:"center",sx:{py:4},children:"No department data available"})]})})})]})]})};function $e(r){const{children:o,value:a,index:j,...i}=r;return e.jsx("div",{role:"tabpanel",hidden:a!==j,id:`petty-cash-tabpanel-${j}`,"aria-labelledby":`petty-cash-tab-${j}`,...i,children:a===j&&e.jsx(z,{children:o})})}const Ds=()=>{const[r,o]=p.useState(0),[a,j]=p.useState(!1),{getBalance:i,getStats:x,balance:E,stats:g,loading:I}=be(),{getEmployeeStats:T,stats:k,loading:P}=Fe();p.useEffect(()=>{if(a)return;(async()=>{if(!a)try{await Promise.all([i(),x(),T()]),j(!0)}catch(y){console.error("Error loading data:",y)}})()},[]);const w=(b,y)=>{o(y)};return e.jsxs(un,{children:[e.jsx(z,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(xr,{value:r,onChange:w,"aria-label":"petty cash management tabs",textColor:"primary",indicatorColor:"primary",children:[e.jsx(we,{icon:e.jsx(Nn,{}),iconPosition:"start",label:"Petty Cash",id:"petty-cash-tab-0"}),e.jsx(we,{icon:e.jsx(Le,{}),iconPosition:"start",label:"Employees",id:"petty-cash-tab-1"}),e.jsx(we,{icon:e.jsx(En,{}),iconPosition:"start",label:"Statistics",id:"petty-cash-tab-2"})]})}),e.jsx($e,{value:r,index:0,children:e.jsx(Ln,{})}),e.jsx($e,{value:r,index:1,children:e.jsx(Un,{})}),e.jsx($e,{value:r,index:2,children:e.jsx(Gn,{pettyCashStats:g,employeeStats:k,balance:E})})]})};export{Ds as default};
