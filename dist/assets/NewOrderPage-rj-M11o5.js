import{g as Y,a as Q,s as E,r as l,u as se,aj as Oe,ak as Be,j as e,d as ae,e as Z,c as Te,al as qe,m as oe,b as $,am as Ne,h as xe,i as ge,an as Ge,ao as We,ap as Ue,aq as Ve,ar as fe,as as ye,P as K,at as Ke,au as Ye,av as Qe,aw as Ze,ax as Xe,a8 as X,a9 as J,ay as Je,H as je,I as F,az as et,q as M,E as De,y as tt,aA as nt,T as D,G as I,C as rt,x as st,F as at,D as ot,S as ve,ai as it,ad as lt,aB as ct,Q as dt}from"./index-jDIXAb2S.js";import{g as ut}from"./fileHelper-DtQg9PBz.js";import{T as q,c as Le,d as Ee,e as Fe,a as B,b as y,f as $e,S as pt}from"./TextField-BKTWEUZi.js";import{R as ht,M as pe}from"./SearchOutlined-DwJHkhgR.js";import{D as mt,a as xt,b as gt}from"./DialogTitle-BjmUltT8.js";import{D as ft}from"./DialogActions-DkjioFdp.js";import{B as me,F as yt}from"./InputLabel-GSHbBSGO.js";import{R as be}from"./PlusOutlined-DQ8S9d5x.js";import{C as Ce}from"./CardMedia-sViZBd7L.js";import{c as we,a as re,j as ke,k as jt,F as vt,b as bt,d as H}from"./index.esm-BCiSsmwH.js";import{c as he}from"./cities-nh0Rcspy.js";import{A as Se}from"./Autocomplete-RW7S2nnm.js";import{S as Ct,F as U}from"./FormControlLabel-_UUy1iM0.js";import{R as wt}from"./DeleteOutlined-B5oEMquz.js";import{C as kt}from"./CircularProgress-BLJDyBaP.js";import{R as St,A as Rt}from"./SaveOutlined-BDtn1lEe.js";function Pt(t){return Q("MuiFormGroup",t)}Y("MuiFormGroup",["root","row","error"]);const Mt=t=>{const{classes:r,row:s,error:o}=t;return Z({root:["root",s&&"row",o&&"error"]},Pt,r)},zt=E("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,s.row&&r.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),It=l.forwardRef(function(r,s){const o=se({props:r,name:"MuiFormGroup"}),{className:x,row:j=!1,...S}=o,v=Oe(),f=Be({props:o,muiFormControl:v,states:["error"]}),m={...o,row:j,error:f.error},g=Mt(m);return e.jsx(zt,{className:ae(g.root,x),ownerState:m,ref:s,...S})}),_t=Te(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),Ot=Te(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),Tt=E("span",{shouldForwardProp:qe})({position:"relative",display:"flex"}),qt=E(_t)({transform:"scale(1)"}),Dt=E(Ot)(oe(({theme:t})=>({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}}]})));function Ae(t){const{checked:r=!1,classes:s={},fontSize:o}=t,x={...t,checked:r};return e.jsxs(Tt,{className:s.root,ownerState:x,children:[e.jsx(qt,{fontSize:o,className:s.background,ownerState:x}),e.jsx(Dt,{fontSize:o,className:s.dot,ownerState:x})]})}const He=l.createContext(void 0);function Lt(){return l.useContext(He)}function Et(t){return Q("MuiRadio",t)}const Re=Y("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),Ft=t=>{const{classes:r,color:s,size:o}=t,x={root:["root",`color${$(s)}`,o!=="medium"&&`size${$(o)}`]};return{...r,...Z(x,Et,r)}},$t=E(Ct,{shouldForwardProp:t=>qe(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,s.size!=="medium"&&r[`size${$(s.size)}`],r[`color${$(s.color)}`]]}})(oe(({theme:t})=>({color:(t.vars||t).palette.text.secondary,[`&.${Re.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:xe(t.palette.action.active,t.palette.action.hoverOpacity)}}},...Object.entries(t.palette).filter(ge()).map(([r])=>({props:{color:r,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[r].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:xe(t.palette[r].main,t.palette.action.hoverOpacity)}}})),...Object.entries(t.palette).filter(ge()).map(([r])=>({props:{color:r,disabled:!1},style:{[`&.${Re.checked}`]:{color:(t.vars||t).palette[r].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function At(t,r){return typeof r=="object"&&r!==null?t===r:String(t)===String(r)}const Pe=e.jsx(Ae,{checked:!0}),Me=e.jsx(Ae,{}),V=l.forwardRef(function(r,s){const o=se({props:r,name:"MuiRadio"}),{checked:x,checkedIcon:j=Pe,color:S="primary",icon:v=Me,name:f,onChange:m,size:g="medium",className:w,disabled:P,disableRipple:i=!1,...u}=o,b=Oe();let C=P;b&&typeof C>"u"&&(C=b.disabled),C??(C=!1);const p={...o,disabled:C,disableRipple:i,color:S,size:g},h=Ft(p),n=Lt();let d=x;const z=Ne(m,n&&n.onChange);let _=f;return n&&(typeof d>"u"&&(d=At(n.value,o.value)),typeof _>"u"&&(_=n.name)),e.jsx($t,{type:"radio",icon:l.cloneElement(v,{fontSize:Me.props.fontSize??g}),checkedIcon:l.cloneElement(j,{fontSize:Pe.props.fontSize??g}),disabled:C,ownerState:p,classes:h,name:_,checked:d,onChange:z,ref:s,className:ae(h.root,w),...u})});function Ht(t){return Q("MuiRadioGroup",t)}Y("MuiRadioGroup",["root","row","error"]);const Bt=t=>{const{classes:r,row:s,error:o}=t;return Z({root:["root",s&&"row",o&&"error"]},Ht,r)},Nt=l.forwardRef(function(r,s){const{actions:o,children:x,className:j,defaultValue:S,name:v,onChange:f,value:m,...g}=r,w=l.useRef(null),P=Bt(r),[i,u]=Ge({controlled:m,default:S,name:"RadioGroup"});l.useImperativeHandle(o,()=>({focus:()=>{let h=w.current.querySelector("input:not(:disabled):checked");h||(h=w.current.querySelector("input:not(:disabled)")),h&&h.focus()}}),[]);const b=We(s,w),C=Ue(v),p=l.useMemo(()=>({name:C,onChange(h){u(h.target.value),f&&f(h,h.target.value)},value:i}),[C,f,u,i]);return e.jsx(He.Provider,{value:p,children:e.jsx(It,{role:"radiogroup",ref:b,className:ae(P.root,j),...g,children:x})})});function Gt(t={}){const{autoHideDuration:r=null,disableWindowBlurListener:s=!1,onClose:o,open:x,resumeHideDuration:j}=t,S=Ve();l.useEffect(()=>{if(!x)return;function p(h){h.defaultPrevented||h.key==="Escape"&&(o==null||o(h,"escapeKeyDown"))}return document.addEventListener("keydown",p),()=>{document.removeEventListener("keydown",p)}},[x,o]);const v=fe((p,h)=>{o==null||o(p,h)}),f=fe(p=>{!o||p==null||S.start(p,()=>{v(null,"timeout")})});l.useEffect(()=>(x&&f(r),S.clear),[x,r,f,S]);const m=p=>{o==null||o(p,"clickaway")},g=S.clear,w=l.useCallback(()=>{r!=null&&f(j??r*.5)},[r,j,f]),P=p=>h=>{const n=p.onBlur;n==null||n(h),w()},i=p=>h=>{const n=p.onFocus;n==null||n(h),g()},u=p=>h=>{const n=p.onMouseEnter;n==null||n(h),g()},b=p=>h=>{const n=p.onMouseLeave;n==null||n(h),w()};return l.useEffect(()=>{if(!s&&x)return window.addEventListener("focus",w),window.addEventListener("blur",g),()=>{window.removeEventListener("focus",w),window.removeEventListener("blur",g)}},[s,x,w,g]),{getRootProps:(p={})=>{const h={...ye(t),...ye(p)};return{role:"presentation",...p,...h,onBlur:P(h),onFocus:i(h),onMouseEnter:u(h),onMouseLeave:b(h)}},onClickAway:m}}function Wt(t){return Q("MuiSnackbarContent",t)}Y("MuiSnackbarContent",["root","message","action"]);const Ut=t=>{const{classes:r}=t;return Z({root:["root"],action:["action"],message:["message"]},Wt,r)},Vt=E(K,{name:"MuiSnackbarContent",slot:"Root",overridesResolver:(t,r)=>r.root})(oe(({theme:t})=>{const r=t.palette.mode==="light"?.8:.98,s=Ke(t.palette.background.default,r);return{...t.typography.body2,color:t.vars?t.vars.palette.SnackbarContent.color:t.palette.getContrastText(s),backgroundColor:t.vars?t.vars.palette.SnackbarContent.bg:s,display:"flex",alignItems:"center",flexWrap:"wrap",padding:"6px 16px",borderRadius:(t.vars||t).shape.borderRadius,flexGrow:1,[t.breakpoints.up("sm")]:{flexGrow:"initial",minWidth:288}}})),Kt=E("div",{name:"MuiSnackbarContent",slot:"Message",overridesResolver:(t,r)=>r.message})({padding:"8px 0"}),Yt=E("div",{name:"MuiSnackbarContent",slot:"Action",overridesResolver:(t,r)=>r.action})({display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}),Qt=l.forwardRef(function(r,s){const o=se({props:r,name:"MuiSnackbarContent"}),{action:x,className:j,message:S,role:v="alert",...f}=o,m=o,g=Ut(m);return e.jsxs(Vt,{role:v,square:!0,elevation:6,className:ae(g.root,j),ownerState:m,ref:s,...f,children:[e.jsx(Kt,{className:g.message,ownerState:m,children:S}),x?e.jsx(Yt,{className:g.action,ownerState:m,children:x}):null]})});function Zt(t){return Q("MuiSnackbar",t)}Y("MuiSnackbar",["root","anchorOriginTopCenter","anchorOriginBottomCenter","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft"]);const Xt=t=>{const{classes:r,anchorOrigin:s}=t,o={root:["root",`anchorOrigin${$(s.vertical)}${$(s.horizontal)}`]};return Z(o,Zt,r)},ze=E("div",{name:"MuiSnackbar",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[`anchorOrigin${$(s.anchorOrigin.vertical)}${$(s.anchorOrigin.horizontal)}`]]}})(oe(({theme:t})=>({zIndex:(t.vars||t).zIndex.snackbar,position:"fixed",display:"flex",left:8,right:8,justifyContent:"center",alignItems:"center",variants:[{props:({ownerState:r})=>r.anchorOrigin.vertical==="top",style:{top:8,[t.breakpoints.up("sm")]:{top:24}}},{props:({ownerState:r})=>r.anchorOrigin.vertical!=="top",style:{bottom:8,[t.breakpoints.up("sm")]:{bottom:24}}},{props:({ownerState:r})=>r.anchorOrigin.horizontal==="left",style:{justifyContent:"flex-start",[t.breakpoints.up("sm")]:{left:24,right:"auto"}}},{props:({ownerState:r})=>r.anchorOrigin.horizontal==="right",style:{justifyContent:"flex-end",[t.breakpoints.up("sm")]:{right:24,left:"auto"}}},{props:({ownerState:r})=>r.anchorOrigin.horizontal==="center",style:{[t.breakpoints.up("sm")]:{left:"50%",right:"auto",transform:"translateX(-50%)"}}}]}))),Jt=l.forwardRef(function(r,s){const o=se({props:r,name:"MuiSnackbar"}),x=Ye(),j={enter:x.transitions.duration.enteringScreen,exit:x.transitions.duration.leavingScreen},{action:S,anchorOrigin:{vertical:v,horizontal:f}={vertical:"bottom",horizontal:"left"},autoHideDuration:m=null,children:g,className:w,ClickAwayListenerProps:P,ContentProps:i,disableWindowBlurListener:u=!1,message:b,onBlur:C,onClose:p,onFocus:h,onMouseEnter:n,onMouseLeave:d,open:z,resumeHideDuration:_,TransitionComponent:ee=Xe,transitionDuration:te=j,TransitionProps:{onEnter:N,onExited:G,...ie}={},...le}=o,W={...o,anchorOrigin:{vertical:v,horizontal:f},autoHideDuration:m,disableWindowBlurListener:u,TransitionComponent:ee,transitionDuration:te},ce=Xt(W),{getRootProps:de,onClickAway:ue}=Gt({...W}),[ne,a]=l.useState(!0),R=Qe({elementType:ze,getSlotProps:de,externalForwardedProps:le,ownerState:W,additionalProps:{ref:s},className:[ce.root,w]}),c=O=>{a(!0),G&&G(O)},k=(O,T)=>{a(!1),N&&N(O,T)};return!z&&ne?null:e.jsx(Ze,{onClickAway:ue,...P,children:e.jsx(ze,{...R,children:e.jsx(ee,{appear:!0,in:z,timeout:te,direction:v==="top"?"down":"up",onEnter:k,onExited:c,...ie,children:g||e.jsx(Qt,{message:b,action:S,...i})})})})});var en={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zM464 544H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H212V612h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200z"}}]},name:"appstore",theme:"outlined"},tn=function(r,s){return l.createElement(X,J({},r,{ref:s,icon:en}))},nn=l.forwardRef(tn),rn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 000 13.8z"}}]},name:"menu-fold",theme:"outlined"},sn=function(r,s){return l.createElement(X,J({},r,{ref:s,icon:rn}))},an=l.forwardRef(sn),on={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM142.4 642.1L298.7 519a8.84 8.84 0 000-13.9L142.4 381.9c-5.8-4.6-14.4-.5-14.4 6.9v246.3a8.9 8.9 0 0014.4 7z"}}]},name:"menu-unfold",theme:"outlined"},ln=function(r,s){return l.createElement(X,J({},r,{ref:s,icon:on}))},cn=l.forwardRef(ln),dn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},un=function(r,s){return l.createElement(X,J({},r,{ref:s,icon:dn}))},pn=l.forwardRef(un),hn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},mn=function(r,s){return l.createElement(X,J({},r,{ref:s,icon:hn}))},xn=l.forwardRef(mn);const Ie=({products:t,categories:r,onAddProduct:s,dialogOpen:o,selectedProduct:x,onCloseDialog:j,onMinimize:S,isMinimized:v})=>{const[f,m]=l.useState(""),[g,w]=l.useState("table"),[P,i]=l.useState(t),[u,b]=l.useState(null);l.useEffect(()=>{let n=t;u&&(n=n.filter(d=>d.category===u)),f&&(n=n.filter(d=>d.name.toLowerCase().includes(f.toLowerCase())||d.code.toLowerCase().includes(f.toLowerCase()))),i(n)},[f,t,u]);const C=()=>e.jsx(Le,{sx:{maxHeight:"800px",overflowY:"auto"},children:e.jsxs(Ee,{stickyHeader:!0,size:"small",children:[e.jsx(Fe,{children:e.jsxs(B,{children:[e.jsx(y,{children:"Code"}),e.jsx(y,{children:"Name"}),e.jsx(y,{align:"right",children:"Regular $"}),e.jsx(y,{align:"right",children:"Walk In $"}),e.jsx(y,{align:"right",children:"Whole sale $"}),e.jsx(y,{align:"right",children:"Qty"}),e.jsx(y,{align:"right",children:" "})]})}),e.jsxs($e,{children:[P.map(n=>e.jsxs(B,{children:[e.jsx(y,{sx:{padding:"0px!important"},children:n.code}),e.jsx(y,{sx:{padding:"0px!important"},children:n.name}),e.jsxs(y,{align:"right",sx:{padding:"0px!important"},children:["₱",n.regular_price]}),e.jsxs(y,{align:"right",sx:{padding:"0px!important"},children:["₱",n.walk_in_price]}),e.jsxs(y,{align:"right",sx:{padding:"0px!important"},children:["₱",n.wholesale_price]}),e.jsx(y,{align:"right",sx:{padding:"0px!important"},children:parseInt(n.quantity,10)}),e.jsx(y,{align:"right",sx:{padding:"0px!important"},children:e.jsx(F,{color:"success",onClick:()=>s(n),disabled:n.quantity===0,children:e.jsx(be,{})})})]},n.id)),P.length===0&&e.jsx(B,{children:e.jsx(y,{colSpan:5,align:"center",children:e.jsx(D,{variant:"body2",color:"textSecondary",children:"No products found"})})})]})]})}),p=()=>e.jsx(M,{sx:{height:"calc(100vh - 100px)",overflowY:"auto",p:1},children:e.jsxs(I,{container:!0,spacing:2,children:[P.map(n=>e.jsx(I,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(rt,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[n.product_image?e.jsx(Ce,{component:"img",image:ut(n.product_image),sx:{height:100,bgcolor:n.quantity>0?"primary.white":"grey.300",display:"flex",alignItems:"center",justifyContent:"center",color:"white"}}):e.jsx(Ce,{component:"div",sx:{height:100,bgcolor:n.quantity>0?"primary.light":"grey.300",display:"flex",alignItems:"center",justifyContent:"center",color:"white"},children:e.jsx(D,{variant:"h6",children:n.code})}),e.jsxs(st,{sx:{flexGrow:1},children:[e.jsx(D,{gutterBottom:!0,variant:"subtitle1",component:"div",children:n.name}),e.jsxs(M,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:1},children:[e.jsxs(D,{variant:"body2",color:"text.secondary",children:["Price: ₱",n.regular_price]}),e.jsxs(D,{variant:"body2",color:"text.secondary",children:["Stock: ",n.quantity]})]}),e.jsx(M,{sx:{mt:2},children:e.jsx(me,{variant:"contained",color:"success",fullWidth:!0,startIcon:e.jsx(be,{}),onClick:()=>s(n),disabled:n.quantity===0,children:"Add to Order"})})]})]})},n.id)),P.length===0&&e.jsx(I,{item:!0,xs:12,children:e.jsx(D,{variant:"body2",color:"textSecondary",align:"center",children:"No products found"})})]})}),h=()=>e.jsxs(M,{sx:{p:0,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(M,{sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(q,{fullWidth:!0,variant:"outlined",placeholder:"Search by name or code",size:"small",value:f,onChange:n=>m(n.target.value),InputProps:{startAdornment:e.jsx(De,{position:"start",children:e.jsx(ht,{})})}}),e.jsx(je,{title:"Minimize",children:e.jsx(F,{onClick:S,color:"primary",children:e.jsx(an,{})})})]}),e.jsxs(M,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(M,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:r.map(n=>e.jsx(tt,{label:`${n.name}`,onClick:()=>b(u===n.name?null:n.name),color:u===n.name?"primary":"default",variant:u===n.name?"filled":"outlined"},n.name))}),e.jsxs(M,{children:[e.jsx(F,{onClick:()=>w("table"),color:g==="table"?"primary":"default",children:e.jsx(nt,{})}),e.jsx(F,{onClick:()=>w("card"),color:g==="card"?"primary":"default",children:e.jsx(nn,{})})]})]}),e.jsx(M,{sx:{flexGrow:1,overflow:"hidden"},children:g==="table"?e.jsx(C,{}):e.jsx(p,{})}),e.jsxs(mt,{open:o,onClose:j,children:[e.jsx(xt,{children:"Product Out of Stock"}),e.jsxs(gt,{children:['The product "',x==null?void 0:x.name,'" is currently out of stock.']}),e.jsx(ft,{children:e.jsx(me,{onClick:j,children:"OK"})})]})]});return v?e.jsx(Je,{in:v,children:e.jsx(K,{elevation:6,sx:{position:"absolute",top:25,left:35,zIndex:20,borderRadius:"50%",overflow:"visible",width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"primary.main",color:"white","&:hover":{opacity:.9}},children:e.jsx(je,{title:"Expand Products",children:e.jsx(F,{onClick:S,color:"inherit",sx:{width:"100%",height:"100%"},children:e.jsx(cn,{})})})})}):e.jsx(et,{in:!v,children:e.jsx(K,{sx:{p:2,height:"100%"},children:e.jsx(h,{})})})},_e=t=>t?new Date(t).toISOString().split("T")[0]:"",gn=we().shape({customer:we().nullable().required("Customer is required"),phone:re().required("Phone is required"),address:re().required("Address is required"),city:re().required("City is required"),orderDate:ke().required("Order date is required"),deliveryDate:ke().required("Delivery date is required").min(jt("orderDate"),"Delivery date must be after order date"),paymentMethod:re().required("Payment method is required")}),fn=l.forwardRef(({orderItems:t,totalPrice:r,customers:s,onSubmit:o,onRemoveProduct:x,onQuantityChange:j,onDiscountChange:S,onPriceTypeChange:v,isSubmitting:f=!1},m)=>{const g={customer:null,phone:"",address:"",city:"",business:"",orderDate:_e(new Date),deliveryDate:_e(new Date(Date.now()+864e5)),paymentMethod:"",term_days:null},w=i=>{switch(i.price_type||"regular"){case"walkin":return i.walk_in_price||i.regular_price;case"wholesale":return i.wholesale_price||i.regular_price;case"regular":default:return i.regular_price}},P=i=>{const u=w(i),b=Number(u)*i.quantity,C=parseFloat(i.discount)||0,p=b*(C/100);return b-p};return e.jsx(vt,{initialValues:g,validationSchema:gn,onSubmit:(i,{setSubmitting:u})=>{o(i)},children:({errors:i,touched:u,setFieldValue:b,values:C,isValid:p,dirty:h})=>e.jsxs(bt,{children:[e.jsx("div",{ref:m,children:e.jsxs(M,{sx:{width:"100%",border:m?"1px solid transparent":"none"},children:[e.jsx(M,{sx:{mb:0,textAlign:"center"},children:e.jsx(D,{variant:"h5",gutterBottom:!0,children:"DELIVERY REPORT"})}),e.jsxs(I,{container:!0,spacing:2,sx:{paddingTop:"0!important"},children:[e.jsx(I,{item:!0,xs:12,md:6,sx:{paddingTop:"0!important"},children:e.jsx(H,{name:"customer",component:Se,size:"small",options:s,getOptionLabel:n=>n.customer_name,renderInput:n=>e.jsx(q,{...n,label:"Customer",slotProps:{inputLabel:{sx:{top:"1px"}}},error:u.customer&&!!i.customer,helperText:u.customer&&i.customer,fullWidth:!0,margin:"normal"}),onChange:(n,d)=>{b("customer",d),b("phone",d?d.contact_number:""),b("address",d?d.address:"");const z=he.find(_=>_.name===(d==null?void 0:d.city));b("city",(z==null?void 0:z.name)||""),console.log(z==null?void 0:z.name),b("business",d?d.business_name?d.business_name:"N/A":"")}})}),e.jsx(I,{item:!0,xs:12,md:6,sx:{paddingTop:"0!important"},children:e.jsx(H,{size:"small",slotProps:{inputLabel:{sx:{top:"1px"}}},as:q,name:"business",label:"Business",fullWidth:!0,margin:"normal",error:u.business&&!!i.business,helperText:u.business&&i.business})}),e.jsx(I,{item:!0,xs:12,md:12,sx:{paddingTop:"0!important"},children:e.jsx(H,{size:"small",slotProps:{inputLabel:{sx:{top:"1px"}}},as:q,name:"address",label:"Address",fullWidth:!0,margin:"normal",error:u.address&&!!i.address,helperText:u.address&&i.address})}),e.jsxs(I,{item:!0,xs:12,md:6,sx:{paddingTop:"0!important"},children:[e.jsx(H,{size:"small",slotProps:{inputLabel:{sx:{top:"1px"}}},as:q,name:"phone",label:"Phone",fullWidth:!0,margin:"normal",error:u.phone&&!!i.phone,helperText:u.phone&&i.phone}),e.jsx(H,{size:"small",slotProps:{inputLabel:{sx:{top:"1px"}}},as:q,name:"orderDate",label:"Order Date",type:"date",fullWidth:!0,margin:"normal",InputLabelProps:{shrink:!0},error:u.orderDate&&!!i.orderDate,helperText:u.orderDate&&i.orderDate})]}),e.jsxs(I,{item:!0,xs:12,md:6,sx:{paddingTop:"0!important"},children:[e.jsx(M,{children:e.jsx(Se,{size:"small",options:he,getOptionLabel:n=>`${n.name}`,isOptionEqualToValue:(n,d)=>n.name===(d==null?void 0:d.name),value:he.find(n=>n.name===C.city)||null,onChange:(n,d)=>{b("city",d?d.name:"")},renderInput:n=>e.jsx(q,{...n,slotProps:{inputLabel:{sx:{top:"1px"}}},label:"City",error:u.city&&!!i.city,helperText:u.city&&i.city,fullWidth:!0,margin:"normal"})})}),e.jsx(M,{children:e.jsx(H,{size:"small",slotProps:{inputLabel:{sx:{top:"1px"}}},as:q,name:"deliveryDate",label:"Delivery Date",type:"date",fullWidth:!0,margin:"normal",InputLabelProps:{shrink:!0},error:u.deliveryDate&&!!i.deliveryDate,helperText:u.deliveryDate&&i.deliveryDate})})]}),e.jsx(I,{item:!0,xs:12,md:12,sx:{paddingTop:"0!important"},children:e.jsxs(at,{component:"fieldset",margin:"normal",fullWidth:!0,children:[e.jsx(yt,{component:"legend",children:"Payment Method"}),e.jsxs(Nt,{row:!0,name:"paymentMethod",value:C.paymentMethod,onChange:n=>b("paymentMethod",n.target.value),children:[e.jsx(U,{value:"cod",control:e.jsx(V,{}),label:"COD"}),e.jsx(U,{value:"cash",control:e.jsx(V,{}),label:"Cash"}),e.jsx(U,{value:"cheque",control:e.jsx(V,{}),label:"Cheque"}),e.jsx(U,{value:"online",control:e.jsx(V,{}),label:"Online Payment"}),e.jsx(U,{value:"term",control:e.jsx(V,{}),label:"Term"})]}),u.paymentMethod&&i.paymentMethod&&e.jsx(D,{color:"error",variant:"caption",children:i.paymentMethod})]})})]}),e.jsx(ot,{sx:{mb:1}}),e.jsxs(M,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(D,{variant:"h6",gutterBottom:!0,children:"Order Items"}),C.paymentMethod==="term"&&e.jsx(H,{size:"small",as:q,name:"term_days",label:"Term",type:"number",width:50,sx:{mb:1},slotProps:{inputLabel:{sx:{top:"1px"}}},margin:"small",InputProps:{min:0},error:u.term_days&&!!i.term_days,helperText:u.term_days&&i.term_days})]}),e.jsx(Le,{component:K,sx:{mb:2,maxHeight:"300px",overflow:"auto"},children:e.jsxs(Ee,{size:"small",stickyHeader:!0,children:[e.jsx(Fe,{children:e.jsxs(B,{children:[e.jsx(y,{children:"Product"}),e.jsx(y,{children:"Price Type"}),e.jsx(y,{align:"right",children:"Price"}),e.jsx(y,{align:"center",children:"Qty"}),e.jsx(y,{align:"right",children:"Discount (%)"}),e.jsx(y,{align:"right",children:"Subtotal"}),e.jsx(y,{align:"right"})]})}),e.jsx($e,{children:t.length===0?e.jsx(B,{children:e.jsx(y,{colSpan:7,align:"center",children:"No items added to order"})}):t.map(n=>e.jsxs(B,{children:[e.jsx(y,{children:n.name}),e.jsx(y,{children:e.jsxs(pt,{value:n.price_type||"regular",onChange:d=>v(n.id,d.target.value),size:"small",fullWidth:!0,children:[e.jsx(pe,{value:"regular",children:"Regular"}),e.jsx(pe,{value:"walkin",children:"Walk-in"}),e.jsx(pe,{value:"wholesale",children:"Wholesale"})]})}),e.jsxs(y,{align:"right",children:["₱",Number(w(n)).toFixed(2)]}),e.jsxs(y,{align:"center",sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:[e.jsx(F,{size:"small",onClick:()=>j(n.id,-1),children:e.jsx(pn,{})}),e.jsx(q,{value:n.quantity,onChange:d=>j(n.id,0,parseInt(d.target.value)||0),onKeyDown:d=>{d.key==="ArrowLeft"&&j(n.id,-1),d.key==="ArrowRight"&&j(n.id,1)},inputProps:{style:{textAlign:"center",width:"40px"}},size:"small"}),e.jsx(F,{size:"small",onClick:()=>j(n.id,1),children:e.jsx(xn,{})})]}),e.jsx(y,{align:"right",children:e.jsx(q,{value:n.discount||0,onChange:d=>S(n.id,d.target.value),InputProps:{style:{textAlign:"right",width:"80px"},min:0,max:100,endAdornment:e.jsx(De,{position:"end",children:"%"})},size:"small"})}),e.jsxs(y,{align:"right",children:["₱",P(n).toFixed(2)]}),e.jsx(y,{align:"right",children:e.jsx(F,{onClick:()=>x(n.id),children:e.jsx(wt,{})})})]},n.id))})]})}),e.jsxs(M,{sx:{mt:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(D,{variant:"body2",children:["Payment Method: ",C.paymentMethod.charAt(0).toUpperCase()+C.paymentMethod.slice(1)]}),e.jsxs(D,{variant:"h6",children:["Total Amount: ₱",t.reduce((n,d)=>n+P(d),0).toFixed(2)]})]})]})}),e.jsx(M,{sx:{mt:3},children:e.jsx(M,{sx:{mt:2,display:"flex",justifyContent:"center"},children:e.jsx(me,{type:"submit",variant:"contained",color:"primary",size:"large",fullWidth:!0,startIcon:f?e.jsx(kt,{size:24,color:"inherit"}):e.jsx(St,{}),disabled:t.length===0||f||!p,children:f?"Submitting...":"Submit Delivery Report"})})})]})})}),qn=()=>{const t=ve(it),r=ve(lt),{inventory:s,getAllInventory:o,isInventoryLoading:x,createSale:j,isSalesLoading:S}=ct(),[v,f]=l.useState([]),[m,g]=l.useState([]),[w,P]=l.useState(0),[i,u]=l.useState(!1),[b,C]=l.useState(null),[p,h]=l.useState(!1),[n,d]=l.useState(!1),[z,_]=l.useState({open:!1,message:"",type:"info"}),ee=l.useRef(),te=dt();l.useEffect(()=>{o()},[]),l.useEffect(()=>{s&&s.length>0&&f(s)},[s]),l.useEffect(()=>{const a=m.reduce((R,c)=>{let k;switch(c.price_type||"regular"){case"walkin":k=c.walk_in_price||c.regular_price;break;case"wholesale":k=c.wholesale_price||c.regular_price;break;case"regular":default:k=c.regular_price}const O=Number(k)*c.quantity,T=parseFloat(c.discount)||0,L=O*(T/100);return R+(O-L)},0);P(a)},[m]);const N=()=>{h(!p)},G=a=>{if(a.quantity>0){const R=m.find(c=>c.id===a.id);g(R?m.map(c=>c.id===a.id?{...c,quantity:c.quantity+1}:c):[...m,{...a,quantity:1,discount:0,distribution_price:a.distribution_price||a.cost_price||0,price_type:"regular"}]),f(v.map(c=>c.id===a.id?{...c,quantity:c.quantity-1}:c))}else C(a),u(!0)},ie=a=>{const R=m.find(c=>c.id===a);R&&(g(m.filter(c=>c.id!==a)),f(v.map(c=>c.id===a?{...c,quantity:c.quantity+R.quantity}:c)))},le=(a,R,c=null)=>{g(m.map(k=>{if(k.id===a){const O=k.quantity,T=c!==null?c:Math.max(0,k.quantity+R);return f(v.map(L=>L.id===a?{...L,quantity:L.quantity+(O-T)}:L)),{...k,quantity:T}}return k}).filter(k=>k.quantity>0))},W=(a,R)=>{const c=R===""?0:Math.min(Math.max(0,parseFloat(R)||0),100);g(m.map(k=>k.id===a?{...k,discount:c}:k))},ce=(a,R)=>{g(m.map(c=>c.id===a?{...c,price_type:R}:c))},de=a=>{switch(a.price_type||"regular"){case"walkin":return a.walk_in_price||a.regular_price;case"wholesale":return a.wholesale_price||a.regular_price;case"regular":default:return a.regular_price}},ue=async a=>{var R,c,k,O;if(m.length===0){_({open:!0,message:"Please add at least one item to the order",type:"error"});return}d(!0);try{const T={customer_id:(R=a.customer)==null?void 0:R.id,customer:{id:(c=a.customer)==null?void 0:c.id,customer_name:((k=a.customer)==null?void 0:k.customer_name)||"Walk-in Customer",contact_number:a.phone||"",email:((O=a.customer)==null?void 0:O.email)||"",address:a.address||"",city:a.city||""},payment_method:a.paymentMethod,order_date:a.orderDate,delivery_date:a.deliveryDate,address:a.address,city:a.city,phone:a.phone,amount_received:0,term_days:a.term_days,items:m.map(A=>({product_id:A.id,quantity:A.quantity,distribution_price:A.distribution_price||A.cost_price||0,sold_price:de(A),discount:A.discount||0,price_type:A.price_type||"regular"}))},L=await j(T);L&&(_({open:!0,message:"Sale created successfully!",type:"success"}),g([]),o(),te(`/app/delivery-report/${L.id}`,{state:{reportData:L}}))}catch(T){console.error("Error creating sale:",T),_({open:!0,message:T.message||"Failed to create sale",type:"error"})}finally{d(!1)}},ne=()=>{_(a=>({...a,open:!1}))};return e.jsxs(e.Fragment,{children:[e.jsxs(I,{container:!0,spacing:2,sx:{position:"relative"},children:[!p&&e.jsx(I,{item:!0,xs:12,md:7,sx:{transition:"all 0.3s ease"},children:e.jsx(Ie,{products:v,categories:r,onAddProduct:G,dialogOpen:i,selectedProduct:b,onCloseDialog:()=>u(!1),onMinimize:N,isMinimized:p})}),e.jsx(I,{item:!0,xs:12,md:p?12:5,sx:{transition:"all 0.3s ease",zIndex:1},children:e.jsx(K,{sx:{p:2},children:e.jsx(fn,{ref:ee,orderItems:m,totalPrice:w,customers:t,onSubmit:ue,onRemoveProduct:ie,onQuantityChange:le,onDiscountChange:W,onPriceTypeChange:ce,isSubmitting:n})})}),p&&e.jsx(Ie,{products:v,categories:r,onAddProduct:G,dialogOpen:i,selectedProduct:b,onCloseDialog:()=>u(!1),onMinimize:N,isMinimized:p})]}),e.jsx(Jt,{open:z.open,autoHideDuration:6e3,onClose:ne,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(Rt,{onClose:ne,severity:z.type,sx:{width:"100%"},children:z.message})})]})};export{qn as default};
